this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};this.BX.UI.AccessRights=this.BX.UI.AccessRights||{};(function(e,t,s,i,r,o,a,l,n,c,u,d,h,p,g,v,b,m,S,f,y){"use strict";class C{getComponentName(){throw new Error("not implemented")}getEmptyValue(e){var t;return(t=e.emptyValue)!=null?t:new Set}getMinValue(e){if(!f.Type.isNil(e.minValue)){return e.minValue}return null}getMaxValue(e){if(!f.Type.isNil(e.maxValue)){return e.maxValue}return null}isRowValueConfigurable(){return true}}class I extends C{getComponentName(){return"DependentVariables"}}class P extends C{getComponentName(){return"Multivariables"}}class L extends C{getComponentName(){return"Toggler"}getEmptyValue(e){const t=!e.emptyValue||!e.emptyValue[0];if(t){return new Set(["0"])}return super.getEmptyValue(e)}getMinValue(e){const t=super.getMinValue(e);if(!f.Type.isNull(t)){return t}return new Set(["0"])}getMaxValue(e){const t=super.getMaxValue(e);if(!f.Type.isNull(t)){return t}return new Set(["1"])}isRowValueConfigurable(){return false}}class M extends C{getComponentName(){return"Variables"}}const R=Object.freeze({ROLE:"ui.accessrights.v2~role-selector",MEMBER:"ui.accessrights.v2~member-selector",VARIABLE:"ui.accessrights.v2~variable-selector",USER:"ui.accessrights.v2~user-selector"});const H=Object.freeze({ROLE:"ui.accessrights.v2~role",VARIABLE:"ui.accessrights.v2~variable"});const B=Object.freeze({TEAM:"team",DEPARTMENT:"department"});const w=Object.freeze({[B.DEPARTMENT]:{commonPrefix:"SND",recursivePrefix:"SNDR",memberType:"structuredepartments"},[B.TEAM]:{commonPrefix:"SNT",recursivePrefix:"SNTR",memberType:"structureteams"}});var F=babelHelpers.classPrivateFieldLooseKey("options");class V{constructor(e){Object.defineProperty(this,F,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e}createDialog(e){var t;return new l.Dialog({...e,context:R.MEMBER,enableSearch:true,alwaysShowLabels:true,cacheable:false,entities:(t=e.entities)!=null?t:this.entities()})}entities(){const e=[{id:"user",options:{intranetUsersOnly:true,emailUsers:false,inviteEmployeeLink:false,inviteGuestLink:false}}];const t=[];if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].useStructureDepartmentsProviderTab){t.push("department")}if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].addStructureTeamsProviderTab){t.push("team")}if(t.length>0){e.push({id:"structure-node",options:{selectMode:"usersAndDepartments",allowSelectRootDepartment:true,allowFlatDepartments:true,includedNodeEntityTypes:t,useMultipleTabs:true,visual:{avatarMode:"node",tagStyle:"none"}}})}if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F].useStructureDepartmentsProviderTab){e.push({id:"department",options:{selectMode:"usersAndDepartments",allowSelectRootDepartment:true,allowFlatDepartments:true}})}e.push({id:"site-groups",dynamicLoad:true,dynamicSearch:true});if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].addStructureRolesProviderTab){e.push({id:"structure-role",options:{includedNodeEntityTypes:["team","department"]},dynamicLoad:true,dynamicSearch:true})}if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].addProjectsProviderTab){e.push({id:"project-access-codes"})}if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].addUserGroupsProviderTab){e.push({id:"user-groups",dynamicLoad:true,options:{}})}return e}getItemIdByAccessCode(e){if(/^I?U(\d+)$/.test(e)){const t=e.match(/^I?U(\d+)$/)||null;const s=t?t[1]:null;return["user",s]}if(/^DR(\d+)$/.test(e)){const t=e.match(/^DR(\d+)$/)||null;const s=t?t[1]:null;return["department",s]}if(/^D(\d+)$/.test(e)){const t=e.match(/^D(\d+)$/)||null;const s=t?t[1]:null;return["department",`${s}:F`]}if(/^G(\d+)$/.test(e)){const t=e.match(/^G(\d+)$/)||null;const s=t?t[1]:null;return["site-groups",s]}if(/^(?:ATD|ATE|ATT|AD|AE|AT)[1-9]\d*$/.test(e)){return["structure-role",e]}if(e.at(0)==="A"){return["user-groups",e]}if(/^SG(\d+)_([AEK])$/.test(e)){return["project-access-codes",e]}if(/^SNT(\d+)$/.test(e)){const t=e.match(/^SNT(\d+)$/)||null;const s=t?t[1]:null;return["structure-node",`${s}:F`]}if(/^SNTR(\d+)$/.test(e)){const t=e.match(/^SNTR(\d+)$/)||null;const s=t?t[1]:null;return["structure-node",s]}if(/^SND(\d+)$/.test(e)){const t=e.match(/^SND(\d+)$/)||null;const s=t?t[1]:null;return["structure-node",`${s}:F`]}if(/^SNDR(\d+)$/.test(e)){const t=e.match(/^SNDR(\d+)$/)||null;const s=t?t[1]:null;return["structure-node",s]}return["unknown",e]}getMemberTypeByItem(e){switch(e.entityId){case"user":return"users";case"intranet":case"department":return"departments";case"socnetgroup":case"project-access-codes":return"sonetgroups";case"group":return"groups";case"structure-node":return this.getItemStructureNodeEntityTypeInfo(e,B.TEAM).memberType;case"site-groups":case"user-groups":case"structure-role":return"usergroups";default:return""}}getItemStructureNodeEntityTypeInfo(e,t){var s,i;const r=Object.values(B);let o=(s=e.getCustomData().get("nodeEntityType"))!=null?s:"";if(r.includes(o)){return w[o]}const a=(i=e.getCustomData().get("accessCode"))!=null?i:"";Object.entries(w).forEach((([e,t])=>{if(a.startsWith(t.commonPrefix)){o=e}}));if(!r.includes(o)){o=t}return w[o]}getAccessCodeByItem(e){const t=e.entityId;if(t==="user"){return`U${e.id}`}if(t==="department"){if(f.Type.isString(e.id)&&e.id.endsWith(":F")){const t=e.id.match(/^(\d+):F$/);const s=t?t[1]:null;return`D${s}`}return`DR${e.id}`}if(t==="structure-node"){const t=this.getItemStructureNodeEntityTypeInfo(e,B.TEAM);if(f.Type.isString(e.id)&&e.id.endsWith(":F")){const s=e.id.match(/^(\d+):F$/);const i=s?s[1]:null;const r=t.commonPrefix;return`${r}${i}`}const s=t.recursivePrefix;return`${s}${e.id}`}if(t==="site-groups"){return`G${e.id}`}if(t==="structure-role"){return e.id}if(t==="user-groups"){return e.id}if(t==="project-access-codes"){return e.id}return""}getItemIdsByAccessCodes(e){const t=new Map;e.forEach((e=>{t.set(e,this.getItemIdByAccessCode(e))}));return t}getMemberByItem(e){return{id:this.getAccessCodeByItem(e),type:this.getMemberTypeByItem(e),name:e.title.text,avatar:f.Type.isStringFilled(e.avatar)?e.avatar:null}}}var T=babelHelpers.classPrivateFieldLooseKey("cache");class E{static getHint(e){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember(`hint-${e}`,(()=>BX.UI.Hint.createInstance({id:`ui-access-rights-v2-hint-${e}`,classNameIcon:"ui-icon-set --o-question",popupParameters:{className:"ui-access-rights-v2-popup-pointer-events ui-hint-popup",autoHide:true,darkMode:true,maxWidth:280,offsetTop:0,offsetLeft:8,angle:true,animation:"fading-slide"}})))}static getValueTypeByRight(e){return this.getValueType(e.type)}static getValueType(e){const t=String(e);return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember(t,(()=>{if(t==="dependent_variables"){return new I}if(t==="multivariables"){return new P}if(t==="toggler"){return new L}if(t==="variables"){return new M}console.warn("ui.accessrights.v2: Unknown access right type",e);return null}))}static getSelectorService(e){return new V(e)}}Object.defineProperty(E,T,{writable:true,value:new f.Cache.MemoryCache});const A={name:"Selector",emits:["close"],props:{userGroup:{type:Object,required:true},bindNode:{type:HTMLElement,required:true}},computed:{selectedItems(){const e=[];for(const t of this.userGroup.members.keys()){e.push(this.getSelectorService().getItemIdByAccessCode(t))}return e},...m.mapState({options:e=>e.application.options,memberOptions:e=>e.application.options.additionalMembersParams})},mounted(){this.getSelectorService().createDialog({targetNode:this.bindNode,preselectedItems:this.selectedItems,events:{onHide:this.onHide}}).show()},methods:{onHide(e){const t=e.getTarget();const s=[];t.selectedItems.forEach((e=>{s.push(this.getSelectorService().getMemberByItem(e))}));this.$store.dispatch("userGroups/updateMembersForUserGroup",{userGroupId:this.userGroup.id,members:s});this.$emit("close")},getMemberFromEvent(e){const{item:t}=e.getData();return this.getSelectorService().getMemberByItem(t)},getSelectorService(){return E.getSelectorService(this.memberOptions)}},template:"<div hidden></div>"};const _={name:"SingleMember",props:{member:{type:Object,required:true}},computed:{avatarBackgroundImage(){return`url('${encodeURI(this.member.avatar)}')`},noAvatarClass(){if(this.member.type==="groups"){return"ui-icon-common-user-group"}if(this.member.type==="sonetgroups"||this.member.type==="departments"||this.member.type==="structuredepartments"){return"ui-icon-common-company"}if(this.member.type==="usergroups"){return"ui-icon-common-user-group"}if(this.member.type==="structureteams"){return"ui-icon-common-my-plan"}return"ui-icon-common-user"},memberTitle(){if(f.Type.isStringFilled(this.member.name)){return this.member.name}return""}},template:`\n\t\t<div class='ui-access-rights-v2-members-item'>\n\t\t\t<a\n\t\t\t\tv-if="member.avatar"\n\t\t\t\tclass='ui-access-rights-v2-members-item-avatar'\n\t\t\t\t:title="memberTitle"\n\t\t\t\t:style="{\n\t\t\t\t\t\tbackgroundImage: avatarBackgroundImage,\n\t\t\t\t\t\tbackgroundSize: 'cover',\n\t\t\t\t\t}"\n\t\t\t>\n\t\t\t</a>\n\t\t\t<a v-else class='ui-icon ui-access-rights-v2-members-item-icon' :class="noAvatarClass" :title="memberTitle">\n\t\t\t\t<i></i>\n\t\t\t</a>\n\t\t</div>\n\t`};const G=5;const x={name:"Members",components:{SingleMember:_,Selector:A},props:{userGroup:{type:Object,required:true}},data(){return{isSelectorShown:false,isSelectedMembersPopupShown:false}},popup:null,computed:{shownMembers(){if(this.userGroup.members.size<=G){return this.userGroup.members}const e=[...this.userGroup.members].slice(0,G);return new Map(e)},notShownMembersCount(){if(this.userGroup.members.size>G){return this.userGroup.members.size-G}return 0},bindNode(){return this.$refs.container}},template:`\n\t\t<div ref="container" class="ui-access-rights-v2-members-container"  @click="isSelectorShown = true">\n\t\t\t<div v-if="userGroup.members.size > 0" class='ui-access-rights-v2-members'>\n\t\t\t\t<SingleMember v-for="[accessCode, member] in shownMembers" :key="accessCode" :member="member"/>\n\t\t\t\t<span v-if="notShownMembersCount > 0" class="ui-access-rights-v2-members-more">\n\t\t\t\t\t+ {{ notShownMembersCount }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass='ui-access-rights-v2-members-item ui-access-rights-v2-members-item-add'\n\t\t\t\t:class="{\n\t\t\t\t\t'--show-always': userGroup.members.size <= 0,\n\t\t\t\t\t'--has-siblings': userGroup.members.size > 0,\n\t\t\t\t}"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --plus-m"></div>\n\t\t\t</div>\n\t\t\t<Selector\n\t\t\t\tv-if="isSelectorShown"\n\t\t\t\t:user-group="userGroup"\n\t\t\t\t:bind-node="bindNode"\n\t\t\t\t@close="isSelectorShown = false"\n\t\t\t/>\n\t\t</div>\n\t`};const O={name:"RoleHeading",components:{RichMenuPopup:p.RichMenuPopup,RichMenuItem:p.RichMenuItem},props:{userGroup:{type:Object,required:true}},data(){return{isEdit:false,isPopupShown:false}},computed:{RichMenuItemIcon:()=>p.RichMenuItemIcon,...m.mapState({isProgress:e=>e.application.isProgress,guid:e=>e.application.guid,maxVisibleUserGroups:e=>e.application.options.maxVisibleUserGroups}),...m.mapGetters({isMaxVisibleUserGroupsReached:"userGroups/isMaxVisibleUserGroupsReached",isMaxValueSetForAny:"accessRights/isMaxValueSetForAny",isMinValueSetForAny:"accessRights/isMinValueSetForAny"}),title:{get(){return this.userGroup.title},set(e){this.$store.dispatch("userGroups/setRoleTitle",{userGroupId:this.userGroup.id,title:e})}}},watch:{isEdit(e){if(e===true){this.bindClickedOutsideHandler();void this.$nextTick((()=>{this.$refs.input.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"});this.$refs.input.focus();this.$refs.input.select()}))}else{this.unbindClickedOutsideHandler()}}},mounted(){if(this.userGroup.isNew){this.isEdit=true}},beforeUnmount(){this.unbindClickedOutsideHandler()},methods:{bindClickedOutsideHandler(){f.Event.bind(window,"click",this.turnOffEditWhenClickedOutside,{capture:true})},unbindClickedOutsideHandler(){f.Event.unbind(window,"click",this.turnOffEditWhenClickedOutside,{capture:true})},turnOffEditWhenClickedOutside(e){if(e.target!==this.$refs.input){this.isEdit=false}},showDeleteConfirmation(){const e=new u.Popup({bindElement:this.$refs.container,width:250,overlay:true,contentPadding:10,content:this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_POPUP_REMOVE_ROLE"),className:"ui-access-rights-v2-text-center",animation:"fading-slide",cacheable:false,buttons:[new o.Button({text:this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_POPUP_REMOVE_ROLE_YES"),size:o.ButtonSize.SMALL,color:o.ButtonColor.PRIMARY,events:{click:()=>{e.destroy();this.$store.dispatch("userGroups/removeUserGroup",{userGroupId:this.userGroup.id})}}}),new o.CancelButton({text:this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_CANCEL"),size:o.ButtonSize.SMALL,events:{click:()=>{e.destroy()}}})]});e.show()},showActionsMenu(){if(!this.isProgress){this.isPopupShown=true}},onSetMaxValuesClick(){this.isPopupShown=false;this.$store.dispatch("userGroups/setMaxAccessRightValues",{userGroupId:this.userGroup.id})},onSetMinValuesClick(){this.isPopupShown=false;this.$store.dispatch("userGroups/setMinAccessRightValues",{userGroupId:this.userGroup.id})},onEnableEditClick(){this.isPopupShown=false;this.isEdit=true},onCopyRoleClick(){if(this.isMaxVisibleUserGroupsReached){return}this.isPopupShown=false;this.$store.dispatch("userGroups/copyUserGroup",{userGroupId:this.userGroup.id})},onDeleteRoleClick(){this.isPopupShown=false;this.showDeleteConfirmation()}},template:`\n\t\t<div ref="container" class='ui-access-rights-v2-role'>\n\t\t\t<div class="ui-access-rights-v2-role-value-container">\n\t\t\t\t<input\n\t\t\t\t\tv-if="isEdit && !isProgress"\n\t\t\t\t\tref="input"\n\t\t\t\t\ttype='text'\n\t\t\t\t\tclass='ui-access-rights-v2-role-input'\n\t\t\t\t\tv-model="title"\n\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_NAME')"\n\t\t\t\t\t@keydown.enter="isEdit = false"\n\t\t\t\t/>\n\t\t\t\t<div v-else class='ui-access-rights-v2-role-value' :title="title">{{ title }}</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tref="menu"\n\t\t\t\tclass="ui-icon-set --more-l ui-access-rights-v2-icon-more"\n\t\t\t\tstyle="position: absolute; right: 11px; top: 5px;"\n\t\t\t\t@click="showActionsMenu"\n\t\t\t>\n\t\t\t\t<RichMenuPopup v-if="isPopupShown" @close="isPopupShown = false" :popup-options="{bindElement: $refs.menu}">\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\tv-if="isMaxValueSetForAny"\n\t\t\t\t\t\t:icon="RichMenuItemIcon.check"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MAX_ACCESS_RIGHTS')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MAX_ACCESS_RIGHTS_SUBTITLE')"\n\t\t\t\t\t\t@click="onSetMaxValuesClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\tv-if="isMinValueSetForAny"\n\t\t\t\t\t\t:icon="RichMenuItemIcon['red-lock']"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MIN_ACCESS_RIGHTS')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MIN_ACCESS_RIGHTS_SUBTITLE')"\n\t\t\t\t\t\t@click="onSetMinValuesClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t:icon="RichMenuItemIcon.pencil"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_RENAME')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_RENAME_SUBTITLE')"\n\t\t\t\t\t\t@click="onEnableEditClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t:icon="RichMenuItemIcon.copy"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY_ROLE_SUBTITLE')"\n\t\t\t\t\t\t:disabled="isMaxVisibleUserGroupsReached"\n\t\t\t\t\t\t:hint="\n\t\t\t\t\t\t\tisMaxVisibleUserGroupsReached\n\t\t\t\t\t\t\t\t? $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_COPYING_DISABLED', {\n\t\t\t\t\t\t\t\t\t'#COUNT#': maxVisibleUserGroups,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t"\n\t\t\t\t\t\t@click="onCopyRoleClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t:icon="RichMenuItemIcon['trash-bin']"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_REMOVE')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_REMOVE_SUBTITLE')"\n\t\t\t\t\t\t@click="onDeleteRoleClick"\n\t\t\t\t\t/>\n\t\t\t\t</RichMenuPopup>\n\t\t\t</div>\n\t\t</div>\n\t`};class U{static mapUserGroups(e){const t=[];for(const s of e.values()){t.push({id:s.id,entityId:H.ROLE,title:s.title,supertitle:f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ROLE"),avatar:"/bitrix/js/ui/accessrights/v2/images/role-avatar.svg",tabs:["recents"]})}return t}static mapVariables(e){const t=[];for(const s of e.values()){const e=f.Runtime.clone(s);e.entityId=e.entityId||H.VARIABLE;e.tabs="recents";t.push(e)}return t}}const $="new~~~";const j="all-users";var D=babelHelpers.classPrivateFieldLooseKey("initialUserGroups");var k=babelHelpers.classPrivateFieldLooseKey("sortConfig");var N=babelHelpers.classPrivateFieldLooseKey("selectedMember");var K=babelHelpers.classPrivateFieldLooseKey("getUserGroupsCollectionBySelectedMember");var z=babelHelpers.classPrivateFieldLooseKey("setAccessRightValuesAction");var J=babelHelpers.classPrivateFieldLooseKey("setAccessRightValuesForShownAction");var X=babelHelpers.classPrivateFieldLooseKey("setMinAccessRightValuesAction");var q=babelHelpers.classPrivateFieldLooseKey("setMinAccessRightValuesInSectionAction");var W=babelHelpers.classPrivateFieldLooseKey("setMinAccessRightValuesForRight");var Y=babelHelpers.classPrivateFieldLooseKey("getMinValueForColumnAction");var Q=babelHelpers.classPrivateFieldLooseKey("getMinValue");var Z=babelHelpers.classPrivateFieldLooseKey("setMaxAccessRightValuesAction");var ee=babelHelpers.classPrivateFieldLooseKey("setMaxAccessRightValuesInSectionAction");var te=babelHelpers.classPrivateFieldLooseKey("setMaxAccessRightValuesForRight");var se=babelHelpers.classPrivateFieldLooseKey("getMaxValueForColumnAction");var ie=babelHelpers.classPrivateFieldLooseKey("getMaxValue");var re=babelHelpers.classPrivateFieldLooseKey("copySectionValuesAction");var oe=babelHelpers.classPrivateFieldLooseKey("setRoleTitleAction");var ae=babelHelpers.classPrivateFieldLooseKey("addMemberAction");var le=babelHelpers.classPrivateFieldLooseKey("isMemberValid");var ne=babelHelpers.classPrivateFieldLooseKey("removeMemberAction");var ce=babelHelpers.classPrivateFieldLooseKey("updateMembersForUserGroupAction");var ue=babelHelpers.classPrivateFieldLooseKey("copyUserGroupAction");var de=babelHelpers.classPrivateFieldLooseKey("addUserGroupAction");var he=babelHelpers.classPrivateFieldLooseKey("removeUserGroupAction");var pe=babelHelpers.classPrivateFieldLooseKey("updateUserGroupSortAction");var ge=babelHelpers.classPrivateFieldLooseKey("updateSortConfigForSelectedMemberAction");var ve=babelHelpers.classPrivateFieldLooseKey("updateSortConfigAction");var be=babelHelpers.classPrivateFieldLooseKey("selectMemberAction");var me=babelHelpers.classPrivateFieldLooseKey("hideUserGroupAction");var Se=babelHelpers.classPrivateFieldLooseKey("updateSortConfig");var fe=babelHelpers.classPrivateFieldLooseKey("isUserGroupExists");var ye=babelHelpers.classPrivateFieldLooseKey("isValidSortConfigForSelectedMember");var Ce=babelHelpers.classPrivateFieldLooseKey("isValidSortConfig");var Ie=babelHelpers.classPrivateFieldLooseKey("isValidSelectedMember");var Pe=babelHelpers.classPrivateFieldLooseKey("getUserGroup");var Le=babelHelpers.classPrivateFieldLooseKey("isValueExistsInStructure");var Me=babelHelpers.classPrivateFieldLooseKey("deleteRightAction");var Re=babelHelpers.classPrivateFieldLooseKey("isValueModified");var He=babelHelpers.classPrivateFieldLooseKey("isSetsEqual");var Be=babelHelpers.classPrivateFieldLooseKey("isUserGroupModified");class we extends m.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,Be,{value:pt});Object.defineProperty(this,He,{value:ht});Object.defineProperty(this,Re,{value:dt});Object.defineProperty(this,Me,{value:ut});Object.defineProperty(this,Le,{value:ct});Object.defineProperty(this,Pe,{value:nt});Object.defineProperty(this,Ie,{value:lt});Object.defineProperty(this,Ce,{value:at});Object.defineProperty(this,ye,{value:ot});Object.defineProperty(this,fe,{value:rt});Object.defineProperty(this,Se,{value:it});Object.defineProperty(this,me,{value:st});Object.defineProperty(this,be,{value:tt});Object.defineProperty(this,ve,{value:et});Object.defineProperty(this,ge,{value:Ze});Object.defineProperty(this,pe,{value:Qe});Object.defineProperty(this,he,{value:Ye});Object.defineProperty(this,de,{value:We});Object.defineProperty(this,ue,{value:qe});Object.defineProperty(this,ce,{value:Xe});Object.defineProperty(this,ne,{value:Je});Object.defineProperty(this,le,{value:ze});Object.defineProperty(this,ae,{value:Ke});Object.defineProperty(this,oe,{value:Ne});Object.defineProperty(this,re,{value:ke});Object.defineProperty(this,ie,{value:De});Object.defineProperty(this,se,{value:je});Object.defineProperty(this,te,{value:$e});Object.defineProperty(this,ee,{value:Ue});Object.defineProperty(this,Z,{value:Oe});Object.defineProperty(this,Q,{value:xe});Object.defineProperty(this,Y,{value:Ge});Object.defineProperty(this,W,{value:_e});Object.defineProperty(this,q,{value:Ae});Object.defineProperty(this,X,{value:Ee});Object.defineProperty(this,J,{value:Te});Object.defineProperty(this,z,{value:Ve});Object.defineProperty(this,K,{value:Fe});Object.defineProperty(this,D,{writable:true,value:new Map});Object.defineProperty(this,k,{writable:true,value:{}});Object.defineProperty(this,N,{writable:true,value:void 0})}getName(){return"userGroups"}setInitialUserGroups(e){babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e;return this}setSortConfig(e){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e;return this}setSelectedMember(e){babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e;return this}getState(){return{collection:f.Runtime.clone(babelHelpers.classPrivateFieldLooseBase(this,D)[D]),deleted:new Set,selectedMember:babelHelpers.classPrivateFieldLooseBase(this,N)[N],sortConfig:babelHelpers.classPrivateFieldLooseBase(this,k)[k]}}getElementState(e={}){return{id:`${$}${f.Text.getRandom()}`,isNew:true,isModified:true,title:f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ROLE_NAME"),accessRights:new Map,members:new Map}}getGetters(){return{shown:(e,t,s)=>{var i,r;const o=(i=(r=e.selectedMember)==null?void 0:r.id)!=null?i:j;const a=babelHelpers.classPrivateFieldLooseBase(this,K)[K](e);if(!e.sortConfig||!e.sortConfig[o]){if(s.application.options.maxVisibleUserGroups>0){return new Map([...a].slice(0,s.application.options.maxVisibleUserGroups))}return a}const l=[...a].filter((([t])=>e.sortConfig[o][t]>=0)).sort((([t],[s])=>{var i,r;return((i=e.sortConfig[o][t])!=null?i:Infinity)-((r=e.sortConfig[o][s])!=null?r:Infinity)}));if(s.application.options.maxVisibleUserGroups>0){return new Map(l.slice(0,s.application.options.maxVisibleUserGroups))}return new Map(l)},userGroupsBySelectedMember:e=>babelHelpers.classPrivateFieldLooseBase(this,K)[K](e),getEmptyAccessRightValue:(e,t,s,i)=>(t,s,r)=>{const o=i["accessRights/getEmptyValue"](s,r);return{id:r,values:o,isModified:e.collection.get(t).isNew}},defaultAccessRightValues:(e,t,s)=>{const i=new Map;for(const e of s.accessRights.collection.values()){for(const[t,s]of e.rights){if(f.Type.isNil(s.defaultValue)){continue}i.set(t,{id:t,values:s.defaultValue,isModified:true})}}return i},isModified:e=>{if(e.deleted.size>0){return true}for(const t of e.collection.values()){if(t.isNew||t.isModified){return true}for(const e of t.accessRights.values()){if(e.isModified){return true}}}return false},isMaxVisibleUserGroupsReached:(e,t,s,i)=>{if(!i["application/isMaxVisibleUserGroupsSet"]){return false}return t.shown.size>=s.application.options.maxVisibleUserGroups}}}getActions(){return{setAccessRightValues:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,z)[z](e,t)},setAccessRightValuesForShown:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,J)[J](e,t)},setMinAccessRightValues:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,X)[X](e,t)},setMaxAccessRightValues:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](e,t)},setMinAccessRightValuesInSection:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,q)[q](e,t)},setMaxAccessRightValuesInSection:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](e,t)},setMinAccessRightValuesForRight:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,W)[W](e,t)},setMaxAccessRightValuesForRight:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,te)[te](e,t)},setRoleTitle:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](e,t)},addMember:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](e,t)},removeMember:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](e,t)},updateMembersForUserGroup:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e,t)},copyUserGroup:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](e,t)},copySectionValues:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,re)[re](e,t)},addUserGroup:e=>{babelHelpers.classPrivateFieldLooseBase(this,de)[de](e)},removeUserGroup:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,he)[he](e,t)},updateUserGroupSort:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](e,t)},updateSortConfigForSelectedMember:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](e,t)},updateSortConfig:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](e,t)},deleteRight:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,Me)[Me](e,t)},selectMember:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,be)[be](e,t)}}}getMutations(){return{setAccessRightValues:(e,{userGroupId:t,valueId:s,values:i,isModified:r})=>{const o=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e,t);const a=o.accessRights.get(s);if(!a){o.accessRights.set(s,{id:s,values:i,isModified:r});return}a.values=i;a.isModified=r},setRoleTitle:(e,{userGroupId:t,title:s})=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e,t);i.title=s;i.isModified=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](i)},addMember:(e,{userGroupId:t,accessCode:s,member:i})=>{const r=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e,t);r.members.set(s,i);r.isModified=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](r)},removeMember:(e,{userGroupId:t,accessCode:s})=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e,t);i.members.delete(s);i.isModified=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](i)},updateMembersForUserGroup:(e,{userGroupId:t,memberCollection:s})=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e,t);i.members=s;i.isModified=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](i)},addUserGroup:(e,{userGroup:t})=>{e.collection.set(t.id,t)},removeUserGroup:(e,{userGroupId:t})=>{e.collection.delete(t)},markUserGroupForDeletion:(e,{userGroupId:t})=>{e.deleted.add(t)},updateSortConfigForSelectedMember:(e,{sortConfigForSelectedMember:t})=>{var s,i;const r=(s=(i=e.selectedMember)==null?void 0:i.id)!=null?s:j;e.sortConfig[r]=t},updateSortConfig:(e,{sortConfig:t})=>{e.sortConfig=t},deleteRight:(e,{rightId:t})=>{for(const s of e.collection.values()){if(s.accessRights.get(t)){s.accessRights.delete(t)}}},selectMember:(e,{member:t})=>{e.selectedMember=t}}}}function Fe(e){var t,s,i;const r=new Map;const o=(t=(s=e.selectedMember)==null?void 0:s.id)!=null?t:j;const a=(i=e.selectedMember)!=null&&i.accessCodes?[...e.selectedMember.accessCodes]:[];for(const[t,s]of e.collection){if(o===j||a.some((e=>s.members.has(e)))){r.set(t,s)}}return r}function Ve(e,t){if(!f.Type.isSet(t.values)){console.warn("ui.accessrights.v2: Attempt to set not-Set values",t);return}if(!babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](e,t.userGroupId)){console.warn("ui.accessrights.v2: Attempt to set value to a user group that dont exists",t);return}if(!babelHelpers.classPrivateFieldLooseBase(this,Le)[Le](e,t.sectionCode,t.valueId)){console.warn("ui.accessrights.v2: Attempt to set value to a right that dont exists in structure",t);return}e.commit("setAccessRightValues",{userGroupId:t.userGroupId,valueId:t.valueId,values:t.values,isModified:babelHelpers.classPrivateFieldLooseBase(this,Re)[Re](t.userGroupId,t.valueId,t.values,e.rootGetters["accessRights/getEmptyValue"](t.sectionCode,t.valueId))})}function Te(e,t){for(const s of e.getters.shown.keys()){void e.dispatch("setAccessRightValues",{...t,userGroupId:s})}}function Ee(e,{userGroupId:t}){for(const s of e.rootState.accessRights.collection.keys()){void e.dispatch("setMinAccessRightValuesInSection",{userGroupId:t,sectionCode:s})}void e.dispatch("accessRights/expandAllSections",null,{root:true})}function Ae(e,{userGroupId:t,sectionCode:s}){const i=e.rootState.accessRights.collection.get(s);if(!i){console.warn("ui.accessrights.v2: attempt to set min values in section that dont exists",{sectionCode:s});return}for(const s of i.rights.values()){const r=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](s,e.rootGetters["accessRights/getEmptyValue"](i.sectionCode,s.id));if(f.Type.isNil(r)){continue}void e.dispatch("setAccessRightValues",{userGroupId:t,sectionCode:i.sectionCode,valueId:s.id,values:r})}}function _e(e,{sectionCode:t,rightId:s}){var i;const r=(i=e.rootState.accessRights.collection.get(t))==null?void 0:i.rights.get(s);if(!r){console.warn("ui.accessrights.v2: attempt to set min values for right that dont exists",{sectionCode:t,rightId:s});return}const o=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](r);if(f.Type.isNil(o)){console.warn("ui.accessrights.v2: attempt to set min values for right that dont have min value set",{sectionCode:t,rightId:s});return}void e.dispatch("setAccessRightValuesForShown",{sectionCode:t,valueId:s,values:o})}function Ge(e,t){const s=f.Type.isBoolean(e.setEmptyOnSetMinMaxValueInColumn)&&e.setEmptyOnSetMinMaxValueInColumn;if(s){return t}return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](e)}function xe(e){var t;return(t=E.getValueTypeByRight(e))==null?void 0:t.getMinValue(e)}function Oe(e,{userGroupId:t}){for(const s of e.rootState.accessRights.collection.keys()){void e.dispatch("setMaxAccessRightValuesInSection",{userGroupId:t,sectionCode:s})}void e.dispatch("accessRights/expandAllSections",null,{root:true})}function Ue(e,{userGroupId:t,sectionCode:s}){const i=e.rootState.accessRights.collection.get(s);if(!i){console.warn("ui.accessrights.v2: attempt to set max values in section that dont exists",{sectionCode:s});return}for(const s of i.rights.values()){const r=babelHelpers.classPrivateFieldLooseBase(this,se)[se](s,e.rootGetters["accessRights/getEmptyValue"](i.sectionCode,s.id));if(f.Type.isNil(r)){continue}void e.dispatch("setAccessRightValues",{userGroupId:t,sectionCode:i.sectionCode,valueId:s.id,values:r})}}function $e(e,{sectionCode:t,rightId:s}){var i;const r=(i=e.rootState.accessRights.collection.get(t))==null?void 0:i.rights.get(s);if(!r){console.warn("ui.accessrights.v2: attempt to set max values for right that dont exists",{sectionCode:t,rightId:s});return}const o=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](r);if(f.Type.isNil(o)){console.warn("ui.accessrights.v2: attempt to set max values for right that dont have max value set",{sectionCode:t,rightId:s});return}void e.dispatch("setAccessRightValuesForShown",{sectionCode:t,valueId:s,values:o})}function je(e,t){const s=f.Type.isBoolean(e.setEmptyOnSetMinMaxValueInColumn)&&e.setEmptyOnSetMinMaxValueInColumn;if(s){return t}return babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](e)}function De(e){var t;return(t=E.getValueTypeByRight(e))==null?void 0:t.getMaxValue(e)}function ke(e,t){const s=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e.state,t.srcUserGroupId);if(!s){console.warn("ui.accessrights.v2: Attempt to copy values from user group that dont exists",t);return}const i=e.rootState.accessRights.collection.get(t.sectionCode);if(!i){console.warn("ui.accessrights.v2: Attempt to copy values for section that dont exists",t);return}for(const r of i.rights.keys()){const o=s.accessRights.get(r);if(o){void e.dispatch("setAccessRightValues",{userGroupId:t.dstUserGroupId,sectionCode:i.sectionCode,valueId:o.id,values:o.values})}else{const s=e.rootGetters["accessRights/getEmptyValue"](i.sectionCode,r);void e.dispatch("setAccessRightValues",{userGroupId:t.dstUserGroupId,sectionCode:i.sectionCode,valueId:r,values:s})}}}function Ne(e,t){if(!f.Type.isString(t.title)){console.warn("ui.accessrights.v2: Attempt to set role title with something other than string",t);return}if(!babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](e,t.userGroupId)){console.warn("ui.accessrights.v2: Attempt to update user group that dont exists",t);return}e.commit("setRoleTitle",t)}function Ke(e,t){if(!babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](e,t.userGroupId)){console.warn("ui.accessrights.v2: Attempt to add member to a user group that dont exists",t);return}if(!f.Type.isStringFilled(t.accessCode)||!babelHelpers.classPrivateFieldLooseBase(this,le)[le](t)){console.warn("ui.accessrights.v2: Attempt to add member with invalid payload",t);return}e.commit("addMember",t)}function ze(e){return f.Type.isStringFilled(e.member.id)&&f.Type.isStringFilled(e.member.type)&&f.Type.isStringFilled(e.member.name)&&(f.Type.isNil(e.member.avatar)||f.Type.isStringFilled(e.member.avatar))}function Je(e,t){if(!babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](e,t.userGroupId)){console.warn("ui.accessrights.v2: Attempt to remove member from a user group that dont exists",t);return}if(!f.Type.isStringFilled(t.accessCode)){console.warn("ui.accessrights.v2: Attempt to remove member with invalid payload",t);return}e.commit("removeMember",t)}function Xe(e,t){if(!babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](e,t.userGroupId)){console.warn("ui.accessrights.v2: Attempt to remove member from a user group that dont exists",t);return}const s=new Map;t.members.forEach((e=>{if(!f.Type.isStringFilled(e.id)||!f.Type.isStringFilled(e.type)||!f.Type.isStringFilled(e.name)||!(f.Type.isNil(e.avatar)||f.Type.isStringFilled(e.avatar))){console.warn("ui.accessrights.v2: Attempt to add member with invalid payload",e)}else{s.set(e.id,e)}}));e.commit("updateMembersForUserGroup",{userGroupId:t.userGroupId,memberCollection:s})}function qe(e,{userGroupId:t}){const s=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e.state,t);if(!s){console.warn("ui.accessrights.v2: Attempt to copy user group that dont exists",{userGroupId:t});return}const i=this.getElementState();const r={...f.Runtime.clone(s),id:i.id,title:f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_COPIED_ROLE_NAME",{"#ORIGINAL#":s.title}),isNew:true,isModified:true};for(const e of r.accessRights.values()){e.isModified=true}const o=babelHelpers.classPrivateFieldLooseBase(this,Se)[Se](e.state.sortConfig,r.id);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](e,{sortConfig:o});e.commit("addUserGroup",{userGroup:r})}function We(e){var t;const s={...this.getElementState(),accessRights:f.Runtime.clone(e.getters.defaultAccessRightValues),members:new Map};if(e.state.selectedMember&&e.state.selectedMember.member){s.members.set(e.state.selectedMember.member.id,e.state.selectedMember.member)}const i=babelHelpers.classPrivateFieldLooseBase(this,Se)[Se](e.state.sortConfig,s.id,(t=e.state.selectedMember)==null?void 0:t.id);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](e,{sortConfig:i});e.commit("addUserGroup",{userGroup:s})}function Ye(e,{userGroupId:t}){const s=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e.state,t);if(!s){console.warn("ui.accessrights.v2: Attempt to remove user group that dont exists",{userGroupId:t});return}e.commit("removeUserGroup",{userGroupId:t});if(!s.isNew){e.commit("markUserGroupForDeletion",{userGroupId:t})}}function Qe(e,{userGroupId:t,sort:s}){if(!babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](e,t)){console.warn("ui.accessrights.v2: Attempt to show user group that dont exists",{userGroupId:t});return}e.commit("updateUserGroupSort",{userGroupId:t,sort:s})}function Ze(e,{sortConfigForSelectedMember:t}){if(!babelHelpers.classPrivateFieldLooseBase(this,ye)[ye](t)){console.warn("ui.accessrights.v2: Invalid sort configuration provided",t);return}e.commit("updateSortConfigForSelectedMember",{sortConfigForSelectedMember:t})}function et(e,{sortConfig:t}){if(!babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce](t)){console.warn("ui.accessrights.v2: Invalid sort configuration provided",t);return}e.commit("updateSortConfig",{sortConfig:t})}function tt(e,t){if(!babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie](t.member)){console.warn("ui.accessrights.v2: Invalid selected member provided",t.member);return}e.commit("selectMember",f.Runtime.clone(t))}function st(e,{userGroupId:t}){if(!babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](e,t)){console.warn("ui.accessrights.v2: Attempt to shrink user group that dont exists",{userGroupId:t});return}e.commit("hideUserGroup",{userGroupId:t})}function it(e,t,s){const i=new Set([j]);if(s){i.add(s)}const r={...e};for(const e of i){if(!r[e]){continue}const s=Object.values(r[e]);const i=s.length>0?Math.max(...s):0;r[e]={...r[e],[t]:i+1}}return r}function rt(e,t){const s=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e.state,t);return Boolean(s)}function ot(e){return Object.values(e).every((e=>f.Type.isNumber(e)))}function at(e){return Object.values(e).every((e=>babelHelpers.classPrivateFieldLooseBase(this,ye)[ye](e)))}function lt(e){if(e.id===j){return true}return f.Type.isString(e.id)&&f.Type.isObject(e.member)&&f.Type.isArray(e.accessCodes)}function nt(e,t){return e.collection.get(t)}function ct(e,t,s){const i=e.rootState.accessRights.collection.get(t);return i==null?void 0:i.rights.has(s)}function ut(e,{rightId:t}){e.commit("deleteRight",{rightId:t})}function dt(e,t,s,i){var r,o;const a=babelHelpers.classPrivateFieldLooseBase(this,D)[D].get(e);if(!a){return true}const l=(r=(o=a.accessRights.get(t))==null?void 0:o.values)!=null?r:i;return!babelHelpers.classPrivateFieldLooseBase(this,He)[He](new Set(l),new Set(s))}function ht(e,t){if(f.Type.isFunction(e.symmetricDifference)){return e.symmetricDifference(t).size===0}if(e.size!==t.size){return false}for(const s of e){if(!t.has(s)){return false}}for(const s of t){if(!e.has(s)){return false}}return true}function pt(e){if(e.isNew){return true}const t=babelHelpers.classPrivateFieldLooseBase(this,D)[D].get(e.id);if(!t){throw new Error("ui.accessrights.v2: initial user group not found")}if(e.title!==t.title){return true}const s=new Set(t.members.keys());const i=new Set(e.members.keys());return!babelHelpers.classPrivateFieldLooseBase(this,He)[He](s,i)}function gt(e){if(!e.isShown){return false}return!e.group||e.isGroupExpanded}function vt(e,t,s){if(s){return e}const i=new Map;for(const[s,r]of e){if(t.has(s)){i.set(s,r)}}return i}function bt(e){const t=[...e.values()].pop();if(e.size===1){return t.title}return f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_HAS_SELECTED_ITEMS",{"#FIRST_ITEM_NAME#":mt(t.title),"#COUNT_REST_ITEMS#":e.size-1})}function mt(e){const t=15;if(e.length>t){return`${e.slice(0,t)}...`}return e}function St(e,t,s){if(e.size<2){return""}let i="";for(const t of ft(e,s)){i+=`<li>${f.Text.encode(t.title)}</li>`}return`\n\t\t<p>${f.Text.encode(t)}</p>\n\t\t<ul>${i}</ul>\n\t`}function ft(e,t){const s=new Map;let i=0;for(const[e]of t){s.set(e,i);i++}return[...e.values()].sort(((e,t)=>{const i=s.get(e.id);const r=s.get(t.id);if(f.Type.isNil(i)){return 1}if(f.Type.isNil(r)){return-1}return i-r}))}const yt="|";function Ct(e,t=yt){const s=e.split(t);return new Set(s)}function It(e,t=yt){const s=[...e].sort();return s.join(t)}function Pt(e,t=yt){const s=Ct(e,t);return It(s,t)}function Lt(e,t){return f.ajax.runAction("ui.accessrights.setUserSortConfig",{data:{name:e,userSortConfig:t}})}const Mt={template:`\n\t\t<div class='ui-access-rights-v2-column-item'>\n\t\t\t<slot/>\n\t\t</div>\n\t`};const Rt={template:`\n\t\t<div class='ui-access-rights-v2-column'>\n\t\t\t<slot/>\n\t\t</div>\n\t`};const Ht={name:"RolesControl",components:{CellLayout:Mt,ColumnLayout:Rt,RichMenuPopup:p.RichMenuPopup,RichMenuItem:p.RichMenuItem},props:{userGroups:{type:Map,required:true}},viewDialog:null,computed:{RichMenuItemIcon:()=>p.RichMenuItemIcon,...m.mapState({allUserGroups:e=>e.userGroups.collection,maxVisibleUserGroups:e=>e.application.options.maxVisibleUserGroups,guid:e=>e.application.guid,userSortConfigName:e=>e.application.options.userSortConfigName,selectedMember:e=>e.userGroups.selectedMember,sortConfig:e=>e.userGroups.sortConfig}),...m.mapGetters({isMaxVisibleUserGroupsSet:"application/isMaxVisibleUserGroupsSet",isMaxVisibleUserGroupsReached:"userGroups/isMaxVisibleUserGroupsReached",userGroupsBySelectedMember:"userGroups/userGroupsBySelectedMember"}),shownGroupsCounter(){return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ROLE_COUNTER",{"#VISIBLE_ROLES#":this.userGroups.size,"#ALL_ROLES#":this.userGroupsBySelectedMember.size,"#GREY_START#":'<span style="opacity: var(--ui-opacity-30)">',"#GREY_FINISH#":"</span>"})},copyDialogItems(){return U.mapUserGroups(this.userGroupsBySelectedMember)},viewDialogItems(){var e;const t=[];const s=(e=this.selectedMember)!=null&&e.id?this.selectedMember.id:j;for(const e of U.mapUserGroups(this.userGroupsBySelectedMember)){t.push({...e,selected:this.userGroups.has(e.id),sort:this.sortConfig[s]?this.sortConfig[s][e.id]:null})}return t}},data(){return{isPopupShown:false}},methods:{onCreateNewRoleClick(){if(this.isMaxVisibleUserGroupsReached){return}this.isPopupShown=false;this.$store.dispatch("userGroups/addUserGroup")},onRoleViewClick(){this.isPopupShown=false;this.showViewDialog(this.$refs.configure)},onCopyRoleClick(){if(this.isMaxVisibleUserGroupsReached){return}this.isPopupShown=false;this.showCopyDialog()},showCopyDialog(){const e=new l.Dialog({context:R.ROLE,targetNode:this.$refs.configure,multiple:false,dropdownMode:true,enableSearch:true,cacheable:false,items:this.copyDialogItems,events:{"Item:onSelect":e=>{const{item:t}=e.getData();this.$store.dispatch("userGroups/copyUserGroup",{userGroupId:t.getId()})}}});e.show()},showViewDialog(e){this.viewDialog=new s.ItemListSelector({title:this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ROLES_SELECTOR_TITLE"),subtitle:this.maxVisibleUserGroups?f.Loc.getMessagePlural("JS_UI_ACCESSRIGHTS_V2_ROLES_SELECTOR_SUBTITLE",this.maxVisibleUserGroups,{"#COUNT#":this.maxVisibleUserGroups}):null,targetNode:e,items:this.viewDialogItems,maxSelected:this.maxVisibleUserGroups,events:{onSave:()=>{var e;const t=this.viewDialog.getSelectedItems();const s={};t.forEach(((e,t)=>{s[e.id]=t}));this.$store.dispatch("userGroups/updateSortConfigForSelectedMember",{sortConfigForSelectedMember:s});if(!((e=this.selectedMember)!=null&&e.id)||this.selectedMember.id===j){Lt(this.userSortConfigName,s)}this.viewDialog=null},onHide:()=>{this.viewDialog=null}}});this.viewDialog.show()},toggleViewDialog(e){if(this.viewDialog){this.viewDialog.hide()}else{this.showViewDialog(e)}}},template:`\n\t\t<ColumnLayout>\n\t\t\t<CellLayout class="ui-access-rights-v2-header-roles-control">\n\t\t\t\t<div class='ui-access-rights-v2-column-item-text ui-access-rights-v2-header-roles-control-header'>\n\t\t\t\t\t<div>{{ $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLES') }}</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="configure"\n\t\t\t\t\t\tclass="ui-icon-set --more-l ui-access-rights-v2-icon-more"\n\t\t\t\t\t\tstyle="position: absolute; right: 11px; top: 5px;"\n\t\t\t\t\t\t@click="isPopupShown = true"\n\t\t\t\t\t>\n\t\t\t\t\t\t<RichMenuPopup v-if="isPopupShown" @close="isPopupShown = false" :popup-options="{bindElement: $refs.configure}">\n\t\t\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t\t\t:icon="RichMenuItemIcon.role"\n\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_NEW_ROLE')"\n\t\t\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_NEW_ROLE_SUBTITLE')"\n\t\t\t\t\t\t\t\t:disabled="isMaxVisibleUserGroupsReached"\n\t\t\t\t\t\t\t\t:hint="\n\t\t\t\t\t\t\t\t\tisMaxVisibleUserGroupsReached\n\t\t\t\t\t\t\t\t\t\t? $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_ADDING_DISABLED', {\n\t\t\t\t\t\t\t\t\t\t\t'#COUNT#': maxVisibleUserGroups,\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t"\n\t\t\t\t\t\t\t\t@click="onCreateNewRoleClick"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t\t\t:icon="RichMenuItemIcon.copy"\n\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY_ROLE')"\n\t\t\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY_ROLE_SUBTITLE')"\n\t\t\t\t\t\t\t\t:disabled="isMaxVisibleUserGroupsReached"\n\t\t\t\t\t\t\t\t:hint="\n\t\t\t\t\t\t\t\t\tisMaxVisibleUserGroupsReached\n\t\t\t\t\t\t\t\t\t\t? $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_COPYING_DISABLED', {\n\t\t\t\t\t\t\t\t\t\t\t'#COUNT#': maxVisibleUserGroups,\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t"\n\t\t\t\t\t\t\t\t@click="onCopyRoleClick"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t\t\t:icon="RichMenuItemIcon['opened-eye']"\n\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_VIEW')"\n\t\t\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_VIEW_SUBTITLE_MSGVER_1')"\n\t\t\t\t\t\t\t\t@click="onRoleViewClick"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</RichMenuPopup>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-access-rights-v2-header-roles-control-actions">\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="counter"\n\t\t\t\t\t\tclass="ui-access-rights-v2-header-roles-control-counter"\n\t\t\t\t\t\t@click="toggleViewDialog($refs.counter)"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="ui-icon-set --o-observer" style="--ui-icon-set__icon-size: 18px;"></div>\n\t\t\t\t\t\t<span v-html="shownGroupsCounter"></span>\n\t\t\t\t\t\t<div class="ui-icon-set --chevron-down ui-access-rights-v2-header-roles-control-chevron"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-access-rights-v2-header-roles-control-expander">\n\t\t\t\t\t\t<div class="ui-access-rights-v2-header-roles-control-expander-button">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="ui-icon-set --collapse"\n\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COLLAPSE_ALL_SECTIONS')"\n\t\t\t\t\t\t\t\t@click="$store.dispatch('accessRights/collapseAllSections')"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-access-rights-v2-header-roles-control-expander-button">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="ui-icon-set --expand-1"\n\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_EXPAND_ALL_SECTIONS')"\n\t\t\t\t\t\t\t\t@click="$store.dispatch('accessRights/expandAllSections')"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</CellLayout>\n\t\t</ColumnLayout>\n\t`};const Bt=new Map;const wt=new Map;const Ft={name:"SyncHorizontalScroll",data(){return{componentGuid:f.Text.getRandom(16)}},computed:{...m.mapState({guid:e=>e.application.guid})},throttledEmitScrollEvent:null,created(){this.throttledEmitScrollEvent=Vt(this.emitScrollEvent)},mounted(){if(!Bt.has(this.guid)){const e=this.$store.state.accessRights.collection.size+1;this.$Bitrix.eventEmitter.incrementMaxListeners("ui:accessrights:v2:syncScroll",e);Bt.set(this.guid,true)}this.$Bitrix.eventEmitter.subscribe("ui:accessrights:v2:syncScroll",this.handleScrollEvent);void this.$nextTick((()=>{if(wt.has(this.guid)){this.syncScroll(wt.get(this.guid))}}))},beforeUnmount(){this.$Bitrix.eventEmitter.unsubscribe("ui:accessrights:v2:syncScroll",this.handleScrollEvent)},methods:{emitScrollEvent(e){const{scrollLeft:t}=e.target;wt.set(this.guid,t);this.$Bitrix.eventEmitter.emit("ui:accessrights:v2:syncScroll",{scrollLeft:t,componentGuid:this.componentGuid})},handleScrollEvent(e){const{scrollLeft:t,componentGuid:s}=e.getData();if(this.componentGuid===s){return}this.syncScroll(t)},syncScroll(e){if(this.$el.scrollLeft!==e){this.$el.scrollLeft=e}}},template:`\n\t\t<div @scroll="throttledEmitScrollEvent">\n\t\t\t<slot/>\n\t\t</div>\n\t`};function Vt(e){let t=false;let s=false;return function i(...r){s=true;if(!t){const i=function i(){if(s){e(...r);s=false;requestAnimationFrame(i);t=true}else{t=false}};i()}}}const Tt={name:"Header",components:{RoleHeading:O,SyncHorizontalScroll:Ft,Members:x,RolesControl:Ht,ColumnLayout:Rt,CellLayout:Mt},directives:{hint:n.hint},props:{userGroups:{type:Map,required:true}},computed:{...m.mapState({maxVisibleUserGroups:e=>e.application.options.maxVisibleUserGroups}),...m.mapGetters({isMaxVisibleUserGroupsReached:"userGroups/isMaxVisibleUserGroupsReached"})},methods:{onCreateNewRoleClick(){if(this.isMaxVisibleUserGroupsReached){return}this.$store.dispatch("userGroups/addUserGroup")}},template:`\n\t\t<div class="ui-access-rights-v2-section ui-access-rights-v2--head-section">\n\t\t\t<div class='ui-access-rights-v2-section-container'>\n\t\t\t\t<div class='ui-access-rights-v2-section-head'>\n\t\t\t\t\t<RolesControl :user-groups="userGroups"/>\n\t\t\t\t</div>\n\t\t\t\t<div class='ui-access-rights-v2-section-content'>\n\t\t\t\t\t<SyncHorizontalScroll class='ui-access-rights-v2-section-wrapper'>\n\t\t\t\t\t\t<ColumnLayout\n\t\t\t\t\t\t\tv-for="[groupId, group] in userGroups" \n\t\t\t\t\t\t\t:key="groupId"\n\t\t\t\t\t\t\t:data-accessrights-user-group-id="groupId"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CellLayout class="ui-access-rights-v2-header-role-cell">\n\t\t\t\t\t\t\t\t<RoleHeading :user-group="group"/>\n\t\t\t\t\t\t\t\t<Members :user-group="group"/>\n\t\t\t\t\t\t\t</CellLayout>\n\t\t\t\t\t\t</ColumnLayout>\n\t\t\t\t\t\t<ColumnLayout>\n\t\t\t\t\t\t\t<div class="ui-access-rights-v2-header-role-add">\n\t\t\t\t\t\t\t\t<button class="ui-btn ui-btn-light-border ui-btn-round ui-btn-disabled"\n\t\t\t\t\t\t\t\t\t\tv-if="isMaxVisibleUserGroupsReached"\n\t\t\t\t\t\t\t\t\t\tv-hint="$Bitrix.Loc.getMessage(\n\t\t\t\t\t\t\t\t\t 'JS_UI_ACCESSRIGHTS_V2_ROLE_ADDING_DISABLED', \n\t\t\t\t\t\t\t\t\t {'#COUNT#': maxVisibleUserGroups,})"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class="ui-icon-set --plus-20"/>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button class="ui-btn ui-btn-light-border ui-btn-round"\n\t\t\t\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t\t\t\t@click="onCreateNewRoleClick"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class="ui-icon-set --plus-20"/>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</ColumnLayout>\n\t\t\t\t\t</SyncHorizontalScroll>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Et={name:"SearchBox",debouncedSetSearchQuery:null,created(){const e=e=>{this.$store.dispatch("accessRights/search",{query:e})};this.debouncedSetSearchQuery=f.Runtime.debounce(e,200)},computed:{searchQuery:{get(){return this.$store.state.accessRights.searchQuery},set(e){this.debouncedSetSearchQuery(e)}}},template:`\n\t\t<div\n\t\t\tclass="ui-ctl ui-ctl-after-icon ui-access-rights-v2-search">\n\t\t\t<input\n\t\t\t\ttype="text"\n\t\t\t\tclass="ui-ctl-element ui-ctl-textbox ui-access-rights-v2-search-input"\n\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SEARCH_PLACEHOLDER')"\n\t\t\t\tv-model="searchQuery"\n\t\t\t\tref="searchInput"\n\t\t\t>\n\t\t\t<a \n\t\t\t\tclass="ui-icon-set --o-search ui-access-rights-v2-search-icon"\n\t\t\t\t@click="this.$refs.searchInput.focus()"\n\t\t\t></a>\n\t\t</div>\n\t`};const At={name:"MemberSelector",components:{Chip:i.Chip},data(){return{accessCodesCache:{}}},computed:{selectedMember:{get(){return this.$store.state.userGroups.selectedMember},set(e){this.$store.dispatch("userGroups/selectMember",{member:e})}},selectedMemberName(){var e,t;if(!this.selectedMember.id||this.selectedMember.id===j||!((e=this.selectedMember)!=null&&(t=e.member)!=null&&t.name)){return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_USER_SELECTOR_ALL_USERS")}return this.selectedMember.member.name},selectedMemberAvatar(){var e,t,s;if(!this.selectedMember.id||this.selectedMember.id===j){return null}return(e=(t=this.selectedMember)==null?void 0:(s=t.member)==null?void 0:s.avatar)!=null?e:"/bitrix/js/ui/accessrights/v2/images/user-avatar.svg"},avatarBackgroundImage(){return`url(${encodeURI(this.selectedMemberAvatar)})`},selectedItems(){if(this.selectedMember&&this.selectedMember.id&&this.selectedMember.id!==j){return[[this.selectedMember.entityType,this.selectedMember.entityId]]}return[["meta-user",j]]},...m.mapState({memberOptions:e=>e.application.options.additionalMembersParams})},methods:{openUserSelector(){this.getSelectorService().createDialog({targetNode:this.$refs.userSelector,preselectedItems:this.selectedItems,multiple:false,hideOnSelect:true,hideOnDeselect:true,events:{"Item:onSelect":this.onMemberSelect,"Item:onDeselect":this.onMemberDeselect},entities:this.getEntities()}).show()},getEntities(){const e=this.getSelectorService().entities();e.push({id:"meta-user",options:{"all-users":true}});return e},onMemberSelect(e){const{item:t}=e.getData();const s=t.id===j?j:t.entityId+t.id;const i={id:s,entityId:t.id,entityType:t.entityId,member:this.getSelectorService().getMemberByItem(t)};const r=this.getAccessCodesFromCache(s);if(r.length>0||t.id===j){this.selectedMember={...i,accessCodes:r};return}if(!this.shouldUseAjax(t)){this.selectedMember={...i,accessCodes:this.getDefaultAccessCodesByItem(t)};return}this.$store.commit("application/setProgress",true);f.ajax.runAction("ui.accessrights.getAccessCodes",{data:{id:i.member.id,params:this.$store.state.application.options.additionalSaveParams,moduleId:this.$store.state.application.options.moduleId}}).then((e=>{var r;let o=(r=e.data)!=null?r:[];if(o.length===0){o=this.getDefaultAccessCodesByItem(t)}this.selectedMember={...i,accessCodes:o};this.accessCodesCache[s]=new Set(o);this.$store.commit("application/setProgress",false)})).catch((()=>{const e=this.getDefaultAccessCodesByItem(t);this.selectedMember={...i,accessCodes:e};this.accessCodesCache[s]=e;this.$store.commit("application/setProgress",false)}))},shouldUseAjax(e){const t=["user","department","structure-node"];return t.includes(e.entityId)},onMemberDeselect(e){this.selectedMember={id:j,entityId:j,entityType:"meta-user",accessCodes:[]}},getDefaultAccessCodesByItem(e){if(e.entityId==="structure-role"){var t;const s=(t=e.id.match(/^(?:ATD|ATE|ATT|AD|AE|AT)([1-9]\d*)$/))==null?void 0:t[1];const i=[this.getSelectorService().getAccessCodeByItem(e),`AE${s}`];return[...new Set(i)]}if(e.entityId==="project-access-codes"){var s;const t=(s=e.id.match(/^SG(\d+)_([AEK])$/))==null?void 0:s[1];const i=[this.getSelectorService().getAccessCodeByItem(e),`SG${t}_K`];return[...new Set(i)]}return[this.getSelectorService().getAccessCodeByItem(e)]},getAccessCodesFromCache(e){return this.accessCodesCache[e]||[]},getSelectorService(){return E.getSelectorService(this.memberOptions)}},template:`\n\t\t<div ref="userSelector" class="ui-access-rights-v2-user-selector">\n\t\t\t<Chip\n\t\t\t\t:image="selectedMemberAvatar ? { src: selectedMemberAvatar, alt: selectedMemberName } : ''"\n\t\t\t\t:dropdown="true"\n\t\t\t\t:text=selectedMemberName\n\t\t\t\t@click="openUserSelector"\n\t\t\t/>\n\t\t</div>\n\t`};var _t=babelHelpers.classPrivateFieldLooseKey("internalizeExternalSection");var Gt=babelHelpers.classPrivateFieldLooseKey("internalizeExternalIcon");var xt=babelHelpers.classPrivateFieldLooseKey("internalizeExternalSectionAction");var Ot=babelHelpers.classPrivateFieldLooseKey("internalizeSelectedVariablesAliases");var Ut=babelHelpers.classPrivateFieldLooseKey("internalizeValueSet");var $t=babelHelpers.classPrivateFieldLooseKey("internalizeSetEmptyOnSetMinMaxValueInColumn");var jt=babelHelpers.classPrivateFieldLooseKey("internalizeExternalVariable");class Dt{constructor(){Object.defineProperty(this,jt,{value:qt});Object.defineProperty(this,$t,{value:Xt});Object.defineProperty(this,Ut,{value:Jt});Object.defineProperty(this,Ot,{value:zt});Object.defineProperty(this,xt,{value:Kt});Object.defineProperty(this,Gt,{value:Nt});Object.defineProperty(this,_t,{value:kt})}transform(e){const t=new Map;for(const s of e){const e=babelHelpers.classPrivateFieldLooseBase(this,_t)[_t](s);t.set(e.sectionCode,e)}return t}internalizeExternalItem(e){const[t,s]=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot](e.selectedVariablesAliases);const i={id:String(e.id),type:String(e.type),title:String(e.title),subtitle:f.Type.isStringFilled(e.subtitle)?e.subtitle:null,hint:f.Type.isStringFilled(e.hint)?e.hint:null,group:f.Type.isNil(e.group)?null:String(e.group),groupHead:f.Type.isBoolean(e.groupHead)?e.groupHead:false,isShown:true,minValue:babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut](e.minValue),maxValue:babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut](e.maxValue),defaultValue:babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut](e.defaultValue),emptyValue:babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut](e.emptyValue),nothingSelectedValue:babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut](e.nothingSelectedValue),setEmptyOnSetMinMaxValueInColumn:babelHelpers.classPrivateFieldLooseBase(this,$t)[$t](e),variables:f.Type.isArray(e.variables)||f.Type.isMap(e.variables)?new Map:null,allSelectedCode:f.Type.isStringFilled(e.allSelectedCode)?e.allSelectedCode:null,selectedVariablesAliases:t,selectedVariablesAliasesSeparator:s,enableSearch:f.Type.isBoolean(e.enableSearch)?e.enableSearch:null,showAvatars:f.Type.isBoolean(e.showAvatars)?e.showAvatars:null,compactView:f.Type.isBoolean(e.compactView)?e.compactView:null,hintTitle:f.Type.isStringFilled(e.hintTitle)?e.hintTitle:null,dependentVariablesPopupHint:f.Type.isStringFilled(e.dependentVariablesPopupHint)?e.dependentVariablesPopupHint:null,iconClass:f.Type.isStringFilled(e.iconClass)?e.iconClass:null,isClickable:f.Type.isBoolean(e.isClickable)?e.isClickable:false,isDeletable:f.Type.isBoolean(e.isDeletable)?e.isDeletable:false,isNew:f.Type.isBoolean(e.isNew)?e.isNew:false,isModified:f.Type.isBoolean(e.isModified)?e.isModified:false};if(i.groupHead||i.group){i.isGroupExpanded=false}if(f.Type.isArray(e.variables)){for(const t of e.variables){const e=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt](t);i.variables.set(e.id,e)}}else if(f.Type.isMap(e.variables)){for(const t of e.variables.values()){const e=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt](t);i.variables.set(e.id,e)}}return i}}function kt(e){const t={sectionCode:f.Type.isStringFilled(e.sectionCode)?e.sectionCode:f.Text.getRandom(),sectionTitle:String(e.sectionTitle),sectionSubTitle:f.Type.isStringFilled(e.sectionSubTitle)?e.sectionSubTitle:null,sectionHint:f.Type.isStringFilled(e.sectionHint)?e.sectionHint:null,sectionIcon:babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt](e.sectionIcon),rights:new Map,isExpanded:true,isShown:true,action:babelHelpers.classPrivateFieldLooseBase(this,xt)[xt](e.action)};for(const s of e.rights){const e=this.internalizeExternalItem(s);t.rights.set(e.id,e)}return t}function Nt(e){if(f.Type.isStringFilled(e==null?void 0:e.type)&&f.Type.isStringFilled(e==null?void 0:e.bgColor)){return{type:e.type,bgColor:e.bgColor}}return null}function Kt(e){if(f.Type.isStringFilled(e==null?void 0:e.buttonText)){return{buttonText:e.buttonText}}return null}function zt(e){if(!f.Type.isPlainObject(e)){return[new Map,yt]}const t=f.Type.isString(e.separator)?e.separator:yt;const s=new Map;for(const[i,r]of Object.entries(e)){if(i==="separator"){continue}s.set(Pt(i,t),String(r))}return[s,t]}function Jt(e){if(f.Type.isNil(e)){return null}if(f.Type.isArray(e)){return new Set(e.map((e=>String(e))))}if(f.Type.isSet(e)){return new Set(Array.from(e,(e=>String(e))))}return new Set([String(e)])}function Xt(e){const t=e=>f.Type.isBoolean(e)?e:null;if(!f.Type.isUndefined(e.setEmptyOnSetMinMaxValueInColumn)){return t(e.setEmptyOnSetMinMaxValueInColumn)}return t(e.setEmptyOnGroupActions)}function qt(e){return{id:String(e.id),title:String(e.title),entityId:f.Type.isStringFilled(e.entityId)?e.entityId:null,supertitle:f.Type.isStringFilled(e.supertitle)?e.supertitle:null,avatar:f.Type.isStringFilled(e.avatar)?e.avatar:null,avatarOptions:f.Type.isPlainObject(e.avatarOptions)?e.avatarOptions:null,conflictsWith:f.Type.isArray(e.conflictsWith)?new Set(e.conflictsWith.map((e=>String(e)))):null,requires:f.Type.isArray(e.requires)?new Set(e.requires.map((e=>String(e)))):null,secondary:f.Type.isBoolean(e.secondary)?e.secondary:null,hint:f.Type.isStringFilled(e.hint)?e.hint:null}}var Wt=babelHelpers.classPrivateFieldLooseKey("initialRights");var Yt=babelHelpers.classPrivateFieldLooseKey("searchAction");class Qt extends m.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,Yt,{value:Zt});Object.defineProperty(this,Wt,{writable:true,value:new Map})}getName(){return"accessRights"}setInitialAccessRights(e){babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]=e;return this}getState(){return{collection:f.Runtime.clone(babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]),searchQuery:"",deleted:new Set}}getElementState(e={}){throw new Error("Cant create AccessRightSection. You are doing something wrong")}getGetters(){return{shown:e=>{const t=new Map;for(const[s,i]of e.collection){if(i.isShown){t.set(s,i)}}return t},isMinValueSetForAny:(e,t)=>{for(const s of e.collection.values()){for(const e of s.rights.values()){const i=t.isMinValueSet(s.sectionCode,e.id);if(i){return true}}}return false},isMinValueSet:e=>(t,s)=>{var i;const r=(i=e.collection.get(t))==null?void 0:i.rights.get(s);if(!r){console.warn("ui.accessrights.v2: attempt to check if min value set for unknown right",{sectionCode:t,rightId:s});return false}return!f.Type.isNil(r.minValue)},isMaxValueSetForAny:(e,t)=>{for(const s of e.collection.values()){for(const e of s.rights.values()){const i=t.isMaxValueSet(s.sectionCode,e.id);if(i){return true}}}return false},isMaxValueSet:e=>(t,s)=>{var i;const r=(i=e.collection.get(t))==null?void 0:i.rights.get(s);if(!r){console.warn("ui.accessrights.v2: attempt to check if max value set for unknown right",{sectionCode:t,rightId:s});return false}return!f.Type.isNil(r.maxValue)},getEmptyValue:e=>(t,s)=>{var i,r,o;const a=(i=e.collection.get(t))==null?void 0:i.rights.get(s);if(!a){return new Set}return(r=(o=E.getValueTypeByRight(a))==null?void 0:o.getEmptyValue(a))!=null?r:new Set},getNothingSelectedValue:(e,t)=>(s,i)=>{var r,o;const a=(r=e.collection.get(s))==null?void 0:r.rights.get(i);return(o=a==null?void 0:a.nothingSelectedValue)!=null?o:t.getEmptyValue(s,i)},getSelectedVariablesAlias:e=>(t,s,i)=>{var r;const o=(r=e.collection.get(t))==null?void 0:r.rights.get(s);if(!o){return null}const a=It(i,o.selectedVariablesAliasesSeparator);return o.selectedVariablesAliases.get(a)},isModified:e=>{if(e.deleted.size>0){return true}for(const t of e.collection.values()){for(const e of t.rights.values()){if(e.isNew||e.isModified){return true}}}return false}}}getActions(){return{toggleSection:(e,{sectionCode:t})=>{if(!e.state.collection.has(t)){console.warn("ui.accessrights.v2: Attempt to toggle section that dont exists",{sectionCode:t});return}e.commit("toggleSection",{sectionCode:t})},expandAllSections:e=>{for(const t of e.state.collection.keys()){e.commit("expandSection",{sectionCode:t})}},collapseAllSections:e=>{for(const t of e.state.collection.keys()){e.commit("collapseSection",{sectionCode:t})}},toggleGroup:(e,{sectionCode:t,groupId:s})=>{var i;const r=(i=e.state.collection.get(t))==null?void 0:i.rights.get(s);if(!r){console.warn("ui.accessrights.v2: Attempt to toggle group that dont exists",{groupId:s});return}if(!r.groupHead){console.warn("ui.accessrights.v2: Attempt to toggle group that is not group head",{groupId:s});return}e.commit("toggleGroup",{sectionCode:t,groupId:s})},search:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt](e,t)},addRight:(e,{sectionCode:t,right:s})=>{if(!e.state.collection.has(t)){console.warn("ui.accessrights.v2: Adding right to section that doesn`t exists",{sectionCode:t});return}const i=e.state.collection.get(t);if(i){const i=(new Dt).internalizeExternalItem(s);e.commit("expandSection",{sectionCode:t});e.commit("addRight",{sectionCode:t,right:i})}},updateRightTitle:(e,{sectionCode:t,rightId:s,rightTitle:i})=>{if(!e.state.collection.has(t)){console.warn("ui.accessrights.v2: Updating right in section that doesn`t exists",{sectionCode:t});return}const r=e.state.collection.get(t);if(!r.rights.has(s)){console.warn("ui.accessrights.v2: Updating right that doesn`t exists",{rightId:s});return}e.commit("expandSection",{sectionCode:t});e.commit("setRightTitle",{sectionCode:t,rightId:s,title:i})},updateRightSubtitle:(e,{sectionCode:t,rightId:s,rightSubtitle:i})=>{if(!e.state.collection.has(t)){console.warn("ui.accessrights.v2: Updating right in section that doesn`t exists",{sectionCode:t});return}const r=e.state.collection.get(t);if(!r.rights.has(s)){console.warn("ui.accessrights.v2: Updating right that doesn`t exists",{rightId:s});return}e.commit("expandSection",{sectionCode:t});e.commit("setRightSubtitle",{sectionCode:t,rightId:s,subtitle:i})},deleteRight:(e,{sectionCode:t,rightId:s})=>{if(!e.state.collection.has(t)){console.warn("ui.accessrights.v2: Deleting right in section that doesn`t exists",{sectionCode:t});return}const i=e.state.collection.get(t);if(!i.rights.has(s)){console.warn("ui.accessrights.v2: Deleting right that doesn`t exists",{rightId:s});return}e.commit("expandSection",{sectionCode:t});e.commit("deleteRight",{sectionCode:t,rightId:s})},markRightAsModified:(e,{sectionCode:t,rightId:s,isModified:i})=>{if(!e.state.collection.has(t)){console.warn("ui.accessrights.v2: Updating right in section that doesn`t exists",{sectionCode:t});return}const r=e.state.collection.get(t);if(!r.rights.has(s)){console.warn("ui.accessrights.v2: Updating right that doesn`t exists",{rightId:s});return}e.commit("expandSection",{sectionCode:t});e.commit("markRightAsModified",{sectionCode:t,rightId:s,isModified:i})}}}getMutations(){return{addRight:(e,{sectionCode:t,right:s})=>{const i=e.collection.get(t);i.rights.set(s.id,s)},setRightTitle:(e,{sectionCode:t,rightId:s,title:i})=>{const r=e.collection.get(t);r.rights.get(s).title=i},setRightSubtitle:(e,{sectionCode:t,rightId:s,subtitle:i})=>{const r=e.collection.get(t);r.rights.get(s).subtitle=i},deleteRight:(e,{sectionCode:t,rightId:s})=>{const i=e.collection.get(t);i.rights.delete(s);e.deleted.add(s)},markRightAsModified:(e,{sectionCode:t,rightId:s,isModified:i})=>{const r=e.collection.get(t);r.rights.get(s).isModified=i},toggleSection:(e,{sectionCode:t})=>{const s=e.collection.get(t);s.isExpanded=!s.isExpanded},expandSection:(e,{sectionCode:t})=>{const s=e.collection.get(t);s.isExpanded=true},collapseSection:(e,{sectionCode:t})=>{const s=e.collection.get(t);s.isExpanded=false},toggleGroup:(e,{sectionCode:t,groupId:s})=>{const i=e.collection.get(t);for(const e of i.rights.values()){if(e.id===s&&e.groupHead||e.group===s){e.isGroupExpanded=!e.isGroupExpanded}}},expandGroup:(e,{sectionCode:t,groupId:s})=>{const i=e.collection.get(t);i.isExpanded=true;for(const e of i.rights.values()){if(e.id===s&&e.groupHead||e.group===s){e.isGroupExpanded=true}}},showItem:(e,{sectionCode:t,itemId:s})=>{const i=e.collection.get(t);i.isShown=true;const r=i.rights.get(s);r.isShown=true;if(r.group){i.rights.get(r.group).isShown=true}},showGroup:(e,{sectionCode:t,groupId:s})=>{const i=e.collection.get(t);i.isShown=true;for(const e of i.rights.values()){if(e.id===s&&e.groupHead||e.group===s){e.isShown=true}}},showSection:(e,{sectionCode:t})=>{const s=e.collection.get(t);s.isShown=true;for(const e of s.rights.values()){e.isShown=true}},showAll:e=>{for(const t of e.collection.values()){t.isShown=true;for(const e of t.rights.values()){e.isShown=true}}},hideAll:e=>{for(const t of e.collection.values()){t.isShown=false;for(const e of t.rights.values()){e.isShown=false}}},setSearchQuery:(e,{query:t})=>{e.searchQuery=String(t)}}}}function Zt(e,{query:t}){if(!f.Type.isString(t)){console.warn("ui.accessrights.v2: attempt to search with non-string search query");return}e.commit("setSearchQuery",{query:t});if(t===""){e.commit("showAll");return}e.commit("hideAll");const s=t.toLowerCase();for(const t of e.state.collection.values()){var i;if(t.sectionTitle.toLowerCase().includes(s)||(i=t.sectionSubTitle)!=null&&i.toLowerCase().includes(s)){e.commit("showSection",{sectionCode:t.sectionCode});continue}for(const i of t.rights.values()){if(!i.title.toLowerCase().includes(s)){continue}if(i.groupHead){e.commit("showGroup",{sectionCode:t.sectionCode,groupId:i.id})}else{e.commit("showItem",{sectionCode:t.sectionCode,itemId:i.id});if(i.group){e.commit("expandGroup",{sectionCode:t.sectionCode,groupId:i.group})}}}}}const es={name:"MenuCell",components:{CellLayout:Mt,RichMenuPopup:p.RichMenuPopup,RichMenuItem:p.RichMenuItem},inject:["section","userGroup"],data(){return{isMenuShown:false}},computed:{RichMenuItemIcon:()=>p.RichMenuItemIcon,...m.mapGetters({isMaxValueSetForAny:"accessRights/isMaxValueSetForAny",isMinValueSetForAny:"accessRights/isMinValueSetForAny"}),menuPopupOptions(){const e=290;return{bindElement:this.$refs.icon,width:e,offsetLeft:-Math.floor(e/2)+9}},shownUserGroupsWithoutCurrent(){const e=this.$store.getters["userGroups/shown"];const t=f.Runtime.clone(e);t.delete(this.userGroup.id);return t},applyDialogItems(){return U.mapUserGroups(this.shownUserGroupsWithoutCurrent)}},methods:{toggleMenu(){this.isMenuShown=!this.isMenuShown},showApplyDialog(){this.isMenuShown=false;const e=new l.Dialog({context:R.ROLE,targetNode:this.$refs.icon,multiple:false,dropdownMode:true,enableSearch:true,cacheable:false,items:this.applyDialogItems,events:{"Item:onSelect":e=>{const{item:t}=e.getData();this.$store.dispatch("userGroups/copySectionValues",{srcUserGroupId:this.userGroup.id,dstUserGroupId:t.getId(),sectionCode:this.section.sectionCode})}}});e.show()},setMaxValuesInSection(){this.isMenuShown=false;this.$store.dispatch("userGroups/setMaxAccessRightValuesInSection",{userGroupId:this.userGroup.id,sectionCode:this.section.sectionCode})},setMinValuesInSection(){this.isMenuShown=false;this.$store.dispatch("userGroups/setMinAccessRightValuesInSection",{userGroupId:this.userGroup.id,sectionCode:this.section.sectionCode})}},template:`\n\t\t<CellLayout class="ui-access-rights-v2-menu-cell" style="cursor: pointer" @click="toggleMenu">\n\t\t\t<div\n\t\t\t\tref="icon"\n\t\t\t\tclass="ui-icon-set --more-l ui-access-rights-v2-icon-more"\n\t\t\t>\n\t\t\t\t<RichMenuPopup\n\t\t\t\t\tv-if="isMenuShown"\n\t\t\t\t\t@close="isMenuShown = false"\n\t\t\t\t\t:popup-options="menuPopupOptions"\n\t\t\t\t>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\tv-if="isMaxValueSetForAny"\n\t\t\t\t\t\t:icon="RichMenuItemIcon.check"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MAX_ACCESS_RIGHTS')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage(\n\t\t\t\t\t\t\t'JS_UI_ACCESSRIGHTS_V2_SET_MAX_ACCESS_RIGHTS_SUBTITLE_SECTION',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t'#SECTION#': section.sectionTitle + (section.sectionSubTitle ? (' ' + section.sectionSubTitle) : ''),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)"\n\t\t\t\t\t\t@click="setMaxValuesInSection"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\tv-if="isMinValueSetForAny"\n\t\t\t\t\t\t:icon="RichMenuItemIcon['red-lock']"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MIN_ACCESS_RIGHTS')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage(\n\t\t\t\t\t\t\t'JS_UI_ACCESSRIGHTS_V2_SET_MIN_ACCESS_RIGHTS_SUBTITLE_SECTION',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t'#SECTION#': section.sectionTitle + (section.sectionSubTitle ? (' ' + section.sectionSubTitle) : ''),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)"\n\t\t\t\t\t\t@click="setMinValuesInSection"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t:icon="RichMenuItemIcon.copy"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_APPLY_TO_ROLE')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_APPLY_TO_ROLE_SUBTITLE')"\n\t\t\t\t\t\t@click="showApplyDialog"\n\t\t\t\t\t/>\n\t\t\t\t</RichMenuPopup>\n\t\t\t</div>\n\t\t</CellLayout>\n\t`};const ts={name:"Icon",inject:["section"],computed:{iconBgColor(){if(this.section.sectionIcon.bgColor.startsWith("--")){return`var(${this.section.sectionIcon.bgColor})`}return this.section.sectionIcon.bgColor}},template:`\n\t\t<div v-if="section.sectionIcon" class="ui-access-rights-v2-section-header-icon" :style="{\n\t\t\tbackgroundColor: iconBgColor,\n\t\t}">\n\t\t\t<div class="ui-icon-set" :class="'--' + section.sectionIcon.type"></div>\n\t\t</div>\n\t`};const ss={name:"Locator",components:{SectionIcon:ts},props:{maxWidth:{type:Number,default:430}},inject:["section","right"],computed:{rightOrGroupTitle(){if(!this.right.group){return this.right.title}const e=this.section.rights.get(this.right.group);return e==null?void 0:e.title}},template:`\n\t\t<div class="ui-access-rights-v2-cell-popup-header-locator" :style="{\n\t\t\tmaxWidth: maxWidth + 'px',\n\t\t}">\n\t\t\t<SectionIcon/>\n\t\t\t<span\n\t\t\t\tclass="ui-access-rights-v2-text-ellipsis"\n\t\t\t\t:title="section.sectionTitle"\n\t\t\t>{{ section.sectionTitle }}</span>\n\t\t\t<span\n\t\t\t\tv-if="section.sectionSubTitle" \n\t\t\t\tclass="ui-access-rights-v2-text-ellipsis"\n\t\t\t\t:title="section.sectionSubTitle"\n\t\t\t\tstyle="margin-left: 5px; color: var(--ui-color-palette-gray-70);"\n\t\t\t>{{ section.sectionSubTitle }}</span>\n\t\t\t<div class="ui-icon-set --chevron-right ui-access-rights-v2-cell-popup-header-chevron"></div>\n\t\t\t<template v-if="rightOrGroupTitle !== right.title">\n\t\t\t\t<span class="ui-access-rights-v2-text-ellipsis" :title="right.title">{{ right.title }}</span>\n\t\t\t\t<div class="ui-icon-set --chevron-right ui-access-rights-v2-cell-popup-header-chevron"></div>\n\t\t\t</template>\n\t\t\t<span class="ui-access-rights-v2-text-ellipsis" :title="rightOrGroupTitle">{{ rightOrGroupTitle }}</span>\n\t\t</div>\n\t`};const is={name:"MasterSwitcher",components:{Switcher:c.Switcher},emits:["check","uncheck"],props:{isChecked:{type:Boolean,required:true}},inject:["section","right"],computed:{switcherOptions(){return{size:"small",color:"green"}}},template:`\n\t\t<div class="ui-access-rights-v2-cell-popup-header-master-switcher" :class="{\n\t\t\t'--checked': isChecked,\n\t\t}">\n\t\t\t<slot/>\n\t\t\t<div class="ui-access-rights-v2-cell-popup-header-toggle-container">\n\t\t\t\t<Switcher\n\t\t\t\t\t:is-checked="isChecked"\n\t\t\t\t\t@check="$emit('check')"\n\t\t\t\t\t@uncheck="$emit('uncheck')"\n\t\t\t\t\t:options="switcherOptions"\n\t\t\t\t\tdata-accessrights-min-max\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const rs={name:"SingleRoleTitle",props:{userGroupTitle:{type:String,required:true}},template:`\n\t\t<div class="ui-access-rights-v2-cell-popup-header-role-container">\n\t\t\t<div>\n\t\t\t\t<div class="ui-access-rights-v2-cell-popup-header-role-caption">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="ui-access-rights-v2-cell-popup-header-role-title ui-access-rights-v2-text-ellipsis"\n\t\t\t\t\t:title="userGroupTitle"\n\t\t\t\t>\n\t\t\t\t\t{{ userGroupTitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const os={name:"DependentVariablesPopupHeader",components:{Locator:ss,MasterSwitcher:is,SingleRoleTitle:rs},emits:["setMax","setMin"],props:{values:{type:Set,required:true}},inject:["right"],computed:{isChecked(){if(!this.isMinMaxValuesSet){return this.values.size>0}return this.isSelectedAnythingBesidesMin},isMinMaxValuesSet(){return!f.Type.isNil(this.right.minValue)&&!f.Type.isNil(this.right.maxValue)},isSelectedAnythingBesidesMin(){if(this.values.size<=0){return false}for(const e of this.values){if(!this.right.minValue.has(e)){return true}}return false}},methods:{setMin(){if(this.isMinMaxValuesSet){this.$emit("setMin")}},setMax(){if(this.isMinMaxValuesSet){this.$emit("setMax")}}},template:`\n\t\t<div>\n\t\t\t<Locator/>\n\t\t\t<MasterSwitcher\n\t\t\t\t:is-checked="isChecked"\n\t\t\t\t@check="setMax"\n\t\t\t\t@uncheck="setMin"\n\t\t\t>\n\t\t\t\t<slot/>\n\t\t\t</MasterSwitcher>\n\t\t</div>\n\t`};const as={name:"DependentVariablesPopupContent",emits:["apply"],components:{Switcher:c.Switcher,PopupHeader:os,Icon:r.BIcon},directives:{hint:n.hint},props:{initialValues:{type:Set,default:new Set}},data(){return{notSavedValues:this.getNotSavedValues()}},inject:["section","right","redefineApply"],computed:{isMinMaxValuesSet(){return!f.Type.isNil(this.right.minValue)&&!f.Type.isNil(this.right.maxValue)},variablesShownInList(){if(!this.isMinMaxValuesSet){return this.right.variables}const e=f.Runtime.clone(this.right.variables);for(const t of this.right.minValue){e.delete(t)}for(const[t,s]of e){if(s.secondary){e.delete(t)}}return e},secondaryVariables(){const e=new Map;for(const[t,s]of this.right.variables){if(s.secondary){e.set(t,s)}}return e},nothingSelectedValues(){return this.$store.getters["accessRights/getNothingSelectedValue"](this.section.sectionCode,this.right.id)},switcherOptions(){return{size:"small",color:"primary"}},secondarySwitcherOptions(){return{size:"extra-small",color:"green"}},iconSet(){return r.Set}},mounted(){this.redefineApply((()=>{this.apply()}))},methods:{addValue(e){const t=this.right.variables.get(e);if(!t){return}this.notSavedValues.add(e);if(!f.Type.isNil(t.requires)){for(const e of t.requires){this.notSavedValues.add(e)}}if(!f.Type.isNil(t.conflictsWith)){for(const e of t.conflictsWith){this.notSavedValues.delete(e)}}for(const t of this.right.variables.values()){if(t.id===e){continue}if(this.notSavedValues.has(t.id)&&!f.Type.isNil(t.conflictsWith)){for(const e of t.conflictsWith){if(this.notSavedValues.has(e)){this.notSavedValues.delete(t.id)}}}}},removeValue(e){this.notSavedValues.delete(e);for(const t of this.notSavedValues){if(t===e){continue}const s=this.right.variables.get(t);if(!s){continue}if(!f.Type.isNil(s.requires)&&s.requires.has(e)){this.notSavedValues.delete(t)}}},setMaxValue(){for(const e of this.right.maxValue){this.addValue(e)}},setMinValue(){for(const e of this.right.minValue){this.addValue(e)}},apply(){let e=this.notSavedValues;if(e.size<=0){e=this.nothingSelectedValues}this.$emit("apply",{values:e})},getNotSavedValues(){const e=new Set;this.initialValues.forEach((t=>{if(this.right.variables.has(t)){e.add(t)}}));return e},getVariableHintOptions(e){return{text:e.hint,popupOptions:{bindOptions:{position:"bottom"},width:262,angle:{position:"top",offset:33}}}}},template:`\n\t\t<div>\n\t\t\t<PopupHeader\n\t\t\t\t:values="notSavedValues"\n\t\t\t\t@set-max="setMaxValue"\n\t\t\t\t@set-min="setMinValue"\n\t\t\t>\n\t\t\t\t<slot name="role-title"/>\n\t\t\t</PopupHeader>\n\t\t\t<div class="ui-access-rights-v2-dv-popup--line-container">\n\t\t\t\t<div\n\t\t\t\t\tv-for="[variableId, variable] in variablesShownInList"\n\t\t\t\t\t:key="variableId"\n\t\t\t\t\tclass="ui-access-rights-v2-dv-popup--line"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-access-rights-v2-dv-popup--line-title">\n\t\t\t\t\t\t<span class="ui-access-rights-v2-text-ellipsis" :title="variable.title">{{ variable.title }}</span>\n\t\t\t\t\t\t<Icon v-if="variable.hint" :name="iconSet.INFO_1" :color="'var(--ui-color-palette-gray-40)'" :size="20" v-hint="getVariableHintOptions(variable)"></Icon>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Switcher\n\t\t\t\t\t\t:is-checked="notSavedValues.has(variable.id)"\n\t\t\t\t\t\t@check="addValue(variable.id)"\n\t\t\t\t\t\t@uncheck="removeValue(variable.id)"\n\t\t\t\t\t\t:options="switcherOptions"\n\t\t\t\t\t\t:data-accessrights-variable-id="variable.id"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-for="[variableId, variable] in secondaryVariables"\n\t\t\t\t\t:key="variableId"\n\t\t\t\t\tclass="ui-access-rights-v2-dv-popup--line --secondary"\n\t\t\t\t>\n\t\t\t\t\t<Switcher\n\t\t\t\t\t\t:is-checked="notSavedValues.has(variable.id)"\n\t\t\t\t\t\t@check="addValue(variable.id)"\n\t\t\t\t\t\t@uncheck="removeValue(variable.id)"\n\t\t\t\t\t\t:options="secondarySwitcherOptions"\n\t\t\t\t\t\tstyle="padding-right: 5px;"\n\t\t\t\t\t\t:data-accessrights-variable-id="variable.id"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class="ui-access-rights-v2-text-ellipsis">{{ variable.title }}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="right.dependentVariablesPopupHint"\n\t\t\t\tclass="ui-access-rights-v2-dv-popup--hint"\n\t\t\t>\n\t\t\t\t<Icon :name="iconSet.INFO_1" :color="'var(--ui-color-palette-gray-40)'" :size="20"></Icon>\n\t\t\t\t<span>{{ right.dependentVariablesPopupHint }}</span>\n\t\t\t</div>\n\t\t</div>\n\t`};const ls={name:"AllRolesTitle",template:`\n\t\t<div class="ui-access-rights-v2-cell-popup-header-all-role-container">\n\t\t\t<div class="ui-icon-set --persons-3" style="margin-right: 4px;"></div>\n\t\t\t<div class="ui-access-rights-v2-cell-popup-header-all-roles-caption">{{ \n\t\t\t\t$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ALL_ROLES')\n\t\t\t}}</div>\n\t\t</div>\n\t`};const ns={name:"ValuePopup",components:{Popup:a.Popup},emits:["close","apply"],provide(){return{redefineApply:e=>{this.onApply=e}}},data(){return{onApply:()=>{this.$emit("apply")}}},computed:{popupOptions(){return{autoHide:true,closeEsc:true,cacheable:false,minWidth:466,padding:18}}},mounted(){void this.$nextTick((()=>{const e=new o.ApplyButton({color:o.ButtonColor.PRIMARY,onclick:()=>{this.apply();this.$emit("close")}});e.renderTo(this.$refs["button-container"]);const t=new o.CancelButton({onclick:()=>{this.$emit("close")},text:this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_CANCEL")});t.renderTo(this.$refs["button-container"])}))},methods:{apply(){this.onApply()}},template:`\n\t\t<Popup @close="$emit('close')" :options="popupOptions">\n\t\t\t<slot/>\n\t\t\t<div ref="button-container" class="ui-access-rights-v2-value-popup-buttons"></div>\n\t\t</Popup>\n\t`};const cs={name:"DependentVariables",components:{PopupContent:as,AllRolesTitle:ls,ValuePopup:ns},emits:["close"],inject:["section","right"],methods:{apply({values:e}){this.$store.dispatch("userGroups/setAccessRightValuesForShown",{sectionCode:this.section.sectionCode,valueId:this.right.id,values:e})}},template:`\n\t\t<ValuePopup @close="$emit('close')">\n\t\t\t<PopupContent @apply="apply">\n\t\t\t\t<template #role-title>\n\t\t\t\t\t<AllRolesTitle/>\n\t\t\t\t</template>\n\t\t\t</PopupContent>\n\t\t</ValuePopup>\n\t`};let us=e=>e,ds,hs;var ps=babelHelpers.classPrivateFieldLooseKey("toggleSelectButtons");var gs=babelHelpers.classPrivateFieldLooseKey("selectAll");var vs=babelHelpers.classPrivateFieldLooseKey("deselectAll");var bs=babelHelpers.classPrivateFieldLooseKey("onItemStatusChange");class ms extends l.DefaultFooter{constructor(e,t){super(e,t);Object.defineProperty(this,bs,{value:Cs});Object.defineProperty(this,vs,{value:ys});Object.defineProperty(this,gs,{value:fs});Object.defineProperty(this,ps,{value:Ss});this.selectAllButton=f.Tag.render(ds||(ds=us`<div class="ui-selector-footer-link">${0}</div>`),f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ALL_SELECT_LABEL"));f.Dom.hide(this.selectAllButton);f.Event.bind(this.selectAllButton,"click",babelHelpers.classPrivateFieldLooseBase(this,gs)[gs].bind(this));this.deselectAllButton=f.Tag.render(hs||(hs=us`<div class="ui-selector-footer-link">${0}</div>`),f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ALL_DESELECT_LABEL"));f.Dom.hide(this.deselectAllButton);f.Event.bind(this.deselectAllButton,"click",babelHelpers.classPrivateFieldLooseBase(this,vs)[vs].bind(this));this.getDialog().subscribe("Item:onSelect",babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].bind(this));this.getDialog().subscribe("Item:onDeselect",babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].bind(this))}getContent(){babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]();return[this.selectAllButton,this.deselectAllButton]}}function Ss(){if(this.getDialog().getSelectedItems().length===this.getDialog().getItems().length){f.Dom.hide(this.selectAllButton);f.Dom.show(this.deselectAllButton)}else{f.Dom.show(this.selectAllButton);f.Dom.hide(this.deselectAllButton)}}function fs(){this.getDialog().getItems().forEach((e=>{e.select()}))}function ys(){this.getDialog().getSelectedItems().forEach((e=>{e.deselect()}))}function Cs(){babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]()}let Is=e=>e,Ps;var Ls=babelHelpers.classPrivateFieldLooseKey("renderVueApp");class Ms extends l.BaseHeader{constructor(...e){super(...e);Object.defineProperty(this,Ls,{value:Rs})}render(){return babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]()}}function Rs(){const e=f.Tag.render(Ps||(Ps=Is`<div style="padding: 20px 20px 0;"></div>`));const t=g.BitrixVue.createApp(ss,{maxWidth:this.getDialog().getWidth()});t.provide("section",this.getOption("section"));t.provide("right",this.getOption("right"));t.mount(e);return e}const Hs={name:"Selector",emits:["apply","close"],props:{initialValues:{type:Set,default:new Set}},inject:["section","right"],data(){return{values:this.initialValues}},dialog:null,computed:{isAllSelected(){return this.values.has(this.right.allSelectedCode)},selectedVariables(){return vt(this.right.variables,this.values,this.isAllSelected)},dialogItems(){return U.mapVariables(this.right.variables)},selectedDialogItems(){return this.dialogItems.filter((e=>this.selectedVariables.has(e.id)))}},mounted(){this.showSelector()},beforeUnmount(){var e;(e=this.dialog)==null?void 0:e.hide()},methods:{showSelector(){this.dialog=new l.Dialog({height:400,context:R.VARIABLE,enableSearch:this.right.enableSearch,multiple:true,autoHide:true,hideByEsc:true,dropdownMode:true,compactView:this.right.compactView,showAvatars:this.right.showAvatars,selectedItems:this.selectedDialogItems,searchOptions:{allowCreateItem:false},cacheable:false,events:{"Item:onSelect":this.onItemSelect,"Item:onDeselect":this.onItemDeselect,onHide:this.apply,onDestroy:()=>{this.dialog=null}},entities:[{id:H.VARIABLE}],items:this.dialogItems,header:Ms,headerOptions:{section:this.section,right:this.right},footer:ms});this.dialog.show()},onItemSelect(e){const t=e.getData().item;this.addValue(String(t.getId()))},onItemDeselect(e){const t=e.getData().item;this.removeValue(String(t.getId()))},addValue(e){const t=f.Runtime.clone(this.values);t.add(e);if(t.size>=this.right.variables.size){this.setValues(new Set([this.right.allSelectedCode]))}else{this.setValues(t)}},removeValue(e){if(this.values.has(this.right.allSelectedCode)){const t=[...this.right.variables.values()].map((e=>e.id));const s=new Set(t);s.delete(e);this.setValues(s)}else{const t=[...this.values].filter((t=>t!==e));this.setValues(new Set(t))}},setValues(e){this.values=e},apply(){this.setNothingSelectedValueIfNeeded();this.$emit("apply",{values:this.values});this.$emit("close")},setNothingSelectedValueIfNeeded(){if(this.values.size<=0){const e=this.$store.getters["accessRights/getNothingSelectedValue"](this.section.sectionCode,this.right.id);for(const t of e){this.addValue(t)}}}},template:`\n\t\t<div></div>\n\t`};const Bs={name:"Multivariables",emits:["close"],components:{Selector:Hs},inject:["section","right"],methods:{apply({values:e}){this.$store.dispatch("userGroups/setAccessRightValuesForShown",{sectionCode:this.section.sectionCode,valueId:this.right.id,values:e})},close(){this.$emit("close")}},template:`\n\t\t<Selector @apply="apply" @close="close"/>\n\t`};const ws="ui-access-rights-v2-row-value-variables";const Fs={name:"Variables",emits:["close"],inject:["section","right"],mounted(){this.showSelector()},beforeUnmount(){this.closeSelector()},methods:{showSelector(){const e=[];for(const t of this.right.variables.values()){e.push({id:t.id,text:t.title,onclick:(e,s)=>{var i;(i=s.getMenuWindow())==null?void 0:i.close();this.setValue(t.id)}})}u.MenuManager.show({id:ws,bindElement:this.$el,items:e,autoHide:true,cacheable:false,events:{onClose:()=>{this.$emit("close")}}})},setValue(e){this.$store.dispatch("userGroups/setAccessRightValuesForShown",{sectionCode:this.section.sectionCode,valueId:this.right.id,values:new Set([e])})},closeSelector(){var e;(e=u.MenuManager.getMenuById(ws))==null?void 0:e.close()}},template:`\n\t\t<div></div>\n\t`};const Vs={name:"SelectedHint",props:{html:{type:String,required:true}},data(){return{isRendered:true}},watch:{html(){this.isRendered=false;void this.$nextTick((()=>{this.isRendered=true}))}},directives:{hint:n.hint},template:`\n\t\t<div v-if="isRendered" v-hint="{\n\t\t\thtml,\n\t\t\tpopupOptions: {\n\t\t\t\toffsetTop: 3,\n\t\t\t},\n\t\t}" data-hint-init="vue">\n\t\t\t<slot/>\n\t\t</div>\n\t`};const Ts={name:"DependentVariables",components:{ValuePopup:ns,PopupContent:as,SelectedHint:Vs,SingleRoleTitle:rs},props:{value:{type:Object,required:true}},data(){return{isPopupShown:false}},inject:["section","userGroup","right"],computed:{selectedVariables(){return vt(this.right.variables,this.value.values,false)},currentAlias(){return this.$store.getters["accessRights/getSelectedVariablesAlias"](this.section.sectionCode,this.value.id,this.value.values)},title(){if(f.Type.isString(this.currentAlias)){return this.currentAlias}if(this.selectedVariables.size<=0){return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ADD")}return bt(this.selectedVariables)},hintHtml(){return St(this.selectedVariables,this.hintTitle,this.right.variables)},hintTitle(){if(f.Type.isString(this.right.hintTitle)){return this.right.hintTitle}return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_SELECTED_ITEMS_TITLE")}},methods:{apply({values:e}){this.$store.dispatch("userGroups/setAccessRightValues",{sectionCode:this.section.sectionCode,userGroupId:this.userGroup.id,valueId:this.value.id,values:e})}},template:`\n\t\t<div class='ui-access-rights-v2-column-item-text-link' :class="{\n\t\t\t'ui-access-rights-v2-text-ellipsis': !hintHtml\n\t\t}" @click="isPopupShown = true">\n\t\t\t<SelectedHint v-if="hintHtml" :html="hintHtml">{{title}}</SelectedHint>\n\t\t\t<div v-else :title="title">{{title}}</div>\n\t\t\t<ValuePopup v-if="isPopupShown" @close="isPopupShown = false">\n\t\t\t\t<PopupContent\n\t\t\t\t\t@apply="apply"\n\t\t\t\t\t:initial-values="value.values"\n\t\t\t\t>\n\t\t\t\t\t<template #role-title>\n\t\t\t\t\t\t<SingleRoleTitle :user-group-title="userGroup.title"/>\n\t\t\t\t\t</template>\n\t\t\t\t</PopupContent>\n\t\t\t</ValuePopup>\n\t\t</div>\n\t`};const Es={name:"Multivariables",components:{SelectedHint:Vs,Selector:Hs},props:{value:{type:Object,required:true}},inject:["section","userGroup","right"],data(){return{isSelectorShown:false}},computed:{isAllSelected(){return this.value.values.has(this.right.allSelectedCode)},selectedVariables(){return vt(this.right.variables,this.value.values,this.isAllSelected)},currentAlias(){return this.$store.getters["accessRights/getSelectedVariablesAlias"](this.section.sectionCode,this.value.id,this.value.values)},title(){if(f.Type.isString(this.currentAlias)){return this.currentAlias}if(this.isAllSelected){return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ALL_ACCEPTED")}if(this.selectedVariables.size<=0){return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ADD")}return bt(this.selectedVariables)},hintHtml(){return St(this.selectedVariables,this.hintTitle,this.right.variables)},hintTitle(){if(f.Type.isString(this.right.hintTitle)){return this.right.hintTitle}return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_SELECTED_ITEMS_TITLE")}},methods:{showSelector(){this.isSelectorShown=true},setValues({values:e}){this.$store.dispatch("userGroups/setAccessRightValues",{sectionCode:this.section.sectionCode,userGroupId:this.userGroup.id,valueId:this.value.id,values:e})}},template:`\n\t\t<SelectedHint \n\t\t\tv-if="hintHtml"\n\t\t\t:html="hintHtml" \n\t\t\tclass='ui-access-rights-v2-column-item-text-link'\n\t\t\t@click="showSelector"\n\t\t\tv-bind="$attrs"\n\t\t>\n\t\t\t{{ title }}\n\t\t</SelectedHint>\n\t\t<div \n\t\t\tv-else\n\t\t\tclass='ui-access-rights-v2-column-item-text-link ui-access-rights-v2-text-ellipsis'\n\t\t\t@click="showSelector"\n\t\t\t:title="title"\n\t\t\tv-bind="$attrs"\n\t\t>\n\t\t\t{{ title }}\n\t\t</div>\n\t\t<Selector\n\t\t\tv-if="isSelectorShown" \n\t\t\t:initial-values="value.values"\n\t\t\t@close="isSelectorShown = false"\n\t\t\t@apply="setValues"\n\t\t/>\n\t`};const As={name:"Toggler",components:{Switcher:c.Switcher},props:{value:{type:Object,required:true}},inject:["section","userGroup"],computed:{isChecked(){return this.value.values.has("1")}},methods:{setValue(e){this.$store.dispatch("userGroups/setAccessRightValues",{userGroupId:this.userGroup.id,sectionCode:this.section.sectionCode,valueId:this.value.id,values:new Set([e])})}},template:`\n\t\t<Switcher\n\t\t\t:is-checked="isChecked"\n\t\t\t@check="setValue('1')"\n\t\t\t@uncheck="setValue('0')"\n\t\t\t:options="{\n\t\t\t\tsize: 'extra-small',\n\t\t\t\tcolor: 'green',\n\t\t\t}"\n\t\t/>\n\t`};const _s="ui-access-rights-v2-column-item-popup-variables";const Gs={name:"Variables",props:{value:{type:Object,required:true}},inject:["section","userGroup","right"],computed:{emptyVariableId(){const e=this.$store.getters["accessRights/getEmptyValue"](this.section.sectionCode,this.value.id);return e[0]},currentVariableId(){if(this.value.values.size<=0){return this.emptyVariableId}const[e]=this.value.values;return e},currentAlias(){return this.$store.getters["accessRights/getSelectedVariablesAlias"](this.section.sectionCode,this.value.id,this.value.values)},currentVariableTitle(){if(f.Type.isString(this.currentAlias)){return this.currentAlias}const e=this.right.variables.get(this.currentVariableId);if(!e){return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ADD")}return e.title}},methods:{showSelector(e){const t=[];for(const e of this.right.variables.values()){t.push({id:e.id,text:e.title,onclick:(t,s)=>{var i;(i=s.getMenuWindow())==null?void 0:i.close();this.setValue(e.id)}})}u.MenuManager.show({id:_s,bindElement:e.target,items:t,autoHide:true,cacheable:false})},setValue(e){this.$store.dispatch("userGroups/setAccessRightValues",{sectionCode:this.section.sectionCode,userGroupId:this.userGroup.id,valueId:this.value.id,values:new Set([e])})}},template:`\n\t\t<div\n\t\t\tclass='ui-access-rights-v2-column-item-text-link ui-access-rights-v2-text-ellipsis'\n\t\t\t:title="currentVariableTitle"\n\t\t\t@click="showSelector"\n\t\t>\n\t\t\t{{ currentVariableTitle }}\n\t\t</div>\n\t`};const xs=Object.freeze({DependentVariables:Ts,Multivariables:Es,Toggler:As,Variables:Gs});const Os=Object.freeze({DependentVariables:cs,Multivariables:Bs,Variables:Fs});function Us(e){const t=E.getValueTypeByRight(e);if(!t){return""}return t.getComponentName()}const $s={name:"ValueCell",components:{CellLayout:Mt,...xs},props:{right:{type:Object,required:true}},inject:["section","userGroup"],provide(){return{right:this.right}},computed:{value(){const e=this.userGroup.accessRights.get(this.right.id);return e||this.$store.getters["userGroups/getEmptyAccessRightValue"](this.userGroup.id,this.section.sectionCode,this.right.id)},cellComponent(){return Us(this.right)}},template:`\n\t\t<CellLayout\n\t\t\t:class="{\n\t\t\t\t'ui-access-rights-v2-group-children': right.group,\n\t\t\t\t'--modified': value.isModified\n\t\t\t}"\n\t\t\tv-memo="[userGroup.id, value.values, value.isModified]"\n\t\t>\n\t\t\t<Component\n\t\t\t\t:is="cellComponent"\n\t\t\t\t:value="value"\n\t\t\t\t:data-accessrights-right-id="right.id"\n\t\t\t/>\n\t\t</CellLayout>\n\t`};const js={name:"Column",components:{ColumnLayout:Rt,ValueCell:$s,MenuCell:es},props:{userGroup:{type:Object,required:true},rights:{type:Map,required:true}},provide(){return{userGroup:g.computed((()=>this.userGroup))}},computed:{renderedRights(){const e=new Map;for(const[t,s]of this.rights){if(gt(s)){e.set(t,s)}}return e}},template:`\n\t\t<ColumnLayout ref="column">\n\t\t\t<MenuCell/>\n\t\t\t<ValueCell\n\t\t\t\tv-for="[rightId, accessRightItem] in renderedRights"\n\t\t\t\t:key="rightId"\n\t\t\t\t:right="accessRightItem"\n\t\t\t/>\n\t\t</ColumnLayout>\n\t`};const Ds={name:"ColumnList",components:{Column:js,SyncHorizontalScroll:Ft,ColumnLayout:Rt},props:{userGroups:{type:Map,required:true},rights:{type:Map,required:true}},throttledScrollHandler:null,throttledResizeHandler:null,ears:null,isEarsInited:false,data(){return{isLeftShadowShown:false,isRightShadowShown:false}},created(){this.throttledScrollHandler=f.Runtime.throttle((()=>{this.adjustShadowsVisibility()}),200);this.throttledResizeHandler=f.Runtime.throttle((()=>{this.adjustShadowsVisibility();this.adjustEars()}),200)},mounted(){f.Event.bind(window,"resize",this.throttledResizeHandler);this.adjustShadowsVisibility();this.initEars()},beforeUnmount(){this.destroyEars();f.Event.unbind(window,"resize",this.throttledResizeHandler)},watch:{userGroups(e,t){if(e.size!==t.size){this.adjustShadowsVisibility();this.adjustEars()}}},methods:{calculateShadowsVisibility(){if(!this.$refs["column-container"]){return{isLeftShadowShown:false,isRightShadowShown:false}}const e=this.$refs["column-container"].$el.scrollLeft;const t=e>0;const s=this.$refs["column-container"].$el.offsetWidth;return{isLeftShadowShown:t,isRightShadowShown:this.$refs["column-container"].$el.scrollWidth>Math.round(e+s)}},adjustShadowsVisibility(){requestAnimationFrame((()=>{const{isLeftShadowShown:e,isRightShadowShown:t}=this.calculateShadowsVisibility();this.isLeftShadowShown=e;this.isRightShadowShown=t}))},adjustEars(){if(!this.isEarsInited){return}requestAnimationFrame((()=>{this.ears.toggleEars()}))},initEars(){if(!this.$refs["column-container"]){return}if(this.ears){return}this.ears=new d.Ears({container:this.$refs["column-container"].$el,immediateInit:true,smallSize:true});requestAnimationFrame((()=>{if(!this.ears||!this.$refs["column-container"]){this.ears=null;return}const e=this.$refs["column-container"].$el.scrollLeft;this.ears.init();f.Dom.style(this.ears.getWrapper(),"flex",1);if(e>0){this.$refs["column-container"].$el.scrollLeft=e}this.isEarsInited=true}))},destroyEars(){var e;(e=this.ears)==null?void 0:e.destroy();this.isEarsInited=false;this.ears=null}},template:`\n\t\t<div\n\t\t\tclass='ui-access-rights-v2-section-content'\n\t\t\t:class="{\n\t\t\t\t'ui-access-rights-v2-section-shadow-left-shown': isLeftShadowShown,\n\t\t\t\t'ui-access-rights-v2-section-shadow-right-shown': isRightShadowShown,\n\t\t\t}"\n\t\t>\n\t\t\t<SyncHorizontalScroll\n\t\t\t\tref="column-container"\n\t\t\t\tclass='ui-access-rights-v2-section-wrapper'\n\t\t\t\t@scroll="throttledScrollHandler"\n\t\t\t>\n\t\t\t\t<Column\n\t\t\t\t\tv-for="[groupId, group] in userGroups"\n\t\t\t\t\t:key="groupId"\n\t\t\t\t\t:user-group="group"\n\t\t\t\t\t:rights="rights"\n\t\t\t\t\t:data-accessrights-user-group-id="groupId"\n\t\t\t\t/>\n\t\t\t\t<ColumnLayout/>\n\t\t\t</SyncHorizontalScroll>\n\t\t</div>\n\t`};let ks=e=>e,Ns;const Ks={name:"Hint",props:{html:{type:String,required:true}},computed:{...m.mapState({guid:e=>e.application.guid})},mounted(){this.renderHint()},watch:{html(){f.Dom.clean(this.$refs.container);this.renderHint()}},methods:{renderHint(){const e=f.Tag.render(Ns||(Ns=ks`<span data-hint-html="true" data-hint-interactivity="true"></span>`));e.setAttribute("data-hint",this.html);f.Dom.append(e,this.$refs.container);this.getHintManager().initNode(e)},getHintManager(){return E.getHint(this.guid)}},template:'<span class="ui-access-rights-v2-hint-container" ref="container"></span>'};const zs={name:"Header",components:{Hint:Ks,Icon:ts},inject:["section"],methods:{toggleSection(){this.$store.dispatch("accessRights/toggleSection",{sectionCode:this.section.sectionCode})},onSectionEventButtonClick(){const e={guid:this.$store.getters["application/guid"],section:this.section};S.EventEmitter.emit("BX.UI.AccessRights.V2:onSectionHeaderClick",e)}},template:`\n\t\t<div\n\t\t\t@click="toggleSection"\n\t\t\tclass='ui-access-rights-v2-section-header'\n\t\t\t:class="{\n\t\t\t\t'--expanded': section.isExpanded,\n\t\t\t}" \n\t\t\tv-memo="[section.isExpanded]"\n\t\t>\n\t\t\t<div class="ui-access-rights-v2-section-header-expander">\n\t\t\t\t<div class='ui-icon-set' :class="{\n\t\t\t\t\t'--chevron-up': section.isExpanded,\n\t\t\t\t\t'--chevron-down': !section.isExpanded,\n\t\t\t\t}"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<Icon/>\n\t\t\t<span \n\t\t\t\tclass="ui-access-rights-v2-text-ellipsis ui-access-rights-v2-section-title"\n\t\t\t\t:title="section.sectionTitle"\n\t\t\t>{{ section.sectionTitle }}</span>\n\t\t\t<span\n\t\t\t\tv-if="section.sectionSubTitle"\n\t\t\t\tclass="ui-access-rights-v2-text-ellipsis ui-access-rights-v2-section-subtitle"\n\t\t\t\t:title="section.sectionSubTitle"\n\t\t\t>\n\t\t\t\t{{ section.sectionSubTitle }}\n\t\t\t</span>\n\t\t\t<Hint v-if="section.sectionHint" :html="section.sectionHint"/>\n\t\t\t<span \n\t\t\t\tv-if="section.action"\n\t\t\t\tclass="ui-btn ui-btn-light-border ui-btn-xs ui-access-rights-v2-section-action"\n\t\t\t\t@click.stop="onSectionEventButtonClick"\n\t\t\t>{{ section.action.buttonText }}</span>\n\t\t</div>\n\t`};const Js={name:"MenuCell",components:{CellLayout:Mt},template:`\n\t\t<CellLayout class="ui-access-rights-v2-menu-cell"/>\n\t`};const Xs={name:"RowValue",components:{...Os},emits:["close"],inject:["right"],computed:{component(){return Us(this.right)}},template:`\n\t\t<Component :is="component" @close="$emit('close')" />\n\t`};const qs={name:"TitleCell",components:{Hint:Ks,RowValue:Xs,RichMenuItem:p.RichMenuItem,RichMenuPopup:p.RichMenuPopup},props:{right:{type:Object,required:true}},inject:["section"],provide(){return{right:this.right}},data(){return{isMenuShown:false,isRowValueShown:false}},computed:{RichMenuItemIcon:()=>p.RichMenuItemIcon,isMinValueSet(){return this.$store.getters["accessRights/isMinValueSet"](this.section.sectionCode,this.right.id)},isMaxValueSet(){return this.$store.getters["accessRights/isMaxValueSet"](this.section.sectionCode,this.right.id)},isRowValueConfigurable(){var e,t;return(e=(t=E.getValueTypeByRight(this.right))==null?void 0:t.isRowValueConfigurable())!=null?e:false},isRightDeletable(){return this.right.isDeletable},rightCellStyle(){return{"margin-left":!this.right.groupHead&&!this.right.group&&!this.right.iconClass?"23px":null,"max-width":this.right.iconClass?"calc(100% - 52px)":"auto"}}},methods:{toggleGroup(){if(!this.right.groupHead){return}this.$store.dispatch("accessRights/toggleGroup",{sectionCode:this.section.sectionCode,groupId:this.right.id})},toggleMenu(){this.isMenuShown=!this.isMenuShown},setMaxValuesForRight(){this.isRowValueShown=false;this.isMenuShown=false;this.$store.dispatch("userGroups/setMaxAccessRightValuesForRight",{sectionCode:this.section.sectionCode,rightId:this.right.id})},setMinValuesForRight(){this.isRowValueShown=false;this.isMenuShown=false;this.$store.dispatch("userGroups/setMinAccessRightValuesForRight",{sectionCode:this.section.sectionCode,rightId:this.right.id})},openRowValue(){this.isMenuShown=false;this.isRowValueShown=true},onRightClick(){const e={guid:this.$store.getters["application/guid"],right:this.right};S.EventEmitter.emit("BX.UI.AccessRights.V2:onRightClick",e)},deleteRight(){this.$store.dispatch("userGroups/deleteRight",{rightId:this.right.id});this.$store.dispatch("accessRights/deleteRight",{sectionCode:this.section.sectionCode,rightId:this.right.id});S.EventEmitter.emit("BX.UI.AccessRights.V2:onRightDelete",{guid:this.$store.getters["application/guid"],right:this.right})}},template:`\n\t\t<div\n\t\t\tclass='ui-access-rights-v2-column-item-text ui-access-rights-v2-column-item-title'\n\t\t\t@click="toggleGroup"\n\t\t\t:style="{\n\t\t\t\tcursor: right.groupHead ? 'pointer' : null,\n\t\t\t}"\n\t\t\tv-memo="[right.isGroupExpanded, right.title, right.subtitle]"\n\t\t\t:data-accessrights-right-id="right.id"\n\t\t>\n\t\t\t<span\n\t\t\t\tv-if="right.groupHead"\n\t\t\t\tclass="ui-icon-set"\n\t\t\t\t:class="{\n\t\t\t\t\t'--o-circle-minus': right.isGroupExpanded,\n\t\t\t\t\t'--o-circle-plus': !right.isGroupExpanded,\n\t\t\t\t}"\n\t\t\t></span>\n\t\t\t<div \n\t\t\t\tv-if="right.iconClass" \n\t\t\t\t:class="right.iconClass"\n\t\t\t\tclass="ui-access-rights-v2-column-item-title-icon"\n\t\t\t><i></i></div>\n\t\t\t<div class="ui-access-rights-v2-column-item-title-block" :style="rightCellStyle">\n\t\t\t\t<span\n\t\t\t\t\tv-if="right.isClickable"\n\t\t\t\t\tclass="ui-access-rights-v2-column-item-title-link ui-access-rights-v2-text-ellipsis"\n\t\t\t\t\t@click="onRightClick"\n\t\t\t\t>\n\t\t\t\t\t{{ right.title }}<Hint v-once v-if="right.hint" :html="right.hint"/>\n\t\t\t\t</span>\n\t\t\t\t<span \n\t\t\t\t\tv-else \n\t\t\t\t\tclass="ui-access-rights-v2-text-wrap"\n\t\t\t\t>\n\t\t\t\t\t{{ right.title }}<Hint v-once v-if="right.hint" :html="right.hint"/>\n\t\t\t\t</span>\n\t\t\t\t<span \n\t\t\t\t\tv-if="right.subtitle" \n\t\t\t\t\tclass="ui-access-rights-v2-column-item-subtitle ui-access-rights-v2-text-ellipsis"\n\t\t\t\t>{{ right.subtitle }}</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<div\n\t\t\tref="icon" \n\t\t\tclass="ui-icon-set --more-l ui-access-rights-v2-icon-more ui-access-rights-v2-title-column-menu" \n\t\t\t@click="toggleMenu"\n\t\t>\n\t\t\t<RichMenuPopup\n\t\t\t\tv-if="isMenuShown"\n\t\t\t\t@close="isMenuShown = false"\n\t\t\t\t:popup-options="{bindElement: $refs.icon, width: 300}"\n\t\t\t>\n\t\t\t\t<RichMenuItem\n\t\t\t\t\tv-if="isMaxValueSet"\n\t\t\t\t\t:icon="RichMenuItemIcon.check"\n\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MAX_ACCESS_RIGHTS_ROW')"\n\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MAX_ACCESS_RIGHTS_ROW_SUBTITLE')"\n\t\t\t\t\t@click="setMaxValuesForRight"\n\t\t\t\t/>\n\t\t\t\t<RichMenuItem\n\t\t\t\t\tv-if="isMinValueSet"\n\t\t\t\t\t:icon="RichMenuItemIcon['red-lock']"\n\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MIN_ACCESS_RIGHTS_ROW')"\n\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MIN_ACCESS_RIGHTS_ROW_SUBTITLE')"\n\t\t\t\t\t@click="setMinValuesForRight"\n\t\t\t\t/>\n\t\t\t\t<RichMenuItem\n\t\t\t\t\tv-if="isRowValueConfigurable"\n\t\t\t\t\t:icon="RichMenuItemIcon.settings"\n\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_OPEN_ROW_VALUE')"\n\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_OPEN_ROW_VALUE_SUBTITLE')"\n\t\t\t\t\t@click="openRowValue"\n\t\t\t\t/>\n\t\t\t\t<RichMenuItem\n\t\t\t\t\tv-if="isRightDeletable"\n\t\t\t\t\t:icon="RichMenuItemIcon['trash-bin']"\n\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_DELETE_ROW')"\n\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_DELETE_ROW_SUBTITLE')"\n\t\t\t\t\t@click="deleteRight"\n\t\t\t\t/>\n\t\t\t</RichMenuPopup>\n\t\t\t<RowValue v-if="isRowValueShown" @close="isRowValueShown = false"/>\n\t\t</div>\n\t`};const Ws={name:"TitleColumn",components:{TitleCell:qs,ColumnLayout:Rt,CellLayout:Mt,MenuCell:Js},props:{rights:{type:Map,required:true}},computed:{renderedRights(){const e=new Map;for(const[t,s]of this.rights){if(gt(s)){e.set(t,s)}}return e}},template:`\n\t\t<ColumnLayout>\n\t\t\t<MenuCell/>\n\t\t\t<CellLayout\n\t\t\t\tv-for="[rightId, accessRightItem] in renderedRights"\n\t\t\t\t:key="rightId"\n\t\t\t\t:class="{\n\t\t\t\t\t'ui-access-rights-v2-group-children': accessRightItem.group,\n\t\t\t\t}"\n\t\t\t>\n\t\t\t\t<TitleCell :right="accessRightItem" />\n\t\t\t</CellLayout>\n\t\t</ColumnLayout>\n\t`};const Ys={name:"Section",components:{Column:js,SyncHorizontalScroll:Ft,TitleColumn:Ws,Header:zs,ColumnList:Ds},props:{userGroups:{type:Map,required:true},rights:{type:Map,required:true},code:{type:String,required:true},isExpanded:{type:Boolean,required:true},title:{type:String,required:true},subTitle:{type:String},hint:{type:String},icon:{type:Object},action:{type:Object}},provide(){return{section:g.computed((()=>({sectionCode:this.code,sectionTitle:this.title,sectionSubTitle:this.subTitle,sectionIcon:this.icon,sectionHint:this.hint,isExpanded:this.isExpanded,rights:this.rights,action:this.action})))}},template:`\n\t\t<div class="ui-access-rights-v2-section" :data-accessrights-section-code="code">\n\t\t\t<Header/>\n\t\t\t<div v-if="isExpanded" class='ui-access-rights-v2-section-container'>\n\t\t\t\t<div class='ui-access-rights-v2-section-head'>\n\t\t\t\t\t<TitleColumn :rights="rights" />\n\t\t\t\t</div>\n\t\t\t\t<ColumnList :rights="rights" :user-groups="userGroups"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Qs={name:"GridSkeleton",template:`\n\t\t<div class="ui-access-rights-v2-grid-skeleton" />\n\t`};const Zs={name:"Grid",components:{Section:Ys,Header:Tt,SearchBox:Et,MemberSelector:At,GridSkeleton:Qs},loader:null,computed:{...m.mapState({isProgress:e=>e.application.isProgress,guid:e=>e.application.guid,searchContainerSelector:e=>e.application.options.searchContainerSelector,maxVisibleUserGroups:e=>e.application.options.maxVisibleUserGroups,sortConfig:e=>e.userGroups.sortConfig,selectedMember:e=>e.userGroups.selectedMember}),...m.mapGetters({shownSections:"accessRights/shown",userGroups:"userGroups/shown"})},mounted(){E.getHint(this.guid).initOwnerDocument(this.$refs.container);S.EventEmitter.subscribe("BX.UI.AccessRights.V2:addRight",this.addRight);S.EventEmitter.subscribe("BX.UI.AccessRights.V2:updateRightTitle",this.updateRightTitle);S.EventEmitter.subscribe("BX.UI.AccessRights.V2:updateRightSubtitle",this.updateRightSubtitle);S.EventEmitter.subscribe("BX.UI.AccessRights.V2:markRightAsModified",this.markRightAsModified)},beforeUnmount(){S.EventEmitter.unsubscribe("BX.UI.AccessRights.V2:addRight",this.addRight);S.EventEmitter.unsubscribe("BX.UI.AccessRights.V2:updateRightTitle",this.updateRightTitle);S.EventEmitter.unsubscribe("BX.UI.AccessRights.V2:updateRightSubtitle",this.updateRightSubtitle);S.EventEmitter.unsubscribe("BX.UI.AccessRights.V2:markRightAsModified",this.markRightAsModified)},methods:{scrollToSection(e){const t=this.$refs.sections.find((t=>t.code===e));if(t){scrollTo({top:f.Dom.getPosition(t.$el).top-155,behavior:"smooth"})}},addRight(e){const{guid:t,sectionCode:s,right:i}=e.data;if(!t){console.warn("ui.accessrights.v2: addRight: application guid should be passed in event data");return}if(t===this.$store.getters["application/guid"]){this.$store.dispatch("accessRights/addRight",{sectionCode:s,right:i})}},updateRightTitle(e){const{guid:t,sectionCode:s,rightId:i,rightTitle:r}=e.data;if(!t){console.warn("ui.accessrights.v2: updateRightTitle: application guid should be passed in event data");return}if(t===this.$store.getters["application/guid"]){this.$store.dispatch("accessRights/updateRightTitle",{sectionCode:s,rightId:i,rightTitle:r})}},updateRightSubtitle(e){const{guid:t,sectionCode:s,rightId:i,rightSubtitle:r}=e.data;if(!t){console.warn("ui.accessrights.v2: updateRightSubtitle: application guid should be passed in event data");return}if(t===this.$store.getters["application/guid"]){this.$store.dispatch("accessRights/updateRightSubtitle",{sectionCode:s,rightId:i,rightSubtitle:r})}},markRightAsModified(e){const{guid:t,sectionCode:s,rightId:i,isModified:r}=e.data;if(!t){console.warn("ui.accessrights.v2: markRightAsModified: application guid should be passed in event data");return}if(t===this.$store.getters["application/guid"]){this.$store.dispatch("accessRights/markRightAsModified",{sectionCode:s,rightId:i,isModified:r})}}},template:`\n\t\t<Teleport v-if="searchContainerSelector" :to="searchContainerSelector">\n\t\t\t<div class="ui-access-rights-v2-search-container">\n\t\t\t\t<MemberSelector/>\n\t\t\t\t<SearchBox/>\n\t\t\t</div>\n\t\t</Teleport>\n\t\t<div ref="container" class='ui-access-rights-v2'>\n\t\t\t<GridSkeleton v-if="isProgress" />\n\t\t\t<template v-else>\n\t\t\t\t<Header :user-groups="userGroups"/>\n\t\t\t\t<Section\n\t\t\t\t\tv-for="[sectionCode, accessRightSection] in shownSections"\n\t\t\t\t\t:key="sectionCode"\n\t\t\t\t\t:code="accessRightSection.sectionCode"\n\t\t\t\t\t:is-expanded="accessRightSection.isExpanded"\n\t\t\t\t\t:title="accessRightSection.sectionTitle"\n\t\t\t\t\t:sub-title="accessRightSection.sectionSubTitle"\n\t\t\t\t\t:hint="accessRightSection.sectionHint"\n\t\t\t\t\t:icon="accessRightSection.sectionIcon"\n\t\t\t\t\t:rights="accessRightSection.rights"\n\t\t\t\t\t:action="accessRightSection.action"\n\t\t\t\t\t:user-groups="userGroups"\n\t\t\t\t\tref="sections"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</div>\n\t`};var ei=babelHelpers.classPrivateFieldLooseKey("store");var ti=babelHelpers.classPrivateFieldLooseKey("data");var si=babelHelpers.classPrivateFieldLooseKey("isEnabled");var ii=babelHelpers.classPrivateFieldLooseKey("isCancelAlreadyRegistered");var ri=babelHelpers.classPrivateFieldLooseKey("analyzeRoles");var oi=babelHelpers.classPrivateFieldLooseKey("isUserGroupEdited");var ai=babelHelpers.classPrivateFieldLooseKey("getSaveErrorStatus");var li=babelHelpers.classPrivateFieldLooseKey("registerRoleCreateEvent");var ni=babelHelpers.classPrivateFieldLooseKey("registerRoleEditEvent");var ci=babelHelpers.classPrivateFieldLooseKey("registerRoleDeleteEvent");var ui=babelHelpers.classPrivateFieldLooseKey("appendRoleCountView");var di=babelHelpers.classPrivateFieldLooseKey("appendP");class hi{constructor(e,t){Object.defineProperty(this,di,{value:yi});Object.defineProperty(this,ui,{value:fi});Object.defineProperty(this,ci,{value:Si});Object.defineProperty(this,ni,{value:mi});Object.defineProperty(this,li,{value:bi});Object.defineProperty(this,ai,{value:vi});Object.defineProperty(this,oi,{value:gi});Object.defineProperty(this,ri,{value:pi});Object.defineProperty(this,ei,{writable:true,value:void 0});Object.defineProperty(this,ti,{writable:true,value:void 0});Object.defineProperty(this,si,{writable:true,value:void 0});Object.defineProperty(this,ii,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]=e;babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]=t;babelHelpers.classPrivateFieldLooseBase(this,si)[si]=Object.hasOwn(babelHelpers.classPrivateFieldLooseBase(this,ti)[ti],"tool")&&Object.hasOwn(babelHelpers.classPrivateFieldLooseBase(this,ti)[ti],"category")}onSaveSuccess(){if(!babelHelpers.classPrivateFieldLooseBase(this,si)[si]){return}const{createdRoles:e,editedRoles:t,deletedRoles:s}=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]();for(let t=0;t<e;t++){babelHelpers.classPrivateFieldLooseBase(this,li)[li]("success")}for(let e=0;e<t;e++){babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]("success")}for(let e=0;e<s;e++){babelHelpers.classPrivateFieldLooseBase(this,ci)[ci]("success")}}onSaveError(e){if(!babelHelpers.classPrivateFieldLooseBase(this,si)[si]){return}const t=babelHelpers.classPrivateFieldLooseBase(this,ai)[ai](e);const{createdRoles:s,editedRoles:i,deletedRoles:r}=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]();for(let e=0;e<s;e++){babelHelpers.classPrivateFieldLooseBase(this,li)[li](t)}for(let e=0;e<i;e++){babelHelpers.classPrivateFieldLooseBase(this,ni)[ni](t)}for(let e=0;e<r;e++){babelHelpers.classPrivateFieldLooseBase(this,ci)[ci](t)}}onCancelChanges(){if(!babelHelpers.classPrivateFieldLooseBase(this,si)[si]){return}if(babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]){return}b.sendData({...babelHelpers.classPrivateFieldLooseBase(this,ti)[ti],event:"settings_cancel"});babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]=true}onCloseWithoutSave(){if(!babelHelpers.classPrivateFieldLooseBase(this,si)[si]){return}b.sendData({...babelHelpers.classPrivateFieldLooseBase(this,ti)[ti],event:"settings_pop_cancel"})}}function pi(){const e={createdRoles:0,editedRoles:0,deletedRoles:babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].state.userGroups.deleted.size};for(const t of babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].state.userGroups.collection.values()){if(t.isNew){e.createdRoles++}else if(babelHelpers.classPrivateFieldLooseBase(this,oi)[oi](t)){e.editedRoles++}}return e}function gi(e){if(e.isModified){return true}for(const t of e.accessRights.values()){if(t.isModified){return true}}return false}function vi(e){if(!f.Type.isArrayFilled(e==null?void 0:e.errors)){return"error"}for(const t of e.errors){if(f.Type.isStringFilled(t==null?void 0:t.code)){return`error_${f.Text.toCamelCase(t.code)}`}}return"error"}function bi(e){const t={...babelHelpers.classPrivateFieldLooseBase(this,ti)[ti],event:"role_create",status:e};babelHelpers.classPrivateFieldLooseBase(this,ui)[ui](t);b.sendData(t)}function mi(e){const t={...babelHelpers.classPrivateFieldLooseBase(this,ti)[ti],event:"role_edit",status:e};babelHelpers.classPrivateFieldLooseBase(this,ui)[ui](t);b.sendData(t)}function Si(e){const t={...babelHelpers.classPrivateFieldLooseBase(this,ti)[ti],event:"role_delete",status:e};babelHelpers.classPrivateFieldLooseBase(this,ui)[ui](t);b.sendData(t)}function fi(e){babelHelpers.classPrivateFieldLooseBase(this,di)[di](e,"roleCountView",babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].getters["userGroups/shown"].size)}function yi(e,t,s){for(const i of["p1","p2","p3","p4","p5"]){if(!Object.hasOwn(e,i)){e[i]=`${t}_${s}`;return}}}const Ci="save";const Ii="ajax";const Pi="data";var Li=babelHelpers.classPrivateFieldLooseKey("guid");var Mi=babelHelpers.classPrivateFieldLooseKey("options");class Ri extends m.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,Li,{writable:true,value:void 0});Object.defineProperty(this,Mi,{writable:true,value:void 0})}getName(){return"application"}setOptions(e){babelHelpers.classPrivateFieldLooseBase(this,Mi)[Mi]=e;return this}setGuid(e){babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]=e;return this}getState(){return{options:babelHelpers.classPrivateFieldLooseBase(this,Mi)[Mi],guid:babelHelpers.classPrivateFieldLooseBase(this,Li)[Li],isProgress:false}}getGetters(){return{isMaxVisibleUserGroupsSet:e=>e.options.maxVisibleUserGroups>0,isModified:(e,t,s,i)=>i["userGroups/isModified"]||i["accessRights/isModified"],guid:e=>e.guid,additionalMembersParams:e=>e.options.additionalMembersParams}}getMutations(){return{setProgress:(e,t)=>{e.isProgress=Boolean(t)}}}}function Hi(e,t,s,i,r){var o,a;const l=(o=r.sortConfig)!=null?o:{};const n=(a=r.selectedMember)!=null?a:{};const c=we.create().setInitialUserGroups(t).setSortConfig(l).setSelectedMember(n);const u=Qt.create().setInitialAccessRights(s);const{store:d}=m.Builder.init().addModel(Ri.create().setOptions(e).setGuid(i)).addModel(u).addModel(c).syncBuild();return{store:d,resetState:()=>{c.clearState();u.clearState();S.EventEmitter.emit("BX.UI.AccessRights.V2:onResetState",{guid:i})},userGroupsModel:c,accessRightsModel:u}}class Bi{transform(e,t){const s=[];for(const r of e.values()){for(const e of r.rights.values()){const r={id:e.id,name:e.title,additionalRightData:{}};const o=S.EventEmitter.emit("BX.UI.AccessRights.V2:additionalRightData",{guid:t,right:e});for(const e of o){var i;r.additionalRightData={...r.additionalRightData,...(i=e.getData())==null?void 0:i.additionalRightData}}s.push(r)}}return s}}var wi=babelHelpers.classPrivateFieldLooseKey("transformAccessCodes");var Fi=babelHelpers.classPrivateFieldLooseKey("transformAccessRightValues");class Vi{constructor(){Object.defineProperty(this,Fi,{value:Ei});Object.defineProperty(this,wi,{value:Ti})}transform(e){const t=[];for(const s of e.values()){t.push({id:s.id.startsWith($)?"0":s.id,title:s.title,accessCodes:babelHelpers.classPrivateFieldLooseBase(this,wi)[wi](s.members),accessRights:babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi](s)})}return t}shouldBeIncludedInExport(e,t){throw new Error("Not implemented")}}function Ti(e){const t={};for(const[s,i]of e){t[s]=i.type}return t}function Ei(e){const t=[];for(const s of e.accessRights.values()){if(!this.shouldBeIncludedInExport(e,s)){continue}for(const e of s.values){t.push({id:s.id,value:e})}}return t}class Ai extends Vi{shouldBeIncludedInExport(e,t){return true}}class _i extends Vi{shouldBeIncludedInExport(e,t){return e.isNew||t.isModified}}var Gi=babelHelpers.classPrivateFieldLooseKey("deepFreeze");class xi{constructor(){Object.defineProperty(this,Gi,{value:Oi})}transform(e){var t,s,i,r,o,a,l,n,c,u,d;return babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi]({component:String(e.component),actionSave:f.Type.isStringFilled(e.actionSave)?e.actionSave:Ci,mode:f.Type.isStringFilled(e.mode)?e.mode:Ii,bodyType:f.Type.isStringFilled(e.bodyType)?e.bodyType:Pi,additionalSaveParams:f.Type.isPlainObject(e.additionalSaveParams)?e.additionalSaveParams:[],isSaveOnlyChangedRights:f.Type.isBoolean(e.isSaveOnlyChangedRights)?e.isSaveOnlyChangedRights:false,maxVisibleUserGroups:f.Type.isInteger(e.maxVisibleUserGroups)?e.maxVisibleUserGroups:null,searchContainerSelector:f.Type.isStringFilled(e.searchContainerSelector)?e.searchContainerSelector:null,additionalMembersParams:f.Type.isPlainObject(e.additionalMembersParams)?{addUserGroupsProviderTab:Boolean((t=(s=e.additionalMembersParams)==null?void 0:s.addUserGroupsProviderTab)!=null?t:false),addProjectsProviderTab:Boolean((i=(r=e.additionalMembersParams)==null?void 0:r.addProjectsProviderTab)!=null?i:true),addStructureTeamsProviderTab:Boolean((o=(a=e.additionalMembersParams)==null?void 0:a.addStructureTeamsProviderTab)!=null?o:false),useStructureDepartmentsProviderTab:Boolean((l=(n=e.additionalMembersParams)==null?void 0:n.useStructureDepartmentsProviderTab)!=null?l:false),addStructureRolesProviderTab:Boolean((c=(u=e.additionalMembersParams)==null?void 0:u.addStructureRolesProviderTab)!=null?c:false)}:{addUserGroupsProviderTab:false,addProjectsProviderTab:true,addStructureTeamsProviderTab:false,useStructureDepartmentsProviderTab:false,addStructureRolesProviderTab:false},userSortConfigName:String((d=e.userSortConfigName)!=null?d:e.component),isSaveAccessRightsList:f.Type.isBoolean(e.isSaveAccessRightsList)?e.isSaveAccessRightsList:false,moduleId:f.Type.isString(e.moduleId)?e.moduleId:""})}}function Oi(e){if(f.Type.isObject(e)){Object.values(e).forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi](e)}));return Object.freeze(e)}return e}var Ui=babelHelpers.classPrivateFieldLooseKey("maxVisibleUserGroups");var $i=babelHelpers.classPrivateFieldLooseKey("internalizeExternalGroup");var ji=babelHelpers.classPrivateFieldLooseKey("internalizeExternalAccessRightsValue");var Di=babelHelpers.classPrivateFieldLooseKey("internalizeExternalAccessCode");var ki=babelHelpers.classPrivateFieldLooseKey("internalizeExternalMember");class Ni{constructor(e){Object.defineProperty(this,ki,{value:Xi});Object.defineProperty(this,Di,{value:Ji});Object.defineProperty(this,ji,{value:zi});Object.defineProperty(this,$i,{value:Ki});Object.defineProperty(this,Ui,{writable:true,value:null});if(f.Type.isInteger(e)){babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui]=e}}transform(e){const t=new Map;for(const s of e){const e=babelHelpers.classPrivateFieldLooseBase(this,$i)[$i](s);t.set(e.id,e)}return t}}function Ki(e){const t={id:String(e.id),isNew:false,isModified:false,title:String(e.title),accessRights:new Map,members:new Map};for(const s of e.accessRights){const e=babelHelpers.classPrivateFieldLooseBase(this,ji)[ji](s);if(t.accessRights.has(e.id)){for(const s of t.accessRights.get(e.id).values){e.values.add(s)}}t.accessRights.set(e.id,e)}for(const[s,i]of Object.entries(e.members)){const e=babelHelpers.classPrivateFieldLooseBase(this,Di)[Di](s);t.members.set(e,babelHelpers.classPrivateFieldLooseBase(this,ki)[ki](i))}return t}function zi(e){const t=String(e.id);const s={id:t,isModified:false};const i=f.Type.isArray(e.value)?e.value:[e.value];s.values=new Set(i.map((e=>String(e))));return s}function Ji(e){let t=String(e);if(/^IU(\d+)$/.test(t)){t=t.replace("IU","U")}return t}function Xi(e){return{id:String(e.id),type:f.Type.isStringFilled(e.type)?e.type:null,name:f.Type.isStringFilled(e.name)?e.name:null,avatar:f.Type.isStringFilled(e.avatar)?e.avatar:null}}var qi=babelHelpers.classPrivateFieldLooseKey("srcUserGroups");var Wi=babelHelpers.classPrivateFieldLooseKey("maxVisibleUserGroups");var Yi=babelHelpers.classPrivateFieldLooseKey("sortConfig");var Qi=babelHelpers.classPrivateFieldLooseKey("addUserGroupInSortConfig");class Zi{constructor(e,t,s){Object.defineProperty(this,Qi,{value:er});Object.defineProperty(this,qi,{writable:true,value:void 0});Object.defineProperty(this,Wi,{writable:true,value:null});Object.defineProperty(this,Yi,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,qi)[qi]=e;if(f.Type.isInteger(t)){babelHelpers.classPrivateFieldLooseBase(this,Wi)[Wi]=t}babelHelpers.classPrivateFieldLooseBase(this,Yi)[Yi]=s}transform(e){for(const[t,s]of e){const e=babelHelpers.classPrivateFieldLooseBase(this,qi)[qi].get(t);if(!e){babelHelpers.classPrivateFieldLooseBase(this,Qi)[Qi](s)}}return e}getSortConfig(){return babelHelpers.classPrivateFieldLooseBase(this,Yi)[Yi]}}function er(e){const t=t=>{if(!babelHelpers.classPrivateFieldLooseBase(this,Yi)[Yi][t]){return}const s=Object.values(babelHelpers.classPrivateFieldLooseBase(this,Yi)[Yi][t]);const i=s.length>0?Math.max(...s):0;babelHelpers.classPrivateFieldLooseBase(this,Yi)[Yi][t][e.id]=i+1};for(const[s]of e.members){t(s)}t(j)}var tr=babelHelpers.classPrivateFieldLooseKey("options");var sr=babelHelpers.classPrivateFieldLooseKey("renderTo");var ir=babelHelpers.classPrivateFieldLooseKey("buttonPanel");var rr=babelHelpers.classPrivateFieldLooseKey("guid");var or=babelHelpers.classPrivateFieldLooseKey("isUserConfirmedClose");var ar=babelHelpers.classPrivateFieldLooseKey("handleSliderClose");var lr=babelHelpers.classPrivateFieldLooseKey("app");var nr=babelHelpers.classPrivateFieldLooseKey("rootComponent");var cr=babelHelpers.classPrivateFieldLooseKey("store");var ur=babelHelpers.classPrivateFieldLooseKey("resetState");var dr=babelHelpers.classPrivateFieldLooseKey("unwatch");var hr=babelHelpers.classPrivateFieldLooseKey("userGroupsModel");var pr=babelHelpers.classPrivateFieldLooseKey("accessRightsModel");var gr=babelHelpers.classPrivateFieldLooseKey("analyticsManager");var vr=babelHelpers.classPrivateFieldLooseKey("selectedMember");var br=babelHelpers.classPrivateFieldLooseKey("sortConfigForAllUserGroups");var mr=babelHelpers.classPrivateFieldLooseKey("confirmationPopup");var Sr=babelHelpers.classPrivateFieldLooseKey("getRenderTo");var fr=babelHelpers.classPrivateFieldLooseKey("bindEvents");var yr=babelHelpers.classPrivateFieldLooseKey("unbindEvents");var Cr=babelHelpers.classPrivateFieldLooseKey("tryShowFeaturePromoter");var Ir=babelHelpers.classPrivateFieldLooseKey("showNotification");var Pr=babelHelpers.classPrivateFieldLooseKey("saveUserSortConfig");var Lr=babelHelpers.classPrivateFieldLooseKey("runSaveAjaxRequest");var Mr=babelHelpers.classPrivateFieldLooseKey("confirmBeforeClosingModifiedSlider");var Rr=babelHelpers.classPrivateFieldLooseKey("getSortConfigForAllUserGroups");class Hr{constructor(e){var t;Object.defineProperty(this,Rr,{value:Gr});Object.defineProperty(this,Mr,{value:_r});Object.defineProperty(this,Lr,{value:Ar});Object.defineProperty(this,Pr,{value:Er});Object.defineProperty(this,Ir,{value:Tr});Object.defineProperty(this,Cr,{value:Vr});Object.defineProperty(this,yr,{value:Fr});Object.defineProperty(this,fr,{value:wr});Object.defineProperty(this,Sr,{value:Br});Object.defineProperty(this,tr,{writable:true,value:{}});Object.defineProperty(this,sr,{writable:true,value:void 0});Object.defineProperty(this,ir,{writable:true,value:void 0});Object.defineProperty(this,rr,{writable:true,value:void 0});Object.defineProperty(this,or,{writable:true,value:false});Object.defineProperty(this,ar,{writable:true,value:void 0});Object.defineProperty(this,lr,{writable:true,value:void 0});Object.defineProperty(this,nr,{writable:true,value:void 0});Object.defineProperty(this,cr,{writable:true,value:void 0});Object.defineProperty(this,ur,{writable:true,value:void 0});Object.defineProperty(this,dr,{writable:true,value:void 0});Object.defineProperty(this,hr,{writable:true,value:void 0});Object.defineProperty(this,pr,{writable:true,value:void 0});Object.defineProperty(this,gr,{writable:true,value:void 0});Object.defineProperty(this,vr,{writable:true,value:void 0});Object.defineProperty(this,br,{writable:true,value:void 0});Object.defineProperty(this,mr,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,tr)[tr]=e||{};babelHelpers.classPrivateFieldLooseBase(this,sr)[sr]=babelHelpers.classPrivateFieldLooseBase(this,Sr)[Sr]();babelHelpers.classPrivateFieldLooseBase(this,ir)[ir]=BX.UI.ButtonPanel||null;babelHelpers.classPrivateFieldLooseBase(this,br)[br]=e.sortConfigForAllUserGroups;babelHelpers.classPrivateFieldLooseBase(this,vr)[vr]=e.selectedMember;babelHelpers.classPrivateFieldLooseBase(this,tr)[tr].userSortConfigName=(t=e.userSortConfigName)!=null?t:e.component;babelHelpers.classPrivateFieldLooseBase(this,rr)[rr]=f.Text.getRandom(16);babelHelpers.classPrivateFieldLooseBase(this,fr)[fr]()}fireEventReset(){const e=t.MessageBox.create({message:f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CANCEL_WARNING"),modal:true,buttons:[new o.Button({color:o.ButtonColor.PRIMARY,size:o.ButtonSize.SMALL,text:f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CANCEL_YES_CANCEL"),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,gr)[gr].onCancelChanges();babelHelpers.classPrivateFieldLooseBase(this,ur)[ur]();e.close()}}),new o.Button({color:o.ButtonColor.LINK,size:o.ButtonSize.SMALL,text:f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CANCEL_NO_CANCEL"),onclick:()=>{e.close()}})]});e.show()}sendActionRequest(){return new Promise(((e,t)=>{if(babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.application.isProgress||!babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].getters["application/isModified"]){e();return}babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].commit("application/setProgress",true);babelHelpers.classPrivateFieldLooseBase(this,Lr)[Lr]().then((({userGroups:e,accessRights:t,sortConfig:s})=>{babelHelpers.classPrivateFieldLooseBase(this,gr)[gr].onSaveSuccess();babelHelpers.classPrivateFieldLooseBase(this,hr)[hr].setInitialUserGroups(e).setSortConfig(s).setSelectedMember(this.getSelectedMember());if(t){babelHelpers.classPrivateFieldLooseBase(this,pr)[pr].setInitialAccessRights(t)}const i=babelHelpers.classPrivateFieldLooseBase(this,rr)[rr];S.EventEmitter.emit("BX.UI.AccessRights.V2:afterSave",{userGroups:e,accessRights:t,guid:i});babelHelpers.classPrivateFieldLooseBase(this,ur)[ur]();babelHelpers.classPrivateFieldLooseBase(this,Pr)[Pr](s[j]);babelHelpers.classPrivateFieldLooseBase(this,Ir)[Ir](f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_SETTINGS_HAVE_BEEN_SAVED"))})).catch((e=>{var s,i;babelHelpers.classPrivateFieldLooseBase(this,gr)[gr].onSaveError(e);console.warn("ui.accessrights.v2: error during save",e);if(babelHelpers.classPrivateFieldLooseBase(this,Cr)[Cr](e)){t(e);return}babelHelpers.classPrivateFieldLooseBase(this,Ir)[Ir]((e==null?void 0:(s=e.errors)==null?void 0:(i=s[0])==null?void 0:i.message)||"Something went wrong");S.EventEmitter.emit("ui:accessRights:v2:onSaveError",{response:e});t(e)})).finally((()=>{var t;const s=(t=babelHelpers.classPrivateFieldLooseBase(this,ir)[ir])==null?void 0:t.getContainer().querySelector(".ui-btn-wait");f.Dom.removeClass(s,"ui-btn-wait");babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].commit("application/setProgress",false);e()}))}))}draw(){const e=new y.Loader({target:babelHelpers.classPrivateFieldLooseBase(this,sr)[sr]});e.show();babelHelpers.classPrivateFieldLooseBase(this,Rr)[Rr]().then((e=>{babelHelpers.classPrivateFieldLooseBase(this,br)[br]=e})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,br)[br]=null})).finally((()=>{const t=(new xi).transform(babelHelpers.classPrivateFieldLooseBase(this,tr)[tr]);const s={sortConfig:{},selectedMember:babelHelpers.classPrivateFieldLooseBase(this,vr)[vr]};if(f.Type.isObject(babelHelpers.classPrivateFieldLooseBase(this,br)[br])){s.sortConfig[j]=babelHelpers.classPrivateFieldLooseBase(this,br)[br]}const{store:i,resetState:r,userGroupsModel:o,accessRightsModel:a}=Hi(t,new Ni(t.maxVisibleUserGroups).transform(babelHelpers.classPrivateFieldLooseBase(this,tr)[tr].userGroups),(new Dt).transform(babelHelpers.classPrivateFieldLooseBase(this,tr)[tr].accessRights),babelHelpers.classPrivateFieldLooseBase(this,rr)[rr],s);babelHelpers.classPrivateFieldLooseBase(this,cr)[cr]=i;babelHelpers.classPrivateFieldLooseBase(this,ur)[ur]=r;babelHelpers.classPrivateFieldLooseBase(this,hr)[hr]=o;babelHelpers.classPrivateFieldLooseBase(this,pr)[pr]=a;babelHelpers.classPrivateFieldLooseBase(this,dr)[dr]=babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].watch(((e,t)=>t["application/isModified"]),(e=>{if(e){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,ir)[ir])==null?void 0:t.show()}else{var s;(s=babelHelpers.classPrivateFieldLooseBase(this,ir)[ir])==null?void 0:s.hide()}}));babelHelpers.classPrivateFieldLooseBase(this,lr)[lr]=g.BitrixVue.createApp(Zs);babelHelpers.classPrivateFieldLooseBase(this,lr)[lr].use(babelHelpers.classPrivateFieldLooseBase(this,cr)[cr]);e.hide();f.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,sr)[sr]);babelHelpers.classPrivateFieldLooseBase(this,nr)[nr]=babelHelpers.classPrivateFieldLooseBase(this,lr)[lr].mount(babelHelpers.classPrivateFieldLooseBase(this,sr)[sr]);babelHelpers.classPrivateFieldLooseBase(this,gr)[gr]=new hi(babelHelpers.classPrivateFieldLooseBase(this,cr)[cr],babelHelpers.classPrivateFieldLooseBase(this,tr)[tr].analytics)}))}destroy(){babelHelpers.classPrivateFieldLooseBase(this,gr)[gr]=null;babelHelpers.classPrivateFieldLooseBase(this,lr)[lr].unmount();babelHelpers.classPrivateFieldLooseBase(this,lr)[lr]=null;babelHelpers.classPrivateFieldLooseBase(this,yr)[yr]();babelHelpers.classPrivateFieldLooseBase(this,dr)[dr]();babelHelpers.classPrivateFieldLooseBase(this,dr)[dr]=null;babelHelpers.classPrivateFieldLooseBase(this,cr)[cr]=null;babelHelpers.classPrivateFieldLooseBase(this,ur)[ur]=null;babelHelpers.classPrivateFieldLooseBase(this,hr)[hr]=null;babelHelpers.classPrivateFieldLooseBase(this,tr)[tr]=null;babelHelpers.classPrivateFieldLooseBase(this,ir)[ir]=null;f.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,sr)[sr]);babelHelpers.classPrivateFieldLooseBase(this,sr)[sr]=null;if(babelHelpers.classPrivateFieldLooseBase(this,mr)[mr]){babelHelpers.classPrivateFieldLooseBase(this,mr)[mr].close();babelHelpers.classPrivateFieldLooseBase(this,mr)[mr].getPopupWindow().destroy();babelHelpers.classPrivateFieldLooseBase(this,mr)[mr]=null}}hasUnsavedChanges(){return!(!babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].getters["application/isModified"]||babelHelpers.classPrivateFieldLooseBase(this,or)[or])}scrollToSection(e){babelHelpers.classPrivateFieldLooseBase(this,nr)[nr].scrollToSection(e)}getSelectedMember(){return babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.userGroups.selectedMember}getGuid(){return babelHelpers.classPrivateFieldLooseBase(this,rr)[rr]}}function Br(){if(f.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,tr)[tr].renderTo)){return babelHelpers.classPrivateFieldLooseBase(this,tr)[tr].renderTo}return document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,tr)[tr].renderToContainerId)}function wr(){babelHelpers.classPrivateFieldLooseBase(this,ar)[ar]=e=>{var t,s;const[i]=e.getData();const r=((t=BX.SidePanel)==null?void 0:(s=t.Instance)==null?void 0:s.getSliderByWindow(window))===(i==null?void 0:i.getSlider());if(!r){return}babelHelpers.classPrivateFieldLooseBase(this,Mr)[Mr](i)};S.EventEmitter.subscribe("SidePanel.Slider:onClose",babelHelpers.classPrivateFieldLooseBase(this,ar)[ar])}function Fr(){S.EventEmitter.unsubscribe("SidePanel.Slider:onClose",babelHelpers.classPrivateFieldLooseBase(this,ar)[ar]);babelHelpers.classPrivateFieldLooseBase(this,ar)[ar]=null}function Vr(e){if(!f.Type.isArrayFilled(e==null?void 0:e.errors)){return false}for(const s of e.errors){var t;if(f.Type.isStringFilled(s==null?void 0:(t=s.customData)==null?void 0:t.sliderCode)){f.Runtime.loadExtension("ui.info-helper").then((({FeaturePromotersRegistry:e})=>{e.getPromoter({code:s.customData.sliderCode}).show()})).catch((e=>{console.error("ui.accessrights.v2: could not load ui.info-helper",e)}));return true}}return false}function Tr(e){BX.UI.Notification.Center.notify({content:e,position:"top-right",autoHideDelay:3e3})}function Er(e){if(!f.Type.isObject(e)){return}const t=babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.userGroups.collection;const s={};for(const[i,r]of Object.entries(e)){if(t.has(i)){s[i]=r}}babelHelpers.classPrivateFieldLooseBase(this,br)[br]=s;return Lt(babelHelpers.classPrivateFieldLooseBase(this,tr)[tr].userSortConfigName,babelHelpers.classPrivateFieldLooseBase(this,br)[br])}function Ar(){const e=babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.userGroups.collection;let t=null;if(babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.application.options.isSaveOnlyChangedRights){t=(new _i).transform(e)}else{t=(new Ai).transform(e)}const s=babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.application.options.bodyType;let i=null;let r=null;if(babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.application.options.isSaveAccessRightsList){i=(new Bi).transform(babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.accessRights.collection,babelHelpers.classPrivateFieldLooseBase(this,rr)[rr]);r=[...babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.accessRights.deleted.values()]}return new Promise(((o,a)=>{f.ajax.runComponentAction(babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.application.options.component,babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.application.options.actionSave,{mode:babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.application.options.mode,[s]:{userGroups:t,deletedUserGroups:[...babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.userGroups.deleted.values()],parameters:babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.application.options.additionalSaveParams,accessRights:i,deletedAccessRights:r}}).then((t=>{const s=babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.application.options.maxVisibleUserGroups;const i=babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].state.userGroups.sortConfig;const r=new Ni(s).transform(t.data.USER_GROUPS);const a=new Zi(e,s,i);a.transform(r);const l=a.getSortConfig();let n=null;if(t.data.ACCESS_RIGHTS){n=(new Dt).transform(t.data.ACCESS_RIGHTS)}o({userGroups:r,sortConfig:l,accessRights:n})})).catch(a)}))}function _r(e){if(!babelHelpers.classPrivateFieldLooseBase(this,cr)[cr].getters["application/isModified"]||babelHelpers.classPrivateFieldLooseBase(this,or)[or]){return}e.denyAction();if(babelHelpers.classPrivateFieldLooseBase(this,mr)[mr]&&babelHelpers.classPrivateFieldLooseBase(this,mr)[mr].getPopupWindow().isShown()){return}babelHelpers.classPrivateFieldLooseBase(this,mr)[mr]=t.MessageBox.create({mediumButtonSize:false,title:f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CLOSE_WARNING_TITLE"),message:f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CLOSE_WARNING"),modal:true,buttons:[new o.Button({color:o.ButtonColor.PRIMARY,size:o.ButtonSize.SMALL,text:f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CLOSE_YES_CLOSE"),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,gr)[gr].onCloseWithoutSave();babelHelpers.classPrivateFieldLooseBase(this,or)[or]=true;babelHelpers.classPrivateFieldLooseBase(this,mr)[mr].close();babelHelpers.classPrivateFieldLooseBase(this,mr)[mr]=null;setTimeout((()=>{e.getSlider().close()}))}}),new o.CancelButton({size:o.ButtonSize.SMALL,text:f.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_CANCEL"),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,mr)[mr].close();babelHelpers.classPrivateFieldLooseBase(this,mr)[mr]=null}})],popupOptions:{fixed:true}});babelHelpers.classPrivateFieldLooseBase(this,mr)[mr].show()}function Gr(){if(babelHelpers.classPrivateFieldLooseBase(this,br)[br]){return Promise.resolve(babelHelpers.classPrivateFieldLooseBase(this,br)[br])}return new Promise((e=>{f.ajax.runAction("ui.accessrights.getUserSortConfig",{data:{name:babelHelpers.classPrivateFieldLooseBase(this,tr)[tr].userSortConfigName}}).then((t=>e(t.data?{...t.data}:null))).catch((()=>e(null)))}))}e.App=Hr})(this.BX.UI.AccessRights.V2=this.BX.UI.AccessRights.V2||{},BX.UI.Dialogs,BX.UI.AccessRights.V2,BX.UI.System.Chip.Vue,BX.UI.IconSet,BX.UI,BX.UI.Vue3.Components,BX.UI.EntitySelector,BX.Vue3.Directives,BX.UI.Vue3.Components,BX.Main,BX.UI,BX,BX.UI.Vue3.Components,BX.Vue3,BX,BX.UI.Analytics,BX.Vue3.Vuex,BX.Event,BX,BX);
//# sourceMappingURL=v2.bundle.map.js