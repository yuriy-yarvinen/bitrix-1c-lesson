{"version":3,"file":"reaction-picker.bundle.js","sources":["../src/ranking.js","../src/picker.js"],"sourcesContent":["import { Type } from 'main.core';\n\nimport { ReactionName } from 'ui.reaction.item';\n\nexport class ReactionPickerRanking\n{\n\tstatic #STORAGE_KEY = 'ui-reaction-picker-ranking';\n\tstatic #INITIAL_COUNTER_VALUE = 2;\n\n\t#counters: Map<string, number>;\n\n\tconstructor()\n\t{\n\t\tthis.#counters = this.#loadCounters();\n\t\tthis.#initializeDefaultCounters();\n\t}\n\n\tgetRankedReactionsNames(): string[]\n\t{\n\t\tconst allReactions = Object.values(ReactionName);\n\t\tconst sortedReactions = this.#sortReactionsByRank(allReactions);\n\n\t\tconst likeIndex = sortedReactions.indexOf(ReactionName.like);\n\t\tif (likeIndex > 0)\n\t\t{\n\t\t\tsortedReactions.splice(likeIndex, 1);\n\t\t\tsortedReactions.unshift(ReactionName.like);\n\t\t}\n\n\t\treturn sortedReactions;\n\t}\n\n\tincrementReactionCounter(reactionName: string): void\n\t{\n\t\tif (!this.#isValidReaction(reactionName))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentCount = this.#counters.get(reactionName) || 0;\n\t\tthis.#counters.set(reactionName, currentCount + 1);\n\t\tthis.#saveCounters();\n\t}\n\n\tgetReactionCounter(reactionName: string): number\n\t{\n\t\tif (!this.#isValidReaction(reactionName))\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn this.#counters.get(reactionName) || 0;\n\t}\n\n\tresetCounters(): void\n\t{\n\t\tthis.#counters.clear();\n\t\tthis.#initializeDefaultCounters();\n\t\tthis.#saveCounters();\n\t}\n\n\t#loadCounters(): Map<string, number>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst stored = localStorage.getItem(ReactionPickerRanking.#STORAGE_KEY);\n\t\t\tif (!stored)\n\t\t\t{\n\t\t\t\treturn new Map();\n\t\t\t}\n\n\t\t\tconst parsed = JSON.parse(stored);\n\t\t\tif (!Type.isObject(parsed) || parsed === null)\n\t\t\t{\n\t\t\t\treturn new Map();\n\t\t\t}\n\n\t\t\treturn new Map(Object.entries(parsed));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn('Failed to load reaction counters from localStorage:', error);\n\n\t\t\treturn new Map();\n\t\t}\n\t}\n\n\t#saveCounters(): void\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst countersObject = Object.fromEntries(this.#counters);\n\t\t\tlocalStorage.setItem(ReactionPickerRanking.#STORAGE_KEY, JSON.stringify(countersObject));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn('Failed to save reaction counters to localStorage:', error);\n\t\t}\n\t}\n\n\t#initializeDefaultCounters(): void\n\t{\n\t\tconst allReactions = Object.values(ReactionName);\n\t\tconst topReactions = [\n\t\t\tReactionName.like,\n\t\t\tReactionName.faceWithTearsOfJoy,\n\t\t\tReactionName.redHeart,\n\t\t\tReactionName.neutralFace,\n\t\t\tReactionName.fire,\n\t\t\tReactionName.cry,\n\t\t];\n\n\t\tfor (const reaction of topReactions)\n\t\t{\n\t\t\tif (!this.#counters.has(reaction))\n\t\t\t{\n\t\t\t\tthis.#counters.set(reaction, ReactionPickerRanking.#INITIAL_COUNTER_VALUE);\n\t\t\t}\n\t\t}\n\n\t\tfor (const reaction of allReactions)\n\t\t{\n\t\t\tif (!this.#counters.has(reaction))\n\t\t\t{\n\t\t\t\tthis.#counters.set(reaction, 0);\n\t\t\t}\n\t\t}\n\t}\n\n\t#sortReactionsByRank(reactions: string[]): string[]\n\t{\n\t\treturn reactions.toSorted((a, b) => {\n\t\t\tconst countA = this.#counters.get(a) || 0;\n\t\t\tconst countB = this.#counters.get(b) || 0;\n\n\t\t\tif (countA !== countB)\n\t\t\t{\n\t\t\t\treturn countB - countA;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t});\n\t}\n\n\t#isValidReaction(reactionName: string): boolean\n\t{\n\t\treturn Object.values(ReactionName).includes(reactionName);\n\t}\n}\n","import { Dom, Tag, Type, Loc, bind, unbind } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { ZIndexManager } from 'main.core.z-index-manager';\nimport { Icon, Outline } from 'ui.icon-set.api.core';\n\nimport 'ui.icon-set.outline';\n\nimport { Reaction, ReactionTitle, ReactionName } from 'ui.reaction.item';\n\nimport './css/popover.css';\nimport { ReactionPickerRanking } from './ranking';\n\ntype ReactionPickerTarget = HTMLElement | {\n\ttop: number;\n\tleft: number;\n};\n\nexport type ReactionPickerOptions = {\n\ttarget: ReactionPickerTarget;\n\treactions?: string[];\n};\n\nexport const ReactionPickerEvents = {\n\tshow: 'show',\n\thide: 'hide',\n\texpand: 'expand',\n\tselect: 'select',\n\tmouseenter: 'mouseenter',\n\tmouseleave: 'mouseleave',\n};\n\nexport class ReactionPicker extends EventEmitter\n{\n\t#target: ReactionPickerTarget;\n\n\t#popover: ?HTMLElement = null;\n\t#isShown: boolean;\n\t#listContainer: ?HTMLElement;\n\t#expandedListContainer: ?HTMLElement;\n\t#reactions: Reaction[];\n\t#allowedReactions: ?string[];\n\n\t#ranking: ReactionPickerRanking;\n\n\t#mouseenterHandler: ?Function = null;\n\t#mouseleaveHandler: ?Function = null;\n\n\tstatic #rowSize = 7;\n\tstatic #minHeight = 56;\n\tstatic #offsetBetweenTargetElement = 8;\n\n\tconstructor(options: ReactionPickerOptions)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('UI.ReactionPicker.V2');\n\t\tthis.#target = options.target;\n\t\tthis.#allowedReactions = Type.isArrayFilled(options.reactions) ? options.reactions : null;\n\n\t\tthis.#listContainer = null;\n\t\tthis.#expandedListContainer = null;\n\t\tthis.#isShown = false;\n\t\tthis.#reactions = [];\n\t\tthis.#ranking = new ReactionPickerRanking();\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.#popover)\n\t\t{\n\t\t\tthis.#initPopover();\n\t\t}\n\n\t\tDom.append(this.#popover, document.body);\n\n\t\tthis.adjustPosition();\n\n\t\tZIndexManager.register(this.#popover);\n\t\tZIndexManager.bringToFront(this.#popover);\n\n\t\trequestAnimationFrame(() => {\n\t\t\tDom.addClass(this.#popover, '--visible');\n\t\t});\n\n\t\tthis.#isShown = true;\n\n\t\tthis.emit(ReactionPickerEvents.show);\n\t}\n\n\thide(): void\n\t{\n\t\tif (!this.#popover)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.#popover, '--hiding');\n\t\tDom.removeClass(this.#popover, '--visible');\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#destroyReactions();\n\t\t\tthis.#destroyPopover();\n\t\t}, 150);\n\n\t\tthis.#isShown = false;\n\n\t\tthis.emit(ReactionPickerEvents.hide);\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#isShown;\n\t}\n\n\tadjustPosition(): void\n\t{\n\t\tif (!this.#popover)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isNumber(this.#target.top) && Type.isNumber(this.#target.left))\n\t\t{\n\t\t\tthis.#adjustPositionToCoordinates(this.#target);\n\t\t}\n\t\telse if (this.#target instanceof HTMLElement)\n\t\t{\n\t\t\tthis.#adjustPositionToElement(this.#target);\n\t\t}\n\t}\n\n\tgetPopoverRect(): ?DOMRect\n\t{\n\t\treturn this.#popover ? Dom.getPosition(this.#popover) : undefined;\n\t}\n\n\t#adjustPositionToElement(target: HTMLElement): void\n\t{\n\t\tconst elementRect = Dom.getPosition(target);\n\t\tconst popoverRect = Dom.getPosition(this.#popover);\n\n\t\tlet top = 0;\n\n\t\tconst isEnoughSpaceBelowTargetElement = this.#isEnoughSpaceBelowTargetElement();\n\n\t\tif (isEnoughSpaceBelowTargetElement === false)\n\t\t{\n\t\t\ttop = elementRect.top - popoverRect.height - ReactionPicker.#offsetBetweenTargetElement;\n\t\t}\n\t\telse if (this.#isEnoughSpaceAboveTargetElement())\n\t\t{\n\t\t\ttop = elementRect.top - ReactionPicker.#minHeight - ReactionPicker.#offsetBetweenTargetElement;\n\t\t}\n\t\telse if (isEnoughSpaceBelowTargetElement)\n\t\t{\n\t\t\ttop = elementRect.top + elementRect.height + ReactionPicker.#offsetBetweenTargetElement;\n\t\t}\n\n\t\tlet left = elementRect.left - 53;\n\n\t\tconst rightEdge = left + popoverRect.width;\n\t\tconst windowWidth = window.innerWidth;\n\t\tconst rightPadding = 40;\n\n\t\tif (rightEdge + rightPadding > windowWidth)\n\t\t{\n\t\t\tleft = windowWidth - popoverRect.width - rightPadding;\n\t\t}\n\n\t\tDom.style(this.#popover, {\n\t\t\ttop: `${top}px`,\n\t\t\tleft: `${left}px`,\n\t\t});\n\t}\n\n\t#adjustPositionToCoordinates(position: { top: number, left: number }): void\n\t{\n\t\tDom.style(this.#popover, {\n\t\t\ttop: `${position.top}px`,\n\t\t\tleft: `${position.left}px`,\n\t\t});\n\t}\n\n\t#initPopover(): void\n\t{\n\t\tif (!this.#popover)\n\t\t{\n\t\t\tthis.#listContainer = this.#renderReactionsList(this.#getReactionsNames().slice(0, ReactionPicker.#rowSize - 1));\n\n\t\t\tthis.#expandedListContainer = Tag.render`\n\t\t\t\t<div class=\"reactions-select-popover__expanded-list\"></div>\n\t\t\t`;\n\t\t\tconst showExpandButton = this.#getReactionsNames().length > ReactionPicker.#rowSize;\n\t\t\tthis.#popover = Tag.render`\n\t\t\t\t<div class=\"reactions-select-popover --ui-context-content-light\">\n\t\t\t\t\t<div class=\"reactions-select-popover__inner\">\n\t\t\t\t\t\t${this.#listContainer}\n\t\t\t\t\t\t${showExpandButton ? this.#renderExpandButton() : null}\n\t\t\t\t\t\t${this.#expandedListContainer}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tthis.#mouseenterHandler = () => {\n\t\t\t\tthis.emit(ReactionPickerEvents.mouseenter);\n\t\t\t};\n\n\t\t\tthis.#mouseleaveHandler = () => {\n\t\t\t\tthis.emit(ReactionPickerEvents.mouseleave);\n\t\t\t};\n\n\t\t\tbind(this.#popover, 'mouseenter', this.#mouseenterHandler);\n\t\t\tbind(this.#popover, 'mouseleave', this.#mouseleaveHandler);\n\t\t}\n\t}\n\n\t#renderReactionsList(reactionsIds: string[], isExpanded: boolean = false): HTMLElement\n\t{\n\t\tconst list = Tag.render`\n\t\t\t<div class=\"reactions-select__list\"></div>\n\t\t`;\n\n\t\tif (isExpanded)\n\t\t{\n\t\t\tDom.addClass(list, '--expanded');\n\t\t}\n\n\t\treactionsIds.forEach((reactionId) => {\n\t\t\tDom.append(this.#renderReactionElement(reactionId), list);\n\t\t});\n\n\t\treturn list;\n\t}\n\n\t#renderReactionElement(reactionName: string): HTMLElement\n\t{\n\t\tconst reactionTitle = ReactionTitle[reactionName];\n\n\t\tconst reaction = new Reaction({\n\t\t\tname: reactionName,\n\t\t\tsize: 32,\n\t\t\tanimation: {\n\t\t\t\tanimate: true,\n\t\t\t\tinfinite: true,\n\t\t\t},\n\t\t});\n\n\t\tthis.#reactions.push(reaction);\n\n\t\tconst element = Tag.render`\n\t\t\t<div class=\"reactions-select__list-elem\" title=\"${reactionTitle}\">\n\t\t\t\t<div ref=\"inner\" class=\"reactions-select__list-elem-inner\">\n\t\t\t\t\t${reaction.render()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tbind(element.inner, 'mouseenter', () => {\n\t\t\t// reaction.playAnimation(true);\n\t\t});\n\n\t\tbind(element.inner, 'mouseleave', () => {\n\t\t\t// reaction.pauseAnimation(false);\n\t\t});\n\n\t\tbind(element.root, 'click', () => {\n\t\t\tthis.emit(ReactionPickerEvents.select, {\n\t\t\t\treaction: reactionName,\n\t\t\t});\n\n\t\t\tthis.#ranking.incrementReactionCounter(reactionName);\n\t\t});\n\n\t\treturn element.root;\n\t}\n\n\t#renderExpandButton(): HTMLElement\n\t{\n\t\tconst icon = new Icon({\n\t\t\ticon: Outline.CHEVRON_DOWN_M,\n\t\t\tsize: 24,\n\t\t});\n\n\t\tconst button = Tag.render`\n\t\t\t<button\n\t\t\t\tclass=\"reactions-select__expand-button --ui-hoverable\"\n\t\t\t\ttitle=\"${Loc.getMessage('UI_REACTIONS_LIST_EXPAND_BUTTON_TITLE')}\"\n\t\t\t>\n\t\t\t\t${icon.render()}\n\t\t\t</button>\n\t\t`;\n\n\t\tconst wrapper = Tag.render`\n\t\t\t<div class=\"reactions-select__expand-button-wrapper\">\n\t\t\t\t${button}\n\t\t\t</div>\n\t\t`;\n\n\t\tbind(button, 'click', () => {\n\t\t\tDom.remove(wrapper);\n\t\t\tDom.append(\n\t\t\t\tthis.#renderReactionElement(this.#getReactionsNames()[ReactionPicker.#rowSize - 1]),\n\t\t\t\tthis.#listContainer,\n\t\t\t);\n\t\t\tthis.#expand();\n\t\t});\n\n\t\treturn wrapper;\n\t}\n\n\t#destroyPopover(): void\n\t{\n\t\tif (!this.#popover)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#mouseenterHandler)\n\t\t{\n\t\t\tunbind(this.#popover, 'mouseenter', this.#mouseenterHandler);\n\t\t\tthis.#mouseenterHandler = null;\n\t\t}\n\n\t\tif (this.#mouseleaveHandler)\n\t\t{\n\t\t\tunbind(this.#popover, 'mouseleave', this.#mouseleaveHandler);\n\t\t\tthis.#mouseleaveHandler = null;\n\t\t}\n\n\t\tZIndexManager.unregister(this.#popover);\n\t\tthis.#popover.remove();\n\t\tthis.#popover = null;\n\t\tthis.#listContainer = null;\n\t\tthis.#expandedListContainer = null;\n\t}\n\n\t#destroyReactions(): void\n\t{\n\t\tthis.#reactions.forEach((reaction: Reaction) => {\n\t\t\treaction.destroy();\n\t\t});\n\n\t\tthis.#reactions = [];\n\t}\n\n\t#expand(): void\n\t{\n\t\tDom.addClass(this.#popover, '--expanded');\n\t\tDom.append(\n\t\t\tthis.#renderReactionsList(this.#getReactionsNames().slice(ReactionPicker.#rowSize), true),\n\t\t\tthis.#expandedListContainer,\n\t\t);\n\n\t\tif (this.#isEnoughSpaceBelowTargetElement() === false)\n\t\t{\n\t\t\tthis.adjustPosition();\n\t\t}\n\t}\n\n\t#isEnoughSpaceBelowTargetElement(): boolean\n\t{\n\t\tconst popoverRect = Dom.getPosition(this.#popover);\n\t\tconst targetRect = Dom.getPosition(this.#target);\n\n\t\treturn targetRect.bottom + popoverRect.height + ReactionPicker.#offsetBetweenTargetElement < window.innerHeight;\n\t}\n\n\t#isEnoughSpaceAboveTargetElement(): boolean\n\t{\n\t\tconst elementRect = Dom.getPosition(this.#target);\n\n\t\treturn (\n\t\t\telementRect.top\n\t\t\t- ReactionPicker.#minHeight\n\t\t\t- window.scrollY\n\t\t\t- ReactionPicker.#offsetBetweenTargetElement)\n\t\t> 0;\n\t}\n\n\t#getReactionsNames(): string[]\n\t{\n\t\tconst rankedReactions = this.#ranking.getRankedReactionsNames();\n\n\t\tconst excludedReactions = new Set([\n\t\t\tReactionName.signHorns,\n\t\t\tReactionName.faceWithStuckOutTongue,\n\t\t\tReactionName.handshake,\n\t\t\tReactionName.hundredPoints,\n\t\t\tReactionName.sleepingSymbol,\n\t\t\tReactionName.crossMark,\n\t\t\tReactionName.whiteHeavyCheckMark,\n\t\t\tReactionName.eyes,\n\t\t]);\n\n\t\tif (this.#allowedReactions)\n\t\t{\n\t\t\treturn rankedReactions.filter((reaction) => this.#allowedReactions.includes(reaction));\n\t\t}\n\n\t\treturn rankedReactions.filter((reaction) => !excludedReactions.has(reaction));\n\t}\n}\n"],"names":["ReactionPickerRanking","constructor","getRankedReactionsNames","allReactions","Object","values","ReactionName","sortedReactions","likeIndex","indexOf","like","splice","unshift","incrementReactionCounter","reactionName","currentCount","get","set","getReactionCounter","resetCounters","clear","stored","localStorage","getItem","Map","parsed","JSON","parse","Type","isObject","entries","error","console","warn","countersObject","fromEntries","setItem","stringify","topReactions","faceWithTearsOfJoy","redHeart","neutralFace","fire","cry","reaction","has","reactions","toSorted","a","b","countA","countB","includes","ReactionPickerEvents","show","hide","expand","select","mouseenter","mouseleave","ReactionPicker","EventEmitter","options","setEventNamespace","target","isArrayFilled","Dom","append","document","body","adjustPosition","ZIndexManager","register","bringToFront","requestAnimationFrame","addClass","emit","removeClass","setTimeout","isShown","isNumber","top","left","HTMLElement","getPopoverRect","getPosition","undefined","elementRect","popoverRect","isEnoughSpaceBelowTargetElement","height","rightEdge","width","windowWidth","window","innerWidth","rightPadding","style","position","slice","Tag","render","showExpandButton","length","bind","reactionsIds","isExpanded","list","forEach","reactionId","reactionTitle","ReactionTitle","Reaction","name","size","animation","animate","infinite","push","element","inner","root","icon","Icon","Outline","CHEVRON_DOWN_M","button","Loc","getMessage","wrapper","remove","unbind","unregister","destroy","targetRect","bottom","innerHeight","scrollY","rankedReactions","excludedReactions","Set","signHorns","faceWithStuckOutTongue","handshake","hundredPoints","sleepingSymbol","crossMark","whiteHeavyCheckMark","eyes","filter"],"mappings":"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"}