this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};this.BX.UI.Reaction=this.BX.UI.Reaction||{};(function(e,s,a,l,i,t,r){"use strict";var o=babelHelpers.classPrivateFieldLooseKey("STORAGE_KEY");var b=babelHelpers.classPrivateFieldLooseKey("INITIAL_COUNTER_VALUE");var c=babelHelpers.classPrivateFieldLooseKey("counters");var n=babelHelpers.classPrivateFieldLooseKey("loadCounters");var d=babelHelpers.classPrivateFieldLooseKey("saveCounters");var v=babelHelpers.classPrivateFieldLooseKey("initializeDefaultCounters");var p=babelHelpers.classPrivateFieldLooseKey("sortReactionsByRank");var P=babelHelpers.classPrivateFieldLooseKey("isValidReaction");class h{constructor(){Object.defineProperty(this,P,{value:B});Object.defineProperty(this,p,{value:F});Object.defineProperty(this,v,{value:L});Object.defineProperty(this,d,{value:H});Object.defineProperty(this,n,{value:u});Object.defineProperty(this,c,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,c)[c]=babelHelpers.classPrivateFieldLooseBase(this,n)[n]();babelHelpers.classPrivateFieldLooseBase(this,v)[v]()}getRankedReactionsNames(){const e=Object.values(r.ReactionName);const s=babelHelpers.classPrivateFieldLooseBase(this,p)[p](e);const a=s.indexOf(r.ReactionName.like);if(a>0){s.splice(a,1);s.unshift(r.ReactionName.like)}return s}incrementReactionCounter(e){if(!babelHelpers.classPrivateFieldLooseBase(this,P)[P](e)){return}const s=babelHelpers.classPrivateFieldLooseBase(this,c)[c].get(e)||0;babelHelpers.classPrivateFieldLooseBase(this,c)[c].set(e,s+1);babelHelpers.classPrivateFieldLooseBase(this,d)[d]()}getReactionCounter(e){if(!babelHelpers.classPrivateFieldLooseBase(this,P)[P](e)){return 0}return babelHelpers.classPrivateFieldLooseBase(this,c)[c].get(e)||0}resetCounters(){babelHelpers.classPrivateFieldLooseBase(this,c)[c].clear();babelHelpers.classPrivateFieldLooseBase(this,v)[v]();babelHelpers.classPrivateFieldLooseBase(this,d)[d]()}}function u(){try{const e=localStorage.getItem(babelHelpers.classPrivateFieldLooseBase(h,o)[o]);if(!e){return new Map}const s=JSON.parse(e);if(!t.Type.isObject(s)||s===null){return new Map}return new Map(Object.entries(s))}catch(e){console.warn("Failed to load reaction counters from localStorage:",e);return new Map}}function H(){try{const e=Object.fromEntries(babelHelpers.classPrivateFieldLooseBase(this,c)[c]);localStorage.setItem(babelHelpers.classPrivateFieldLooseBase(h,o)[o],JSON.stringify(e))}catch(e){console.warn("Failed to save reaction counters to localStorage:",e)}}function L(){const e=Object.values(r.ReactionName);const s=[r.ReactionName.like,r.ReactionName.faceWithTearsOfJoy,r.ReactionName.redHeart,r.ReactionName.neutralFace,r.ReactionName.fire,r.ReactionName.cry];for(const e of s){if(!babelHelpers.classPrivateFieldLooseBase(this,c)[c].has(e)){babelHelpers.classPrivateFieldLooseBase(this,c)[c].set(e,babelHelpers.classPrivateFieldLooseBase(h,b)[b])}}for(const s of e){if(!babelHelpers.classPrivateFieldLooseBase(this,c)[c].has(s)){babelHelpers.classPrivateFieldLooseBase(this,c)[c].set(s,0)}}}function F(e){return e.toSorted(((e,s)=>{const a=babelHelpers.classPrivateFieldLooseBase(this,c)[c].get(e)||0;const l=babelHelpers.classPrivateFieldLooseBase(this,c)[c].get(s)||0;if(a!==l){return l-a}return 0}))}function B(e){return Object.values(r.ReactionName).includes(e)}Object.defineProperty(h,o,{writable:true,value:"ui-reaction-picker-ranking"});Object.defineProperty(h,b,{writable:true,value:2});let f=e=>e,m,y,g,O,R,w;const j={show:"show",hide:"hide",expand:"expand",select:"select",mouseenter:"mouseenter",mouseleave:"mouseleave"};var K=babelHelpers.classPrivateFieldLooseKey("target");var N=babelHelpers.classPrivateFieldLooseKey("popover");var T=babelHelpers.classPrivateFieldLooseKey("isShown");var E=babelHelpers.classPrivateFieldLooseKey("listContainer");var I=babelHelpers.classPrivateFieldLooseKey("expandedListContainer");var _=babelHelpers.classPrivateFieldLooseKey("reactions");var k=babelHelpers.classPrivateFieldLooseKey("allowedReactions");var D=babelHelpers.classPrivateFieldLooseKey("ranking");var x=babelHelpers.classPrivateFieldLooseKey("mouseenterHandler");var C=babelHelpers.classPrivateFieldLooseKey("mouseleaveHandler");var S=babelHelpers.classPrivateFieldLooseKey("rowSize");var X=babelHelpers.classPrivateFieldLooseKey("minHeight");var U=babelHelpers.classPrivateFieldLooseKey("offsetBetweenTargetElement");var M=babelHelpers.classPrivateFieldLooseKey("adjustPositionToElement");var $=babelHelpers.classPrivateFieldLooseKey("adjustPositionToCoordinates");var A=babelHelpers.classPrivateFieldLooseKey("initPopover");var z=babelHelpers.classPrivateFieldLooseKey("renderReactionsList");var V=babelHelpers.classPrivateFieldLooseKey("renderReactionElement");var W=babelHelpers.classPrivateFieldLooseKey("renderExpandButton");var J=babelHelpers.classPrivateFieldLooseKey("destroyPopover");var Z=babelHelpers.classPrivateFieldLooseKey("destroyReactions");var Y=babelHelpers.classPrivateFieldLooseKey("expand");var q=babelHelpers.classPrivateFieldLooseKey("isEnoughSpaceBelowTargetElement");var G=babelHelpers.classPrivateFieldLooseKey("isEnoughSpaceAboveTargetElement");var Q=babelHelpers.classPrivateFieldLooseKey("getReactionsNames");class ee extends s.EventEmitter{constructor(e){super();Object.defineProperty(this,Q,{value:ve});Object.defineProperty(this,G,{value:de});Object.defineProperty(this,q,{value:ne});Object.defineProperty(this,Y,{value:ce});Object.defineProperty(this,Z,{value:be});Object.defineProperty(this,J,{value:oe});Object.defineProperty(this,W,{value:re});Object.defineProperty(this,V,{value:te});Object.defineProperty(this,z,{value:ie});Object.defineProperty(this,A,{value:le});Object.defineProperty(this,$,{value:ae});Object.defineProperty(this,M,{value:se});Object.defineProperty(this,K,{writable:true,value:void 0});Object.defineProperty(this,N,{writable:true,value:null});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,x,{writable:true,value:null});Object.defineProperty(this,C,{writable:true,value:null});this.setEventNamespace("UI.ReactionPicker.V2");babelHelpers.classPrivateFieldLooseBase(this,K)[K]=e.target;babelHelpers.classPrivateFieldLooseBase(this,k)[k]=t.Type.isArrayFilled(e.reactions)?e.reactions:null;babelHelpers.classPrivateFieldLooseBase(this,E)[E]=null;babelHelpers.classPrivateFieldLooseBase(this,I)[I]=null;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=false;babelHelpers.classPrivateFieldLooseBase(this,_)[_]=[];babelHelpers.classPrivateFieldLooseBase(this,D)[D]=new h}show(){if(!babelHelpers.classPrivateFieldLooseBase(this,N)[N]){babelHelpers.classPrivateFieldLooseBase(this,A)[A]()}t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,N)[N],document.body);this.adjustPosition();a.ZIndexManager.register(babelHelpers.classPrivateFieldLooseBase(this,N)[N]);a.ZIndexManager.bringToFront(babelHelpers.classPrivateFieldLooseBase(this,N)[N]);requestAnimationFrame((()=>{t.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,N)[N],"--visible")}));babelHelpers.classPrivateFieldLooseBase(this,T)[T]=true;this.emit(j.show)}hide(){if(!babelHelpers.classPrivateFieldLooseBase(this,N)[N]){return}t.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,N)[N],"--hiding");t.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,N)[N],"--visible");setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]();babelHelpers.classPrivateFieldLooseBase(this,J)[J]()}),150);babelHelpers.classPrivateFieldLooseBase(this,T)[T]=false;this.emit(j.hide)}isShown(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T]}adjustPosition(){if(!babelHelpers.classPrivateFieldLooseBase(this,N)[N]){return}if(t.Type.isNumber(babelHelpers.classPrivateFieldLooseBase(this,K)[K].top)&&t.Type.isNumber(babelHelpers.classPrivateFieldLooseBase(this,K)[K].left)){babelHelpers.classPrivateFieldLooseBase(this,$)[$](babelHelpers.classPrivateFieldLooseBase(this,K)[K])}else if(babelHelpers.classPrivateFieldLooseBase(this,K)[K]instanceof HTMLElement){babelHelpers.classPrivateFieldLooseBase(this,M)[M](babelHelpers.classPrivateFieldLooseBase(this,K)[K])}}getPopoverRect(){return babelHelpers.classPrivateFieldLooseBase(this,N)[N]?t.Dom.getPosition(babelHelpers.classPrivateFieldLooseBase(this,N)[N]):undefined}}function se(e){const s=t.Dom.getPosition(e);const a=t.Dom.getPosition(babelHelpers.classPrivateFieldLooseBase(this,N)[N]);let l=0;const i=babelHelpers.classPrivateFieldLooseBase(this,q)[q]();if(i===false){l=s.top-a.height-babelHelpers.classPrivateFieldLooseBase(ee,U)[U]}else if(babelHelpers.classPrivateFieldLooseBase(this,G)[G]()){l=s.top-babelHelpers.classPrivateFieldLooseBase(ee,X)[X]-babelHelpers.classPrivateFieldLooseBase(ee,U)[U]}else if(i){l=s.top+s.height+babelHelpers.classPrivateFieldLooseBase(ee,U)[U]}let r=s.left-53;const o=r+a.width;const b=window.innerWidth;const c=40;if(o+c>b){r=b-a.width-c}t.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,N)[N],{top:`${l}px`,left:`${r}px`})}function ae(e){t.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,N)[N],{top:`${e.top}px`,left:`${e.left}px`})}function le(){if(!babelHelpers.classPrivateFieldLooseBase(this,N)[N]){babelHelpers.classPrivateFieldLooseBase(this,E)[E]=babelHelpers.classPrivateFieldLooseBase(this,z)[z](babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]().slice(0,babelHelpers.classPrivateFieldLooseBase(ee,S)[S]-1));babelHelpers.classPrivateFieldLooseBase(this,I)[I]=t.Tag.render(m||(m=f`
				<div class="reactions-select-popover__expanded-list"></div>
			`));const e=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]().length>babelHelpers.classPrivateFieldLooseBase(ee,S)[S];babelHelpers.classPrivateFieldLooseBase(this,N)[N]=t.Tag.render(y||(y=f`
				<div class="reactions-select-popover --ui-context-content-light">
					<div class="reactions-select-popover__inner">
						${0}
						${0}
						${0}
					</div>
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,E)[E],e?babelHelpers.classPrivateFieldLooseBase(this,W)[W]():null,babelHelpers.classPrivateFieldLooseBase(this,I)[I]);babelHelpers.classPrivateFieldLooseBase(this,x)[x]=()=>{this.emit(j.mouseenter)};babelHelpers.classPrivateFieldLooseBase(this,C)[C]=()=>{this.emit(j.mouseleave)};t.bind(babelHelpers.classPrivateFieldLooseBase(this,N)[N],"mouseenter",babelHelpers.classPrivateFieldLooseBase(this,x)[x]);t.bind(babelHelpers.classPrivateFieldLooseBase(this,N)[N],"mouseleave",babelHelpers.classPrivateFieldLooseBase(this,C)[C])}}function ie(e,s=false){const a=t.Tag.render(g||(g=f`
			<div class="reactions-select__list"></div>
		`));if(s){t.Dom.addClass(a,"--expanded")}e.forEach((e=>{t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,V)[V](e),a)}));return a}function te(e){const s=r.ReactionTitle[e];const a=new r.Reaction({name:e,size:32,animation:{animate:true,infinite:true}});babelHelpers.classPrivateFieldLooseBase(this,_)[_].push(a);const l=t.Tag.render(O||(O=f`
			<div class="reactions-select__list-elem" title="${0}">
				<div ref="inner" class="reactions-select__list-elem-inner">
					${0}
				</div>
			</div>
		`),s,a.render());t.bind(l.inner,"mouseenter",(()=>{}));t.bind(l.inner,"mouseleave",(()=>{}));t.bind(l.root,"click",(()=>{this.emit(j.select,{reaction:e});babelHelpers.classPrivateFieldLooseBase(this,D)[D].incrementReactionCounter(e)}));return l.root}function re(){const e=new l.Icon({icon:l.Outline.CHEVRON_DOWN_M,size:24});const s=t.Tag.render(R||(R=f`
			<button
				class="reactions-select__expand-button --ui-hoverable"
				title="${0}"
			>
				${0}
			</button>
		`),t.Loc.getMessage("UI_REACTIONS_LIST_EXPAND_BUTTON_TITLE"),e.render());const a=t.Tag.render(w||(w=f`
			<div class="reactions-select__expand-button-wrapper">
				${0}
			</div>
		`),s);t.bind(s,"click",(()=>{t.Dom.remove(a);t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,V)[V](babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]()[babelHelpers.classPrivateFieldLooseBase(ee,S)[S]-1]),babelHelpers.classPrivateFieldLooseBase(this,E)[E]);babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]()}));return a}function oe(){if(!babelHelpers.classPrivateFieldLooseBase(this,N)[N]){return}if(babelHelpers.classPrivateFieldLooseBase(this,x)[x]){t.unbind(babelHelpers.classPrivateFieldLooseBase(this,N)[N],"mouseenter",babelHelpers.classPrivateFieldLooseBase(this,x)[x]);babelHelpers.classPrivateFieldLooseBase(this,x)[x]=null}if(babelHelpers.classPrivateFieldLooseBase(this,C)[C]){t.unbind(babelHelpers.classPrivateFieldLooseBase(this,N)[N],"mouseleave",babelHelpers.classPrivateFieldLooseBase(this,C)[C]);babelHelpers.classPrivateFieldLooseBase(this,C)[C]=null}a.ZIndexManager.unregister(babelHelpers.classPrivateFieldLooseBase(this,N)[N]);babelHelpers.classPrivateFieldLooseBase(this,N)[N].remove();babelHelpers.classPrivateFieldLooseBase(this,N)[N]=null;babelHelpers.classPrivateFieldLooseBase(this,E)[E]=null;babelHelpers.classPrivateFieldLooseBase(this,I)[I]=null}function be(){babelHelpers.classPrivateFieldLooseBase(this,_)[_].forEach((e=>{e.destroy()}));babelHelpers.classPrivateFieldLooseBase(this,_)[_]=[]}function ce(){t.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,N)[N],"--expanded");t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,z)[z](babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]().slice(babelHelpers.classPrivateFieldLooseBase(ee,S)[S]),true),babelHelpers.classPrivateFieldLooseBase(this,I)[I]);if(babelHelpers.classPrivateFieldLooseBase(this,q)[q]()===false){this.adjustPosition()}}function ne(){const e=t.Dom.getPosition(babelHelpers.classPrivateFieldLooseBase(this,N)[N]);const s=t.Dom.getPosition(babelHelpers.classPrivateFieldLooseBase(this,K)[K]);return s.bottom+e.height+babelHelpers.classPrivateFieldLooseBase(ee,U)[U]<window.innerHeight}function de(){const e=t.Dom.getPosition(babelHelpers.classPrivateFieldLooseBase(this,K)[K]);return e.top-babelHelpers.classPrivateFieldLooseBase(ee,X)[X]-window.scrollY-babelHelpers.classPrivateFieldLooseBase(ee,U)[U]>0}function ve(){const e=babelHelpers.classPrivateFieldLooseBase(this,D)[D].getRankedReactionsNames();const s=new Set([r.ReactionName.signHorns,r.ReactionName.faceWithStuckOutTongue,r.ReactionName.handshake,r.ReactionName.hundredPoints,r.ReactionName.sleepingSymbol,r.ReactionName.crossMark,r.ReactionName.whiteHeavyCheckMark,r.ReactionName.eyes]);if(babelHelpers.classPrivateFieldLooseBase(this,k)[k]){return e.filter((e=>babelHelpers.classPrivateFieldLooseBase(this,k)[k].includes(e)))}return e.filter((e=>!s.has(e)))}Object.defineProperty(ee,S,{writable:true,value:7});Object.defineProperty(ee,X,{writable:true,value:56});Object.defineProperty(ee,U,{writable:true,value:8});e.ReactionPickerEvents=j;e.ReactionPicker=ee})(this.BX.UI.Reaction.Picker=this.BX.UI.Reaction.Picker||{},BX.Event,BX,BX.UI.IconSet,BX,BX,BX.UI.Reaction.Item);
//# sourceMappingURL=reaction-picker.bundle.map.js