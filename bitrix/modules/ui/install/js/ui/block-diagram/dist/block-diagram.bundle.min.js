this.BX=this.BX||{};(function(t,e,o,n,a,s){"use strict";function i(){return{blockDiagramRef:null,blockDiagramTop:0,blockDiagramLeft:0,cursorType:"default",isResizing:false,isDisabled:false,blocks:[],connections:[],portsElMap:s.markRaw(new Map),portsRectMap:{},newConnection:null,movingBlock:null,movingConnections:[],resizingBlock:null,canvasRef:null,transformLayoutRef:null,canvasInstance:null,canvasWidth:0,canvasHeight:0,transformX:0,transformY:0,viewportX:0,viewportY:0,zoom:1,minZoom:.2,maxZoom:4,contextMenuLayerRef:null,targetContainerRef:null,isOpenContextMenu:false,contextMenuInstance:null,positionContextMenu:{top:0,left:0},historyCurrentState:s.markRaw({blocks:[],connections:[]}),headSnapshot:null,tailSnapshot:null,currentSnapshot:null,maxCountSnapshots:20,snapshotHandler:null,revertHandler:null,highlitedBlockIds:[],animationQueue:null,currentAnimationItem:null,isPauseAnimation:false,isStopAnimation:false}}const l=46;const r=14;const c=5;const u={CHANGED_BLOCKS:"changedBlocks",CHANGED_CONNECTIONS:"changedConnections",START_DRAG_BLOCK:"startDragBlock",MOVE_DRAG_BLOCK:"moveDragBlock",END_DRAG_BLOCK:"endDragBlock",ADD_BLOCK:"addBlock",UPDATE_BLOCK:"updateBlock",DELETE_BLOCK:"deleteBlock",CREATE_CONNECTION:"createConnection",DELETE_CONNECTION:"deleteConnection",BLOCK_TRANSITION_START:"blockTransitionStart",BLOCK_TRANSITION_END:"blockTransitionEnd",CONNECTION_TRANSITION_START:"connectionTransitionStart",CONNECTION_TRANSITION_END:"connectionTransitionEnd",DROP_NEW_BLOCK:"dropNewBlock"};const d={SIMPLE:"simple",TRIGGER:"trigger",COMPLEX:"complex"};const b="default";const p="default";const v={TOP:"top",BOTTOM:"bottom",RIGHT:"right",LEFT:"left"};const m={BEZIER:"bezier",SMOOTHSTEP:"smoothstep"};const h={BEZIER:"bezier",LINE:"line"};const f={BLOCK:"block",CONNECTION:"connection",REMOVE_BLOCK:"remove_block",REMOVE_CONNECTION:"remove_connection"};const g={EW_RESIZE:"ew-resize",NS_RESIZE:"ns-resize",NWSE_RESIZE:"nwse-resize",NESW_RESIZE:"nesw-resize"};const B={HIGHLITED:4,MOVABLE:3,STANDING:2,RESIZABLE:1};const y="x";const P="x";const k={[v.LEFT]:{x:-1,y:0},[v.RIGHT]:{x:1,y:0},[v.TOP]:{x:0,y:-1},[v.BOTTOM]:{x:0,y:1}};function L(t,e){const[o,n]=F({sourceX:t.x,sourceY:t.y,targetX:e.x,targetY:e.y});return{path:`M ${t.x} ${t.y} L ${e.x} ${e.y}`,center:{x:o,y:n}}}function V(t,e){const o=(t.x+e.x)/2;const[n,a]=F({sourceX:t.x,sourceY:t.y,targetX:e.x,targetY:e.y});return{path:`M ${t.x} ${t.y} C ${o} ${t.y}, ${o} ${e.y}, ${e.x} ${e.y}`,center:{x:n,y:a}}}function H(t,e,o){let n=Math.round((t.x-e.x)/e.zoom);let a=Math.round((t.y-e.y)/e.zoom);n-=Math.round(o.left/e.zoom);a-=Math.round(o.top/e.zoom);return{x:n,y:a}}function F({sourceX:t,sourceY:e,targetX:o,targetY:n}){const a=Math.abs(o-t)/2;const s=o<t?o+a:o-a;const i=Math.abs(n-e)/2;const l=n<e?n+i:n-i;return[s,l,a,i]}function x({source:t,sourcePosition:e=v.BOTTOM,target:o}){if(e===v.LEFT||e===v.RIGHT){return t.x<o.x?{x:1,y:0}:{x:-1,y:0}}return t.y<o.y?{x:0,y:1}:{x:0,y:-1}}function C(t,e){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function S({source:t,sourcePosition:e=v.BOTTOM,target:o,targetPosition:n=v.TOP,center:a,offset:s}){const i=k[e];const l=k[n];const r={x:t.x+i.x*s,y:t.y+i.y*s};const c={x:o.x+l.x*s,y:o.y+l.y*s};const u=x({source:r,sourcePosition:e,target:c});const d=u.x!==0?y:P;const b=u[d];let p=[];let m=0;let h=0;const f={x:0,y:0};const g={x:0,y:0};const[B,L,V,H]=F({sourceX:t.x,sourceY:t.y,targetX:o.x,targetY:o.y});if(i[d]*l[d]===-1){var C,S;m=(C=a.x)!=null?C:B;h=(S=a.y)!=null?S:L;const t=[{x:m,y:r.y},{x:m,y:c.y}];const e=[{x:r.x,y:h},{x:c.x,y:h}];if(i[d]===b){p=d===y?t:e}else{p=d===y?e:t}}else{const a=[{x:r.x,y:c.y}];const u=[{x:c.x,y:r.y}];if(d===y){p=i.x===b?u:a}else{p=i.y===b?a:u}if(e===n){const e=Math.abs(t[d]-o[d]);if(e<=s){const n=Math.min(s-1,s-e);if(i[d]===b){const e=r[d]>t[d]?-1:1;f[d]=e*n}else{const t=c[d]>o[d]?-1:1;g[d]=t*n}}}if(e!==n){const t=d===y?P:y;const e=i[d]===l[t];const o=r[t]>c[t];const n=r[t]<c[t];const s=i[d]===1&&(!e&&o||e&&n)||i[d]!==1&&(!e&&n||e&&o);if(s){p=d===y?a:u}}const v={x:r.x+f.x,y:r.y+f.y};const B={x:c.x+g.x,y:c.y+g.y};const k=Math.max(Math.abs(v.x-p[0].x),Math.abs(B.x-p[0].x));const L=Math.max(Math.abs(v.y-p[0].y),Math.abs(B.y-p[0].y));if(k>=L){m=(v.x+B.x)/2;h=p[0].y}else{m=p[0].x;h=(v.y+B.y)/2}}const E=[t,{x:r.x+f.x,y:r.y+f.y},...p,{x:c.x+g.x,y:c.y+g.y},o];return{points:E,offsetX:V,offsetY:H,centerX:m,centerY:h}}function E(t,e,o,n){const a=Math.min(C(t,e)/2,C(e,o)/2,n);const{x:s,y:i}=e;if(t.x===s&&s===o.x||t.y===i&&i===o.y){return`L${s} ${i}`}if(t.y===i){const e=t.x<o.x?-1:1;const n=t.y<o.y?1:-1;return`L ${s+a*e},${i}Q ${s},${i} ${s},${i+a*n}`}const l=t.x<o.x?1:-1;const r=t.y<o.y?-1:1;return`L ${s},${i+a*r}Q ${s},${i} ${s+a*l},${i}`}function w(t){const{sourceX:e,sourceY:o,sourcePosition:n=v.BOTTOM,targetX:a,targetY:s,targetPosition:i=v.TOP,borderRadius:l=5,centerX:r,centerY:c,offset:u=20}=t;const{points:d,centerX:b,centerY:p}=S({source:{x:e,y:o},sourcePosition:n,target:{x:a,y:s},targetPosition:i,center:{x:r,y:c},offset:u});const m=d.reduce(((t,e,o)=>{let n="";if(o>0&&o<d.length-1){n=E(d[o-1],e,d[o+1],l)}else{n=`${o===0?"M":"L"}${e.x} ${e.y}`}t+=n;return t}),"");return{path:m,center:{x:b,y:p}}}const M=Object.freeze({REPLACE:"replace",PUSH:"push",UPDATE_BY_INDEX:"updateByIndex",DELETE_BY_INDEX:"deleteByIndex"});const _={[M.REPLACE]:({payload:t})=>[...t],[M.PUSH]:({source:t,payload:e})=>{const o=[...t];o.push(e);return o},[M.UPDATE_BY_INDEX]:({source:t,payload:e,index:o})=>{const n=[...t];n[o]={...n[o],...e};return n},[M.DELETE_BY_INDEX]:({source:t,index:e})=>{const o=[...t];o.splice(e,1);return o}};function I(t,e){return{commandType:t,...e}}function O(t){return I(M.REPLACE,{payload:t})}function T(t){return I(M.PUSH,{payload:t})}function D(t,e){return I(M.UPDATE_BY_INDEX,{index:t,payload:e})}function N(t){return I(M.DELETE_BY_INDEX,{index:t})}function R(t,e,o){const{commandType:n,payload:a,index:s}=e;const i=_[n]({source:t,payload:a,index:s});o(i)}function z(){const t=new Set;const e=e=>{if(a.Type.isFunction(e)&&!t.has(e)){t.add(e)}};const o=e=>{t.delete(e)};const n=(...e)=>{for(const o of t){o(...e)}};return{on:e,off:o,trigger:n}}function A(t){return`block:${t}`}function j(t){return`conenction:${t}`}var K=1e-6;var G=typeof Float32Array!=="undefined"?Float32Array:Array;var $=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var t=0,e=arguments.length;while(e--){t+=arguments[e]*arguments[e]}return Math.sqrt(t)};function X(){var t=new G(9);if(G!=Float32Array){t[1]=0;t[2]=0;t[3]=0;t[5]=0;t[6]=0;t[7]=0}t[0]=1;t[4]=1;t[8]=1;return t}function Y(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function Z(t){t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=1;t[5]=0;t[6]=0;t[7]=0;t[8]=1;return t}function U(t,e){var o=e[0],n=e[1],a=e[2];var s=e[3],i=e[4],l=e[5];var r=e[6],c=e[7],u=e[8];var d=u*i-l*c;var b=-u*s+l*r;var p=c*s-i*r;var v=o*d+n*b+a*p;if(!v){return null}v=1/v;t[0]=d*v;t[1]=(-u*n+a*c)*v;t[2]=(l*n-a*i)*v;t[3]=b*v;t[4]=(u*o-a*r)*v;t[5]=(-l*o+a*s)*v;t[6]=p*v;t[7]=(-c*o+n*r)*v;t[8]=(i*o-n*s)*v;return t}function W(t,e,o){var n=e[0],a=e[1],s=e[2];var i=e[3],l=e[4],r=e[5];var c=e[6],u=e[7],d=e[8];var b=o[0],p=o[1],v=o[2];var m=o[3],h=o[4],f=o[5];var g=o[6],B=o[7],y=o[8];t[0]=b*n+p*i+v*c;t[1]=b*a+p*l+v*u;t[2]=b*s+p*r+v*d;t[3]=m*n+h*i+f*c;t[4]=m*a+h*l+f*u;t[5]=m*s+h*r+f*d;t[6]=g*n+B*i+y*c;t[7]=g*a+B*l+y*u;t[8]=g*s+B*r+y*d;return t}function q(t,e,o){var n=e[0],a=e[1],s=e[2],i=e[3],l=e[4],r=e[5],c=e[6],u=e[7],d=e[8],b=o[0],p=o[1];t[0]=n;t[1]=a;t[2]=s;t[3]=i;t[4]=l;t[5]=r;t[6]=b*n+p*i+c;t[7]=b*a+p*l+u;t[8]=b*s+p*r+d;return t}function Q(t,e,o){var n=e[0],a=e[1],s=e[2],i=e[3],l=e[4],r=e[5],c=e[6],u=e[7],d=e[8],b=Math.sin(o),p=Math.cos(o);t[0]=p*n+b*i;t[1]=p*a+b*l;t[2]=p*s+b*r;t[3]=p*i-b*n;t[4]=p*l-b*a;t[5]=p*r-b*s;t[6]=c;t[7]=u;t[8]=d;return t}function J(t,e,o){var n=o[0],a=o[1];t[0]=n*e[0];t[1]=n*e[1];t[2]=n*e[2];t[3]=a*e[3];t[4]=a*e[4];t[5]=a*e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function tt(t,e,o){t[0]=2/e;t[1]=0;t[2]=0;t[3]=0;t[4]=-2/o;t[5]=0;t[6]=-1;t[7]=1;t[8]=1;return t}function et(){var t=new G(3);if(G!=Float32Array){t[0]=0;t[1]=0;t[2]=0}return t}function ot(t){var e=t[0];var o=t[1];var n=t[2];return Math.hypot(e,o,n)}function nt(t,e,o){var n=new G(3);n[0]=t;n[1]=e;n[2]=o;return n}function at(t,e){var o=e[0];var n=e[1];var a=e[2];var s=o*o+n*n+a*a;if(s>0){s=1/Math.sqrt(s)}t[0]=e[0]*s;t[1]=e[1]*s;t[2]=e[2]*s;return t}function st(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function it(t,e,o){var n=e[0],a=e[1],s=e[2];var i=o[0],l=o[1],r=o[2];t[0]=a*r-s*l;t[1]=s*i-n*r;t[2]=n*l-a*i;return t}var lt=ot;var rt=function(){var t=et();return function(e,o,n,a,s,i){var l,r;if(!o){o=3}if(!n){n=0}if(a){r=Math.min(a*o+n,e.length)}else{r=e.length}for(l=n;l<r;l+=o){t[0]=e[l];t[1]=e[l+1];t[2]=e[l+2];s(t,t,i);e[l]=t[0];e[l+1]=t[1];e[l+2]=t[2]}return e}}();function ct(){var t=new G(4);if(G!=Float32Array){t[0]=0;t[1]=0;t[2]=0;t[3]=0}return t}function ut(t,e){var o=e[0];var n=e[1];var a=e[2];var s=e[3];var i=o*o+n*n+a*a+s*s;if(i>0){i=1/Math.sqrt(i)}t[0]=o*i;t[1]=n*i;t[2]=a*i;t[3]=s*i;return t}var dt=function(){var t=ct();return function(e,o,n,a,s,i){var l,r;if(!o){o=4}if(!n){n=0}if(a){r=Math.min(a*o+n,e.length)}else{r=e.length}for(l=n;l<r;l+=o){t[0]=e[l];t[1]=e[l+1];t[2]=e[l+2];t[3]=e[l+3];s(t,t,i);e[l]=t[0];e[l+1]=t[1];e[l+2]=t[2];e[l+3]=t[3]}return e}}();function bt(){var t=new G(4);if(G!=Float32Array){t[0]=0;t[1]=0;t[2]=0}t[3]=1;return t}function pt(t,e,o){o=o*.5;var n=Math.sin(o);t[0]=n*e[0];t[1]=n*e[1];t[2]=n*e[2];t[3]=Math.cos(o);return t}function vt(t,e,o,n){var a=e[0],s=e[1],i=e[2],l=e[3];var r=o[0],c=o[1],u=o[2],d=o[3];var b,p,v,m,h;p=a*r+s*c+i*u+l*d;if(p<0){p=-p;r=-r;c=-c;u=-u;d=-d}if(1-p>K){b=Math.acos(p);v=Math.sin(b);m=Math.sin((1-n)*b)/v;h=Math.sin(n*b)/v}else{m=1-n;h=n}t[0]=m*a+h*r;t[1]=m*s+h*c;t[2]=m*i+h*u;t[3]=m*l+h*d;return t}function mt(t,e){var o=e[0]+e[4]+e[8];var n;if(o>0){n=Math.sqrt(o+1);t[3]=.5*n;n=.5/n;t[0]=(e[5]-e[7])*n;t[1]=(e[6]-e[2])*n;t[2]=(e[1]-e[3])*n}else{var a=0;if(e[4]>e[0])a=1;if(e[8]>e[a*3+a])a=2;var s=(a+1)%3;var i=(a+2)%3;n=Math.sqrt(e[a*3+a]-e[s*3+s]-e[i*3+i]+1);t[a]=.5*n;n=.5/n;t[3]=(e[s*3+i]-e[i*3+s])*n;t[s]=(e[s*3+a]+e[a*3+s])*n;t[i]=(e[i*3+a]+e[a*3+i])*n}return t}var ht=ut;var ft=function(){var t=et();var e=nt(1,0,0);var o=nt(0,1,0);return function(n,a,s){var i=st(a,s);if(i<-.999999){it(t,e,a);if(lt(t)<1e-6)it(t,o,a);at(t,t);pt(n,t,Math.PI);return n}else if(i>.999999){n[0]=0;n[1]=0;n[2]=0;n[3]=1;return n}else{it(t,a,s);n[0]=t[0];n[1]=t[1];n[2]=t[2];n[3]=1+i;return ht(n,n)}}}();var gt=function(){var t=bt();var e=bt();return function(o,n,a,s,i,l){vt(t,n,i,l);vt(e,a,s,l);vt(o,t,e,2*l*(1-l));return o}}();var Bt=function(){var t=X();return function(e,o,n,a){t[0]=n[0];t[3]=n[1];t[6]=n[2];t[1]=a[0];t[4]=a[1];t[7]=a[2];t[2]=-o[0];t[5]=-o[1];t[8]=-o[2];return ht(e,mt(e,t))}}();function yt(){var t=new G(2);if(G!=Float32Array){t[0]=0;t[1]=0}return t}function Pt(t,e,o){var n=e[0],a=e[1];t[0]=o[0]*n+o[3]*a+o[6];t[1]=o[1]*n+o[4]*a+o[7];return t}var kt=function(){var t=yt();return function(e,o,n,a,s,i){var l,r;if(!o){o=2}if(!n){n=0}if(a){r=Math.min(a*o+n,e.length)}else{r=e.length}for(l=n;l<r;l+=o){t[0]=e[l];t[1]=e[l+1];s(t,t,i);e[l]=t[0];e[l+1]=t[1]}return e}}();var Lt=babelHelpers.classPrivateFieldLooseKey("x");var Vt=babelHelpers.classPrivateFieldLooseKey("y");var Ht=babelHelpers.classPrivateFieldLooseKey("rotation");var Ft=babelHelpers.classPrivateFieldLooseKey("zoom");var xt=babelHelpers.classPrivateFieldLooseKey("width");var Ct=babelHelpers.classPrivateFieldLooseKey("height");var St=babelHelpers.classPrivateFieldLooseKey("matrix");var Et=babelHelpers.classPrivateFieldLooseKey("projectionMatrix");var wt=babelHelpers.classPrivateFieldLooseKey("viewMatrix");var Mt=babelHelpers.classPrivateFieldLooseKey("viewProjectionMatrix");var _t=babelHelpers.classPrivateFieldLooseKey("viewProjectionMatrixInv");var It=babelHelpers.classPrivateFieldLooseKey("changeCallback");var Ot=babelHelpers.classPrivateFieldLooseKey("onChangedTransformParams");class Tt{constructor(t){Object.defineProperty(this,Ot,{value:Dt});Object.defineProperty(this,Lt,{writable:true,value:0});Object.defineProperty(this,Vt,{writable:true,value:0});Object.defineProperty(this,Ht,{writable:true,value:0});Object.defineProperty(this,Ft,{writable:true,value:1});Object.defineProperty(this,xt,{writable:true,value:0});Object.defineProperty(this,Ct,{writable:true,value:0});Object.defineProperty(this,St,{writable:true,value:X()});Object.defineProperty(this,Et,{writable:true,value:X()});Object.defineProperty(this,wt,{writable:true,value:X()});Object.defineProperty(this,Mt,{writable:true,value:X()});Object.defineProperty(this,_t,{writable:true,value:X()});Object.defineProperty(this,It,{writable:true,value:null});const{width:e,height:o,onChangeCallback:n}=t;babelHelpers.classPrivateFieldLooseBase(this,It)[It]=n;this.projection(e,o);this.updateMatrix();babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]({width:e,height:o})}get projectionMatrix(){return babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]}get viewMatrix(){return babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]}get viewProjectionMatrix(){return babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]}get viewProjectionMatrixInv(){return babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]}get matrix(){return babelHelpers.classPrivateFieldLooseBase(this,St)[St]}get zoom(){return babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]}set zoom(t){if(babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]!==t){babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]=t;babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]({zoom:t});this.updateMatrix()}}get x(){return babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]}set x(t){if(babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]!==t){babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]=t;babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]({x:t});this.updateMatrix()}}get y(){return babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]}set y(t){if(babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]!==t){babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=t;babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]({y:t});this.updateMatrix()}}get rotation(){return babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]}set rotation(t){if(babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]!==t){babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]=t;this.updateMatrix()}}get width(){return babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]}get height(){return babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]}setChangeTransformCallback(t){babelHelpers.classPrivateFieldLooseBase(this,It)[It]=t}clone(t=null,e=null){const o=new Tt({width:t||babelHelpers.classPrivateFieldLooseBase(this,xt)[xt],height:e||babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct],onChangeCallback:babelHelpers.classPrivateFieldLooseBase(this,It)[It]});babelHelpers.classPrivateFieldLooseBase(o,Lt)[Lt]=babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt];babelHelpers.classPrivateFieldLooseBase(o,Vt)[Vt]=babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt];babelHelpers.classPrivateFieldLooseBase(o,Ft)[Ft]=babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft];babelHelpers.classPrivateFieldLooseBase(o,Ht)[Ht]=babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht];o.updateMatrix();return o}projection(t,e){babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]=t;babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=e;tt(babelHelpers.classPrivateFieldLooseBase(this,Et)[Et],t,e);this.updateViewProjectionMatrix()}updateMatrix(){const t=1/babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft];Z(babelHelpers.classPrivateFieldLooseBase(this,St)[St]);q(babelHelpers.classPrivateFieldLooseBase(this,St)[St],babelHelpers.classPrivateFieldLooseBase(this,St)[St],[babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt],babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]]);Q(babelHelpers.classPrivateFieldLooseBase(this,St)[St],babelHelpers.classPrivateFieldLooseBase(this,St)[St],babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]);J(babelHelpers.classPrivateFieldLooseBase(this,St)[St],babelHelpers.classPrivateFieldLooseBase(this,St)[St],[t,t]);U(babelHelpers.classPrivateFieldLooseBase(this,wt)[wt],babelHelpers.classPrivateFieldLooseBase(this,St)[St]);this.updateViewProjectionMatrix()}updateViewProjectionMatrix(){W(babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt],babelHelpers.classPrivateFieldLooseBase(this,Et)[Et],babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]);U(babelHelpers.classPrivateFieldLooseBase(this,_t)[_t],babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt])}createLandmark(t={}){return{zoom:babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft],x:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt],y:babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt],rotation:babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht],...t}}viewportToCanvas({x:t,y:e},o){const{width:n,height:a,viewProjectionMatrixInv:s}=o||this;const i=Pt(yt(),[t/n*2-1,(1-e/a)*2-1],s);return{x:i[0],y:i[1]}}applyLandmark(t){const{x:e,y:o,zoom:n,rotation:a,viewportX:s,viewportY:i}=t;const l=s||i;let r=0;let c=0;if(l){const t=this.viewportToCanvas({x:s,y:i});r=t.x;c=t.y}babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]=n;babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]=a;babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]=e;babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=o;this.updateMatrix();babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]({x:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt],y:babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt],zoom:babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]});if(l){const{x:t,y:e}=this.viewportToCanvas({x:s,y:i});babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]+=r-t;babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]+=c-e;this.updateMatrix();babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]({x:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt],y:babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt],zoom:babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]})}}}function Dt(t){babelHelpers.classPrivateFieldLooseBase(this,It)[It]({x:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt],y:babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt],zoom:babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft],width:babelHelpers.classPrivateFieldLooseBase(this,xt)[xt],height:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct],...t})}var Nt=babelHelpers.classPrivateFieldLooseKey("canvas");var Rt=babelHelpers.classPrivateFieldLooseKey("dpr");var zt=babelHelpers.classPrivateFieldLooseKey("width");var At=babelHelpers.classPrivateFieldLooseKey("height");var jt=babelHelpers.classPrivateFieldLooseKey("minZoom");var Kt=babelHelpers.classPrivateFieldLooseKey("maxZoom");var Gt=babelHelpers.classPrivateFieldLooseKey("camera");var $t=babelHelpers.classPrivateFieldLooseKey("canvasStyleInstance");var Xt=babelHelpers.classPrivateFieldLooseKey("startInvertViewProjectionMatrix");var Yt=babelHelpers.classPrivateFieldLooseKey("startCameraX");var Zt=babelHelpers.classPrivateFieldLooseKey("startCameraY");var Ut=babelHelpers.classPrivateFieldLooseKey("startPos");var Wt=babelHelpers.classPrivateFieldLooseKey("resizeObserver");var qt=babelHelpers.classPrivateFieldLooseKey("initCanvas");var Qt=babelHelpers.classPrivateFieldLooseKey("initCamera");var Jt=babelHelpers.classPrivateFieldLooseKey("initCanvasStyle");var te=babelHelpers.classPrivateFieldLooseKey("initResizeObserver");var ee=babelHelpers.classPrivateFieldLooseKey("setCameraZoom");var oe=babelHelpers.classPrivateFieldLooseKey("getClipSpaceMousePosition");class ne{constructor(t){Object.defineProperty(this,oe,{value:ce});Object.defineProperty(this,ee,{value:re});Object.defineProperty(this,te,{value:le});Object.defineProperty(this,Jt,{value:ie});Object.defineProperty(this,Qt,{value:se});Object.defineProperty(this,qt,{value:ae});Object.defineProperty(this,Nt,{writable:true,value:null});Object.defineProperty(this,Rt,{writable:true,value:window.devicePixelRatio||1});Object.defineProperty(this,zt,{writable:true,value:0});Object.defineProperty(this,At,{writable:true,value:0});Object.defineProperty(this,jt,{writable:true,value:.02});Object.defineProperty(this,Kt,{writable:true,value:4});Object.defineProperty(this,Gt,{writable:true,value:null});Object.defineProperty(this,$t,{writable:true,value:null});Object.defineProperty(this,Xt,{writable:true,value:X()});Object.defineProperty(this,Yt,{writable:true,value:0});Object.defineProperty(this,Zt,{writable:true,value:0});Object.defineProperty(this,Ut,{writable:true,value:yt()});Object.defineProperty(this,Wt,{writable:true,value:null});this.transform=s.ref({x:0,y:0,zoom:0});const{canvas:e,canvasStyle:o,minZoom:n,maxZoom:a}=t;babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]=n;babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt]=a;babelHelpers.classPrivateFieldLooseBase(this,qt)[qt](e);babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]();babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt](o);babelHelpers.classPrivateFieldLooseBase(this,te)[te]()}get viewMatrix(){var t,e;return(t=(e=babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt])==null?void 0:e.viewMatrix)!=null?t:[]}get camera(){return babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]}clientToViewport({x:t,y:e}){const{left:o,top:n}=babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt].getBoundingClientRect();return{x:t-o,y:e-n}}viewportToClient({x:t,y:e}){const{left:o,top:n}=babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt].getBoundingClientRect();return{x:t+o,y:e+n}}render(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t])==null?void 0:t.render({projectionMatrix:babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].projectionMatrix,viewMatrix:babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].viewMatrix,viewProjectionMatrixInv:babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].viewProjectionMatrixInv,zoomScale:babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].zoom})}setCamera(t){babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].applyLandmark(babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].createLandmark({...t}))}zoomIn(t){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](t)}zoomOut(t){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](t*-1)}setCameraZoomByWheel(t,e=0){const o=Math.max(babelHelpers.classPrivateFieldLooseBase(this,jt)[jt],Math.min(babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt],(babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].zoom+e)*2**(t.deltaY*-.01)));const n=this.clientToViewport({x:t.clientX,y:t.clientY});babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].applyLandmark(babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].createLandmark({viewportX:n.x,viewportY:n.y,zoom:o}))}setCameraPositionByWheel(t){babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].x+=t.deltaX/babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].zoom;babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].y+=t.deltaY/babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].zoom}setCameraPositionByMouseDown(t){Y(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt],babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].viewProjectionMatrixInv);babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]=babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].x;babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].y;Pt(babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut],babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](t),babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt])}setCameraPositionByMouseMove(t){const e=Pt(yt(),babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](t),babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]);babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].x=babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]+babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut][0]-e[0];babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].y=babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]+babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut][1]-e[1]}destroy(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t])==null?void 0:t.destroy();babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].unobserve(babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt])}}function ae(t){const{width:e,height:o}=t.getBoundingClientRect();babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]=t;babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt].width=e*babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt].height=o*babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]=babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt].width;babelHelpers.classPrivateFieldLooseBase(this,At)[At]=babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt].height}function se(){babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]=new Tt({width:babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt],height:babelHelpers.classPrivateFieldLooseBase(this,At)[At]/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt],onChangeCallback:({x:t,y:e,zoom:o})=>{this.transform.x=t;this.transform.y=e;this.transform.zoom=o}})}function ie(t){if(t){const e=t.instance;babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]=new e(babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt],t.options)}}function le(){babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]=new ResizeObserver((t=>{for(const e of t){babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]=babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].clone(e.contentRect.width,e.contentRect.height)}}));babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].observe(babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt])}function re(t){const e=Number((babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].zoom+t).toFixed(1));if(e<babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]||e>babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt]){return}babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].applyLandmark(babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].createLandmark({x:babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].x,y:babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].y,viewportX:babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].width/2,viewportY:babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].height/2,zoom:e}))}function ce(t){const{left:e,top:o}=babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt].getBoundingClientRect();const n=t.clientX-e;const a=t.clientY-o;const s=n/babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt].clientWidth||babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt].width/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];const i=a/babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt].clientHeight||babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt].height/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];const l=s*2-1;const r=i*-2+1;return[l,r]}const ue=`\n  #extension GL_OES_standard_derivatives : enable\n  precision mediump float;\n\n  attribute vec2 a_Position;\n  uniform mat3 u_ViewProjectionInvMatrix;\n  varying vec2 v_Position;\n\n  vec2 project_clipspace(vec2 p) {\n  \treturn (u_ViewProjectionInvMatrix * vec3(p, 1)).xy;\n  }\n\n  void main() {\n  \tv_Position = project_clipspace(a_Position);\n  \tgl_Position = vec4(a_Position, 0, 1);\n  }\n`;const de=`\n  #extension GL_OES_standard_derivatives : enable\n  precision mediump float;\n\n  uniform vec4 u_BackgroundColor;\n  uniform vec4 u_GridColor;\n  uniform float u_GridSize;\n  uniform float u_ZoomStep;\n  uniform float u_ZoomScale;\n  varying vec2 v_Position;\n\n  vec4 render_grid(vec2 coord) {\n  \tfloat alpha = 0.0;\n  \tfloat gridSize1 = u_GridSize;\n  \tfloat gridSize2 = gridSize1 / 4.0;\n\n  \tvec2 grid1 = abs(fract(coord / gridSize1 - 0.5) - 0.5) / fwidth(coord) * gridSize1 / 0.95;\n  \tvec2 grid2 = abs(fract(coord / gridSize2 - 0.5) - 0.5) / fwidth(coord) * gridSize2 / 0.75;\n  \tfloat v1 = 1.0 - min(min(grid1.x, grid1.y), 1.0);\n  \tfloat v2 = 1.0 - min(min(grid2.x, grid2.y), 1.0);\n\n  \tif (v1 > 0.0) {\n  \t\talpha = clamp(v1, 0.0, 0.222);\n  \t} else {\n  \t\talpha = v2 * clamp(u_ZoomScale / u_ZoomStep, 0.0, 1.0);\n  \t}\n\n  \treturn mix(u_BackgroundColor, u_GridColor, alpha);\n  }\n\n  void main() {\n  \tgl_FragColor = render_grid(v_Position);\n  }\n`;function be(t,e,o){const n=t.createShader(o);t.shaderSource(n,e);t.compileShader(n);const a=t.getShaderParameter(n,t.COMPILE_STATUS);if(!a){throw new Error(`Error shader compilation: ${t.getShaderInfoLog(n)}`)}return n}function pe(t,e,o){const n=t.createProgram();t.attachShader(n,e);t.attachShader(n,o);t.linkProgram(n);const a=t.getProgramParameter(n,t.LINK_STATUS);if(!a){throw new Error(`Error initializing shader program: ${t.getProgramInfoLog(n)}`)}return n}function ve(t,e,o,n){const a=o||t.ARRAY_BUFFER;const s=t.createBuffer();t.bindBuffer(a,s);t.bufferData(a,e,n||t.STATIC_DRAW);return s}function me(t){const e=t.replace(/^#/,"");const o=parseInt(e.slice(0,2),16);const n=parseInt(e.slice(2,4),16);const a=parseInt(e.slice(4,6),16);return[o/255,n/255,a/255]}var he=babelHelpers.classPrivateFieldLooseKey("gl");var fe=babelHelpers.classPrivateFieldLooseKey("program");var ge=babelHelpers.classPrivateFieldLooseKey("positionAttributeLocation");var Be=babelHelpers.classPrivateFieldLooseKey("vertexShader");var ye=babelHelpers.classPrivateFieldLooseKey("fragmentShader");var Pe=babelHelpers.classPrivateFieldLooseKey("projectionMatrixLink");var ke=babelHelpers.classPrivateFieldLooseKey("viewMatrixLink");var Le=babelHelpers.classPrivateFieldLooseKey("viewProjectionInvMatrixLink");var Ve=babelHelpers.classPrivateFieldLooseKey("backgroundColorLink");var He=babelHelpers.classPrivateFieldLooseKey("backgroundColor");var Fe=babelHelpers.classPrivateFieldLooseKey("gridColorLink");var xe=babelHelpers.classPrivateFieldLooseKey("gridColor");var Ce=babelHelpers.classPrivateFieldLooseKey("gridColorAlpha");var Se=babelHelpers.classPrivateFieldLooseKey("gridSizeLink");var Ee=babelHelpers.classPrivateFieldLooseKey("gridSize");var we=babelHelpers.classPrivateFieldLooseKey("zoomScaleLink");var Me=babelHelpers.classPrivateFieldLooseKey("gridPosition");var _e=babelHelpers.classPrivateFieldLooseKey("gridPositionBuffer");var Ie=babelHelpers.classPrivateFieldLooseKey("zoomStepLink");var Oe=babelHelpers.classPrivateFieldLooseKey("zoomStep");var Te=babelHelpers.classPrivateFieldLooseKey("zoomSteps");var De=babelHelpers.classPrivateFieldLooseKey("initGrid");var Ne=babelHelpers.classPrivateFieldLooseKey("getPreparedZoomSteps");var Re=babelHelpers.classPrivateFieldLooseKey("initParams");var ze=babelHelpers.classPrivateFieldLooseKey("getParamsByZoom");class Ae{constructor(t,e){Object.defineProperty(this,ze,{value:$e});Object.defineProperty(this,Re,{value:Ge});Object.defineProperty(this,Ne,{value:Ke});Object.defineProperty(this,De,{value:je});Object.defineProperty(this,he,{writable:true,value:void 0});Object.defineProperty(this,fe,{writable:true,value:null});Object.defineProperty(this,ge,{writable:true,value:null});Object.defineProperty(this,Be,{writable:true,value:null});Object.defineProperty(this,ye,{writable:true,value:null});Object.defineProperty(this,Pe,{writable:true,value:null});Object.defineProperty(this,ke,{writable:true,value:null});Object.defineProperty(this,Le,{writable:true,value:null});Object.defineProperty(this,Ve,{writable:true,value:null});Object.defineProperty(this,He,{writable:true,value:null});Object.defineProperty(this,Fe,{writable:true,value:null});Object.defineProperty(this,xe,{writable:true,value:null});Object.defineProperty(this,Ce,{writable:true,value:null});Object.defineProperty(this,Se,{writable:true,value:null});Object.defineProperty(this,Ee,{writable:true,value:null});Object.defineProperty(this,we,{writable:true,value:null});Object.defineProperty(this,Me,{writable:true,value:[-1,-1,-1,1,1,-1,1,1]});Object.defineProperty(this,_e,{writable:true,value:null});Object.defineProperty(this,Ie,{writable:true,value:null});Object.defineProperty(this,Oe,{writable:true,value:4});Object.defineProperty(this,Te,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,Re)[Re](e);babelHelpers.classPrivateFieldLooseBase(this,De)[De](t)}render({projectionMatrix:t,viewMatrix:e,viewProjectionMatrixInv:o,zoomScale:n}){babelHelpers.classPrivateFieldLooseBase(this,he)[he].clearColor(1,1,1,1);babelHelpers.classPrivateFieldLooseBase(this,he)[he].clear(babelHelpers.classPrivateFieldLooseBase(this,he)[he].COLOR_BUFFER_BIT);babelHelpers.classPrivateFieldLooseBase(this,he)[he].useProgram(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]);const{gridColor:a,zoomStep:s,size:i}=babelHelpers.classPrivateFieldLooseBase(this,ze)[ze](n);babelHelpers.classPrivateFieldLooseBase(this,he)[he].uniformMatrix3fv(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe],false,t);babelHelpers.classPrivateFieldLooseBase(this,he)[he].uniformMatrix3fv(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke],false,e);babelHelpers.classPrivateFieldLooseBase(this,he)[he].uniformMatrix3fv(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le],false,o);babelHelpers.classPrivateFieldLooseBase(this,he)[he].uniform4f(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve],...babelHelpers.classPrivateFieldLooseBase(this,He)[He],1);babelHelpers.classPrivateFieldLooseBase(this,he)[he].uniform4f(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe],...a,1);babelHelpers.classPrivateFieldLooseBase(this,he)[he].uniform1f(babelHelpers.classPrivateFieldLooseBase(this,Se)[Se],i);babelHelpers.classPrivateFieldLooseBase(this,he)[he].uniform1f(babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie],s);babelHelpers.classPrivateFieldLooseBase(this,he)[he].uniform1f(babelHelpers.classPrivateFieldLooseBase(this,we)[we],n);babelHelpers.classPrivateFieldLooseBase(this,he)[he].enableVertexAttribArray(babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]);babelHelpers.classPrivateFieldLooseBase(this,he)[he].bindBuffer(babelHelpers.classPrivateFieldLooseBase(this,he)[he].ARRAY_BUFFER,babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]);babelHelpers.classPrivateFieldLooseBase(this,he)[he].vertexAttribPointer(babelHelpers.classPrivateFieldLooseBase(this,ge)[ge],2,babelHelpers.classPrivateFieldLooseBase(this,he)[he].FLOAT,false,0,0);babelHelpers.classPrivateFieldLooseBase(this,he)[he].drawArrays(babelHelpers.classPrivateFieldLooseBase(this,he)[he].TRIANGLE_STRIP,0,4)}destroy(){babelHelpers.classPrivateFieldLooseBase(this,he)[he].deleteProgram(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]);babelHelpers.classPrivateFieldLooseBase(this,he)[he].deleteShader(babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]);babelHelpers.classPrivateFieldLooseBase(this,he)[he].deleteShader(babelHelpers.classPrivateFieldLooseBase(this,ye)[ye])}}function je(t){babelHelpers.classPrivateFieldLooseBase(this,he)[he]=t.getContext("webgl");babelHelpers.classPrivateFieldLooseBase(this,he)[he].getExtension("OES_standard_derivatives");babelHelpers.classPrivateFieldLooseBase(this,he)[he].viewport(0,0,babelHelpers.classPrivateFieldLooseBase(this,he)[he].canvas.width,babelHelpers.classPrivateFieldLooseBase(this,he)[he].canvas.height);babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]=be(babelHelpers.classPrivateFieldLooseBase(this,he)[he],ue,babelHelpers.classPrivateFieldLooseBase(this,he)[he].VERTEX_SHADER);babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]=be(babelHelpers.classPrivateFieldLooseBase(this,he)[he],de,babelHelpers.classPrivateFieldLooseBase(this,he)[he].FRAGMENT_SHADER);babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]=pe(babelHelpers.classPrivateFieldLooseBase(this,he)[he],babelHelpers.classPrivateFieldLooseBase(this,Be)[Be],babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]);babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getAttribLocation(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe],"a_Position");babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe],"u_ProjectionMatrix");babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe],"u_ViewMatrix");babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe],"u_ViewProjectionInvMatrix");babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe],"u_BackgroundColor");babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe],"u_GridColor");babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe],"u_GridSize");babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe],"u_ZoomStep");babelHelpers.classPrivateFieldLooseBase(this,we)[we]=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe],"u_ZoomScale");babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]=ve(babelHelpers.classPrivateFieldLooseBase(this,he)[he],new Float32Array(babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]))}function Ke(t){return t.sort(((t,e)=>e.zoomStep-t.zoomStep)).map((t=>({zoomStep:babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe],...t,size:"size"in t?t.size:babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee],gridColor:"gridColor"in t?me(t.gridColor):babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]})))}function Ge(t){const{size:e,gridColor:o,gridColorAlpha:n,backgroundColor:a,zoomStep:s,zoomSteps:i}=t;babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]=e;babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]=s;babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=new Float32Array(me(o));babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]=n;babelHelpers.classPrivateFieldLooseBase(this,He)[He]=new Float32Array(me(a));babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]=babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne](i)}function $e(t){for(const e of babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]){if(e.zoom<=t){return e}}return{gridColor:babelHelpers.classPrivateFieldLooseBase(this,xe)[xe],size:babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee],zoomStep:babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]}}function Xe(t={}){const e=t=>s.markRaw({blocks:s.markRaw(JSON.parse(JSON.stringify(t.blocks))),connections:s.markRaw(JSON.parse(JSON.stringify(t.connections)))});const o=t=>{u.changedBlocks.trigger(O(t.blocks));u.changedConnections.trigger(O(t.connections))};const n={blocks:[],connections:[]};const a=We();const{headSnapshot:i,tailSnapshot:l,currentSnapshot:r,maxCountSnapshots:c,hooks:u,snapshotHandler:d,revertHandler:b,setHistoryHandlers:p,historyCurrentState:v}=a;const{snapshotHandler:m=null,revertHandler:h=null,emptyHistorySnapshot:f=n,maxCount:g}=t;P({newSnapshotHandler:m,newRevertHandler:h});c.value=g||s.toValue(c);const B=s.computed((()=>s.toValue(r)&&s.toValue(r).next!==null));const y=s.computed((()=>s.toValue(r)&&s.toValue(r).prev!==null));function P(t){var n,a,i,l;const r={snapshotHandler:(n=(a=t.snapshotHandler)!=null?a:s.toValue(d))!=null?n:e,revertHandler:(i=(l=t.revertHandler)!=null?l:s.toValue(b))!=null?i:o};p(r)}function k(){let t=0;let e=s.toValue(i);while(e){e=e.next;t+=1}return t}function L(t={}){var e;const{snapshotHandler:o=null,revertHandler:n=null,emptySnapshot:a=null}=t;const u=o||s.toValue(d);const p=n||s.toValue(b);const m=a||f;const h=s.markRaw({snapshot:u(s.toValue(v)),revertHandler:p,emptySnapshot:m,next:null,prev:l.value});if(s.toValue(r)&&((e=s.toValue(r))==null?void 0:e.next)!==null){r.value.next=h;h.prev=r.value;l.value.prev=null;l.value.next=null;l.value=h}else if(s.toValue(i)===null){i.value=h;l.value=h}else{l.value.next=h;l.value=h}r.value=h;if(k()<=s.toValue(c)+1){return}const g=i.value;i.value=g.next;i.value.prev=null;g.next=null}async function V({revertHandler:t,snapshot:e,emptySnapshot:o}){t(o);await s.nextTick();t(e)}async function H(){if(s.toValue(r)===null||s.toValue(r).next===null){return}await V(s.toValue(r).next);r.value=s.toValue(r).next}async function F(){if(s.toValue(r)===null||s.toValue(r).prev===null){return}await V(s.toValue(r).prev);r.value=s.toValue(r).prev}function x(){i.value=null;l.value=null;r.value=null}return{hasNext:B,hasPrev:y,setHandlers:P,makeSnapshot:()=>s.nextTick((()=>L())),next:H,prev:F,clear:x,commonSnapshotHandler:e,commonRevertHandler:o}}function Ye({state:t,getters:e,hooks:o}){function n(e){t.blocks=s.toValue(e.blocks);t.connections=s.toValue(e.connections);t.transformX=e.transform.x;t.transformY=e.transfrom.y;t.zoom=s.toValue(e.zoom)}function i(e){const{x:o=0,y:n=0,zoom:a=1,viewportX:s=0,viewportY:i=0}=e;t.transformX=o;t.transformY=n;t.viewportX=s;t.viewportY=i;t.zoom=a}const u=e=>{const{sourceBlockId:o,sourcePortId:n,targetBlockId:a,targetPortId:s}=e;return t.connections.some((({sourceBlockId:t,sourcePortId:e,targetBlockId:i,targetPortId:l})=>{const r=t===o&&e===n&&i===a&&l===s;const c=t===a&&e===s&&i===o&&l===n;return r||c}))};const b=t=>{if(!u(t)){o.changedConnections.trigger(T({id:a.Text.getRandom(),...t}));o.createConnection.trigger(t)}};const p=e=>{const n=t.connections.filter((t=>t.id!==e));o.changedConnections.trigger(O(n));o.deleteConnection.trigger(e)};const v=(e,n)=>{var a,s,i,l;const r=t.blocks.find((t=>t.id===e));if(!r){return}const c=new Set([...(a=(s=r.ports)==null?void 0:s.input)!=null?a:[],...(i=(l=r.ports)==null?void 0:l.output)!=null?i:[]].map((t=>t.id)));const u=t.connections.filter((t=>{const{sourceBlockId:o,sourcePortId:n,targetBlockId:a,targetPortId:s}=t;const i=o===e&&c.has(n);const l=a===e&&c.has(s);return!i&&!l}));o.changedConnections.trigger(O(u))};const m=e=>{const n=t.blocks.findIndex((t=>t.id===e));if(n===-1){return}v(e);o.changedBlocks.trigger(N(n));o.deleteBlock.trigger(e)};const h=t=>{o.changedBlocks.trigger(T(t));o.addBlock.trigger(t)};const f=(e,o,n)=>{t.blocks[e].position.x=o;t.blocks[e].position.y=n};const g=e=>{const n=t.blocks.findIndex((t=>t.id===e.id));if(n===-1){return}o.changedBlocks.trigger(D(n,e));o.updateBlock.trigger(e)};const B=(t,e)=>{const{position:{x:o,y:n},dimensions:{width:a},ports:{output:s},node:{type:i}}=t;const{position:c,id:u}=e;let b=c*l/2;if(i===d.COMPLEX){b+=r+l}let p=o;const v=s.some((t=>t.id===u));if(v){p=Number(o)+Number(a)}return{x:p,y:Number(n)+b}};const y=(e,o)=>{let n=null;let a=Infinity;t.blocks.forEach((t=>{const s=[...t.ports.input,...t.ports.output];s.forEach((s=>{const{x:i,y:l}=B(t,s);const r=e-i;const u=o-l;const d=Math.hypot(r,u);if(d<c&&d<a){n={block:t,port:s};a=d}}))}));return n};const P=e=>{var o,n;let a=Math.round(e.clientX/s.toValue(t.zoom));let i=Math.round(e.clientY/s.toValue(t.zoom));const{top:l,left:r}=(o=(n=s.toValue(t.blockDiagramRef))==null?void 0:n.getBoundingClientRect())!=null?o:{top:0,left:0};a-=Math.round(r/s.toValue(t.zoom));i-=Math.round(l/s.toValue(t.zoom));return{x:a,y:i}};const k=e=>{t.movingBlock=s.toRaw({...e});const o=[];const n=[...e.ports.input,...e.ports.output];n.forEach((n=>{const a=t.connections.filter((t=>{const{targetBlockId:o,targetPortId:a,sourceBlockId:s,sourcePortId:i}=t;const l=o===e.id&&a===n.id;const r=s===e.id&&i===n.id;return l||r}));o.push(...a)}));t.movingConnections=o};const L=(e,o)=>{t.movingBlock.position.x=e;t.movingBlock.position.y=o};const V=()=>{t.movingBlock=null;t.movingConnections=[]};const H=({snapshotHandler:e=null,revertHandler:o=null})=>{t.snapshotHandler=e||t.snapshotHandler;t.revertHandler=o||t.revertHandler};const F=(e,o)=>{var n,a;const i=(n=(a=s.toValue(t.portsRectMap))==null?void 0:a[e])!=null?n:{};Object.entries(i).forEach((([t,e])=>{i[t].x=e.x-o.x;i[t].y=e.y-o.y}))};const x=(e,o)=>{var n,a,i;const{portsElMap:l,blockDiagramLeft:r,blockDiagramTop:c,zoom:u,transformX:d,transformY:b}=t;const p=s.toValue(l).has(e);const v=p&&s.toValue(l).get(e).has(o);if(!p||!v){return}const{x:m=0,y:h=0,width:f=0,height:g=0}=(n=(a=l.get(e))==null?void 0:(i=a.get(o))==null?void 0:i.getBoundingClientRect())!=null?n:{};t.portsRectMap[e][o].x=m/u+s.toValue(d)-s.toValue(r)/u;t.portsRectMap[e][o].y=h/u+s.toValue(b)-s.toValue(c)/u;t.portsRectMap[e][o].width=f;t.portsRectMap[e][o].height=g};return{setState:n,updateCanvasTransform:i,isExistConnection:u,addConnection:b,deleteConnectionById:p,addBlock:h,updateBlockPositionByIndex:f,updateBlock:g,deleteBlockById:m,getPortAbsolutePosition:B,findNearestPort:y,transformEventToPoint:P,setMovingBlock:k,updateMovingBlockPosition:L,resetMovingBlock:V,setHistoryHandlers:H,setPortOffsetByBlockId:F,updatePortPosition:x}}function Ze(t){const e=s.computed((()=>({x:t.transformX,y:t.transformY,zoom:t.zoom,viewportX:t.viewportX,viewportY:t.viewportY})));const o=s.computed((()=>{var e,o;return(e=(o=t.canvasRef)==null?void 0:o.canvasId)!=null?e:null}));const n=s.computed((()=>t.blocks.reduce(((t,e)=>{var o;const n=(o=e==null?void 0:e.type)!=null?o:b;if(n in t){t[n]=[...t[n],e]}else{t[n]=[e]}return t}),{[b]:[]})));const a=s.computed((()=>Object.keys(s.toValue(n))));const i=s.computed((()=>t.connections.reduce(((t,e)=>{var o;const n=(o=e==null?void 0:e.type)!=null?o:p;if(n in t){t[n]=[...t[n],e]}else{t[n]=[e]}return t}),{[p]:[]})));const l=s.computed((()=>Object.keys(s.toValue(i))));const r=s.computed((()=>t.animationQueue!==null));const c=s.computed((()=>t.isDisabled||s.toValue(r)));return{transform:e,canvasId:o,groupedBlocks:n,blockGroupNames:a,groupedConnections:i,connectionGroupNames:l,isAnimate:r,isDisabledBlockDiagram:c}}function Ue(){return{[u.START_DRAG_BLOCK]:z(),[u.MOVE_DRAG_BLOCK]:z(),[u.END_DRAG_BLOCK]:z(),[u.ADD_BLOCK]:z(),[u.UPDATE_BLOCK]:z(),[u.DELETE_BLOCK]:z(),[u.CREATE_CONNECTION]:z(),[u.DELETE_CONNECTION]:z(),[u.CHANGED_BLOCKS]:z(),[u.CHANGED_CONNECTIONS]:z(),[u.BLOCK_TRANSITION_START]:z(),[u.BLOCK_TRANSITION_END]:z(),[u.CONNECTION_TRANSITION_START]:z(),[u.CONNECTION_TRANSITION_END]:z(),[u.DROP_NEW_BLOCK]:z()}}function We(t){var e,o,n,a,l;const r=(e=s.getCurrentInstance())==null?void 0:e.appContext.app;const c=(o=r==null?void 0:(n=r.config)==null?void 0:(a=n.globalProperties)==null?void 0:a.$blockDiagram)!=null?o:null;if(c!==null){return c}const u=i(t);const d=s.reactive(u);const b=Ze(d);const p=Ue();const v=Ye({state:d,getters:b,hooks:p});if(t){v.setState(t)}r.config.globalProperties.$blockDiagram={...s.toRefs(d),...b,...v,hooks:p};r.config.globalProperties.$blockDiagramTestId=(t,...e)=>{if(!t){throw new Error("ui.block-diagram not found test id")}const o=e.reduce(((t,e)=>`${t}-${e}`),"");return`${t}${o}`};return(l=r.config.globalProperties)==null?void 0:l.$blockDiagram}function qe(t=[]){const{contextMenuLayerRef:o,targetContainerRef:n,isOpenContextMenu:i,positionContextMenu:l,contextMenuInstance:r,zoom:c}=We();r.value=s.toValue(r)||s.shallowRef(e.MenuManager.create(v()));const u=s.ref(false);let d={items:t};function b(t){d=v(t)}function p(t=[]){return t.map((t=>({...t,onclick:()=>{if(a.Type.isFunction(t.onclick)){t.onclick()}f()}})))}function v(t){var e;return{id:"block-diagram-context-menu",bindElement:{left:0,top:0},minWidth:200,autoHide:true,draggable:false,cacheable:false,targetContainer:s.toValue(n),...t,items:p((e=t==null?void 0:t.items)!=null?e:[])}}function m(t){var e,o;(e=s.toValue(r))==null?void 0:(o=e.popupWindow)==null?void 0:o.subscribeOnce("onDestroy",t)}function h(t){var o;(o=s.toValue(r))==null?void 0:o.destroy();r.value=s.shallowRef(e.MenuManager.create(v(t)));s.toValue(r).show()}function f(){var t;(t=s.toValue(r))==null?void 0:t.close()}function g(t){var e,n;const{clientX:a=0,clientY:r=0}=t;const{left:b,top:p}=(e=(n=s.toValue(o))==null?void 0:n.getBoundingClientRect())!=null?e:{top:0,left:0};l.value.top=(r-p)/s.toValue(c);l.value.left=(a-b)/s.toValue(c);h(d);m((()=>{u.value=false}));u.value=true;i.value=true}function B(){u.value=false;i.value=false;f()}return{isOpen:u,showContextMenu:g,closeContextMenu:B,setOptions:b}}function Qe(t,e){const{isDisabledBlockDiagram:o,newConnection:n,portsRectMap:i,blockDiagramTop:l,blockDiagramLeft:r,zoom:c,transformX:u,transformY:d,addConnection:b}=We();const p=s.ref(false);function v(l){var r,c;l.stopPropagation();if(s.toValue(o)){return}p.value=true;const u=(r=s.toValue(i))==null?void 0:(c=r[s.toValue(t).id])==null?void 0:c[s.toValue(e).id];const d={x:u.x+u.width/2,y:u.y+u.height/2};n.value={sourceBlockId:s.toValue(t).id,sourcePortId:s.toValue(e).id,targetBlockId:null,targetPortId:null,start:d,end:d};a.Event.bind(document,"mousemove",m);a.Event.bind(document,"mouseup",h)}function m(t){if(!s.toValue(n)||s.toValue(o)){return}const e=t.clientX/s.toValue(c);const a=t.clientY/s.toValue(c);n.value.end={x:e+s.toValue(u)-s.toValue(r)/s.toValue(c),y:a+s.toValue(d)-s.toValue(l)/s.toValue(c)}}function h(t){if(s.toValue(n)===null||s.toValue(o)){return}const{sourceBlockId:e=null,sourcePortId:i=null,targetBlockId:l=null,targetPortId:r=null}=s.toValue(n);const c=e===l&&i===r;const u=e!==null&&i!==null;const d=l!==null&&r!==null;if(!c&&u&&d){b({sourceBlockId:e,sourcePortId:i,targetBlockId:l,targetPortId:r})}n.value=null;p.value=false;a.Event.unbind(document,"mousemove",m);a.Event.unbind(document,"mouseup",h)}function f(){if(s.toValue(o)){return}if(s.toValue(n)!==null){n.value.targetBlockId=s.toValue(t).id;n.value.targetPortId=s.toValue(e).id}}function g(){if(s.toValue(o)){return}if(s.toValue(n)!==null){n.value.targetBlockId=null;n.value.targetPortId=null}}return{isSourcePort:p,onMouseDownPort:v,onMouseOverPort:f,onMouseLeavePort:g}}function Je(t){const{highlitedBlockIds:e,isDisabledBlockDiagram:o,movingBlock:n,updatePortPosition:a}=We();const i=s.computed((()=>e.value.includes(s.toValue(t).id)));const l=s.computed((()=>s.toValue(o)));const r=s.computed((()=>{var e;if(((e=s.toValue(n))==null?void 0:e.id)===s.toValue(t).id){return{zIndex:B.MOVABLE}}if(s.toValue(i)){return{zIndex:B.HIGHLITED}}return{zIndex:B.STANDING}}));function c(){[...s.toValue(t).ports.input,...s.toValue(t).ports.output].forEach((e=>{a(s.toValue(t).id,e.id)}))}return{isHiglitedBlock:i,isDisabled:l,blockZindex:r,updatePortsPositions:c}}function to(t,e){const o=s.ref(false);const{isDisabledBlockDiagram:n,zoom:i,updateBlock:l,hooks:r,setMovingBlock:c,updateMovingBlockPosition:u,resetMovingBlock:d,setPortOffsetByBlockId:b}=We();let p=0;let v=0;const m=s.ref(0);const h=s.ref(0);const f=s.ref(s.toValue(e).position.x);const g=s.ref(s.toValue(e).position.y);s.watchEffect((()=>{f.value=s.toValue(e).position.x;g.value=s.toValue(e).position.y}));const B=s.computed((()=>({top:`${g.value}px`,left:`${f.value}px`})));s.onMounted((()=>{a.Event.bind(s.toValue(t),"mousedown",y)}));s.onBeforeUnmount((()=>{a.Event.unbind(s.toValue(t),"mousedown",y)}));const y=t=>{if(t.button!==0||s.toValue(n)){return}t.stopPropagation();c(s.toValue(e));r.startDragBlock.trigger(e);p=s.toValue(e).position.x;v=s.toValue(e).position.y;m.value=Math.round(t.clientX-s.toValue(e).position.x*s.toValue(i));h.value=Math.round(t.clientY-s.toValue(e).position.y*s.toValue(i));o.value=true;a.Event.bind(document,"mousemove",P);a.Event.bind(document,"mouseup",k)};const P=t=>{if(!s.toValue(o)||s.toValue(n)){return}t.stopPropagation();r.moveDragBlock.trigger(e);f.value=Math.round((t.clientX-s.toValue(m))/s.toValue(i));g.value=Math.round((t.clientY-s.toValue(h))/s.toValue(i));u(f.value,g.value);b(s.toValue(e).id,{x:p-f.value,y:v-g.value});p=f.value;v=g.value};const k=t=>{t.stopPropagation();if(!s.toValue(o)||s.toValue(n)){return}const c=Math.round((t.clientX-s.toValue(m))/s.toValue(i));const u=Math.round((t.clientY-s.toValue(h))/s.toValue(i));const f={...s.toValue(e),position:{...s.toValue(e).position,x:c,y:u}};b(s.toValue(e).id,{x:p-c,y:v-u});l(f);if(s.toValue(e).position.x!==f.position.x||s.toValue(e).position.y!==f.position.y){r.endDragBlock.trigger(f)}d();m.value=0;h.value=0;o.value=false;a.Event.unbind(document,"mousemove",P);a.Event.unbind(document,"mouseup",k)};return{isDragged:o,blockPositionStyle:B}}function eo(t){const{blocks:e,connections:o,historyCurrentState:n,hooks:a}=We();const i={[u.CHANGED_BLOCKS]:l,[u.CHANGED_CONNECTIONS]:r};Object.entries(i).forEach((([t,e])=>{a[t].on(e)}));function l(e){R(s.toValue(n.value.blocks),e,(e=>{n.value.blocks=e;t("update:blocks",e)}))}function r(e){R(s.toValue(n.value.connections),e,(e=>{n.value.connections=e;t("update:connections",e)}))}function c(){Object.entries(i).forEach((([t,e])=>{a[t].off(e)}))}return{dispose:c}}function oo(t){const{blocks:e,connections:o,historyCurrentState:n,zoom:a,isDisabled:i}=We();const l=s.effectScope(true);l.run((()=>{s.watch([()=>t.blocks,()=>t.blocks.length],(([t])=>{if(t&&Array.isArray(t)){n.value.blocks=s.markRaw(JSON.parse(JSON.stringify(t)));e.value=t}}),{immediate:true,deep:true});s.watch([()=>t.connections,()=>t.connections.length],(([t])=>{n.value.connections=s.markRaw(JSON.parse(JSON.stringify(t)));o.value=[...t]}),{immediate:true,deep:true});s.watch((()=>t.zoom),(t=>{a.value=t}),{immediate:true});s.watch((()=>t.minZoom),(t=>{a.value=t}),{immediate:true});s.watch((()=>t.maxZoom),(t=>{a.value=t}),{immediate:true});s.watch((()=>t.disabled),(t=>{i.value=t}),{immediate:true})}));function r(){l.stop()}return{dispose:r}}function no(...t){const{hooks:e}=We();const o=[...t].reduce(((t,e)=>{const o={...t};Object.entries(e).forEach((([e,n])=>{if(e in t){o[e].push(...a.Type.isFunction(n)?[n]:n)}else{o[e]=[...a.Type.isFunction(n)?[n]:n]}}));return o}),{});Object.entries(o).forEach((([t,o])=>{o.forEach((o=>{var n;e==null?void 0:(n=e[t])==null?void 0:n.on(o)}))}));function n(){Object.entries(o).forEach((([t,o])=>{o.forEach((o=>{var n;e==null?void 0:(n=e[t])==null?void 0:n.off(o)}))}))}return{dispose:n}}const ao={searchCallback:()=>false,delay:300};function so(t){const{blocks:e}=We();const o={...ao,...t};const n=s.ref("");const i=s.ref([]);function l(t){n.value=t;i.value=[];if(s.toValue(n).trim()===""){return}e.value.forEach((t=>{if(o.searchCallback(t,s.toValue(n))){i.value.push(t)}}))}function r(){n.value="";i.value=[]}return{seachText:n,foundBlocks:i,onSearchBlocks:a.debounce(l,o.delay),onClearSearch:r}}function io(){const{zoom:t,blocks:e,canvasWidth:o,canvasHeight:n,blockDiagramTop:a,blockDiagramLeft:i,canvasInstance:l}=We();function r(t){var e;(e=s.toValue(l))==null?void 0:e.zoomIn(t)}function c(t){var e;(e=s.toValue(l))==null?void 0:e.zoomOut(t)}function u(t){var e;(e=s.toValue(l))==null?void 0:e.setCamera(t)}function d(l){const r=s.toValue(e).find((t=>t.id===l));if(!r){return}const{x:c,y:d}=r.position;const{width:b,height:p}=r.dimensions;const v=c+b/2;const m=d+p/2;u({x:v-s.toValue(o)/2/s.toValue(t)-s.toValue(i)/s.toValue(t),y:m-s.toValue(n)/2/s.toValue(t)-s.toValue(a)/s.toValue(t)})}return{zoomIn:r,zoomOut:c,setCamera:u,goToBlockById:d}}function lo(){const{highlitedBlockIds:t}=We();function e(e){s.toValue(t).push(...e)}function o(e){s.toValue(t).push(e)}function n(e){const o=t.value.indexOf(e);if(o>-1){t.value.splice(o,1)}}function a(){t.value=[]}return{highlitedBlockIds:t,set:e,add:o,remove:n,clear:a}}function ro(){var t,e,o,n;const a=(t=s.getCurrentInstance())==null?void 0:t.appContext.app;const i=(e=a==null?void 0:(o=a.config)==null?void 0:(n=o.globalProperties)==null?void 0:n.$bitrix)!=null?e:null;return{getMessage:(t,e)=>{var o;return i==null?void 0:(o=i.Loc)==null?void 0:o.getMessage(t,e)}}}function co(t){const{portRef:e,block:o,port:n,position:a=v.LEFT}=t;const{portsElMap:i,portsRectMap:l,zoom:r,transformX:c,transformY:u,blockDiagramTop:d,blockDiagramLeft:b,isDisabledBlockDiagram:p}=We();const m=s.computed((()=>s.toValue(p)));function h(t,e,o){if(!s.toValue(i).has(t)){s.toValue(i).set(t,new Map)}s.toValue(i).get(t).set(e,s.toValue(o))}function f(t,e){if(!s.toValue(i).has(t)){return}s.toValue(i).get(t).delete(e)}function g(t,e,o){var n,i;if(!(t in s.toValue(l))){s.toValue(l)[t]={}}const{x:p=0,y:v=0,width:m=0,height:h=0}=(n=(i=s.toValue(o))==null?void 0:i.getBoundingClientRect())!=null?n:{};s.toValue(l)[t][e]={x:p/s.toValue(r)+s.toValue(c)-s.toValue(b)/s.toValue(r),y:v/s.toValue(r)+s.toValue(u)-s.toValue(d)/s.toValue(r),width:m,height:h,position:a}}function B(t,e){if(!(t in s.toValue(l))){return}const o=s.toValue(l)[t];if(Object.keys(o).length===1){delete s.toValue(l)[t]}else{delete s.toValue(o)[e]}}function y(){h(s.toValue(o).id,s.toValue(n).id,e);g(s.toValue(o).id,s.toValue(n).id,e)}function P(){f(s.toValue(o).id,s.toValue(n).id);B(s.toValue(o).id,s.toValue(n).id)}return{isDisabled:m,onMountedPort:y,onUnmountedPort:P}}function uo(t){const{portsRectMap:e,isDisabledBlockDiagram:o}=We();const{connection:n,viewType:a}=t;const i=s.computed((()=>{const{sourceBlockId:t,sourcePortId:o,targetBlockId:a,targetPortId:i}=s.toValue(n);const l=t in s.toValue(e);const r=l&&o in s.toValue(e)[t];const c=a in s.toValue(e);const u=c&&i in s.toValue(e)[a];if(!l||!r||!c||!u){return null}const{x:d,y:b,width:p,height:v,position:m}=s.toValue(e)[t][o];const{x:h,y:f,width:g,height:B,position:y}=s.toValue(e)[a][i];return{sourcePort:{x:d+p/2,y:b+v/2,position:m},targetPort:{x:h+g/2,y:f+B/2,position:y}}}));const l=s.computed((()=>{if(s.toValue(i)===null){return{path:"",center:{x:0,y:0}}}if(s.toValue(a)===m.BEZIER){return V(s.toValue(i).sourcePort,s.toValue(i).targetPort)}return w({sourceX:s.toValue(i).sourcePort.x,sourceY:s.toValue(i).sourcePort.y,sourcePosition:s.toValue(i).sourcePort.position,targetX:s.toValue(i).targetPort.x,targetY:s.toValue(i).targetPort.y,targetPosition:s.toValue(i).targetPort.position,borderRadius:10,offset:30})}));const r=s.computed((()=>s.toValue(o)));return{connectionPortsPosition:i,connectionPathInfo:l,isDisabled:r}}function bo(t){const{blockDiagramRef:e}=t;const{blockDiagramRef:o,blockDiagramTop:n,blockDiagramLeft:a}=We();let i=null;function l(t){t.forEach((t=>{const{top:e,left:o}=t.boundingClientRect;n.value=e;a.value=o}))}function r(){o.value=s.toValue(e);const{left:t,top:r}=s.toValue(e).getBoundingClientRect();n.value=r;a.value=t;i=new IntersectionObserver(l);i.observe(s.toValue(o))}function c(){i.unobserve(s.toValue(o))}return{onMountedAppElements:r,onUnmountedAppElements:c}}function po(t){const{newConnection:e}=We();const{viewType:o}=t;const n=s.computed((()=>s.toValue(e)!==null));const a=s.computed((()=>{if(!s.toValue(n)){return{path:"",center:{x:0,y:0}}}if(s.toValue(o)===m.BEZIER){return V(s.toValue(e).start,s.toValue(e).end)}return L(s.toValue(e).start,s.toValue(e).end)}));return{hasNewConnection:n,newConnectionPathInfo:a}}function vo(){const{zoom:t,isPauseAnimation:e,isStopAnimation:o,animationQueue:n,currentAnimationItem:a,addConnection:i,deleteConnectionById:l,addBlock:r,deleteBlockById:c}=We();function u(t){switch(t.type){case f.BLOCK:{r(t.item);break}case f.CONNECTION:{i(t.item);break}case f.REMOVE_BLOCK:{c(t.item.id);break}case f.REMOVE_CONNECTION:{l(t.item.id);break}default:break}}function*d(t){for(const n of t){if(s.toValue(e)){yield}if(s.toValue(o)){break}a.value=n;if(n.type&&n.item){u(n);yield n}}m()}function b(e){const{items:a=[]}=e!=null?e:{};t.value=1;o.value=false;n.value=d(a);if(a.length>0){setTimeout((()=>v()),100)}else{m()}}function p(){e.value=true}function v(){var t;e.value=false;(t=n.value)==null?void 0:t.next()}function m(){o.value=true;e.value=false;a.value=null;n.value=null}return{start:b,pause:p,play:v,stop:m}}const mo={grid:{options:{size:64,gridColor:"#A1B8D9",backgroundColor:"#ECF0F2",zoomStep:4,zoomSteps:[{zoom:1.1,size:64,zoomStep:4},{zoom:1,size:64,zoomStep:4},{zoom:.99,size:64,zoomStep:4},{zoom:.5,size:64*5,zoomStep:.5},{zoom:.25,size:64*25,zoomStep:.25},{zoom:.125,size:64*125,zoomStep:.125}]},instance:Ae}};function ho(t){const{canvasRef:e,transformLayoutRef:o,canvasStyle:n,zoomSensitivity:i,zoomSensitivityMouse:l}=t;const{isDisabledBlockDiagram:r,transformX:c,transformY:u,zoom:d,minZoom:b,maxZoom:p,canvasRef:v,transformLayoutRef:m,canvasWidth:h,canvasHeight:f,canvasInstance:g}=We();const B=s.ref(false);const y=s.ref(false);const P=s.ref(false);let k=null;function L(t){if(t&&t.style in mo){return{instance:mo[t.style].instance,options:{...mo[t.style].options,...t}}}return null}function V(){v.value=e;m.value=o;g.value=s.markRaw(new ne({canvas:s.toValue(e),canvasStyle:L(n),minZoom:s.toValue(b),maxZoom:s.toValue(p)}));s.toValue(g).camera.setChangeTransformCallback((t=>{c.value=t.x;u.value=t.y;d.value=t.zoom;h.value=t.width;f.value=t.height}));E()}function H(){var t;(t=s.toValue(g))==null?void 0:t.destroy();cancelAnimationFrame(k)}function F(t){var e;if(s.toValue(r)){return}B.value=true;(e=s.toValue(g))==null?void 0:e.setCameraPositionByMouseDown(t)}function x(t){var e;if(!s.toValue(B)||s.toValue(r)){return}if(t.buttons!==1){B.value=false;y.value=false;return}y.value=true;(e=s.toValue(g))==null?void 0:e.setCameraPositionByMouseMove(t)}function C(){B.value=false;y.value=false}function S(t){t.preventDefault();if(s.toValue(r)){return}const e=t.wheelDeltaY?t.wheelDeltaY===-3*t.deltaY:t.deltaMode===0;if(t.ctrlKey){var o;const n=e?-t.deltaY*s.toValue(i):-Math.sign(t.deltaY)*s.toValue(l);P.value=true;(o=s.toValue(g))==null?void 0:o.setCameraZoomByWheel(t,n);setTimeout((()=>{P.value=false}),200)}else{var n;(n=s.toValue(g))==null?void 0:n.setCameraPositionByWheel(t)}}function E(){if(g){var t;(t=s.toValue(g))==null?void 0:t.render();const e=s.toValue(g).viewMatrix;a.Dom.style(s.toValue(m),"transform",`\n\t\t\t\t\tmatrix(\n\t\t\t\t\t\t${e[0]}, 0, 0, ${e[4]}, ${e[6]}, ${e[7]}\n\t\t\t\t\t)\n\t\t\t\t`)}k=requestAnimationFrame(E)}return{isDragging:y,onMounted:V,onUnmounted:H,onMouseDown:F,onMouseMove:x,onMouseUp:C,onWheel:S}}function fo(){const{zoom:t,blockDiagramTop:e,blockDiagramLeft:o,transformX:n,transformY:a,addBlock:i,hooks:l}=We();function r(r){r.preventDefault();const c=r.dataTransfer.getData("text/plain");const u=JSON.parse(c);const{width:d,height:b}=u.dimensions;u.position.x=(r.clientX-d*s.toValue(t)/2)/s.toValue(t);u.position.y=(r.clientY-b*s.toValue(t)/2)/s.toValue(t);u.position.x+=s.toValue(n);u.position.y+=s.toValue(a);u.position.x-=s.toValue(o)/s.toValue(t);u.position.y-=s.toValue(e)/s.toValue(t);i(u);l.dropNewBlock.trigger(u)}function c(t,e){t.dataTransfer.setData("text/plain",JSON.stringify(e))}return{setBlockData:c,onDrop:r}}function go(t){const{cursorType:e,resizingBlock:o,blockDiagramTop:n,blockDiagramLeft:i,transformX:l,transformY:r,zoom:c,updateBlock:u}=We();const{block:d,minWidth:b,minHeight:p,leftSideRef:v,topSideRef:m,rightSideRef:h,bottomSideRef:f,leftTopCornerRef:B,rightTopCornerRef:y,rightBottomCornerRef:P,leftBottomCornerRef:k}=t;const L=s.ref(false);let V=0;let H=0;let F=0;let x=0;const C=s.computed((()=>{if(s.toValue(L)){return{width:`${s.toValue(o).dimensions.width}px`,height:`${s.toValue(o).dimensions.height}px`,cursor:s.toValue(e)}}return{width:`${s.toValue(d).dimensions.width}px`,height:`${s.toValue(d).dimensions.height}px`,cursor:s.toValue(e)}}));function S(){u({...s.toValue(d),position:{x:s.toValue(o).position.x,y:s.toValue(o).position.y},dimensions:{width:s.toValue(o).dimensions.width,height:s.toValue(o).dimensions.height}})}function E(){a.Event.bind(s.toValue(h),"mousedown",N);a.Event.bind(s.toValue(f),"mousedown",A);a.Event.bind(s.toValue(v),"mousedown",G);a.Event.bind(s.toValue(m),"mousedown",Y);a.Event.bind(s.toValue(y),"mousedown",J);a.Event.bind(s.toValue(P),"mousedown",W);a.Event.bind(s.toValue(B),"mousedown",st);a.Event.bind(s.toValue(k),"mousedown",ot)}function w(){a.Event.unbind(s.toValue(h),"mousedown",N);a.Event.unbind(s.toValue(f),"mousedown",A);a.Event.unbind(s.toValue(v),"mousedown",G);a.Event.unbind(s.toValue(m),"mousedown",Y);a.Event.unbind(s.toValue(y),"mousedown",J);a.Event.unbind(s.toValue(P),"mousedown",W);a.Event.unbind(s.toValue(B),"mousedown",st);a.Event.unbind(s.toValue(k),"mousedown",ot)}function M(t,n){t.stopPropagation();e.value=n;o.value={...s.toValue(d)};V=s.toValue(d).position.x;H=s.toValue(d).position.y;F=s.toValue(d).dimensions.width;x=s.toValue(d).dimensions.height;L.value=true}function _(t){t.stopPropagation();e.value="default";S();L.value=false;o.value=null}function I(t){let e=t.clientY/s.toValue(c);e+=s.toValue(r);e-=s.toValue(n)/s.toValue(c);let a=t.clientY/s.toValue(c);a+=s.toValue(r);a-=s.toValue(n)/s.toValue(c);a-=H+x;a=Math.abs(a);const i=H+x-s.toValue(p);o.value.position.y=a<s.toValue(p)||e>=i?i:e;o.value.dimensions.height=a<s.toValue(p)||e>=i?s.toValue(p):a}function O(t){let e=t.clientX/s.toValue(c);e+=s.toValue(l);e-=s.toValue(i)/s.toValue(c);let n=V;n-=t.clientX/s.toValue(c);n-=s.toValue(l);n-=s.toValue(i)/s.toValue(c);n=Math.abs(n);o.value.dimensions.width=n<s.toValue(b)||e<=V?s.toValue(b):n}function T(t){let e=t.clientY/s.toValue(c);e+=s.toValue(r);e-=s.toValue(n)/s.toValue(c);let a=t.clientY/s.toValue(c);a-=H;a+=s.toValue(r);a-=s.toValue(n)/s.toValue(c);a=Math.abs(a);o.value.dimensions.height=a<s.toValue(p)||e<=H?s.toValue(p):a}function D(t){let e=t.clientX/s.toValue(c);e+=s.toValue(l);e-=s.toValue(i)/s.toValue(c);let n=t.clientX/s.toValue(c);n+=s.toValue(l);n-=s.toValue(i)/s.toValue(c);n-=V+F;n=Math.abs(n);const a=V+F-s.toValue(b);o.value.position.x=n<s.toValue(b)||e>=a?a:e;o.value.dimensions.width=n<s.toValue(b)||e>=a?s.toValue(b):n}function N(t){M(t,g.EW_RESIZE);a.Event.bind(document,"mousemove",R);a.Event.bind(document,"mouseup",z)}function R(t){t.stopPropagation();if(!s.toValue(L)){return}O(t)}function z(t){_(t);a.Event.unbind(document,"mousemove",R);a.Event.unbind(document,"mouseup",z)}function A(t){M(t,g.NS_RESIZE);a.Event.bind(document,"mousemove",j);a.Event.bind(document,"mouseup",K)}function j(t){t.stopPropagation();if(!s.toValue(L)){return}T(t)}function K(t){_(t);a.Event.unbind(document,"mousemove",j);a.Event.unbind(document,"mouseup",K)}function G(t){M(t,g.EW_RESIZE);a.Event.bind(document,"mousemove",$);a.Event.bind(document,"mouseup",X)}function $(t){t.stopPropagation();if(!s.toValue(L)){return}D(t)}function X(t){_(t);a.Event.unbind(document,"mousemove",$);a.Event.unbind(document,"mouseup",X)}function Y(t){M(t,g.NS_RESIZE);a.Event.bind(document,"mousemove",Z);a.Event.bind(document,"mouseup",U)}function Z(t){t.stopPropagation();if(!s.toValue(L)){return}I(t)}function U(t){_(t);a.Event.unbind(document,"mousemove",Z);a.Event.unbind(document,"mouseup",U)}function W(t){M(t,g.NWSE_RESIZE);a.Event.bind(document,"mousemove",q);a.Event.bind(document,"mouseup",Q)}function q(t){t.stopPropagation();if(!s.toValue(L)){return}O(t);T(t)}function Q(t){_(t);a.Event.unbind(document,"mousemove",q);a.Event.unbind(document,"mouseup",Q)}function J(t){M(t,g.NESW_RESIZE);a.Event.bind(document,"mousemove",tt);a.Event.bind(document,"mouseup",et)}function tt(t){t.stopPropagation();if(!s.toValue(L)){return}I(t);O(t)}function et(t){_(t);a.Event.unbind(document,"mousemove",tt);a.Event.unbind(document,"mouseup",et)}function ot(t){M(t,g.NESW_RESIZE);a.Event.bind(document,"mousemove",nt);a.Event.bind(document,"mouseup",at)}function nt(t){t.stopPropagation();if(!s.toValue(L)){return}D(t);T(t)}function at(t){_(t);a.Event.unbind(document,"mousemove",nt);a.Event.unbind(document,"mouseup",at)}function st(t){M(t,g.NWSE_RESIZE);a.Event.bind(document,"mousemove",it);a.Event.bind(document,"mouseup",lt)}function it(t){t.stopPropagation();if(!s.toValue(L)){return}D(t);I(t)}function lt(t){_(t);a.Event.unbind(document,"mousemove",it);a.Event.unbind(document,"mouseup",lt)}return{isResize:L,sizeBlockStyle:C,onMounted:E,onUnmounted:w}}const Bo={base:"ui-block-diagram-canvas-transform",dragging:"--dragging"};const yo={name:"canvas-transform",props:{canvasStyle:{type:Object,required:true},zoomSensitivity:{type:Number,default:.01},zoomSensitivityMouse:{type:Number,default:.04}},setup(t){const{isDragging:e,onMounted:o,onUmounted:n,onMouseDown:a,onMouseMove:i,onMouseUp:l,onWheel:r}=ho({canvasRef:s.useTemplateRef("canvasLayout"),transformLayoutRef:s.useTemplateRef("transformLayout"),canvasStyle:t.canvasStyle,zoomSensitivity:t.zoomSensitivity,zoomSensitivityMouse:t.zoomSensitivityMouse});const c=s.computed((()=>({[Bo.base]:true,[Bo.dragging]:s.toValue(e)})));s.onMounted((()=>{o()}));s.onUnmounted((()=>{n()}));return{canvasTransformClassNames:c,onMouseDown:a,onMouseMove:i,onMouseUp:l,onWheel:r}},template:`\n\t\t<div\n\t\t\t:class="canvasTransformClassNames"\n\t\t\t@mousedown="onMouseDown"\n\t\t\t@mousemove="onMouseMove"\n\t\t\t@mouseup="onMouseUp"\n\t\t\t@wheel="onWheel"\n\t\t\t@contextmenu.prevent\n\t\t>\n\t\t\t<canvas\n\t\t\t\tref="canvasLayout"\n\t\t\t\tclass="ui-block-diagram-canvas-transform__canvas"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tref="transformLayout"\n\t\t\t\tclass="ui-block-diagram-canvas-transform__transform"\n\t\t\t>\n\t\t\t\t<slot/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Po={base:"ui-block-diagram-connection__target",active:"--active"};const ko={name:"diagram-connection",props:{connection:{type:Object,required:true},viewType:{type:String,default:m.SMOOTHSTEP,validator(t){return Object.values(m).includes(t)}},barWidth:{type:Number,default:22},barHeight:{type:Number,default:22},contextMenuItems:{type:Array,default:()=>[]},disabled:{type:Boolean,default:false}},setup(t){const{connectionPathInfo:e,isDisabled:o}=uo({connection:t.connection,viewType:t.viewType});const{deleteConnectionById:n}=We();const a=ro();const{isOpen:i,showContextMenu:l}=qe([{id:"deleteConnection",text:a.getMessage("UI_BLOCK_DIAGRAM_DELETE_CONNECTION_CONTEXT_MENU_ITEM"),onclick:()=>{n(t.connection.id)}}]);const r=s.computed((()=>({[Po.base]:true,[Po.active]:s.toValue(i)})));const c=s.computed((()=>{var o;const{x:n=0,y:a=0}=(o=s.toValue(e).center)!=null?o:{};return{x:n-t.barWidth/2,y:a-t.barHeight/2}}));function u(e){if(s.toValue(o)||t.disabled){return}e.preventDefault();l(e)}return{isDisabled:o,connectionPathInfo:e,targetConnectionClasses:r,barPosition:c,onOpenContextMenu:u}},template:`\n\t\t<svg class="ui-block-diagram-connection">\n\t\t\t<g class="ui-block-diagram-connection__group">\n\t\t\t\t<path\n\t\t\t\t\t:d="connectionPathInfo.path"\n\t\t\t\t\t:class="targetConnectionClasses"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('connectionLine', connection.id)"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\t:d="connectionPathInfo.path"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('connectionHoveredLine', connection.id)"\n\t\t\t\t\tclass="ui-block-diagram-connection__hovered"\n\t\t\t\t\tstroke="transparent"\n\t\t\t\t\tfill="transparent"\n\t\t\t\t\t@contextmenu="onOpenContextMenu"\n\t\t\t\t/>\n\t\t\t\t<foreignObject\n\t\t\t\t\t:x="barPosition.x"\n\t\t\t\t\t:y="barPosition.y"\n\t\t\t\t\t:width="barWidth"\n\t\t\t\t\t:height="barHeight"\n\t\t\t\t\tclass="ui-block-diagram-connection__bar"\n\t\t\t\t>\n\t\t\t\t\t<slot :isDisabled="isDisabled || disabled" />\n\t\t\t\t</foreignObject>\n\t\t\t</g>\n\t\t</svg>\n\t`};const Lo={name:"delete-connection-btn",components:{BIcon:n.BIcon},props:{connectionId:{type:String,required:true},disabled:{type:Boolean,default:false}},setup(t){const{deleteConnectionById:e}=We();function o(){if(t.disabled){return}e(t.connectionId)}return{iconSet:n.Outline,onDeleteConnection:o}},template:`\n\t\t<button\n\t\t\tclass="ui-block-diagram-delete-connection-btn"\n\t\t\t:data-test-id="$blockDiagramTestId('connectionDeleteBtn', connectionId)"\n\t\t\t@click="onDeleteConnection"\n\t\t>\n\t\t\t<div class="ui-block-diagram-delete-connection-btn__icon-wrap">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="iconSet.TRASHCAN"\n\t\t\t\t\t:size="14"\n\t\t\t\t\tclass="ui-block-diagram-delete-connection-btn__icon"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</button>\n\t`};const Vo={name:"ContextMenuLayout",setup(){const t=We();const e=s.computed((()=>({top:`${s.toValue(t.positionContextMenu).top}px`,left:`${s.toValue(t.positionContextMenu).left}px`})));return{instance:t,targetContainerStyle:e}},template:`\n\t\t<div\n\t\t\t:ref="instance.contextMenuLayerRef"\n\t\t\tclass="ui-block-diagram-context-menu__layout"\n\t\t>\n\t\t\t<slot/>\n\t\t\t<div\n\t\t\t\t:ref="instance.targetContainerRef"\n\t\t\t\t:style="targetContainerStyle"\n\t\t\t\tclass="ui-block-diagram-context-menu__target-container"\n\t\t\t/>\n\t\t</div>\n\t`};const Ho={name:"blocks-queue-transition",setup(){const{isAnimate:t,currentAnimationItem:e,animationQueue:o,hooks:n}=We();const a=io();const i=Xe();const l=lo();function r(){var t,e;const{done:n=false}=(t=(e=s.toValue(o))==null?void 0:e.next())!=null?t:{};if(n){o.value=null}else{i.makeSnapshot()}}function c(){var t;n.blockTransitionStart.trigger((t=s.toValue(e))==null?void 0:t.item)}function u(){l.clear();l.add(s.toValue(e).item.id);a.goToBlockById(s.toValue(e).item.id)}function d(){var t;n.blockTransitionEnd.trigger((t=s.toValue(e))==null?void 0:t.item);r()}function b(){r()}return{isAnimate:t,onBeforeEnter:c,onEnter:u,onAfterEnter:d,onAfterLeave:b}},template:`\n\t\t<TransitionGroup\n\t\t\tv-if="isAnimate"\n\t\t\tname="ui-block-diagram-blocks-queue-transition"\n\t\t\t@before-enter="onBeforeEnter"\n\t\t\t@enter="onEnter"\n\t\t\t@after-enter="onAfterEnter"\n\t\t\t@after-leave="onAfterLeave"\n\t\t>\n\t\t\t<slot/>\n\t\t</TransitionGroup>\n\t\t<template v-else>\n\t\t\t<slot/>\n\t\t</template>\n\t`};const Fo={name:"grouped-blocks",components:{BlocksQueueTransition:Ho},setup(){const{groupedBlocks:t,blockGroupNames:e}=We();return{blockGroupNames:e,groupedBlocks:t,getGroupBlockSlotName:A}},template:`\n\t\t<BlocksQueueTransition>\n\t\t\t<slot\n\t\t\t\tv-for="group in blockGroupNames"\n\t\t\t\t:key="group"\n\t\t\t\t:name="getGroupBlockSlotName(group)"\n\t\t\t\t:blocks="groupedBlocks[group]"\n\t\t\t/>\n\t\t</BlocksQueueTransition>\n\t`};const xo={name:"new-connection",props:{viewType:{type:String,default:h.BEZIER,validator(t){return Object.values(h).includes(t)}}},setup(t){const{hasNewConnection:e,newConnectionPathInfo:o}=po({viewType:t.viewType});return{hasNewConnection:e,newConnectionPathInfo:o}},template:`\n\t\t<svg\n\t\t\tv-if="hasNewConnection"\n\t\t\tclass="ui-block-diagram-new-connection"\n\t\t>\n\t\t\t<path\n\t\t\t\t:d="newConnectionPathInfo.path"\n\t\t\t\tclass="ui-block-diagram-new-connection__path"\n\t\t\t/>\n\t\t</svg>\n\t`};const Co={name:"connections-queue-transition",setup(){const{isAnimate:t,currentAnimationItem:e,animationQueue:o,updatePortPosition:n,hooks:a}=We();const i=Xe();function l(){var t;const{item:o}=(t=s.toValue(e))!=null?t:{};a.connectionTransitionStart.trigger(o);const{sourceBlockId:i,sourcePortId:l,targetBlockId:r,targetPortId:c}=o;n(i,l);n(r,c)}function r(){var t,e;const{done:n=false}=(t=(e=s.toValue(o))==null?void 0:e.next())!=null?t:{};if(n){o.value=null}else{i.makeSnapshot()}}function c(){var t;a.connectionTransitionEnd.trigger((t=s.toValue(e))==null?void 0:t.item);r()}function u(){r()}return{isAnimate:t,onBeforeEnter:l,onAfterEnter:c,onAfterLeave:u}},template:`\n\t\t<TransitionGroup\n\t\t\tv-if="isAnimate"\n\t\t\tname="ui-block-diagram-connections-queue-transition"\n\t\t\t@before-enter="onBeforeEnter"\n\t\t\t@after-enter="onAfterEnter"\n\t\t\t@after-leave="onAfterLeave"\n\t\t>\n\t\t\t<slot/>\n\t\t</TransitionGroup>\n\t\t<template v-else>\n\t\t\t<slot/>\n\t\t</template>\n\t`};const So={name:"grouped-connections",components:{Connection:ko,NewConnection:xo,ConnectionsQueueTransition:Co},setup(){const{groupedConnections:t,connectionGroupNames:e}=We();return{groupedConnections:t,connectionGroupNames:e,getGroupConnectionSlotName:j}},template:`\n\t\t<ConnectionsQueueTransition>\n\t\t\t<slot\n\t\t\t\tv-for="connection in connectionGroupNames"\n\t\t\t\t:key="connection"\n\t\t\t\t:name="getGroupConnectionSlotName(connection)"\n\t\t\t\t:connections="groupedConnections[connection]"\n\t\t\t/>\n\t\t\t<NewConnection/>\n\t\t</ConnectionsQueueTransition>\n\t`};const Eo={name:"moveable-block",props:{block:{type:Object,required:true},highlighted:{type:Boolean,default:false}},setup(t){const{block:e}=s.toRefs(t);const{blockZindex:o,isHiglitedBlock:n,isDisabled:a}=Je(e);const i=lo();const{isDragged:l,blockPositionStyle:r}=to(s.useTemplateRef("blockEl"),e);s.watch((()=>t.highlighted),(e=>{if(e){i.add(t.block.id)}else{i.remove(t.block.id)}}));const c=s.computed((()=>({...s.toValue(r),...s.toValue(o)})));s.onUnmounted((()=>{i.remove(t.block.id)}));function u(){i.clear();i.add(t.block.id)}return{isHiglitedBlock:n,isDisabled:a,isDragged:l,blockStyle:c,blockZindex:o,blockPositionStyle:r,onMouseDownSelectBlock:u}},template:`\n\t\t<div\n\t\t\tclass="ui-block-diagram-moveable-block"\n\t\t\t:style="blockStyle"\n\t\t\tref="blockEl"\n\t\t\t:data-test-id="$blockDiagramTestId('block', block.id)"\n\t\t\t@mousedown="onMouseDownSelectBlock"\n\t\t>\n\t\t\t<slot\n\t\t\t\t:block="block"\n\t\t\t\t:isHighlighted="isHiglitedBlock"\n\t\t\t\t:isDragged="isDragged"\n\t\t\t\t:isDisabled="isDisabled"\n\t\t\t/>\n\t\t</div>\n\t`};const wo={base:"ui-block-diagram-port",disabled:"--disabled",active:"--active"};const Mo={name:"diagram-port",props:{block:{type:Object,required:true},port:{type:Object,required:true},position:{type:String,required:true,validator(t){return Object.values(v).includes(t)}},disabled:{type:Boolean,default:false}},setup(t){const{isDisabled:e,onMountedPort:o,onUnmountedPort:n}=co({portRef:s.useTemplateRef("port"),block:t.block,port:t.port,position:t.position});const{isSourcePort:a,onMouseDownPort:i,onMouseOverPort:l,onMouseLeavePort:r}=Qe(t.block,t.port);const c=s.computed((()=>({[wo.base]:true,[wo.active]:s.toValue(a),[wo.disabled]:s.toValue(e)})));s.onMounted((()=>{o()}));s.onUnmounted((()=>{n()}));return{portClassNames:c,onMouseDownPort:i,onMouseOverPort:l,onMouseLeavePort:r}},template:`\n\t\t<div\n\t\t\tref="port"\n\t\t\t:class="portClassNames"\n\t\t\t:data-test-id="$blockDiagramTestId('port', port.id)"\n\t\t\t@mousedown="onMouseDownPort"\n\t\t\t@mouseover="onMouseOverPort"\n\t\t\t@mouseleave="onMouseLeavePort"\n\t\t/>\n\t`};const _o={base:"ui-block-diagram-block-content-stub",highlighted:"--highlighted"};const Io={name:"block-content-stub",components:{Port:Mo},props:{block:{type:Object,required:true},highlighted:{type:Boolean,default:false},dragged:{type:Boolean,default:false},disabled:{type:Boolean,default:false}},setup(t){const{deleteBlockById:e}=We();const o=ro();const{showContextMenu:n}=qe([{id:"deleteConnection",text:o.getMessage("UI_BLOCK_DIAGRAM_DELETE_BLOCK_CONTEXT_MENU_ITEM"),onclick:()=>{e(t.block.id)}}]);const a=s.computed((()=>({[_o.base]:true,[_o.highlighted]:t.highlighted})));function i(e){e.preventDefault();if(t.disabled){return}const{clientX:o,clientY:a}=e;n({clientX:o,clientY:a})}return{blockContentClassNames:a,onShowContextMenu:i}},template:`\n\t\t<div\n\t\t\t:class="blockContentClassNames"\n\t\t\t@contextmenu="onShowContextMenu"\n\t\t>\n\t\t\t<div class="ui-block-diagram-block-content-stub__id">\n\t\t\t\t{{ block.id }}\n\t\t\t</div>\n\n\t\t\t<div class="ui-block-diagram-block-content-stub__left-column">\n\t\t\t\t<div\n\t\t\t\t\tv-for="port in block.ports.input"\n\t\t\t\t\t:key="port.id"\n\t\t\t\t\tclass="ui-block-diagram-block-content-stub__port-line"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-block-diagram-block-content-stub__port --left">\n\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t:port="port"\n\t\t\t\t\t\t\t:styled="false"\n\t\t\t\t\t\t\t:portsToShow="null"\n\t\t\t\t\t\t\tposition="left"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="ui-block-diagram-block-content-stub__right-column">\n\t\t\t\t<div\n\t\t\t\t\tv-for="port in block.ports.output"\n\t\t\t\t\t:key="port.id"\n\t\t\t\t\tclass="ui-block-diagram-block-content-stub__port-line"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-block-diagram-block-content-stub__port --right">\n\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t:port="port"\n\t\t\t\t\t\t\t:styled="false"\n\t\t\t\t\t\t\t:portsToShow="null"\n\t\t\t\t\t\t\tposition="right"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Oo="#A1B8D9";const To="#ECF0F2";const Do={base:"ui-block-diagram",ewResize:"--cursor-ew-resize",nsResize:"--cursor-ns-resize",nwSeResize:"--cursor-nwse-resize",neSwResize:"--cursor-nesw-resize",grabbing:"--grabbing"};const No={name:"block-diagram",components:{CanvasTransform:yo,ContextMenuLayout:Vo,GroupedBlocks:Fo,GroupedConnections:So,Connection:ko,DeleteConnectionBtn:Lo,MoveableBlock:Eo,BlockContentStub:Io},props:{blocks:{type:Array,required:true},connections:{type:Array,required:true},canvasStyle:{type:Object,default:()=>({style:"grid",size:64,gridColor:Oo,backgroundColor:To})},zoomSensitivity:{type:Number,default:.01},zoomSensitivityMouse:{type:Number,default:.04},zoom:{type:Number,default:1},minZoom:{type:Number,default:.2},maxZoom:{type:Number,default:4},historyHooks:{type:Array,default:()=>[u.END_DRAG_BLOCK,u.ADD_BLOCK,u.DELETE_BLOCK,u.CREATE_CONNECTION,u.DELETE_CONNECTION]},snapshotHandler:{type:Function,default:null},revertHandler:{type:Function,default:null},disabled:{type:Boolean,default:false}},emits:["update:blocks","update:connections",u.CHANGED_BLOCKS,u.CHANGED_CONNECTIONS,u.START_DRAG_BLOCK,u.MOVE_DRAG_BLOCK,u.END_DRAG_BLOCK,u.ADD_BLOCK,u.UPDATE_BLOCK,u.DELETE_BLOCK,u.CREATE_CONNECTION,u.DELETE_CONNECTION,u.BLOCK_TRANSITION_START,u.BLOCK_TRANSITION_END,u.CONNECTION_TRANSITION_START,u.CONNECTION_TRANSITION_END,u.DROP_NEW_BLOCK],setup(t,{emit:e}){const{blockGroupNames:o,connectionGroupNames:n,cursorType:a}=We(t);const i=bo({blockDiagramRef:s.useTemplateRef("blockDiagram")});const{makeSnapshot:l}=Xe();const{dispose:r}=eo(e);const{dispose:c}=oo(t);const{dispose:d}=no({...Object.entries(u).reduce(((t,[o,n])=>{t[n]=(...t)=>{e(n,...t)};return t}),{})},{...t.historyHooks.reduce(((t,e)=>{t[e]=()=>l();return t}),{})});const{onDrop:b}=fo();const p=s.ref(false);const v=s.computed((()=>({[Do.base]:true,[Do.grabbing]:p.value,[Do.ewResize]:s.toValue(a)===g.EW_RESIZE,[Do.nsResize]:s.toValue(a)===g.NS_RESIZE,[Do.nwSeResize]:s.toValue(a)===g.NWSE_RESIZE,[Do.neSwResize]:s.toValue(a)===g.NESW_RESIZE})));s.onMounted((()=>{i.onMountedAppElements()}));s.onUnmounted((()=>{r();c();d();i.onUnmountedAppElements()}));function m(t){p.value=true}function h(t){p.value=false}function f(t){p.value=false;b(t)}return{blockDiagramClassNames:v,blockGroupNames:o,connectionGroupNames:n,getGroupBlockSlotName:A,getGroupConnectionSlotName:j,onDragDrop:f,onDragEnter:m,onDragLeave:h}},template:`\n\t\t<div\n\t\t\t:class="blockDiagramClassNames"\n\t\t\tref="blockDiagram"\n\t\t\t@dragover.prevent\n\t\t\t@dragenter="onDragEnter"\n\t\t\t@dragleave="onDragLeave"\n\t\t\t@drop="onDragDrop"\n\t\t>\n\t\t\t<CanvasTransform\n\t\t\t\t:canvasStyle="canvasStyle"\n\t\t\t\t:zoomSensitivity="zoomSensitivity"\n\t\t\t\t:zoomSensitivityMouse="zoomSensitivityMouse"\n\t\t\t>\n\t\t\t\t<ContextMenuLayout>\n\t\t\t\t\t<GroupedConnections>\n\t\t\t\t\t\t<template\n\t\t\t\t\t\t\tv-for="groupName in connectionGroupNames"\n\t\t\t\t\t\t\t#[getGroupConnectionSlotName(groupName)]="{ connections }"\n\t\t\t\t\t\t\t:key="groupName"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\tv-for="connection in connections"\n\t\t\t\t\t\t\t\t:name="getGroupConnectionSlotName(groupName)"\n\t\t\t\t\t\t\t\t:key="connection.id"\n\t\t\t\t\t\t\t\t:connection="connection"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Connection\n\t\t\t\t\t\t\t\t\t:connection="connection"\n\t\t\t\t\t\t\t\t\t:key="connection.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #default="{ isDisabled }">\n\t\t\t\t\t\t\t\t\t\t<DeleteConnectionBtn \n\t\t\t\t\t\t\t\t\t\t\t:connectionId="connection.id"\n\t\t\t\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</Connection>\n\t\t\t\t\t\t\t</slot>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #new-connection>\n\t\t\t\t\t\t\t<slot name="new-connection"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</GroupedConnections>\n\t\t\t\t\t<GroupedBlocks>\n\t\t\t\t\t\t<template\n\t\t\t\t\t\t\tv-for="groupName in blockGroupNames"\n\t\t\t\t\t\t\t#[getGroupBlockSlotName(groupName)]="{ blocks }"\n\t\t\t\t\t\t\t:key="groupName"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\tv-for="block in blocks"\n\t\t\t\t\t\t\t\t:name="getGroupBlockSlotName(groupName)"\n\t\t\t\t\t\t\t\t:key="block.id"\n\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<MoveableBlock\n\t\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t\t:key="block.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #default="{ isHighlighted, isDragged, isDisabled }">\n\t\t\t\t\t\t\t\t\t\t<BlockContentStub\n\t\t\t\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t\t\t\t:highlighted="isHighlighted"\n\t\t\t\t\t\t\t\t\t\t\t:dragged="isDragged"\n\t\t\t\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</MoveableBlock>\n\t\t\t\t\t\t\t</slot>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</GroupedBlocks>\n\t\t\t\t</ContextMenuLayout>\n\t\t\t</CanvasTransform>\n\t\t</div>\n\t`};const Ro={name:"icon-button",components:{BIcon:n.BIcon},props:{iconName:{type:String,default:""},size:{type:[Number,String],default:16},color:{type:String,default:"#959CA4"},active:{type:Boolean,default:false},activeColor:{type:String,default:"#4A9DFF"},disabled:{type:Boolean,default:false}},setup(t){const{size:e,active:o,disabled:n}=s.toRefs(t);const a=s.computed((()=>({"ui-block-diagram-icon-button":true,"--disabled":s.toValue(n)})));const i=s.computed((()=>({width:`${s.toValue(e)}px`,height:`${s.toValue(e)}px`})));const l=s.computed((()=>({"ui-block-diagram-icon-button__icon":true,"--active":s.toValue(o)})));return{buttonClassNames:a,buttonStyle:i,iconClassNames:l}},template:`\n\t\t<button\n\t\t\t:class="buttonClassNames"\n\t\t\t:style="buttonStyle"\n\t\t>\n\t\t\t<slot>\n\t\t\t\t<BIcon\n\t\t\t\t\t:class="iconClassNames"\n\t\t\t\t\t:name="iconName"\n\t\t\t\t\t:color="color"\n\t\t\t\t\t:size="size"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t</button>\n\t`};const zo={name:"history-bar",components:{IconButton:Ro},props:{disabled:{type:Boolean,default:false}},setup(t){const{isDisabledBlockDiagram:e}=We();const{hasNext:o,hasPrev:a,next:i,prev:l}=Xe();function r(){if(t.disabled||s.toValue(e)){return}i()}function c(){if(t.disabled||s.toValue(e)){return}l()}return{hasNext:o,hasPrev:a,onNext:r,onPrev:c,Outline:n.Outline}},template:`\n\t\t<div class="ui-block-diagram-histoy-bar">\n\t\t\t<slot>\n\t\t\t\t<IconButton\n\t\t\t\t\tclass="ui-block-diagram-histoy-bar__prev-button"\n\t\t\t\t\t:icon-name="Outline.FORWARD"\n\t\t\t\t\t:size="22"\n\t\t\t\t\t:disabled="!hasPrev"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('historyPrevBtn')"\n\t\t\t\t\t@click="onPrev"\n\t\t\t\t/>\n\t\t\t\t<IconButton\n\t\t\t\t\t:icon-name="Outline.FORWARD"\n\t\t\t\t\t:size="22"\n\t\t\t\t\t:disabled="!hasNext"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('historyNextBtn')"\n\t\t\t\t\t@click="onNext"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t</div>\n\t`};const Ao={in:"in",out:"out"};const jo={name:"zoom-btn",components:{BIcon:n.BIcon},props:{stepZoom:{type:Number,default:.2},typeZoom:{type:String,default:Ao.in,validator(t){return t===Ao.in||t===Ao.out}},disabled:{type:Boolean,default:false}},emits:["zoom-change"],setup(t,{emit:e}){const{isDisabledBlockDiagram:o}=We();const{zoomIn:a,zoomOut:i}=io();const{stepZoom:l,typeZoom:r}=s.toRefs(t);function c(){if(t.disabled||s.toValue(o)){return}if(s.toValue(r)===Ao.in){a(s.toValue(l))}else if(s.toValue(r)===Ao.out){i(s.toValue(l))}}return{iconSet:n.Outline,zoomTypes:Ao,onZoom:c}},template:`\n\t\t<button\n\t\t\tclass="ui-block-diagram-control-btn__btn"\n\t\t\t@click="onZoom"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tv-if="typeZoom === zoomTypes.in"\n\t\t\t\t:name="iconSet.PLUS_M"\n\t\t\t\t:size="22"\n\t\t\t\tclass="ui-block-diagram-control-btn__icon"\n\t\t\t/>\n\t\t\t<BIcon\n\t\t\t\tv-else\n\t\t\t\t:name="iconSet.MINUS_M"\n\t\t\t\t:size="22"\n\t\t\t\tclass="ui-block-diagram-control-btn__icon"\n\t\t\t/>\n\t\t</button>\n\t`};const Ko={name:"zoom-percent",setup(t){const{zoom:e}=We();const o=s.computed((()=>{var t;return(((t=s.toValue(e))!=null?t:0)*100).toFixed(0)}));return{percent:o}},template:`\n\t\t<span class="ui-block-diagram-percent">{{ percent }}</span>\n\t`};const Go=2;const $o="firstCanvasBlock";const Xo="lastCanvasBlock";const Yo={name:"canvas-map",props:{mapWidth:{type:Number,default:310},mapHeight:{type:Number,default:183}},setup(t,{emit:e}){const{blocks:o,canvasWidth:n,canvasHeight:i,transformX:l,transformY:r,zoom:c}=We();const{setCamera:u}=io();const{mapWidth:d,mapHeight:b}=s.toRefs(t);const p=s.useTemplateRef("map");let v=0;let m=0;const h=s.ref(false);const f=s.computed((()=>({width:`${s.toValue(d)}px`,height:`${s.toValue(b)}px`})));const g=s.computed((()=>{if(s.toValue(o).length===1){return[{id:$o,position:{x:0,y:0},dimensions:{width:0,height:0}},{...s.toValue(o)[0]},{id:Xo,position:{x:t.mapWidth,y:t.mapHeight},dimensions:{width:0,height:0}}]}return s.toValue(o)}));const B=s.computed((()=>s.toValue(g).reduce(((t,e)=>Math.min(t,e.position.x)),Infinity)));const y=s.computed((()=>s.toValue(g).reduce(((t,e)=>Math.min(t,e.position.y)),Infinity)));const P=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(o))){return t.mapWidth}const e=s.toValue(g).reduce(((t,e)=>Math.max(t,e.position.x+e.dimensions.width)),-Infinity);return e-s.toValue(B)}));const k=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(o))){return t.mapHeight}const e=s.toValue(g).reduce(((t,e)=>Math.max(t,e.position.y+e.dimensions.height)),-Infinity);return e-s.toValue(y)}));const L=s.computed((()=>Math.min(s.toValue(d)/s.toValue(P),s.toValue(b)/s.toValue(k))));const V=s.computed((()=>s.toValue(n)*s.toValue(L)/s.toValue(c)));const H=s.computed((()=>s.toValue(i)*s.toValue(L)/s.toValue(c)));const F=s.computed((()=>{let t=s.toValue(V);let e=s.toValue(H);let o=(s.toValue(l)-s.toValue(B))*s.toValue(L);let n=(s.toValue(r)-s.toValue(y))*s.toValue(L);[o,t]=t>s.toValue(d)?[1,s.toValue(d)-Go]:[o,t];[n,e]=e>s.toValue(b)?[1,s.toValue(b)-Go]:[n,e];o=o<0?1:o;n=n<0?1:n;o=o+t>s.toValue(d)?s.toValue(d)-t-Go:o;n=n+e>s.toValue(b)?s.toValue(b)-e-Go:n;return{x:o,y:n,width:t,height:e}}));function x(t){const e=t.clientX-v;const o=t.clientY-m;const a=e/s.toValue(L)+s.toValue(B);const l=o/s.toValue(L)+s.toValue(y);u({x:a-s.toValue(n)/s.toValue(c)/2,y:l-s.toValue(i)/s.toValue(c)/2,zoom:s.toValue(c),viewportX:0,viewportY:0})}function C(t){h.value=true;if(s.toValue(p)){const{left:t,top:e}=s.toValue(p).getBoundingClientRect();[v,m]=[t,e]}x(t)}function S(t){if(!s.toValue(h)){return}x(t)}function E(t){h.value=false;x(t)}return{preparedBlock:g,canvasMapStyle:f,startDiagramX:B,startDiagramY:y,scaleMap:L,cursorRectPosition:F,onMapMouseDown:C,onMapMouseMove:S,onMapMouseUp:E}},template:`\n\t\t<div :style="canvasMapStyle">\n\t\t\t<svg\n\t\t\t\t:width="mapWidth"\n\t\t\t\t:height="mapHeight"\n\t\t\t\tref="map"\n\t\t\t\tclass="ui-block-diagram-canvas-map"\n\t\t\t\t@mousedown="onMapMouseDown"\n\t\t\t\t@mousemove="onMapMouseMove"\n\t\t\t\t@mouseup="onMapMouseUp"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tv-for="block in preparedBlock"\n\t\t\t\t\t:key="block.id"\n\t\t\t\t\t:x="(block.position.x - startDiagramX) * scaleMap"\n\t\t\t\t\t:y="(block.position.y - startDiagramY) * scaleMap"\n\t\t\t\t\t:width="block.dimensions.width * scaleMap"\n\t\t\t\t\t:height="block.dimensions.height * scaleMap"\n\t\t\t\t\t:rx="2"\n\t\t\t\t\tclass="ui-block-diagram-canvas-map__block"\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\t:x="cursorRectPosition.x"\n\t\t\t\t\t:y="cursorRectPosition.y"\n\t\t\t\t\t:width="cursorRectPosition.width"\n\t\t\t\t\t:height="cursorRectPosition.height"\n\t\t\t\t\t:rx="3"\n\t\t\t\t\tclass="ui-block-diagram-canvas-map__cursor"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</div>\n\t`};const Zo={name:"canvas-map-btn",props:{width:{type:Number,default:75},height:{type:Number,default:32}},setup(t){const{blocks:e}=We();const o=s.computed((()=>({width:`${t.width}px`,height:`${t.height}px`})));const n=s.computed((()=>s.toValue(e).reduce(((t,e)=>Math.min(t,e.position.x)),Infinity)));const i=s.computed((()=>s.toValue(e).reduce(((t,e)=>Math.min(t,e.position.y)),Infinity)));const l=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(e))){return t.width}const o=s.toValue(e).reduce(((t,e)=>Math.max(t,e.position.x+e.dimensions.width)),-Infinity);return o-s.toValue(n)}));const r=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(e))){return t.height}const o=s.toValue(e).reduce(((t,e)=>Math.max(t,e.position.y+e.dimensions.height)),-Infinity);return o-s.toValue(i)}));const c=s.computed((()=>Math.min(t.width/s.toValue(l),t.height/s.toValue(r))));return{blocks:e,btnStyle:o,startDiagramX:n,startDiagramY:i,scaleButton:c}},template:`\n\t\t<button\n\t\t\t:style="btnStyle"\n\t\t\tclass="ui-block-diagram-canvas-map-btn"\n\t\t>\n\t\t\t<svg\n\t\t\t\t:width="width"\n\t\t\t\t:height="height"\n\t\t\t\tclass="ui-block-diagram-canvas-map-btn__icon"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tv-for="block in blocks"\n\t\t\t\t\t:key="block.id"\n\t\t\t\t\t:x="(block.position.x - startDiagramX) * scaleButton"\n\t\t\t\t\t:y="(block.position.y - startDiagramY) * scaleButton"\n\t\t\t\t\t:width="block.dimensions.width * scaleButton"\n\t\t\t\t\t:height="block.dimensions.height * scaleButton"\n\t\t\t\t\t:rx="1"\n\t\t\t\t\tclass="ui-block-diagram-canvas-map-btn__rect"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</button>\n\t`};const Uo={left:"left",right:"right"};const Wo={top:"top",bottom:"bottom"};const qo={base:"ui-block-diagram-canvas-zoom-bar__map",top:"--top",bottom:"--bottom",left:"--left",right:"--right"};const Qo="top right";const Jo={name:"zoom-bar",components:{BIcon:n.BIcon,ZoomBtn:jo,ZoomPercent:Ko,CanvasMap:Yo,CanvasMapBtn:Zo},props:{stepZoom:{type:Number,default:.2},positionMap:{type:String,default:Qo},disabled:{type:Boolean,default:false}},emits:["update:modelValue"],setup(t){const e=s.ref(false);const o=s.computed((()=>{const e=t.positionMap.toLowerCase().includes(Wo.top);const o=t.positionMap.toLowerCase().includes(Uo.left);return{[qo.base]:true,[qo.top]:e,[qo.bottom]:!e,[qo.left]:o,[qo.right]:!o}}));function a(){if(t.disabled){e.value=false;return}e.value=!s.toValue(e)}return{iconSet:n.Outline,mapPositionClasses:o,isShowMap:e,onToggleMap:a}},template:`\n\t\t<div class="ui-block-diagram-canvas-zoom-bar">\n\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__locate">\n\t\t\t\t<CanvasMapBtn\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomOpenMapBtn')"\n\t\t\t\t\t@click="onToggleMap"\n\t\t\t\t/>\n\t\t\t\t<transition name="editor-large-map-fade" mode="in-out">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isShowMap"\n\t\t\t\t\t\tclass="ui-block-diagram-canvas-zoom-bar__map"\n\t\t\t\t\t\t:class="mapPositionClasses"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__map-header">\n\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\t:name="iconSet.CROSS_M"\n\t\t\t\t\t\t\t\t:size="24"\n\t\t\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomCloseMapBtn')"\n\t\t\t\t\t\t\t\tclass="ui-block-diagram-canvas-zoom-bar__map-close-icon"\n\t\t\t\t\t\t\t\tcolor="#2FC6F6"\n\t\t\t\t\t\t\t\t@click="onToggleMap"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<CanvasMap\n\t\t\t\t\t\t\t:mapSize="310"\n\t\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomCanvasMap')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</transition>\n\t\t\t</div>\n\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__separator"/>\n\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__zoom">\n\t\t\t\t<ZoomBtn\n\t\t\t\t\t:stepZoom="stepZoom"\n\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomOutBtn')"\n\t\t\t\t\ttypeZoom="out"\n\t\t\t\t/>\n\t\t\t\t<ZoomPercent/>\n\t\t\t\t<ZoomBtn\n\t\t\t\t\t:stepZoom="stepZoom"\n\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomInBtn')"\n\t\t\t\t\ttypeZoom="in"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const tn={name:"search-result",props:{title:{type:String,required:true},count:{type:String,required:true}},template:`\n\t\t<div class="ui-block-diagram-search-result">\n\t\t\t<div class="ui-block-diagram-search-result__left-col">\n\t\t\t\t<p class="ui-block-diagram-search-result__title">{{ title }}</p>\n\t\t\t</div>\n\t\t\t<div class="ui-block-diagram-search-result__right-col">\n\t\t\t\t<span class="ui-block-diagram-search-result__count">{{ count }}</span>\n\t\t\t\t<div class="ui-block-diagram-search-result__nav">\n\t\t\t\t\t<slot/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const en={name:"search-nav-btn",template:`\n\t\t<button class="ui-block-diagram-search-nav-btn">\n\t\t\t<slot/>\n\t\t</button>\n\t`};const on={name:"search-input",components:{BIcon:n.BIcon},props:{value:{type:String,default:""},placeholder:{type:String,default:""},focusable:{type:Boolean,default:false},disabled:{type:Boolean,default:false}},emit:["update:value","clear"],setup(t,{emit:e}){const o=ro();const a=s.useTemplateRef("searchInput");const i=s.computed((()=>{if(t.placeholder){return t.placeholder}return o.getMessage("UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_PLACEHOLDER")}));s.onMounted((()=>{if(s.toValue(t.focusable)){s.toValue(a).focus()}}));function l(o){if(t.disabled){return}e("update:value",o.target.value)}function r(){if(t.disabled){return}e("clear")}return{iconSet:n.Outline,placeholderOrDefaultValue:i,onInput:l,onClear:r}},template:`\n\t\t<div class="ui-block-diagram-search-input">\n\t\t\t<BIcon\n\t\t\t\t:name="iconSet.SEARCH"\n\t\t\t\t:size="24"\n\t\t\t\tclass="ui-block-diagram-search-input__icon"\n\t\t\t/>\n\t\t\t<input\n\t\t\t\t:value="value"\n\t\t\t\t:placeholder="placeholderOrDefaultValue"\n\t\t\t\t:data-test-id="$blockDiagramTestId('searchInput')"\n\t\t\t\tref="searchInput"\n\t\t\t\ttype="text"\n\t\t\t\tclass="ui-block-diagram-search-input__input"\n\t\t\t\t@input="onInput"\n\t\t\t/>\n\t\t\t<button\n\t\t\t\tclass="ui-block-diagram-search-input__clear-btn"\n\t\t\t\t:data-test-id="$blockDiagramTestId('searchClearInputBtn')"\n\t\t\t\t@click="onClear"\n\t\t\t>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="iconSet.CROSS_L"\n\t\t\t\t\t:size="24"\n\t\t\t\t\tclass="ui-block-diagram-search-input__clear-btn-icon"\n\t\t\t\t/>\n\t\t\t</button>\n\t\t</div>\n\t`};const nn={name:"open-search-btn",components:{BIcon:n.BIcon},setup(){return{iconSet:n.Outline}},template:`\n\t\t<button class="ui-block-diagram-open-search-btn">\n\t\t\t<BIcon\n\t\t\t\t:name="iconSet.SEARCH"\n\t\t\t\t:size="24"\n\t\t\t\tclass="ui-block-diagram-open-search-btn__icon"\n\t\t\t/>\n\t\t</button>\n\t`};const an={name:"search-bar",components:{BIcon:n.BIcon,SearchResult:tn,SearchNavBtn:en,SearchInput:on,OpenSearchBtn:nn},props:{searchResultTitle:{type:String,default:""},placeholder:{type:String,default:""},searchCallback:{type:Function,required:true,default:(t,e)=>t.node.title.toLowerCase().includes(e.toLowerCase())},searchDelay:{type:Number,default:300},disabled:{type:Boolean,default:false}},setup(t){const{seachText:e,foundBlocks:o,onSearchBlocks:i,onClearSearch:l}=so({searchCallback:t.searchCallback,delay:t.searchDelay});const{isDisabledBlockDiagram:r}=We();const c=lo();const u=ro();const{goToBlockById:d}=io();const b=s.useTemplateRef("searchPanel");const p=s.ref(false);const v=s.ref(true);const m=s.ref(0);const h=s.computed((()=>t.disabled||s.toValue(r)));const f=s.computed((()=>`${m.value+1} / ${s.toValue(o).length}`));const g=s.computed((()=>{if(t.placeholder){return t.placeholder}return u.getMessage("UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_PLACEHOLDER")}));const B=s.computed((()=>{if(t.searchResultTitle){return t.searchResultTitle}return u.getMessage("UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_RESULT_TITLE")}));s.watch(o,(t=>{m.value=0;if(s.toValue(t).length>0){const e=s.toValue(t)[0].id;c.clear();c.add(e);d(e)}else{c.clear()}}));s.onMounted((()=>{a.Event.bind(document,"mousedown",H)}));s.onUnmounted((()=>{a.Event.unbind(document,"mousedown",H)}));function y(){if(s.toValue(h)){return}v.value=false;p.value=true}function P(){v.value=true}function k(){if(s.toValue(h)){return}m.value+=1;if(s.toValue(m)>s.toValue(o).length-1){m.value=0}const t=s.toValue(o)[s.toValue(m)].id;c.clear();c.add(t);d(t)}function L(){if(s.toValue(h)){return}m.value-=1;if(s.toValue(m)<0){m.value=s.toValue(o).length-1}const t=s.toValue(o)[s.toValue(m)].id;c.clear();c.add(t);d(s.toValue(o)[s.toValue(m)].id)}function V(){c.clear();l();p.value=false;m.value=0}function H(t){if(s.toValue(b)&&!s.toValue(b).contains(t.target)){V()}}return{iconSet:n.Outline,isDisabled:h,placeholderOrDefaultValue:g,searchResultTitleOrDefaultValue:B,seachText:e,labelResult:f,isShowOpenBtn:v,isShowSearchBar:p,foundBlocks:o,onOpenSearchBar:y,onLeaveTransition:P,onSearchBlocks:i,onClearSearch:l,closeAndResetSearch:V,onGoToNextBlock:k,onGoToPrevBlock:L}},template:`\n\t\t<div\n\t\t\t:class="{ '--opened': isShowSearchBar }"\n\t\t\tclass="ui-block-diagram-search-bar"\n\t\t\tref="searchPanel"\n\t\t>\n\t\t\t<OpenSearchBtn\n\t\t\t\tv-if="isShowOpenBtn"\n\t\t\t\t:data-test-id="$blockDiagramTestId('searchOpenBtn')"\n\t\t\t\t@click="onOpenSearchBar"\n\t\t\t/>\n\t\t\t<transition\n\t\t\t\tname="ui-block-diagram-search-bar-fade"\n\t\t\t\tmode="in-out"\n\t\t\t\t@after-leave="onLeaveTransition"\n\t\t\t>\n\t\t\t\t<SearchInput\n\t\t\t\t\tv-if="isShowSearchBar"\n\t\t\t\t\t:value="seachText"\n\t\t\t\t\t:placeholder="placeholderOrDefaultValue"\n\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\tfocusable\n\t\t\t\t\t@update:value="onSearchBlocks"\n\t\t\t\t\t@clear="closeAndResetSearch"\n\t\t\t\t/>\n\t\t\t</transition>\n\t\t\t<div\n\t\t\t\tv-if="isShowSearchBar && foundBlocks.length > 0"\n\t\t\t\tclass="ui-block-diagram-search-bar__search-result"\n\t\t\t>\n\t\t\t\t<SearchResult\n\t\t\t\t\t:title="searchResultTitleOrDefaultValue"\n\t\t\t\t\t:count="labelResult"\n\t\t\t\t>\n\t\t\t\t\t<SearchNavBtn\n\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('searchResultPrevBtn')"\n\t\t\t\t\t\t@click="onGoToPrevBlock"\n\t\t\t\t\t>\n\t\t\t\t\t\t&lt;\n\t\t\t\t\t</SearchNavBtn>\n\t\t\t\t\t<SearchNavBtn\n\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('searchResultNextBtn')"\n\t\t\t\t\t\t@click="onGoToNextBlock"\n\t\t\t\t\t>\n\t\t\t\t\t\t&gt;\n\t\t\t\t\t</SearchNavBtn>\n\t\t\t\t</SearchResult>\n\t\t\t</div>\n\t\t</div>\n\t`};const sn={name:"resizable-block",props:{block:{type:Object,required:true},minWidth:{type:Number,default:100},minHeight:{type:Number,default:100},highlighted:{type:Boolean,default:false}},setup(t){const{block:e,minWidth:o,minHeight:n}=s.toRefs(t);const{isHiglitedBlock:a,isDisabled:i}=Je(e);const l=lo();const{isDragged:r,blockPositionStyle:c}=to(s.useTemplateRef("blockEl"),e);const{isResize:u,sizeBlockStyle:d,onMounted:b,onUnmounted:p}=go({block:e,minWidth:o,minHeight:n,leftSideRef:s.useTemplateRef("leftSide"),topSideRef:s.useTemplateRef("topSide"),rightSideRef:s.useTemplateRef("rightSide"),bottomSideRef:s.useTemplateRef("bottomSide"),leftTopCornerRef:s.useTemplateRef("leftTopCorner"),rightTopCornerRef:s.useTemplateRef("rightTopCorner"),rightBottomCornerRef:s.useTemplateRef("rightBottomCorner"),leftBottomCornerRef:s.useTemplateRef("leftBottomCorner")});const v=s.computed((()=>({...s.toValue(c),...s.toValue(d)})));s.watch((()=>t.highlighted),(e=>{if(e){l.add(t.block.id)}else{l.remove(t.block.id)}}));s.onMounted((()=>{b()}));s.onUnmounted((()=>{l.remove(t.block.id);p()}));function m(){l.clear();l.add(t.block.id)}return{isHiglitedBlock:a,isDisabled:i,isResize:u,isDragged:r,blockStyle:v,onMouseDownSelectBlock:m}},template:`\n\t\t<div\n\t\t\t:style="blockStyle"\n\t\t\tref="blockEl"\n\t\t\tclass="ui-block-diagram-resizable-block"\n\t\t\t@mousedown="onMouseDownSelectBlock"\n\t\t>\n\t\t\t<div class="ui-block-diagram-resizable-block__container">\n\t\t\t\t<div\n\t\t\t\t\tref="leftSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__left-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="topSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__top-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="rightSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__right-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="bottomSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__bottom-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="leftTopCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__top-left-corner"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="rightTopCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__top-right-corner"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="rightBottomCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__bottom-right-corner"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="leftBottomCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__bottom-left-corner"\n\t\t\t\t/>\n\n\t\t\t\t<slot\n\t\t\t\t\t:block="block"\n\t\t\t\t\t:isHighlighted="isHiglitedBlock"\n\t\t\t\t\t:isDragged="isDragged"\n\t\t\t\t\t:isResize="isResize"\n\t\t\t\t\t:isDisabled="isDisabled"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};let ln=t=>t,rn;let cn=null;function un(t,e){const{dragData:o,dragImage:n}=a.Type.isFunction(e)?e():e;cn=s.toValue(n).cloneNode(true).children[0];const i=document.getElementById("blockDiagramDragWrapper");a.Dom.append(cn,i);a.Dom.style(cn,{display:"block",position:"absolute",top:0,left:0});const{width:l,height:r}=cn.getBoundingClientRect();t.dataTransfer.setDragImage(cn,l/2,r/2);t.dataTransfer.setData("text/plain",JSON.stringify({...s.toValue(o),dimensions:{width:l,height:r}}))}function dn(t){a.Dom.remove(cn);cn=null}function bn(){const t=document.getElementById("blockDiagramDragWrapper");if(t){return}const e=a.Tag.render(rn||(rn=ln`
		<div>
			<div
				id="blockDiagramDragWrapper"
				style="position: relative; width: 100%; height: 100%;"
			>
			</div>
		</div>
	`));a.Dom.append(e,document.body);a.Dom.style(e,{position:"absolute",transform:"translate(-100%, -100%)",top:0,right:0})}const pn={mounted(t,{arg:e,value:o}){bn();a.Dom.attr(t,"draggable","true");a.Event.bind(t,"dragstart",(t=>un(t,o)));a.Event.bind(t,"dragend",(t=>dn()))},unmounted(t,{arg:e,value:o}){a.Event.unbind(t,"dragstart",(t=>un(t,o)));a.Event.unbind(t,"dragend",(t=>dn(t)))}};t.BlockDiagram=No;t.HistoryBar=zo;t.ZoomBar=Jo;t.SearchBar=an;t.MoveableBlock=Eo;t.ResizableBlock=sn;t.Port=Mo;t.transformPoint=H;t.useBlockDiagram=We;t.useContextMenu=qe;t.useHistory=Xe;t.useSearchBlocks=so;t.useCanvas=io;t.useBlockState=Je;t.useMoveableBlock=to;t.useResizableBlock=go;t.useHighlightedBlocks=lo;t.useAnimationQueue=vo;t.usePortState=co;t.useConnectionState=uo;t.useNewConnectionState=po;t.useDragAndDrop=fo;t.DragBlock=pn})(this.BX.UI=this.BX.UI||{},BX.Main,BX,BX.UI.IconSet,BX,BX.Vue3);
//# sourceMappingURL=block-diagram.bundle.map.js