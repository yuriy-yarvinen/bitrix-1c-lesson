{"version":3,"file":"block-diagram.bundle.js","sources":["../src/composables/state.js","../src/constants.js","../src/utils/diagram.js","../src/utils/command-to-array.js","../src/utils/create-hook.js","../src/utils/slots.js","../src/lib/gl-matrix/common.js","../src/lib/gl-matrix/mat3.js","../src/lib/gl-matrix/vec3.js","../src/lib/gl-matrix/vec4.js","../src/lib/gl-matrix/quat.js","../src/lib/gl-matrix/vec2.js","../src/utils/canvas/camera.js","../src/utils/canvas/canvas.js","../src/utils/canvas/shaders/grid.js","../src/utils/canvas/helpers.js","../src/utils/canvas/grid.js","../src/composables/history.js","../src/composables/actions.js","../src/composables/getters.js","../src/composables/hooks.js","../src/composables/block-diagram.js","../src/composables/context-menu.js","../src/composables/new-connection.js","../src/composables/block-state.js","../src/composables/moveable-block.js","../src/composables/model-value.js","../src/composables/watch-props.js","../src/composables/register-hooks.js","../src/composables/search-blocks.js","../src/composables/canvas.js","../src/composables/highlighted-blocks.js","../src/composables/loc.js","../src/composables/port-state.js","../src/composables/connection-state.js","../src/composables/init-app-elements.js","../src/composables/new-connection-state.js","../src/composables/animation-queue.js","../src/composables/canvas-transform.js","../src/composables/drag-n-drop.js","../src/composables/resizable-block.js","../src/components/canvas-transform/canvas-transform.js","../src/components/connection/connection.js","../src/components/delete-connection-btn/delete-connection-btn.js","../src/components/context-menu-layout/context-menu-layout.js","../src/components/blocks-queue-transition/blocks-queue-transition.js","../src/components/grouped-blocks/grouped-blocks.js","../src/components/new-connection/new-connection.js","../src/components/connections-queue-transition/connections-queue-transition.js","../src/components/grouped-connections/grouped-connections.js","../src/components/moveable-block/moveable-block.js","../src/components/port/port.js","../src/components/block-content-stub/block-content-stub.js","../src/components/block-diagram/block-diagram.js","../src/components/icon-button/icon-button.js","../src/components/history-bar/history-bar.js","../src/components/zoom-btn/zoom-btn.js","../src/components/zoom-percent/zoom-percent.js","../src/components/canvas-map/canvas-map.js","../src/components/canvas-map-btn/canvas-map-btn.js","../src/components/zoom-bar/zoom-bar.js","../src/components/search-bar/search-result.js","../src/components/search-bar/search-nav-btn.js","../src/components/search-bar/search-input.js","../src/components/search-bar/open-search-btn.js","../src/components/search-bar/search-bar.js","../src/components/resizable-block/resizable-block.js","../src/directives/drag-block.js"],"sourcesContent":["import { markRaw } from 'ui.vue3';\nimport type { State } from '../types';\n\nexport function useState(): State\n{\n\treturn {\n\t\tblockDiagramRef: null,\n\t\tblockDiagramTop: 0,\n\t\tblockDiagramLeft: 0,\n\n\t\tcursorType: 'default',\n\n\t\tisResizing: false,\n\t\tisDisabled: false,\n\n\t\tblocks: [],\n\t\tconnections: [],\n\n\t\tportsElMap: markRaw(new Map()),\n\t\tportsRectMap: {},\n\n\t\tnewConnection: null,\n\n\t\tmovingBlock: null,\n\t\tmovingConnections: [],\n\n\t\tresizingBlock: null,\n\n\t\tcanvasRef: null,\n\t\ttransformLayoutRef: null,\n\t\tcanvasInstance: null,\n\t\tcanvasWidth: 0,\n\t\tcanvasHeight: 0,\n\t\ttransformX: 0,\n\t\ttransformY: 0,\n\t\tviewportX: 0,\n\t\tviewportY: 0,\n\t\tzoom: 1,\n\t\tminZoom: 0.2,\n\t\tmaxZoom: 4,\n\n\t\tcontextMenuLayerRef: null,\n\t\ttargetContainerRef: null,\n\t\tisOpenContextMenu: false,\n\t\tcontextMenuInstance: null,\n\t\tpositionContextMenu: {\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t},\n\n\t\thistoryCurrentState: markRaw({\n\t\t\tblocks: [],\n\t\t\tconnections: [],\n\t\t}),\n\n\t\theadSnapshot: null,\n\t\ttailSnapshot: null,\n\t\tcurrentSnapshot: null,\n\t\tmaxCountSnapshots: 20,\n\t\tsnapshotHandler: null,\n\t\trevertHandler: null,\n\n\t\thighlitedBlockIds: [],\n\n\t\tanimationQueue: null,\n\t\tcurrentAnimationItem: null,\n\t\tisPauseAnimation: false,\n\t\tisStopAnimation: false,\n\t};\n}\n","import type { AnimationItemTypes } from './types';\n\nexport const PORT_SIZE = 9;\nexport const NODE_HEADER_HEIGHT = 46;\nexport const NODE_CONTENT_HEADER_HEIGHT = 14;\nexport const DELETE_BUTTON_SIZE = 22;\nexport const GRID_SIZE = 100;\nexport const STICKING_DISTANCE = 5;\n\nexport const HOOK_NAMES = {\n\tCHANGED_BLOCKS: 'changedBlocks',\n\tCHANGED_CONNECTIONS: 'changedConnections',\n\tSTART_DRAG_BLOCK: 'startDragBlock',\n\tMOVE_DRAG_BLOCK: 'moveDragBlock',\n\tEND_DRAG_BLOCK: 'endDragBlock',\n\tADD_BLOCK: 'addBlock',\n\tUPDATE_BLOCK: 'updateBlock',\n\tDELETE_BLOCK: 'deleteBlock',\n\tCREATE_CONNECTION: 'createConnection',\n\tDELETE_CONNECTION: 'deleteConnection',\n\tBLOCK_TRANSITION_START: 'blockTransitionStart',\n\tBLOCK_TRANSITION_END: 'blockTransitionEnd',\n\tCONNECTION_TRANSITION_START: 'connectionTransitionStart',\n\tCONNECTION_TRANSITION_END: 'connectionTransitionEnd',\n\tDROP_NEW_BLOCK: 'dropNewBlock',\n};\n\nexport const PORT_TYPES: { ... } = {\n\tINPUT: 'input',\n\tOUTPUT: 'output',\n};\n\nexport const NODE_TYPES: { ... } = {\n\tSIMPLE: 'simple',\n\tTRIGGER: 'trigger',\n\tCOMPLEX: 'complex',\n};\n\nexport const BLOCK_GROUP_DEFAULT_NAME = 'default';\nexport const CONNECTION_GROUP_DEFAULT_NAME = 'default';\n\nexport const PORT_POSITION = {\n\tTOP: 'top',\n\tBOTTOM: 'bottom',\n\tRIGHT: 'right',\n\tLEFT: 'left',\n};\n\nexport const CONNECTION_VIEW_TYPE = {\n\tBEZIER: 'bezier',\n\tSMOOTHSTEP: 'smoothstep',\n};\n\nexport const NEW_CONNECTION_VIEW_TYPE = {\n\tBEZIER: 'bezier',\n\tLINE: 'line',\n};\n\nexport const ANIMATED_TYPES: { [string]: AnimationItemTypes } = {\n\tBLOCK: 'block',\n\tCONNECTION: 'connection',\n\tREMOVE_BLOCK: 'remove_block',\n\tREMOVE_CONNECTION: 'remove_connection',\n};\n\nexport const CURSOR_TYPES = {\n\tEW_RESIZE: 'ew-resize',\n\tNS_RESIZE: 'ns-resize',\n\tNWSE_RESIZE: 'nwse-resize',\n\tNESW_RESIZE: 'nesw-resize',\n};\n\nexport const BLOCK_INDEXES = {\n\tHIGHLITED: 4,\n\tMOVABLE: 3,\n\tSTANDING: 2,\n\tRESIZABLE: 1,\n};\n","import type { Point, DiagramPortPosition } from '../types';\nimport { PORT_POSITION } from '../constants';\n\nconst DIR_ACCESSOR_X = 'x';\nconst DIR_ACCESSOR_Y = 'x';\n\nconst DIRECTIONS_BY_POSITION: { [DiagramPortPosition]: Point } = {\n\t[PORT_POSITION.LEFT]: { x: -1, y: 0 },\n\t[PORT_POSITION.RIGHT]: { x: 1, y: 0 },\n\t[PORT_POSITION.TOP]: { x: 0, y: -1 },\n\t[PORT_POSITION.BOTTOM]: { x: 0, y: 1 },\n};\n\nexport type PathInfo = {\n\tpath: string;\n\tcenter: {\n\t\tx: number;\n\t\ty: number;\n\t}\n};\n\nexport function getLinePath(start: Point, end: Point): PathInfo\n{\n\tconst [x, y] = getConnectionCenter({\n\t\tsourceX: start.x,\n\t\tsourceY: start.y,\n\t\ttargetX: end.x,\n\t\ttargetY: end.y,\n\t});\n\n\treturn {\n\t\tpath: `M ${start.x} ${start.y} L ${end.x} ${end.y}`,\n\t\tcenter: { x, y },\n\t};\n}\n\nexport function getBeziePath(start: Point, end: Point): PathInfo\n{\n\tconst midX: number = (start.x + end.x) / 2;\n\tconst [centerX, centerY] = getConnectionCenter({\n\t\tsourceX: start.x,\n\t\tsourceY: start.y,\n\t\ttargetX: end.x,\n\t\ttargetY: end.y,\n\t});\n\n\treturn {\n\t\tpath: `M ${start.x} ${start.y} C ${midX} ${start.y}, ${midX} ${end.y}, ${end.x} ${end.y}`,\n\t\tcenter: {\n\t\t\tx: centerX,\n\t\t\ty: centerY,\n\t\t},\n\t};\n}\n\nexport function transformPoint(point: Point, transform, viewport): Point\n{\n\tlet transformedX: number = Math.round((point.x - transform.x) / transform.zoom);\n\tlet transformedY: number = Math.round((point.y - transform.y) / transform.zoom);\n\n\ttransformedX -= Math.round(viewport.left / transform.zoom);\n\ttransformedY -= Math.round(viewport.top / transform.zoom);\n\n\treturn {\n\t\tx: transformedX,\n\t\ty: transformedY,\n\t};\n}\n\nexport function getConnectionCenter({\n\tsourceX,\n\tsourceY,\n\ttargetX,\n\ttargetY,\n}: {\n\tsourceX: number,\n\tsourceY: number,\n\ttargetX: number,\n\ttargetY: number,\n}): [number, number, number, number]\n{\n\tconst xOffset = Math.abs(targetX - sourceX) / 2;\n\tconst centerX = targetX < sourceX\n\t\t? targetX + xOffset\n\t\t: targetX - xOffset;\n\n\tconst yOffset = Math.abs(targetY - sourceY) / 2;\n\tconst centerY = targetY < sourceY\n\t\t? targetY + yOffset\n\t\t: targetY - yOffset;\n\n\treturn [centerX, centerY, xOffset, yOffset];\n}\n\nfunction getDirection({ source, sourcePosition = PORT_POSITION.BOTTOM, target }: {\n\tsource: XYPosition,\n\tsourcePosition: Position,\n\ttarget: XYPosition,\n}): XYPosition\n{\n\tif (sourcePosition === PORT_POSITION.LEFT || sourcePosition === PORT_POSITION.RIGHT)\n\t{\n\t\treturn source.x < target.x\n\t\t\t? { x: 1, y: 0 }\n\t\t\t: { x: -1, y: 0 };\n\t}\n\n\treturn source.y < target.y\n\t\t? { x: 0, y: 1 }\n\t\t: { x: 0, y: -1 };\n}\n\nfunction distance(a: Point, b: Point): number\n{\n\treturn Math.sqrt((b.x - a.x) ** 2 + (b.y - a.y) ** 2);\n}\n\nexport type GetPointsParams = {\n\tsource: Point;\n\tsourcePosition: DiagramPortPosition;\n\ttarget: Point;\n}\n\n// eslint-disable-next-line max-lines-per-function\nfunction getPoints({\n\tsource,\n\tsourcePosition = PORT_POSITION.BOTTOM,\n\ttarget,\n\ttargetPosition = PORT_POSITION.TOP,\n\tcenter,\n\toffset,\n}: {\n  source: Point,\n  sourcePosition: DiagramPortPosition,\n  target: Point,\n  targetPosition: DiagramPortPosition,\n  center: Partial<Point>,\n  offset: number,\n}): [Point[], number, number, number, number]\n{\n\tconst sourceDir = DIRECTIONS_BY_POSITION[sourcePosition];\n\tconst targetDir = DIRECTIONS_BY_POSITION[targetPosition];\n\tconst sourceGapped: Point = {\n\t\tx: source.x + sourceDir.x * offset,\n\t\ty: source.y + sourceDir.y * offset,\n\t};\n\tconst targetGapped: Point = {\n\t\tx: target.x + targetDir.x * offset,\n\t\ty: target.y + targetDir.y * offset,\n\t};\n\tconst dir = getDirection({\n\t\tsource: sourceGapped,\n\t\tsourcePosition,\n\t\ttarget: targetGapped,\n\t});\n\tconst dirAccessor = dir.x !== 0\n\t\t? DIR_ACCESSOR_X\n\t\t: DIR_ACCESSOR_Y;\n\tconst currDir = dir[dirAccessor];\n\n\tlet points: Point[] = [];\n\tlet centerX = 0;\n\tlet centerY = 0;\n\n\tconst sourceGapOffset: Point = { x: 0, y: 0 };\n\tconst targetGapOffset: Point = { x: 0, y: 0 };\n\n\tconst [\n\t\tdefaultCenterX,\n\t\tdefaultCenterY,\n\t\tdefaultOffsetX,\n\t\tdefaultOffsetY,\n\t] = getConnectionCenter({\n\t\tsourceX: source.x,\n\t\tsourceY: source.y,\n\t\ttargetX: target.x,\n\t\ttargetY: target.y,\n\t});\n\n\tif (sourceDir[dirAccessor] * targetDir[dirAccessor] === -1)\n\t{\n\t\tcenterX = center.x ?? defaultCenterX;\n\t\tcenterY = center.y ?? defaultCenterY;\n\n\t\tconst verticalSplit: Point[] = [\n\t\t\t{ x: centerX, y: sourceGapped.y },\n\t\t\t{ x: centerX, y: targetGapped.y },\n\t\t];\n\n\t\tconst horizontalSplit: Point[] = [\n\t\t\t{ x: sourceGapped.x, y: centerY },\n\t\t\t{ x: targetGapped.x, y: centerY },\n\t\t];\n\n\t\tif (sourceDir[dirAccessor] === currDir)\n\t\t{\n\t\t\tpoints = dirAccessor === DIR_ACCESSOR_X\n\t\t\t\t? verticalSplit\n\t\t\t\t: horizontalSplit;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpoints = dirAccessor === DIR_ACCESSOR_X\n\t\t\t\t? horizontalSplit\n\t\t\t\t: verticalSplit;\n\t\t}\n\t}\n\telse\n\t{\n\t\tconst sourceTarget: Point[] = [{\n\t\t\tx: sourceGapped.x,\n\t\t\ty: targetGapped.y,\n\t\t}];\n\t\tconst targetSource: Point[] = [{\n\t\t\tx: targetGapped.x,\n\t\t\ty: sourceGapped.y,\n\t\t}];\n\n\t\tif (dirAccessor === DIR_ACCESSOR_X)\n\t\t{\n\t\t\tpoints = sourceDir.x === currDir\n\t\t\t\t? targetSource\n\t\t\t\t: sourceTarget;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpoints = sourceDir.y === currDir\n\t\t\t\t? sourceTarget\n\t\t\t\t: targetSource;\n\t\t}\n\n\t\tif (sourcePosition === targetPosition)\n\t\t{\n\t\t\tconst diff = Math.abs(source[dirAccessor] - target[dirAccessor]);\n\n\t\t\tif (diff <= offset)\n\t\t\t{\n\t\t\t\tconst gapOffset = Math.min(offset - 1, offset - diff);\n\n\t\t\t\tif (sourceDir[dirAccessor] === currDir)\n\t\t\t\t{\n\t\t\t\t\tconst dirSource = sourceGapped[dirAccessor] > source[dirAccessor] ? -1 : 1;\n\t\t\t\t\tsourceGapOffset[dirAccessor] = dirSource * gapOffset;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst dirTarget = targetGapped[dirAccessor] > target[dirAccessor] ? -1 : 1;\n\t\t\t\t\ttargetGapOffset[dirAccessor] = dirTarget * gapOffset;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (sourcePosition !== targetPosition)\n\t\t{\n\t\t\tconst dirAccessorOpposite = dirAccessor === DIR_ACCESSOR_X\n\t\t\t\t? DIR_ACCESSOR_Y\n\t\t\t\t: DIR_ACCESSOR_X;\n\t\t\tconst isSameDir = sourceDir[dirAccessor] === targetDir[dirAccessorOpposite];\n\t\t\tconst sourceGtTargetOppo = sourceGapped[dirAccessorOpposite] > targetGapped[dirAccessorOpposite];\n\t\t\tconst sourceLtTargetOppo = sourceGapped[dirAccessorOpposite] < targetGapped[dirAccessorOpposite];\n\t\t\tconst isFlipSourceTarget =\n\t\t\t\t(sourceDir[dirAccessor] === 1 && ((!isSameDir && sourceGtTargetOppo) || (isSameDir && sourceLtTargetOppo))) ||\n\t\t\t\t(sourceDir[dirAccessor] !== 1 && ((!isSameDir && sourceLtTargetOppo) || (isSameDir && sourceGtTargetOppo)));\n\n\t\t\tif (isFlipSourceTarget)\n\t\t\t{\n\t\t\t\tpoints = dirAccessor === DIR_ACCESSOR_X\n\t\t\t\t\t? sourceTarget\n\t\t\t\t\t: targetSource;\n\t\t\t}\n\t\t}\n\n\t\tconst sourceGapPoint = {\n\t\t\tx: sourceGapped.x + sourceGapOffset.x,\n\t\t\ty: sourceGapped.y + sourceGapOffset.y,\n\t\t};\n\t\tconst targetGapPoint = {\n\t\t\tx: targetGapped.x + targetGapOffset.x,\n\t\t\ty: targetGapped.y + targetGapOffset.y,\n\t\t};\n\t\tconst maxXDistance = Math.max(\n\t\t\tMath.abs(sourceGapPoint.x - points[0].x),\n\t\t\tMath.abs(targetGapPoint.x - points[0].x),\n\t\t);\n\t\tconst maxYDistance = Math.max(\n\t\t\tMath.abs(sourceGapPoint.y - points[0].y),\n\t\t\tMath.abs(targetGapPoint.y - points[0].y),\n\t\t);\n\n\t\tif (maxXDistance >= maxYDistance)\n\t\t{\n\t\t\tcenterX = (sourceGapPoint.x + targetGapPoint.x) / 2;\n\t\t\tcenterY = points[0].y;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcenterX = points[0].x;\n\t\t\tcenterY = (sourceGapPoint.y + targetGapPoint.y) / 2;\n\t\t}\n\t}\n\n\tconst pathPoints: Point[] = [\n\t\tsource,\n\t\t{\n\t\t\tx: sourceGapped.x + sourceGapOffset.x,\n\t\t\ty: sourceGapped.y + sourceGapOffset.y,\n\t\t},\n\t\t...points,\n\t\t{\n\t\t\tx: targetGapped.x + targetGapOffset.x,\n\t\t\ty: targetGapped.y + targetGapOffset.y,\n\t\t},\n\t\ttarget,\n\t];\n\n\treturn {\n\t\tpoints: pathPoints,\n\t\toffsetX: defaultOffsetX,\n\t\toffsetY: defaultOffsetY,\n\t\tcenterX,\n\t\tcenterY,\n\t};\n}\n\nfunction getBend(\n\ta: Point,\n\tb: Point,\n\tc: Point,\n\tsize: number,\n): string\n{\n\tconst bendSize = Math.min(\n\t\tdistance(a, b) / 2,\n\t\tdistance(b, c) / 2,\n\t\tsize,\n\t);\n\tconst { x, y } = b;\n\n\tif ((a.x === x && x === c.x) || (a.y === y && y === c.y))\n\t{\n\t\treturn `L${x} ${y}`;\n\t}\n\n\tif (a.y === y)\n\t{\n\t\tconst xDir = a.x < c.x ? -1 : 1;\n\t\tconst yDir = a.y < c.y ? 1 : -1;\n\n\t\treturn `L ${x + bendSize * xDir},${y}Q ${x},${y} ${x},${y + bendSize * yDir}`;\n\t}\n\n\tconst xDir = a.x < c.x ? 1 : -1;\n\tconst yDir = a.y < c.y ? -1 : 1;\n\n\treturn `L ${x},${y + bendSize * yDir}Q ${x},${y} ${x + bendSize * xDir},${y}`;\n}\n\nexport type GetSmoothStepPathParams = {\n\tsourceX: number;\n\tsourceY: number;\n\tsourcePosition?: DiagramPortPosition;\n\ttargetX: number;\n\ttargetY: number;\n\ttargetPosition?: DiagramPortPosition;\n\tborderRadius?: number;\n\tcenterX?: number;\n\tcenterY?: number;\n\toffset?: number;\n};\n\nexport function getSmoothStepPath(params: GetSmoothStepPathParams): PathInfo\n{\n\tconst {\n\t\tsourceX,\n\t\tsourceY,\n\t\tsourcePosition = PORT_POSITION.BOTTOM,\n\t\ttargetX,\n\t\ttargetY,\n\t\ttargetPosition = PORT_POSITION.TOP,\n\t\tborderRadius = 5,\n\t\tcenterX,\n\t\tcenterY,\n\t\toffset = 20,\n\t} = params;\n\n\tconst {\n\t\tpoints,\n\t\tcenterX: pointsCenterX,\n\t\tcenterY: pointsCenterY,\n\t} = getPoints({\n\t\tsource: { x: sourceX, y: sourceY },\n\t\tsourcePosition,\n\t\ttarget: { x: targetX, y: targetY },\n\t\ttargetPosition,\n\t\tcenter: { x: centerX, y: centerY },\n\t\toffset,\n\t});\n\n\tconst path = points.reduce((res, p, i) => {\n\t\tlet segment = '';\n\n\t\tif (i > 0 && i < points.length - 1)\n\t\t{\n\t\t\tsegment = getBend(points[i - 1], p, points[i + 1], borderRadius);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsegment = `${i === 0 ? 'M' : 'L'}${p.x} ${p.y}`;\n\t\t}\n\n\t\tres += segment;\n\n\t\treturn res;\n\t}, '');\n\n\treturn {\n\t\tpath,\n\t\tcenter: {\n\t\t\tx: pointsCenterX,\n\t\t\ty: pointsCenterY,\n\t\t},\n\t};\n}\n","export const ARRAY_COMMANDS = Object.freeze({\n\tREPLACE: 'replace',\n\tPUSH: 'push',\n\tUPDATE_BY_INDEX: 'updateByIndex',\n\tDELETE_BY_INDEX: 'deleteByIndex',\n});\n\nexport type CommandPayload = {\n\tcommandType: $Values<typeof ARRAY_COMMANDS>,\n\tpayload?: Array<{...}> | {...},\n\tindex?: number,\n};\n\nconst commandExecMap = {\n\t[ARRAY_COMMANDS.REPLACE]: ({ payload }) => {\n\t\treturn [...payload];\n\t},\n\t[ARRAY_COMMANDS.PUSH]: ({ source, payload }) => {\n\t\tconst result = [...source];\n\t\tresult.push(payload);\n\n\t\treturn result;\n\t},\n\t[ARRAY_COMMANDS.UPDATE_BY_INDEX]: ({ source, payload, index }) => {\n\t\tconst result = [...source];\n\t\tresult[index] = {\n\t\t\t...result[index],\n\t\t\t...payload,\n\t\t};\n\n\t\treturn result;\n\t},\n\t[ARRAY_COMMANDS.DELETE_BY_INDEX]: ({ source, index }) => {\n\t\tconst result = [...source];\n\t\tresult.splice(index, 1);\n\n\t\treturn result;\n\t},\n};\n\nfunction command(\n\tcommandType: $Values<typeof ARRAY_COMMANDS>,\n\targs: { payload: Array<{...}> | {...}, index: number },\n): CommandReturnType<P, I>\n{\n\treturn {\n\t\tcommandType,\n\t\t...args,\n\t};\n}\n\nexport function commandReplace(payload: Array<{...}>): CommandPayload\n{\n\treturn command(ARRAY_COMMANDS.REPLACE, { payload });\n}\n\nexport function commandPush(payload: {...}): CommandPayload\n{\n\treturn command(ARRAY_COMMANDS.PUSH, { payload });\n}\n\nexport function commandUpdateByIndex(index: number, payload: {...}): CommandPayload\n{\n\treturn command(ARRAY_COMMANDS.UPDATE_BY_INDEX, { index, payload });\n}\n\nexport function commandDeleteByIndex(index: number): CommandPayload\n{\n\treturn command(ARRAY_COMMANDS.DELETE_BY_INDEX, { index });\n}\n\nexport function runCommand(\n\tsourceArray: Array<{...}>,\n\tcommandPayload: CommandPayload,\n\tcallback: (value: Array<{...}>) => any,\n): void\n{\n\tconst { commandType, payload, index } = commandPayload;\n\tconst result = commandExecMap[commandType]({\n\t\tsource: sourceArray,\n\t\tpayload,\n\t\tindex,\n\t});\n\n\tcallback(result);\n}\n","import { Type } from 'main.core';\n\nexport type CreateHook = {\n\ton: (handler: () => void) => void,\n\toff: (handler: () => void) => void,\n\ttrigger: (...args: any) => void,\n};\n\nexport function createHook(): CreateHook\n{\n\tconst handlers = new Set();\n\n\tconst on = (handler: () => void) => {\n\t\tif (Type.isFunction(handler) && !handlers.has(handler))\n\t\t{\n\t\t\thandlers.add(handler);\n\t\t}\n\t};\n\n\tconst off = (handler) => {\n\t\thandlers.delete(handler);\n\t};\n\n\tconst trigger = (...args) => {\n\t\tfor (const handler of handlers)\n\t\t{\n\t\t\thandler(...args);\n\t\t}\n\t};\n\n\treturn {\n\t\ton,\n\t\toff,\n\t\ttrigger,\n\t};\n}\n","export function getGroupBlockSlotName(group: string): string\n{\n\treturn `block:${group}`;\n}\n\nexport function getGroupConnectionSlotName(group: string): string\n{\n\treturn `conenction:${group}`;\n}\n","/**\n * Common utilities\n * @module glMatrix\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== \"undefined\" ? Float32Array : Array;\nexport var RANDOM = Math.random;\nexport var ANGLE_ORDER = \"zyx\";\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a The first number to test.\n * @param {Number} b The second number to test.\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};","import * as glMatrix from \"./common.js\";\n/**\n * 3x3 Matrix\n * @module mat3\n */\n\n/**\n * Creates a new identity mat3\n *\n * @returns {mat3} a new 3x3 matrix\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(9);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[5] = 0;\n    out[6] = 0;\n    out[7] = 0;\n  }\n\n  out[0] = 1;\n  out[4] = 1;\n  out[8] = 1;\n  return out;\n}\n/**\n * Copies the upper-left 3x3 values into the given mat3.\n *\n * @param {mat3} out the receiving 3x3 matrix\n * @param {ReadonlyMat4} a   the source 4x4 matrix\n * @returns {mat3} out\n */\n\nexport function fromMat4(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[4];\n  out[4] = a[5];\n  out[5] = a[6];\n  out[6] = a[8];\n  out[7] = a[9];\n  out[8] = a[10];\n  return out;\n}\n/**\n * Creates a new mat3 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat3} a matrix to clone\n * @returns {mat3} a new 3x3 matrix\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n/**\n * Copy the values from one mat3 to another\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n/**\n * Create a new mat3 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} A new mat3\n */\n\nexport function fromValues(m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n/**\n * Set the components of a mat3 to the given values\n *\n * @param {mat3} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} out\n */\n\nexport function set(out, m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n/**\n * Set a mat3 to the identity matrix\n *\n * @param {mat3} out the receiving matrix\n * @returns {mat3} out\n */\n\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n/**\n * Transpose the values of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\n\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n        a02 = a[2],\n        a12 = a[5];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a01;\n    out[5] = a[7];\n    out[6] = a02;\n    out[7] = a12;\n  } else {\n    out[0] = a[0];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a[1];\n    out[4] = a[4];\n    out[5] = a[7];\n    out[6] = a[2];\n    out[7] = a[5];\n    out[8] = a[8];\n  }\n\n  return out;\n}\n/**\n * Inverts a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\n\nexport function invert(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2];\n  var a10 = a[3],\n      a11 = a[4],\n      a12 = a[5];\n  var a20 = a[6],\n      a21 = a[7],\n      a22 = a[8];\n  var b01 = a22 * a11 - a12 * a21;\n  var b11 = -a22 * a10 + a12 * a20;\n  var b21 = a21 * a10 - a11 * a20; // Calculate the determinant\n\n  var det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = b01 * det;\n  out[1] = (-a22 * a01 + a02 * a21) * det;\n  out[2] = (a12 * a01 - a02 * a11) * det;\n  out[3] = b11 * det;\n  out[4] = (a22 * a00 - a02 * a20) * det;\n  out[5] = (-a12 * a00 + a02 * a10) * det;\n  out[6] = b21 * det;\n  out[7] = (-a21 * a00 + a01 * a20) * det;\n  out[8] = (a11 * a00 - a01 * a10) * det;\n  return out;\n}\n/**\n * Calculates the adjugate of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\n\nexport function adjoint(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2];\n  var a10 = a[3],\n      a11 = a[4],\n      a12 = a[5];\n  var a20 = a[6],\n      a21 = a[7],\n      a22 = a[8];\n  out[0] = a11 * a22 - a12 * a21;\n  out[1] = a02 * a21 - a01 * a22;\n  out[2] = a01 * a12 - a02 * a11;\n  out[3] = a12 * a20 - a10 * a22;\n  out[4] = a00 * a22 - a02 * a20;\n  out[5] = a02 * a10 - a00 * a12;\n  out[6] = a10 * a21 - a11 * a20;\n  out[7] = a01 * a20 - a00 * a21;\n  out[8] = a00 * a11 - a01 * a10;\n  return out;\n}\n/**\n * Calculates the determinant of a mat3\n *\n * @param {ReadonlyMat3} a the source matrix\n * @returns {Number} determinant of a\n */\n\nexport function determinant(a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2];\n  var a10 = a[3],\n      a11 = a[4],\n      a12 = a[5];\n  var a20 = a[6],\n      a21 = a[7],\n      a22 = a[8];\n  return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\n}\n/**\n * Multiplies two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\n\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2];\n  var a10 = a[3],\n      a11 = a[4],\n      a12 = a[5];\n  var a20 = a[6],\n      a21 = a[7],\n      a22 = a[8];\n  var b00 = b[0],\n      b01 = b[1],\n      b02 = b[2];\n  var b10 = b[3],\n      b11 = b[4],\n      b12 = b[5];\n  var b20 = b[6],\n      b21 = b[7],\n      b22 = b[8];\n  out[0] = b00 * a00 + b01 * a10 + b02 * a20;\n  out[1] = b00 * a01 + b01 * a11 + b02 * a21;\n  out[2] = b00 * a02 + b01 * a12 + b02 * a22;\n  out[3] = b10 * a00 + b11 * a10 + b12 * a20;\n  out[4] = b10 * a01 + b11 * a11 + b12 * a21;\n  out[5] = b10 * a02 + b11 * a12 + b12 * a22;\n  out[6] = b20 * a00 + b21 * a10 + b22 * a20;\n  out[7] = b20 * a01 + b21 * a11 + b22 * a21;\n  out[8] = b20 * a02 + b21 * a12 + b22 * a22;\n  return out;\n}\n/**\n * Translate a mat3 by the given vector\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to translate\n * @param {ReadonlyVec2} v vector to translate by\n * @returns {mat3} out\n */\n\nexport function translate(out, a, v) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a10 = a[3],\n      a11 = a[4],\n      a12 = a[5],\n      a20 = a[6],\n      a21 = a[7],\n      a22 = a[8],\n      x = v[0],\n      y = v[1];\n  out[0] = a00;\n  out[1] = a01;\n  out[2] = a02;\n  out[3] = a10;\n  out[4] = a11;\n  out[5] = a12;\n  out[6] = x * a00 + y * a10 + a20;\n  out[7] = x * a01 + y * a11 + a21;\n  out[8] = x * a02 + y * a12 + a22;\n  return out;\n}\n/**\n * Rotates a mat3 by the given angle\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\n\nexport function rotate(out, a, rad) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a10 = a[3],\n      a11 = a[4],\n      a12 = a[5],\n      a20 = a[6],\n      a21 = a[7],\n      a22 = a[8],\n      s = Math.sin(rad),\n      c = Math.cos(rad);\n  out[0] = c * a00 + s * a10;\n  out[1] = c * a01 + s * a11;\n  out[2] = c * a02 + s * a12;\n  out[3] = c * a10 - s * a00;\n  out[4] = c * a11 - s * a01;\n  out[5] = c * a12 - s * a02;\n  out[6] = a20;\n  out[7] = a21;\n  out[8] = a22;\n  return out;\n}\n/**\n * Scales the mat3 by the dimensions in the given vec2\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to rotate\n * @param {ReadonlyVec2} v the vec2 to scale the matrix by\n * @returns {mat3} out\n **/\n\nexport function scale(out, a, v) {\n  var x = v[0],\n      y = v[1];\n  out[0] = x * a[0];\n  out[1] = x * a[1];\n  out[2] = x * a[2];\n  out[3] = y * a[3];\n  out[4] = y * a[4];\n  out[5] = y * a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.translate(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyVec2} v Translation vector\n * @returns {mat3} out\n */\n\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = v[0];\n  out[7] = v[1];\n  out[8] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a given angle\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.rotate(dest, dest, rad);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\n\nexport function fromRotation(out, rad) {\n  var s = Math.sin(rad),\n      c = Math.cos(rad);\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = -s;\n  out[4] = c;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.scale(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyVec2} v Scaling vector\n * @returns {mat3} out\n */\n\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = v[1];\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n/**\n * Copies the values from a mat2d into a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat2d} a the matrix to copy\n * @returns {mat3} out\n **/\n\nexport function fromMat2d(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = 0;\n  out[3] = a[2];\n  out[4] = a[3];\n  out[5] = 0;\n  out[6] = a[4];\n  out[7] = a[5];\n  out[8] = 1;\n  return out;\n}\n/**\n * Calculates a 3x3 matrix from the given quaternion\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat3} out\n */\n\nexport function fromQuat(out, q) {\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[3] = yx - wz;\n  out[6] = zx + wy;\n  out[1] = yx + wz;\n  out[4] = 1 - xx - zz;\n  out[7] = zy - wx;\n  out[2] = zx - wy;\n  out[5] = zy + wx;\n  out[8] = 1 - xx - yy;\n  return out;\n}\n/**\n * Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyMat4} a Mat4 to derive the normal matrix from\n *\n * @returns {mat3} out\n */\n\nexport function normalFromMat4(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  return out;\n}\n/**\n * Generates a 2D projection matrix with the given bounds\n *\n * @param {mat3} out mat3 frustum matrix will be written into\n * @param {number} width Width of your gl context\n * @param {number} height Height of gl context\n * @returns {mat3} out\n */\n\nexport function projection(out, width, height) {\n  out[0] = 2 / width;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -2 / height;\n  out[5] = 0;\n  out[6] = -1;\n  out[7] = 1;\n  out[8] = 1;\n  return out;\n}\n/**\n * Returns a string representation of a mat3\n *\n * @param {ReadonlyMat3} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\n\nexport function str(a) {\n  return \"mat3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \")\";\n}\n/**\n * Returns Frobenius norm of a mat3\n *\n * @param {ReadonlyMat3} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\n\nexport function frob(a) {\n  return Math.hypot(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8]);\n}\n/**\n * Adds two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  return out;\n}\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  return out;\n}\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat3} out\n */\n\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  return out;\n}\n/**\n * Adds two mat3's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat3} out the receiving vector\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat3} out\n */\n\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  return out;\n}\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat3} a The first matrix.\n * @param {ReadonlyMat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8];\n}\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat3} a The first matrix.\n * @param {ReadonlyMat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3],\n      a4 = a[4],\n      a5 = a[5],\n      a6 = a[6],\n      a7 = a[7],\n      a8 = a[8];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3],\n      b4 = b[4],\n      b5 = b[5],\n      b6 = b[6],\n      b7 = b[7],\n      b8 = b[8];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8));\n}\n/**\n * Alias for {@link mat3.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link mat3.subtract}\n * @function\n */\n\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(3);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {ReadonlyVec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Calculates the length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\n\nexport function fromValues(x, y, z) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the source vector\n * @returns {vec3} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\n\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to ceil\n * @returns {vec3} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to floor\n * @returns {vec3} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to round\n * @returns {vec3} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  return out;\n}\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Calculates the squared length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to negate\n * @returns {vec3} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to invert\n * @returns {vec3} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to normalize\n * @returns {vec3} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var len = x * x + y * y + z * z;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  out[2] = a[2] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2];\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n/**\n * Performs a spherical linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function slerp(out, a, b, t) {\n  var angle = Math.acos(Math.min(Math.max(dot(a, b), -1), 1));\n  var sinTotal = Math.sin(angle);\n  var ratioA = Math.sin((1 - t) * angle) / sinTotal;\n  var ratioB = Math.sin(t * angle) / sinTotal;\n  out[0] = ratioA * a[0] + ratioB * b[0];\n  out[1] = ratioA * a[1] + ratioB * b[1];\n  out[2] = ratioA * a[2] + ratioB * b[2];\n  return out;\n}\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function hermite(out, a, b, c, d, t) {\n  var factorTimes2 = t * t;\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\n  var factor2 = factorTimes2 * (t - 2) + t;\n  var factor3 = factorTimes2 * (t - 1);\n  var factor4 = factorTimes2 * (3 - 2 * t);\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function bezier(out, a, b, c, d, t) {\n  var inverseFactor = 1 - t;\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  var factorTimes2 = t * t;\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\n  var factor2 = 3 * t * inverseFactorTimesTwo;\n  var factor3 = 3 * factorTimes2 * inverseFactor;\n  var factor4 = factorTimes2 * t;\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec3} out\n */\n\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec3} out\n */\n\nexport function transformQuat(out, a, q) {\n  // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3];\n  var x = a[0],\n      y = a[1],\n      z = a[2]; // var qvec = [qx, qy, qz];\n  // var uv = vec3.cross([], qvec, a);\n\n  var uvx = qy * z - qz * y,\n      uvy = qz * x - qx * z,\n      uvz = qx * y - qy * x; // var uuv = vec3.cross([], qvec, uv);\n\n  var uuvx = qy * uvz - qz * uvy,\n      uuvy = qz * uvx - qx * uvz,\n      uuvz = qx * uvy - qy * uvx; // vec3.scale(uv, uv, 2 * w);\n\n  var w2 = qw * 2;\n  uvx *= w2;\n  uvy *= w2;\n  uvz *= w2; // vec3.scale(uuv, uuv, 2);\n\n  uuvx *= 2;\n  uuvy *= 2;\n  uuvz *= 2; // return vec3.add(out, a, vec3.add(out, uv, uuv));\n\n  out[0] = x + uvx + uuvx;\n  out[1] = y + uvy + uuvy;\n  out[2] = z + uvz + uuvz;\n  return out;\n}\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateX(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0];\n  r[1] = p[1] * Math.cos(rad) - p[2] * Math.sin(rad);\n  r[2] = p[1] * Math.sin(rad) + p[2] * Math.cos(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateY(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[2] * Math.sin(rad) + p[0] * Math.cos(rad);\n  r[1] = p[1];\n  r[2] = p[2] * Math.cos(rad) - p[0] * Math.sin(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateZ(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0] * Math.cos(rad) - p[1] * Math.sin(rad);\n  r[1] = p[0] * Math.sin(rad) + p[1] * Math.cos(rad);\n  r[2] = p[2]; //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Get the angle between two 3D vectors\n * @param {ReadonlyVec3} a The first operand\n * @param {ReadonlyVec3} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      bx = b[0],\n      by = b[1],\n      bz = b[2],\n      mag = Math.sqrt((ax * ax + ay * ay + az * az) * (bx * bx + by * by + bz * bz)),\n      cosine = mag && dot(a, b) / mag;\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec3 to zero\n *\n * @param {vec3} out the receiving vector\n * @returns {vec3} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\n}\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec3.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 3;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n    }\n\n    return a;\n  };\n}();","import * as glMatrix from \"./common.js\";\n/**\n * 4 Dimensional Vector\n * @module vec4\n */\n\n/**\n * Creates a new, empty vec4\n *\n * @returns {vec4} a new 4D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(4);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec4 initialized with values from an existing vector\n *\n * @param {ReadonlyVec4} a vector to clone\n * @returns {vec4} a new 4D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\n * Creates a new vec4 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {vec4} a new 4D vector\n */\n\nexport function fromValues(x, y, z, w) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n/**\n * Copy the values from one vec4 to another\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the source vector\n * @returns {vec4} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\n * Set the components of a vec4 to the given values\n *\n * @param {vec4} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {vec4} out\n */\n\nexport function set(out, x, y, z, w) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n/**\n * Adds two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  return out;\n}\n/**\n * Multiplies two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  out[3] = a[3] * b[3];\n  return out;\n}\n/**\n * Divides two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  out[3] = a[3] / b[3];\n  return out;\n}\n/**\n * Math.ceil the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to ceil\n * @returns {vec4} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  out[3] = Math.ceil(a[3]);\n  return out;\n}\n/**\n * Math.floor the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to floor\n * @returns {vec4} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  out[3] = Math.floor(a[3]);\n  return out;\n}\n/**\n * Returns the minimum of two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  out[3] = Math.min(a[3], b[3]);\n  return out;\n}\n/**\n * Returns the maximum of two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  out[3] = Math.max(a[3], b[3]);\n  return out;\n}\n/**\n * Math.round the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to round\n * @returns {vec4} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  out[3] = Math.round(a[3]);\n  return out;\n}\n/**\n * Scales a vec4 by a scalar number\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec4} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  return out;\n}\n/**\n * Adds two vec4's after scaling the second operand by a scalar value\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec4} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return Math.hypot(x, y, z, w);\n}\n/**\n * Calculates the squared euclidian distance between two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return x * x + y * y + z * z + w * w;\n}\n/**\n * Calculates the length of a vec4\n *\n * @param {ReadonlyVec4} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return Math.hypot(x, y, z, w);\n}\n/**\n * Calculates the squared length of a vec4\n *\n * @param {ReadonlyVec4} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return x * x + y * y + z * z + w * w;\n}\n/**\n * Negates the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to negate\n * @returns {vec4} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  out[3] = -a[3];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to invert\n * @returns {vec4} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  out[3] = 1.0 / a[3];\n  return out;\n}\n/**\n * Normalize a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to normalize\n * @returns {vec4} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  var len = x * x + y * y + z * z + w * w;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = x * len;\n  out[1] = y * len;\n  out[2] = z * len;\n  out[3] = w * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\n/**\n * Returns the cross-product of three vectors in a 4-dimensional space\n *\n * @param {ReadonlyVec4} result the receiving vector\n * @param {ReadonlyVec4} U the first vector\n * @param {ReadonlyVec4} V the second vector\n * @param {ReadonlyVec4} W the third vector\n * @returns {vec4} result\n */\n\nexport function cross(out, u, v, w) {\n  var A = v[0] * w[1] - v[1] * w[0],\n      B = v[0] * w[2] - v[2] * w[0],\n      C = v[0] * w[3] - v[3] * w[0],\n      D = v[1] * w[2] - v[2] * w[1],\n      E = v[1] * w[3] - v[3] * w[1],\n      F = v[2] * w[3] - v[3] * w[2];\n  var G = u[0];\n  var H = u[1];\n  var I = u[2];\n  var J = u[3];\n  out[0] = H * F - I * E + J * D;\n  out[1] = -(G * F) + I * C - J * B;\n  out[2] = G * E - H * C + J * A;\n  out[3] = -(G * D) + H * B - I * A;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec4} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  var aw = a[3];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  out[3] = aw + t * (b[3] - aw);\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec4} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec4} out\n */\n\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale; // Marsaglia, George. Choosing a Point from the Surface of a\n  // Sphere. Ann. Math. Statist. 43 (1972), no. 2, 645--646.\n  // http://projecteuclid.org/euclid.aoms/1177692644;\n\n  var v1, v2, v3, v4;\n  var s1, s2;\n\n  do {\n    v1 = glMatrix.RANDOM() * 2 - 1;\n    v2 = glMatrix.RANDOM() * 2 - 1;\n    s1 = v1 * v1 + v2 * v2;\n  } while (s1 >= 1);\n\n  do {\n    v3 = glMatrix.RANDOM() * 2 - 1;\n    v4 = glMatrix.RANDOM() * 2 - 1;\n    s2 = v3 * v3 + v4 * v4;\n  } while (s2 >= 1);\n\n  var d = Math.sqrt((1 - s1) / s2);\n  out[0] = scale * v1;\n  out[1] = scale * v2;\n  out[2] = scale * v3 * d;\n  out[3] = scale * v4 * d;\n  return out;\n}\n/**\n * Transforms the vec4 with a mat4.\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec4} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2],\n      w = a[3];\n  out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;\n  out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;\n  out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n  out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n  return out;\n}\n/**\n * Transforms the vec4 with a quat\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec4} out\n */\n\nexport function transformQuat(out, a, q) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3]; // calculate quat * vec\n\n  var ix = qw * x + qy * z - qz * y;\n  var iy = qw * y + qz * x - qx * z;\n  var iz = qw * z + qx * y - qy * x;\n  var iw = -qx * x - qy * y - qz * z; // calculate result * inverse quat\n\n  out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n  out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n  out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n  out[3] = a[3];\n  return out;\n}\n/**\n * Set the components of a vec4 to zero\n *\n * @param {vec4} out the receiving vector\n * @returns {vec4} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec4} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec4} a The first vector.\n * @param {ReadonlyVec4} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec4} a The first vector.\n * @param {ReadonlyVec4} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3));\n}\n/**\n * Alias for {@link vec4.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec4.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec4.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec4.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec4.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec4.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec4.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec4s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec4s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 4;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      vec[3] = a[i + 3];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n      a[i + 3] = vec[3];\n    }\n\n    return a;\n  };\n}();","import * as glMatrix from \"./common.js\";\nimport * as mat3 from \"./mat3.js\";\nimport * as vec3 from \"./vec3.js\";\nimport * as vec4 from \"./vec4.js\";\n/**\n * Quaternion in the format XYZW\n * @module quat\n */\n\n/**\n * Creates a new identity quat\n *\n * @returns {quat} a new quaternion\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(4);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n\n  out[3] = 1;\n  return out;\n}\n/**\n * Set a quat to the identity quaternion\n *\n * @param {quat} out the receiving quaternion\n * @returns {quat} out\n */\n\nexport function identity(out) {\n  out[0] = 0;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 1;\n  return out;\n}\n/**\n * Sets a quat from the given angle and rotation axis,\n * then returns it.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyVec3} axis the axis around which to rotate\n * @param {Number} rad the angle in radians\n * @returns {quat} out\n **/\n\nexport function setAxisAngle(out, axis, rad) {\n  rad = rad * 0.5;\n  var s = Math.sin(rad);\n  out[0] = s * axis[0];\n  out[1] = s * axis[1];\n  out[2] = s * axis[2];\n  out[3] = Math.cos(rad);\n  return out;\n}\n/**\n * Gets the rotation axis and angle for a given\n *  quaternion. If a quaternion is created with\n *  setAxisAngle, this method will return the same\n *  values as providied in the original parameter list\n *  OR functionally equivalent values.\n * Example: The quaternion formed by axis [0, 0, 1] and\n *  angle -90 is the same as the quaternion formed by\n *  [0, 0, 1] and 270. This method favors the latter.\n * @param  {vec3} out_axis  Vector receiving the axis of rotation\n * @param  {ReadonlyQuat} q     Quaternion to be decomposed\n * @return {Number}     Angle, in radians, of the rotation\n */\n\nexport function getAxisAngle(out_axis, q) {\n  var rad = Math.acos(q[3]) * 2.0;\n  var s = Math.sin(rad / 2.0);\n\n  if (s > glMatrix.EPSILON) {\n    out_axis[0] = q[0] / s;\n    out_axis[1] = q[1] / s;\n    out_axis[2] = q[2] / s;\n  } else {\n    // If s is zero, return any axis (no rotation - axis does not matter)\n    out_axis[0] = 1;\n    out_axis[1] = 0;\n    out_axis[2] = 0;\n  }\n\n  return rad;\n}\n/**\n * Gets the angular distance between two unit quaternions\n *\n * @param  {ReadonlyQuat} a     Origin unit quaternion\n * @param  {ReadonlyQuat} b     Destination unit quaternion\n * @return {Number}     Angle, in radians, between the two quaternions\n */\n\nexport function getAngle(a, b) {\n  var dotproduct = dot(a, b);\n  return Math.acos(2 * dotproduct * dotproduct - 1);\n}\n/**\n * Multiplies two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @returns {quat} out\n */\n\nexport function multiply(out, a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      aw = a[3];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2],\n      bw = b[3];\n  out[0] = ax * bw + aw * bx + ay * bz - az * by;\n  out[1] = ay * bw + aw * by + az * bx - ax * bz;\n  out[2] = az * bw + aw * bz + ax * by - ay * bx;\n  out[3] = aw * bw - ax * bx - ay * by - az * bz;\n  return out;\n}\n/**\n * Rotates a quaternion by the given angle about the X axis\n *\n * @param {quat} out quat receiving operation result\n * @param {ReadonlyQuat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\n\nexport function rotateX(out, a, rad) {\n  rad *= 0.5;\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      aw = a[3];\n  var bx = Math.sin(rad),\n      bw = Math.cos(rad);\n  out[0] = ax * bw + aw * bx;\n  out[1] = ay * bw + az * bx;\n  out[2] = az * bw - ay * bx;\n  out[3] = aw * bw - ax * bx;\n  return out;\n}\n/**\n * Rotates a quaternion by the given angle about the Y axis\n *\n * @param {quat} out quat receiving operation result\n * @param {ReadonlyQuat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\n\nexport function rotateY(out, a, rad) {\n  rad *= 0.5;\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      aw = a[3];\n  var by = Math.sin(rad),\n      bw = Math.cos(rad);\n  out[0] = ax * bw - az * by;\n  out[1] = ay * bw + aw * by;\n  out[2] = az * bw + ax * by;\n  out[3] = aw * bw - ay * by;\n  return out;\n}\n/**\n * Rotates a quaternion by the given angle about the Z axis\n *\n * @param {quat} out quat receiving operation result\n * @param {ReadonlyQuat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\n\nexport function rotateZ(out, a, rad) {\n  rad *= 0.5;\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      aw = a[3];\n  var bz = Math.sin(rad),\n      bw = Math.cos(rad);\n  out[0] = ax * bw + ay * bz;\n  out[1] = ay * bw - ax * bz;\n  out[2] = az * bw + aw * bz;\n  out[3] = aw * bw - az * bz;\n  return out;\n}\n/**\n * Calculates the W component of a quat from the X, Y, and Z components.\n * Assumes that quaternion is 1 unit in length.\n * Any existing W component will be ignored.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate W component of\n * @returns {quat} out\n */\n\nexport function calculateW(out, a) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = Math.sqrt(Math.abs(1.0 - x * x - y * y - z * z));\n  return out;\n}\n/**\n * Calculate the exponential of a unit quaternion.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate the exponential of\n * @returns {quat} out\n */\n\nexport function exp(out, a) {\n  var x = a[0],\n      y = a[1],\n      z = a[2],\n      w = a[3];\n  var r = Math.sqrt(x * x + y * y + z * z);\n  var et = Math.exp(w);\n  var s = r > 0 ? et * Math.sin(r) / r : 0;\n  out[0] = x * s;\n  out[1] = y * s;\n  out[2] = z * s;\n  out[3] = et * Math.cos(r);\n  return out;\n}\n/**\n * Calculate the natural logarithm of a unit quaternion.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate the exponential of\n * @returns {quat} out\n */\n\nexport function ln(out, a) {\n  var x = a[0],\n      y = a[1],\n      z = a[2],\n      w = a[3];\n  var r = Math.sqrt(x * x + y * y + z * z);\n  var t = r > 0 ? Math.atan2(r, w) / r : 0;\n  out[0] = x * t;\n  out[1] = y * t;\n  out[2] = z * t;\n  out[3] = 0.5 * Math.log(x * x + y * y + z * z + w * w);\n  return out;\n}\n/**\n * Calculate the scalar power of a unit quaternion.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate the exponential of\n * @param {Number} b amount to scale the quaternion by\n * @returns {quat} out\n */\n\nexport function pow(out, a, b) {\n  ln(out, a);\n  scale(out, out, b);\n  exp(out, out);\n  return out;\n}\n/**\n * Performs a spherical linear interpolation between two quat\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n */\n\nexport function slerp(out, a, b, t) {\n  // benchmarks:\n  //    http://jsperf.com/quaternion-slerp-implementations\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      aw = a[3];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2],\n      bw = b[3];\n  var omega, cosom, sinom, scale0, scale1; // calc cosine\n\n  cosom = ax * bx + ay * by + az * bz + aw * bw; // adjust signs (if necessary)\n\n  if (cosom < 0.0) {\n    cosom = -cosom;\n    bx = -bx;\n    by = -by;\n    bz = -bz;\n    bw = -bw;\n  } // calculate coefficients\n\n\n  if (1.0 - cosom > glMatrix.EPSILON) {\n    // standard case (slerp)\n    omega = Math.acos(cosom);\n    sinom = Math.sin(omega);\n    scale0 = Math.sin((1.0 - t) * omega) / sinom;\n    scale1 = Math.sin(t * omega) / sinom;\n  } else {\n    // \"from\" and \"to\" quaternions are very close\n    //  ... so we can do a linear interpolation\n    scale0 = 1.0 - t;\n    scale1 = t;\n  } // calculate final values\n\n\n  out[0] = scale0 * ax + scale1 * bx;\n  out[1] = scale0 * ay + scale1 * by;\n  out[2] = scale0 * az + scale1 * bz;\n  out[3] = scale0 * aw + scale1 * bw;\n  return out;\n}\n/**\n * Generates a random unit quaternion\n *\n * @param {quat} out the receiving quaternion\n * @returns {quat} out\n */\n\nexport function random(out) {\n  // Implementation of http://planning.cs.uiuc.edu/node198.html\n  // TODO: Calling random 3 times is probably not the fastest solution\n  var u1 = glMatrix.RANDOM();\n  var u2 = glMatrix.RANDOM();\n  var u3 = glMatrix.RANDOM();\n  var sqrt1MinusU1 = Math.sqrt(1 - u1);\n  var sqrtU1 = Math.sqrt(u1);\n  out[0] = sqrt1MinusU1 * Math.sin(2.0 * Math.PI * u2);\n  out[1] = sqrt1MinusU1 * Math.cos(2.0 * Math.PI * u2);\n  out[2] = sqrtU1 * Math.sin(2.0 * Math.PI * u3);\n  out[3] = sqrtU1 * Math.cos(2.0 * Math.PI * u3);\n  return out;\n}\n/**\n * Calculates the inverse of a quat\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate inverse of\n * @returns {quat} out\n */\n\nexport function invert(out, a) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var dot = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;\n  var invDot = dot ? 1.0 / dot : 0; // TODO: Would be faster to return [0,0,0,0] immediately if dot == 0\n\n  out[0] = -a0 * invDot;\n  out[1] = -a1 * invDot;\n  out[2] = -a2 * invDot;\n  out[3] = a3 * invDot;\n  return out;\n}\n/**\n * Calculates the conjugate of a quat\n * If the quaternion is normalized, this function is faster than quat.inverse and produces the same result.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate conjugate of\n * @returns {quat} out\n */\n\nexport function conjugate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\n * Creates a quaternion from the given 3x3 rotation matrix.\n *\n * NOTE: The resultant quaternion is not normalized, so you should be sure\n * to renormalize the quaternion yourself where necessary.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyMat3} m rotation matrix\n * @returns {quat} out\n * @function\n */\n\nexport function fromMat3(out, m) {\n  // Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes\n  // article \"Quaternion Calculus and Fast Animation\".\n  var fTrace = m[0] + m[4] + m[8];\n  var fRoot;\n\n  if (fTrace > 0.0) {\n    // |w| > 1/2, may as well choose w > 1/2\n    fRoot = Math.sqrt(fTrace + 1.0); // 2w\n\n    out[3] = 0.5 * fRoot;\n    fRoot = 0.5 / fRoot; // 1/(4w)\n\n    out[0] = (m[5] - m[7]) * fRoot;\n    out[1] = (m[6] - m[2]) * fRoot;\n    out[2] = (m[1] - m[3]) * fRoot;\n  } else {\n    // |w| <= 1/2\n    var i = 0;\n    if (m[4] > m[0]) i = 1;\n    if (m[8] > m[i * 3 + i]) i = 2;\n    var j = (i + 1) % 3;\n    var k = (i + 2) % 3;\n    fRoot = Math.sqrt(m[i * 3 + i] - m[j * 3 + j] - m[k * 3 + k] + 1.0);\n    out[i] = 0.5 * fRoot;\n    fRoot = 0.5 / fRoot;\n    out[3] = (m[j * 3 + k] - m[k * 3 + j]) * fRoot;\n    out[j] = (m[j * 3 + i] + m[i * 3 + j]) * fRoot;\n    out[k] = (m[k * 3 + i] + m[i * 3 + k]) * fRoot;\n  }\n\n  return out;\n}\n/**\n * Creates a quaternion from the given euler angle x, y, z using the provided intrinsic order for the conversion.\n *\n * @param {quat} out the receiving quaternion\n * @param {x} x Angle to rotate around X axis in degrees.\n * @param {y} y Angle to rotate around Y axis in degrees.\n * @param {z} z Angle to rotate around Z axis in degrees.\n * @param {'zyx'|'xyz'|'yxz'|'yzx'|'zxy'|'zyx'} order Intrinsic order for conversion, default is zyx.\n * @returns {quat} out\n * @function\n */\n\nexport function fromEuler(out, x, y, z) {\n  var order = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : glMatrix.ANGLE_ORDER;\n  var halfToRad = Math.PI / 360;\n  x *= halfToRad;\n  z *= halfToRad;\n  y *= halfToRad;\n  var sx = Math.sin(x);\n  var cx = Math.cos(x);\n  var sy = Math.sin(y);\n  var cy = Math.cos(y);\n  var sz = Math.sin(z);\n  var cz = Math.cos(z);\n\n  switch (order) {\n    case \"xyz\":\n      out[0] = sx * cy * cz + cx * sy * sz;\n      out[1] = cx * sy * cz - sx * cy * sz;\n      out[2] = cx * cy * sz + sx * sy * cz;\n      out[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case \"xzy\":\n      out[0] = sx * cy * cz - cx * sy * sz;\n      out[1] = cx * sy * cz - sx * cy * sz;\n      out[2] = cx * cy * sz + sx * sy * cz;\n      out[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    case \"yxz\":\n      out[0] = sx * cy * cz + cx * sy * sz;\n      out[1] = cx * sy * cz - sx * cy * sz;\n      out[2] = cx * cy * sz - sx * sy * cz;\n      out[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    case \"yzx\":\n      out[0] = sx * cy * cz + cx * sy * sz;\n      out[1] = cx * sy * cz + sx * cy * sz;\n      out[2] = cx * cy * sz - sx * sy * cz;\n      out[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case \"zxy\":\n      out[0] = sx * cy * cz - cx * sy * sz;\n      out[1] = cx * sy * cz + sx * cy * sz;\n      out[2] = cx * cy * sz + sx * sy * cz;\n      out[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case \"zyx\":\n      out[0] = sx * cy * cz - cx * sy * sz;\n      out[1] = cx * sy * cz + sx * cy * sz;\n      out[2] = cx * cy * sz - sx * sy * cz;\n      out[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    default:\n      throw new Error('Unknown angle order ' + order);\n  }\n\n  return out;\n}\n/**\n * Returns a string representation of a quaternion\n *\n * @param {ReadonlyQuat} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"quat(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \")\";\n}\n/**\n * Creates a new quat initialized with values from an existing quaternion\n *\n * @param {ReadonlyQuat} a quaternion to clone\n * @returns {quat} a new quaternion\n * @function\n */\n\nexport var clone = vec4.clone;\n/**\n * Creates a new quat initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {quat} a new quaternion\n * @function\n */\n\nexport var fromValues = vec4.fromValues;\n/**\n * Copy the values from one quat to another\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the source quaternion\n * @returns {quat} out\n * @function\n */\n\nexport var copy = vec4.copy;\n/**\n * Set the components of a quat to the given values\n *\n * @param {quat} out the receiving quaternion\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {quat} out\n * @function\n */\n\nexport var set = vec4.set;\n/**\n * Adds two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @returns {quat} out\n * @function\n */\n\nexport var add = vec4.add;\n/**\n * Alias for {@link quat.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Scales a quat by a scalar number\n *\n * @param {quat} out the receiving vector\n * @param {ReadonlyQuat} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {quat} out\n * @function\n */\n\nexport var scale = vec4.scale;\n/**\n * Calculates the dot product of two quat's\n *\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @returns {Number} dot product of a and b\n * @function\n */\n\nexport var dot = vec4.dot;\n/**\n * Performs a linear interpolation between two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n * @function\n */\n\nexport var lerp = vec4.lerp;\n/**\n * Calculates the length of a quat\n *\n * @param {ReadonlyQuat} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport var length = vec4.length;\n/**\n * Alias for {@link quat.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Calculates the squared length of a quat\n *\n * @param {ReadonlyQuat} a vector to calculate squared length of\n * @returns {Number} squared length of a\n * @function\n */\n\nexport var squaredLength = vec4.squaredLength;\n/**\n * Alias for {@link quat.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Normalize a quat\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quaternion to normalize\n * @returns {quat} out\n * @function\n */\n\nexport var normalize = vec4.normalize;\n/**\n * Returns whether or not the quaternions have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyQuat} a The first quaternion.\n * @param {ReadonlyQuat} b The second quaternion.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport var exactEquals = vec4.exactEquals;\n/**\n * Returns whether or not the quaternions point approximately to the same direction.\n *\n * Both quaternions are assumed to be unit length.\n *\n * @param {ReadonlyQuat} a The first unit quaternion.\n * @param {ReadonlyQuat} b The second unit quaternion.\n * @returns {Boolean} True if the quaternions are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  return Math.abs(vec4.dot(a, b)) >= 1 - glMatrix.EPSILON;\n}\n/**\n * Sets a quaternion to represent the shortest rotation from one\n * vector to another.\n *\n * Both vectors are assumed to be unit length.\n *\n * @param {quat} out the receiving quaternion.\n * @param {ReadonlyVec3} a the initial vector\n * @param {ReadonlyVec3} b the destination vector\n * @returns {quat} out\n */\n\nexport var rotationTo = function () {\n  var tmpvec3 = vec3.create();\n  var xUnitVec3 = vec3.fromValues(1, 0, 0);\n  var yUnitVec3 = vec3.fromValues(0, 1, 0);\n  return function (out, a, b) {\n    var dot = vec3.dot(a, b);\n\n    if (dot < -0.999999) {\n      vec3.cross(tmpvec3, xUnitVec3, a);\n      if (vec3.len(tmpvec3) < 0.000001) vec3.cross(tmpvec3, yUnitVec3, a);\n      vec3.normalize(tmpvec3, tmpvec3);\n      setAxisAngle(out, tmpvec3, Math.PI);\n      return out;\n    } else if (dot > 0.999999) {\n      out[0] = 0;\n      out[1] = 0;\n      out[2] = 0;\n      out[3] = 1;\n      return out;\n    } else {\n      vec3.cross(tmpvec3, a, b);\n      out[0] = tmpvec3[0];\n      out[1] = tmpvec3[1];\n      out[2] = tmpvec3[2];\n      out[3] = 1 + dot;\n      return normalize(out, out);\n    }\n  };\n}();\n/**\n * Performs a spherical linear interpolation with two control points\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @param {ReadonlyQuat} c the third operand\n * @param {ReadonlyQuat} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n */\n\nexport var sqlerp = function () {\n  var temp1 = create();\n  var temp2 = create();\n  return function (out, a, b, c, d, t) {\n    slerp(temp1, a, d, t);\n    slerp(temp2, b, c, t);\n    slerp(out, temp1, temp2, 2 * t * (1 - t));\n    return out;\n  };\n}();\n/**\n * Sets the specified quaternion with values corresponding to the given\n * axes. Each axis is a vec3 and is expected to be unit length and\n * perpendicular to all other specified axes.\n *\n * @param {ReadonlyVec3} view  the vector representing the viewing direction\n * @param {ReadonlyVec3} right the vector representing the local \"right\" direction\n * @param {ReadonlyVec3} up    the vector representing the local \"up\" direction\n * @returns {quat} out\n */\n\nexport var setAxes = function () {\n  var matr = mat3.create();\n  return function (out, view, right, up) {\n    matr[0] = right[0];\n    matr[3] = right[1];\n    matr[6] = right[2];\n    matr[1] = up[0];\n    matr[4] = up[1];\n    matr[7] = up[2];\n    matr[2] = -view[0];\n    matr[5] = -view[1];\n    matr[8] = -view[2];\n    return normalize(out, fromMat3(out, matr));\n  };\n}();","import * as glMatrix from \"./common.js\";\n/**\n * 2 Dimensional Vector\n * @module vec2\n */\n\n/**\n * Creates a new, empty vec2\n *\n * @returns {vec2} a new 2D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(2);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec2 initialized with values from an existing vector\n *\n * @param {ReadonlyVec2} a vector to clone\n * @returns {vec2} a new 2D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n/**\n * Creates a new vec2 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} a new 2D vector\n */\n\nexport function fromValues(x, y) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n/**\n * Copy the values from one vec2 to another\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the source vector\n * @returns {vec2} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n/**\n * Set the components of a vec2 to the given values\n *\n * @param {vec2} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} out\n */\n\nexport function set(out, x, y) {\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n/**\n * Adds two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  return out;\n}\n/**\n * Multiplies two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  return out;\n}\n/**\n * Divides two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  return out;\n}\n/**\n * Math.ceil the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to ceil\n * @returns {vec2} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  return out;\n}\n/**\n * Math.floor the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to floor\n * @returns {vec2} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  return out;\n}\n/**\n * Returns the minimum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  return out;\n}\n/**\n * Returns the maximum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  return out;\n}\n/**\n * Math.round the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to round\n * @returns {vec2} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  return out;\n}\n/**\n * Scales a vec2 by a scalar number\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec2} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  return out;\n}\n/**\n * Adds two vec2's after scaling the second operand by a scalar value\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec2} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0],\n      y = b[1] - a[1];\n  return Math.hypot(x, y);\n}\n/**\n * Calculates the squared euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0],\n      y = b[1] - a[1];\n  return x * x + y * y;\n}\n/**\n * Calculates the length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0],\n      y = a[1];\n  return Math.hypot(x, y);\n}\n/**\n * Calculates the squared length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0],\n      y = a[1];\n  return x * x + y * y;\n}\n/**\n * Negates the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to negate\n * @returns {vec2} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to invert\n * @returns {vec2} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  return out;\n}\n/**\n * Normalize a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to normalize\n * @returns {vec2} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0],\n      y = a[1];\n  var len = x * x + y * y;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1];\n}\n/**\n * Computes the cross product of two vec2's\n * Note that the cross product must by definition produce a 3D vector\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var z = a[0] * b[1] - a[1] * b[0];\n  out[0] = out[1] = 0;\n  out[2] = z;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec2} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0],\n      ay = a[1];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec2} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec2} out\n */\n\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  out[0] = Math.cos(r) * scale;\n  out[1] = Math.sin(r) * scale;\n  return out;\n}\n/**\n * Transforms the vec2 with a mat2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat2(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[2] * y;\n  out[1] = m[1] * x + m[3] * y;\n  return out;\n}\n/**\n * Transforms the vec2 with a mat2d\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2d} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat2d(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[2] * y + m[4];\n  out[1] = m[1] * x + m[3] * y + m[5];\n  return out;\n}\n/**\n * Transforms the vec2 with a mat3\n * 3rd vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat3} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[3] * y + m[6];\n  out[1] = m[1] * x + m[4] * y + m[7];\n  return out;\n}\n/**\n * Transforms the vec2 with a mat4\n * 3rd vector component is implicitly '0'\n * 4th vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0];\n  var y = a[1];\n  out[0] = m[0] * x + m[4] * y + m[12];\n  out[1] = m[1] * x + m[5] * y + m[13];\n  return out;\n}\n/**\n * Rotate a 2D vector\n * @param {vec2} out The receiving vec2\n * @param {ReadonlyVec2} a The vec2 point to rotate\n * @param {ReadonlyVec2} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec2} out\n */\n\nexport function rotate(out, a, b, rad) {\n  //Translate point to the origin\n  var p0 = a[0] - b[0],\n      p1 = a[1] - b[1],\n      sinC = Math.sin(rad),\n      cosC = Math.cos(rad); //perform rotation and translate to correct position\n\n  out[0] = p0 * cosC - p1 * sinC + b[0];\n  out[1] = p0 * sinC + p1 * cosC + b[1];\n  return out;\n}\n/**\n * Get the angle between two 2D vectors\n * @param {ReadonlyVec2} a The first operand\n * @param {ReadonlyVec2} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var x1 = a[0],\n      y1 = a[1],\n      x2 = b[0],\n      y2 = b[1],\n      // mag is the product of the magnitudes of a and b\n  mag = Math.sqrt((x1 * x1 + y1 * y1) * (x2 * x2 + y2 * y2)),\n      // mag &&.. short circuits if mag == 0\n  cosine = mag && (x1 * x2 + y1 * y2) / mag; // Math.min(Math.max(cosine, -1), 1) clamps the cosine between -1 and 1\n\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec2 to zero\n *\n * @param {vec2} out the receiving vector\n * @returns {vec2} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec2} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec2(\" + a[0] + \", \" + a[1] + \")\";\n}\n/**\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1];\n  var b0 = b[0],\n      b1 = b[1];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1));\n}\n/**\n * Alias for {@link vec2.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec2.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec2.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec2.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec2.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec2.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec2.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec2s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 2;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n    }\n\n    return a;\n  };\n}();","import { mat3, vec2 } from '../../lib/gl-matrix';\n\ndeclare type Landmark = {\n\tzoom: number,\n\tx: number,\n\ty: number,\n\trotation: number,\n\tviewportX: number,\n\tviewportY: number,\n};\n\nexport class Camera\n{\n\t#x: number = 0;\n\t#y: number = 0;\n\t#rotation: number = 0;\n\t#zoom: number = 1;\n\t#width: number = 0;\n\t#height: number = 0;\n\t#matrix: Float32Array = mat3.create();\n\t#projectionMatrix: Float32Array = mat3.create();\n\t#viewMatrix: Float32Array = mat3.create();\n\t#viewProjectionMatrix: Float32Array = mat3.create();\n\t#viewProjectionMatrixInv: Float32Array = mat3.create();\n\n\t#changeCallback: (...args: any) => void | null = null;\n\n\tconstructor(options)\n\t{\n\t\tconst {\n\t\t\twidth,\n\t\t\theight,\n\t\t\tonChangeCallback,\n\t\t} = options;\n\n\t\tthis.#changeCallback = onChangeCallback;\n\t\tthis.projection(width, height);\n\t\tthis.updateMatrix();\n\t\tthis.#onChangedTransformParams({ width, height });\n\t}\n\n\tget projectionMatrix(): Float32Array\n\t{\n\t\treturn this.#projectionMatrix;\n\t}\n\n\tget viewMatrix(): Float32Array\n\t{\n\t\treturn this.#viewMatrix;\n\t}\n\n\tget viewProjectionMatrix(): Float32Array\n\t{\n\t\treturn this.#viewProjectionMatrix;\n\t}\n\n\tget viewProjectionMatrixInv(): Float32Array\n\t{\n\t\treturn this.#viewProjectionMatrixInv;\n\t}\n\n\tget matrix(): Float32Array\n\t{\n\t\treturn this.#matrix;\n\t}\n\n\tget zoom(): number\n\t{\n\t\treturn this.#zoom;\n\t}\n\n\tset zoom(zoom: number): void\n\t{\n\t\tif (this.#zoom !== zoom)\n\t\t{\n\t\t\tthis.#zoom = zoom;\n\t\t\tthis.#onChangedTransformParams({ zoom });\n\t\t\tthis.updateMatrix();\n\t\t}\n\t}\n\n\tget x(): number\n\t{\n\t\treturn this.#x;\n\t}\n\n\tset x(x: number): void\n\t{\n\t\tif (this.#x !== x)\n\t\t{\n\t\t\tthis.#x = x;\n\t\t\tthis.#onChangedTransformParams({ x });\n\t\t\tthis.updateMatrix();\n\t\t}\n\t}\n\n\tget y(): number\n\t{\n\t\treturn this.#y;\n\t}\n\n\tset y(y: number): void\n\t{\n\t\tif (this.#y !== y)\n\t\t{\n\t\t\tthis.#y = y;\n\t\t\tthis.#onChangedTransformParams({ y });\n\t\t\tthis.updateMatrix();\n\t\t}\n\t}\n\n\tget rotation(): number\n\t{\n\t\treturn this.#rotation;\n\t}\n\n\tset rotation(rotation: number): void\n\t{\n\t\tif (this.#rotation !== rotation)\n\t\t{\n\t\t\tthis.#rotation = rotation;\n\t\t\tthis.updateMatrix();\n\t\t}\n\t}\n\n\tget width(): number\n\t{\n\t\treturn this.#width;\n\t}\n\n\tget height(): number\n\t{\n\t\treturn this.#height;\n\t}\n\n\tsetChangeTransformCallback(callback: ({ x: number, y: number, zoom: number }) => any): void\n\t{\n\t\tthis.#changeCallback = callback;\n\t}\n\n\t#onChangedTransformParams(params: {...}): void\n\t{\n\t\tthis.#changeCallback({\n\t\t\tx: this.#x,\n\t\t\ty: this.#y,\n\t\t\tzoom: this.#zoom,\n\t\t\twidth: this.#width,\n\t\t\theight: this.#height,\n\t\t\t...params,\n\t\t});\n\t}\n\n\tclone(width = null, height = null): Camera\n\t{\n\t\tconst camera = new Camera({\n\t\t\twidth: width || this.#width,\n\t\t\theight: height || this.#height,\n\t\t\tonChangeCallback: this.#changeCallback,\n\t\t});\n\t\tcamera.#x = this.#x;\n\t\tcamera.#y = this.#y;\n\t\tcamera.#zoom = this.#zoom;\n\t\tcamera.#rotation = this.#rotation;\n\t\tcamera.updateMatrix();\n\n\t\treturn camera;\n\t}\n\n\tprojection(width, height): void\n\t{\n\t\tthis.#width = width;\n\t\tthis.#height = height;\n\t\tmat3.projection(this.#projectionMatrix, width, height);\n\t\tthis.updateViewProjectionMatrix();\n\t}\n\n\tupdateMatrix(): void\n\t{\n\t\tconst zoomScale = 1 / this.#zoom;\n\t\tmat3.identity(this.#matrix);\n\t\tmat3.translate(this.#matrix, this.#matrix, [this.#x, this.#y]);\n\t\tmat3.rotate(this.#matrix, this.#matrix, this.#rotation);\n\t\tmat3.scale(this.#matrix, this.#matrix, [zoomScale, zoomScale]);\n\t\tmat3.invert(this.#viewMatrix, this.#matrix);\n\t\tthis.updateViewProjectionMatrix();\n\t}\n\n\tupdateViewProjectionMatrix(): void\n\t{\n\t\tmat3.multiply(\n\t\t\tthis.#viewProjectionMatrix,\n\t\t\tthis.#projectionMatrix,\n\t\t\tthis.#viewMatrix,\n\t\t);\n\t\tmat3.invert(this.#viewProjectionMatrixInv, this.#viewProjectionMatrix);\n\t}\n\n\tcreateLandmark(params: Partial<Landmark> = {}): Landmark\n\t{\n\t\treturn {\n\t\t\tzoom: this.#zoom,\n\t\t\tx: this.#x,\n\t\t\ty: this.#y,\n\t\t\trotation: this.#rotation,\n\t\t\t...params,\n\t\t};\n\t}\n\n\tviewportToCanvas(\n\t\t{ x, y }: { x: number, y: number },\n\t\tcamera: Camera,\n\t): { x: number, y: number }\n\t{\n\t\tconst { width, height, viewProjectionMatrixInv } = camera || this;\n\t\tconst canvas = vec2.transformMat3(\n\t\t\tvec2.create(),\n\t\t\t[(x / width) * 2 - 1, (1 - y / height) * 2 - 1],\n\t\t\tviewProjectionMatrixInv,\n\t\t);\n\n\t\treturn { x: canvas[0], y: canvas[1] };\n\t}\n\n\tapplyLandmark(landmark: Landmark): void\n\t{\n\t\tconst { x, y, zoom, rotation, viewportX, viewportY } = landmark;\n\t\tconst useFixedViewport = viewportX || viewportY;\n\t\tlet preZoomX = 0;\n\t\tlet preZoomY = 0;\n\n\t\tif (useFixedViewport)\n\t\t{\n\t\t\tconst canvas = this.viewportToCanvas({\n\t\t\t\tx: viewportX,\n\t\t\t\ty: viewportY,\n\t\t\t});\n\t\t\tpreZoomX = canvas.x;\n\t\t\tpreZoomY = canvas.y;\n\t\t}\n\n\t\tthis.#zoom = zoom;\n\t\tthis.#rotation = rotation;\n\t\tthis.#x = x;\n\t\tthis.#y = y;\n\t\tthis.updateMatrix();\n\t\tthis.#onChangedTransformParams({\n\t\t\tx: this.#x,\n\t\t\ty: this.#y,\n\t\t\tzoom: this.#zoom,\n\t\t});\n\n\t\tif (useFixedViewport)\n\t\t{\n\t\t\tconst { x: postZoomX, y: postZoomY } = this.viewportToCanvas({\n\t\t\t\tx: viewportX,\n\t\t\t\ty: viewportY,\n\t\t\t});\n\t\t\tthis.#x += preZoomX - postZoomX;\n\t\t\tthis.#y += preZoomY - postZoomY;\n\t\t\tthis.updateMatrix();\n\t\t\tthis.#onChangedTransformParams({\n\t\t\t\tx: this.#x,\n\t\t\t\ty: this.#y,\n\t\t\t\tzoom: this.#zoom,\n\t\t\t});\n\t\t}\n\t}\n}\n","import { ref } from 'ui.vue3';\nimport { mat3, vec2 } from '../../lib/gl-matrix';\nimport { Camera } from './camera';\n\nexport class Canvas\n{\n\t#canvas: HTMLCanvasElement | null = null;\n\t#dpr: number = window.devicePixelRatio || 1;\n\n\t#width: number = 0;\n\t#height: number = 0;\n\n\t#minZoom: number = 0.02;\n\t#maxZoom: number = 4;\n\n\t#camera: Camera | null = null;\n\t#canvasStyleInstance = null;\n\n\t#startInvertViewProjectionMatrix: Float32Array = mat3.create();\n\t#startCameraX: number = 0;\n\t#startCameraY: number = 0;\n\n\t#startPos: Float32Array = vec2.create();\n\n\t#resizeObserver: ResizeObserver | null = null;\n\n\ttransform = ref({\n\t\tx: 0,\n\t\ty: 0,\n\t\tzoom: 0,\n\t});\n\n\tconstructor(options)\n\t{\n\t\tconst {\n\t\t\tcanvas,\n\t\t\tcanvasStyle,\n\t\t\tminZoom,\n\t\t\tmaxZoom,\n\t\t} = options;\n\n\t\tthis.#minZoom = minZoom;\n\t\tthis.#maxZoom = maxZoom;\n\n\t\tthis.#initCanvas(canvas);\n\t\tthis.#initCamera();\n\t\tthis.#initCanvasStyle(canvasStyle);\n\t\tthis.#initResizeObserver();\n\t}\n\n\tget viewMatrix(): Float32Array\n\t{\n\t\treturn this.#camera?.viewMatrix ?? [];\n\t}\n\n\tget camera(): typeof Camera\n\t{\n\t\treturn this.#camera;\n\t}\n\n\t#initCanvas(canvas: HTMLCanvasElement): void\n\t{\n\t\tconst { width, height } = canvas.getBoundingClientRect();\n\n\t\tthis.#canvas = canvas;\n\t\tthis.#canvas.width = width * this.#dpr;\n\t\tthis.#canvas.height = height * this.#dpr;\n\t\tthis.#width = this.#canvas.width;\n\t\tthis.#height = this.#canvas.height;\n\t}\n\n\t#initCamera(): void\n\t{\n\t\tthis.#camera = new Camera({\n\t\t\twidth: this.#width / this.#dpr,\n\t\t\theight: this.#height / this.#dpr,\n\t\t\tonChangeCallback: ({ x, y, zoom }) => {\n\t\t\t\tthis.transform.x = x;\n\t\t\t\tthis.transform.y = y;\n\t\t\t\tthis.transform.zoom = zoom;\n\t\t\t},\n\t\t});\n\t}\n\n\t#initCanvasStyle(canvasStyle): void\n\t{\n\t\tif (canvasStyle)\n\t\t{\n\t\t\tconst StyleInstance = canvasStyle.instance;\n\t\t\tthis.#canvasStyleInstance = new StyleInstance(this.#canvas, canvasStyle.options);\n\t\t}\n\t}\n\n\t#initResizeObserver(): void\n\t{\n\t\tthis.#resizeObserver = new ResizeObserver((entries) => {\n\t\t\tfor (const entry of entries)\n\t\t\t{\n\t\t\t\tthis.#camera = this.#camera.clone(\n\t\t\t\t\tentry.contentRect.width,\n\t\t\t\t\tentry.contentRect.height,\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\tthis.#resizeObserver.observe(this.#canvas);\n\t}\n\n\tclientToViewport({ x, y }: { x: number, y: number }): { x: number, y: number }\n\t{\n\t\tconst { left, top } = this.#canvas.getBoundingClientRect();\n\n\t\treturn { x: x - left, y: y - top };\n\t}\n\n\tviewportToClient({ x, y }: { x: number, y: number }): { x: number, y: number }\n\t{\n\t\tconst { left, top } = this.#canvas.getBoundingClientRect();\n\n\t\treturn { x: x + left, y: y + top };\n\t}\n\n\trender(): void\n\t{\n\t\tthis.#canvasStyleInstance?.render({\n\t\t\tprojectionMatrix: this.#camera.projectionMatrix,\n\t\t\tviewMatrix: this.#camera.viewMatrix,\n\t\t\tviewProjectionMatrixInv: this.#camera.viewProjectionMatrixInv,\n\t\t\tzoomScale: this.#camera.zoom,\n\t\t});\n\t}\n\n\tsetCamera(params): void\n\t{\n\t\tthis.#camera.applyLandmark(\n\t\t\tthis.#camera.createLandmark({\n\t\t\t\t...params,\n\t\t\t}),\n\t\t);\n\t}\n\n\t#setCameraZoom(zoomStep: number): void\n\t{\n\t\tconst zoom: number = Number((this.#camera.zoom + zoomStep).toFixed(1));\n\n\t\tif (zoom < this.#minZoom || zoom > this.#maxZoom)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#camera.applyLandmark(\n\t\t\tthis.#camera.createLandmark({\n\t\t\t\tx: this.#camera.x,\n\t\t\t\ty: this.#camera.y,\n\t\t\t\tviewportX: this.#camera.width / 2,\n\t\t\t\tviewportY: this.#camera.height / 2,\n\t\t\t\tzoom,\n\t\t\t}),\n\t\t);\n\t}\n\n\tzoomIn(zoomStep: number): void\n\t{\n\t\tthis.#setCameraZoom(zoomStep);\n\t}\n\n\tzoomOut(zoomStep: number): void\n\t{\n\t\tthis.#setCameraZoom(zoomStep * -1);\n\t}\n\n\tsetCameraZoomByWheel(event: MouseEvent, zoomChange: number = 0): void\n\t{\n\t\tconst newZoom = Math.max(\n\t\t\tthis.#minZoom,\n\t\t\tMath.min(this.#maxZoom, (this.#camera.zoom + zoomChange) * 2 ** (event.deltaY * -0.01)),\n\t\t);\n\n\t\tconst viewport = this.clientToViewport({\n\t\t\tx: event.clientX,\n\t\t\ty: event.clientY,\n\t\t});\n\n\t\tthis.#camera.applyLandmark(\n\t\t\tthis.#camera.createLandmark({\n\t\t\t\tviewportX: viewport.x,\n\t\t\t\tviewportY: viewport.y,\n\t\t\t\tzoom: newZoom,\n\t\t\t}),\n\t\t);\n\t}\n\n\tsetCameraPositionByWheel(event: MouseEvent): void\n\t{\n\t\tthis.#camera.x += event.deltaX / this.#camera.zoom;\n\t\tthis.#camera.y += event.deltaY / this.#camera.zoom;\n\t}\n\n\t#getClipSpaceMousePosition(event: MouseEvent): Array<number, number>\n\t{\n\t\tconst { left, top } = this.#canvas.getBoundingClientRect();\n\t\tconst cssX: number = event.clientX - left;\n\t\tconst cssY: number = event.clientY - top;\n\n\t\tconst normalizedX: number = cssX / this.#canvas.clientWidth || this.#canvas.width / this.#dpr;\n\t\tconst normalizedY: number = cssY / this.#canvas.clientHeight || this.#canvas.height / this.#dpr;\n\n\t\tconst clipX: number = normalizedX * 2 - 1;\n\t\tconst clipY: number = normalizedY * -2 + 1;\n\n\t\treturn [clipX, clipY];\n\t}\n\n\tsetCameraPositionByMouseDown(event: MouseEvent): void\n\t{\n\t\tmat3.copy(\n\t\t\tthis.#startInvertViewProjectionMatrix,\n\t\t\tthis.#camera.viewProjectionMatrixInv,\n\t\t);\n\t\tthis.#startCameraX = this.#camera.x;\n\t\tthis.#startCameraY = this.#camera.y;\n\t\tvec2.transformMat3(\n\t\t\tthis.#startPos,\n\t\t\tthis.#getClipSpaceMousePosition(event),\n\t\t\tthis.#startInvertViewProjectionMatrix,\n\t\t);\n\t}\n\n\tsetCameraPositionByMouseMove(event: MouseEvent): void\n\t{\n\t\tconst pos = vec2.transformMat3(\n\t\t\tvec2.create(),\n\t\t\tthis.#getClipSpaceMousePosition(event),\n\t\t\tthis.#startInvertViewProjectionMatrix,\n\t\t);\n\n\t\tthis.#camera.x = this.#startCameraX + this.#startPos[0] - pos[0];\n\t\tthis.#camera.y = this.#startCameraY + this.#startPos[1] - pos[1];\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#canvasStyleInstance?.destroy();\n\t\tthis.#resizeObserver.unobserve(this.#canvas);\n\t}\n}\n","export const vertexShader: string = `\n  #extension GL_OES_standard_derivatives : enable\n  precision mediump float;\n\n  attribute vec2 a_Position;\n  uniform mat3 u_ViewProjectionInvMatrix;\n  varying vec2 v_Position;\n\n  vec2 project_clipspace(vec2 p) {\n  \treturn (u_ViewProjectionInvMatrix * vec3(p, 1)).xy;\n  }\n\n  void main() {\n  \tv_Position = project_clipspace(a_Position);\n  \tgl_Position = vec4(a_Position, 0, 1);\n  }\n`;\n\nexport const fragmentShader: string = `\n  #extension GL_OES_standard_derivatives : enable\n  precision mediump float;\n\n  uniform vec4 u_BackgroundColor;\n  uniform vec4 u_GridColor;\n  uniform float u_GridSize;\n  uniform float u_ZoomStep;\n  uniform float u_ZoomScale;\n  varying vec2 v_Position;\n\n  vec4 render_grid(vec2 coord) {\n  \tfloat alpha = 0.0;\n  \tfloat gridSize1 = u_GridSize;\n  \tfloat gridSize2 = gridSize1 / 4.0;\n\n  \tvec2 grid1 = abs(fract(coord / gridSize1 - 0.5) - 0.5) / fwidth(coord) * gridSize1 / 0.95;\n  \tvec2 grid2 = abs(fract(coord / gridSize2 - 0.5) - 0.5) / fwidth(coord) * gridSize2 / 0.75;\n  \tfloat v1 = 1.0 - min(min(grid1.x, grid1.y), 1.0);\n  \tfloat v2 = 1.0 - min(min(grid2.x, grid2.y), 1.0);\n\n  \tif (v1 > 0.0) {\n  \t\talpha = clamp(v1, 0.0, 0.222);\n  \t} else {\n  \t\talpha = v2 * clamp(u_ZoomScale / u_ZoomStep, 0.0, 1.0);\n  \t}\n\n  \treturn mix(u_BackgroundColor, u_GridColor, alpha);\n  }\n\n  void main() {\n  \tgl_FragColor = render_grid(v_Position);\n  }\n`;\n","export function compileShader(\n\tgl: WebGLRenderingContext,\n\tshaderSource: string,\n\tshaderType: number,\n): WebGLShader\n{\n\tconst shader = gl.createShader(shaderType);\n\tgl.shaderSource(shader, shaderSource);\n\tgl.compileShader(shader);\n\n\tconst success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\n\tif (!success)\n\t{\n\t\tthrow new Error(`Error shader compilation: ${gl.getShaderInfoLog(shader)}`);\n\t}\n\n\treturn shader;\n}\n\nexport function createProgram(\n\tgl: WebGLRenderingContext,\n\tvertexShader: WebGLShader,\n\tfragmentShader: WebGLShader,\n): WebGLProgram\n{\n\tconst program = gl.createProgram();\n\n\tgl.attachShader(program, vertexShader);\n\tgl.attachShader(program, fragmentShader);\n\tgl.linkProgram(program);\n\n\tconst success = gl.getProgramParameter(program, gl.LINK_STATUS);\n\n\tif (!success)\n\t{\n\t\tthrow new Error(`Error initializing shader program: ${gl.getProgramInfoLog(program)}`);\n\t}\n\n\treturn program;\n}\n\nexport function createBufferFromTypedArray(\n\tgl: WebGLRenderingContext,\n\tarray: ArrayBuffer,\n\ttype: number,\n\tdrawType: number,\n): WebGLBuffer\n{\n\tconst bufferType = type || gl.ARRAY_BUFFER;\n\tconst buffer = gl.createBuffer();\n\tgl.bindBuffer(bufferType, buffer);\n\tgl.bufferData(bufferType, array, drawType || gl.STATIC_DRAW);\n\n\treturn buffer;\n}\n\nexport function convHex(hex: string): Array<number>\n{\n\tconst preHex = hex.replace(/^#/, '');\n\tconst r = parseInt(preHex.slice(0, 2), 16);\n\tconst g = parseInt(preHex.slice(2, 4), 16);\n\tconst b = parseInt(preHex.slice(4, 6), 16);\n\n\treturn [r / 255, g / 255, b / 255];\n}\n","import { gridShaders } from './shaders';\nimport {\n\tcompileShader,\n\tcreateProgram,\n\tcreateBufferFromTypedArray,\n\tconvHex,\n} from './helpers';\nimport type { CanvasStyleZoomStep } from '../composables';\n\nexport type GridOptions = {\n\tsize: number,\n\tborderColor: string,\n\tbackgroundColor: string,\n};\n\nexport class Grid\n{\n\t#gl: WebGLRenderingContext;\n\t#program: WebGLProgram | null = null;\n\t#positionAttributeLocation: number | null = null;\n\n\t#vertexShader: WebGLShader | null = null;\n\t#fragmentShader: WebGLShader | null = null;\n\n\t#projectionMatrixLink: WebGLUniformLocation | null = null;\n\t#viewMatrixLink: WebGLUniformLocation | null = null;\n\t#viewProjectionInvMatrixLink: WebGLUniformLocation | null = null;\n\n\t#backgroundColorLink: WebGLUniformLocation | null = null;\n\t#backgroundColor = null;\n\n\t#gridColorLink: WebGLUniformLocation | null = null;\n\t#gridColor = null;\n\t#gridColorAlpha = null;\n\n\t#gridSizeLink: WebGLUniformLocation | null = null;\n\t#gridSize = null;\n\n\t#zoomScaleLink: WebGLUniformLocation | null = null;\n\n\t#gridPosition: Array<number> = [\n\t\t-1, -1,\n\t\t-1, 1,\n\t\t1, -1,\n\t\t1, 1,\n\t];\n\n\t#gridPositionBuffer: WebGLBuffer | null = null;\n\n\t#zoomStepLink: WebGLUniformLocation | null = null;\n\t#zoomStep: nubmer = 4;\n\t#zoomSteps = [];\n\n\tconstructor(canvas: HTMLElementCanvas, options: GridOptions)\n\t{\n\t\tthis.#initParams(options);\n\t\tthis.#initGrid(canvas);\n\t}\n\n\t#initGrid(canvas): void\n\t{\n\t\tthis.#gl = canvas.getContext('webgl');\n\t\tthis.#gl.getExtension('OES_standard_derivatives');\n\t\tthis.#gl.viewport(0, 0, this.#gl.canvas.width, this.#gl.canvas.height);\n\n\t\tthis.#vertexShader = compileShader(\n\t\t\tthis.#gl,\n\t\t\tgridShaders.vertexShader,\n\t\t\tthis.#gl.VERTEX_SHADER,\n\t\t);\n\t\tthis.#fragmentShader = compileShader(\n\t\t\tthis.#gl,\n\t\t\tgridShaders.fragmentShader,\n\t\t\tthis.#gl.FRAGMENT_SHADER,\n\t\t);\n\t\tthis.#program = createProgram(\n\t\t\tthis.#gl,\n\t\t\tthis.#vertexShader,\n\t\t\tthis.#fragmentShader,\n\t\t);\n\t\tthis.#positionAttributeLocation = this.#gl.getAttribLocation(\n\t\t\tthis.#program,\n\t\t\t'a_Position',\n\t\t);\n\t\tthis.#projectionMatrixLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_ProjectionMatrix',\n\t\t);\n\t\tthis.#viewMatrixLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_ViewMatrix',\n\t\t);\n\t\tthis.#viewProjectionInvMatrixLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_ViewProjectionInvMatrix',\n\t\t);\n\t\tthis.#backgroundColorLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_BackgroundColor',\n\t\t);\n\t\tthis.#gridColorLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_GridColor',\n\t\t);\n\t\tthis.#gridSizeLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_GridSize',\n\t\t);\n\t\tthis.#zoomStepLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_ZoomStep',\n\t\t);\n\t\tthis.#zoomScaleLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_ZoomScale',\n\t\t);\n\t\tthis.#gridPositionBuffer = createBufferFromTypedArray(\n\t\t\tthis.#gl,\n\t\t\tnew Float32Array(this.#gridPosition),\n\t\t);\n\t}\n\n\t#getPreparedZoomSteps(zoomSteps: CanvasStyleZoomStep): CanvasStyleZoomStep\n\t{\n\t\treturn zoomSteps\n\t\t\t.sort((stepA, stepB) => stepB.zoomStep - stepA.zoomStep)\n\t\t\t.map((step) => ({\n\t\t\t\tzoomStep: this.#zoomStep,\n\t\t\t\t...step,\n\t\t\t\tsize: 'size' in step\n\t\t\t\t\t? step.size\n\t\t\t\t\t: this.#gridSize,\n\t\t\t\tgridColor: 'gridColor' in step\n\t\t\t\t\t? convHex(step.gridColor)\n\t\t\t\t\t: this.#gridColor,\n\t\t\t}));\n\t}\n\n\t#initParams(options)\n\t{\n\t\tconst {\n\t\t\tsize,\n\t\t\tgridColor,\n\t\t\tgridColorAlpha,\n\t\t\tbackgroundColor,\n\t\t\tzoomStep,\n\t\t\tzoomSteps,\n\t\t} = options;\n\n\t\tthis.#gridSize = size;\n\t\tthis.#zoomStep = zoomStep;\n\t\tthis.#gridColor = new Float32Array(convHex(gridColor));\n\t\tthis.#gridColorAlpha = gridColorAlpha;\n\t\tthis.#backgroundColor = new Float32Array(convHex(backgroundColor));\n\t\tthis.#zoomSteps = this.#getPreparedZoomSteps(zoomSteps);\n\t}\n\n\t#getParamsByZoom(zoom: number): CanvasStyleZoomStep\n\t{\n\t\tfor (const step of this.#zoomSteps)\n\t\t{\n\t\t\tif (step.zoom <= zoom)\n\t\t\t{\n\t\t\t\treturn step;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tgridColor: this.#gridColor,\n\t\t\tsize: this.#gridSize,\n\t\t\tzoomStep: this.#zoomStep,\n\t\t};\n\t}\n\n\trender({\n\t\tprojectionMatrix,\n\t\tviewMatrix,\n\t\tviewProjectionMatrixInv,\n\t\tzoomScale,\n\t}): void\n\t{\n\t\tthis.#gl.clearColor(1, 1, 1, 1);\n\t\tthis.#gl.clear(this.#gl.COLOR_BUFFER_BIT);\n\t\tthis.#gl.useProgram(this.#program);\n\n\t\tconst {\n\t\t\tgridColor,\n\t\t\tzoomStep,\n\t\t\tsize,\n\t\t} = this.#getParamsByZoom(zoomScale);\n\n\t\tthis.#gl.uniformMatrix3fv(\n\t\t\tthis.#projectionMatrixLink,\n\t\t\tfalse,\n\t\t\tprojectionMatrix,\n\t\t);\n\t\tthis.#gl.uniformMatrix3fv(\n\t\t\tthis.#viewMatrixLink,\n\t\t\tfalse,\n\t\t\tviewMatrix,\n\t\t);\n\t\tthis.#gl.uniformMatrix3fv(\n\t\t\tthis.#viewProjectionInvMatrixLink,\n\t\t\tfalse,\n\t\t\tviewProjectionMatrixInv,\n\t\t);\n\t\tthis.#gl.uniform4f(\n\t\t\tthis.#backgroundColorLink,\n\t\t\t...this.#backgroundColor,\n\t\t\t1,\n\t\t);\n\t\tthis.#gl.uniform4f(\n\t\t\tthis.#gridColorLink,\n\t\t\t...gridColor,\n\t\t\t1,\n\t\t);\n\t\tthis.#gl.uniform1f(\n\t\t\tthis.#gridSizeLink,\n\t\t\tsize,\n\t\t);\n\t\tthis.#gl.uniform1f(\n\t\t\tthis.#zoomStepLink,\n\t\t\tzoomStep,\n\t\t);\n\t\tthis.#gl.uniform1f(\n\t\t\tthis.#zoomScaleLink,\n\t\t\tzoomScale,\n\t\t);\n\n\t\tthis.#gl.enableVertexAttribArray(this.#positionAttributeLocation);\n\t\tthis.#gl.bindBuffer(this.#gl.ARRAY_BUFFER, this.#gridPositionBuffer);\n\n\t\tthis.#gl.vertexAttribPointer(\n\t\t\tthis.#positionAttributeLocation,\n\t\t\t2,\n\t\t\tthis.#gl.FLOAT,\n\t\t\tfalse,\n\t\t\t0,\n\t\t\t0,\n\t\t);\n\n\t\tthis.#gl.drawArrays(\n\t\t\tthis.#gl.TRIANGLE_STRIP,\n\t\t\t0,\n\t\t\t4,\n\t\t);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#gl.deleteProgram(this.#program);\n\t\tthis.#gl.deleteShader(this.#vertexShader);\n\t\tthis.#gl.deleteShader(this.#fragmentShader);\n\t}\n}\n","import { computed, toValue, nextTick, markRaw } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport { commandToArray } from '../utils';\nimport type { State, Snapshot } from '../types';\n\nexport type SnapshotHandler = (state: State) => {...};\nexport type RevertHandler = (snapshot: Snapshot) => void;\n\nexport type UseHistoryOptions = {\n\tsnapshotHandler?: SnapshotHandler,\n\trevertHandler?: RevertHandler,\n\tmaxCount?: number,\n};\n\nexport type HandlerOptions = {\n\tsnapshotHandler?: SnapshotHandler,\n\trevertHandler?: RevertHandler,\n\temptyHistorySnapshot: {...},\n};\n\nexport type UseHistory = {\n\thasNext: boolean,\n\thasPrev: boolean,\n\tsetHandlers: (options: HandlerOptions) => void,\n\tmakeSnapshot: (options: HandlerOptions) => void,\n\tnext: () => void,\n\tprev: () => void,\n\tclear: () => void,\n};\n\n// eslint-disable-next-line max-lines-per-function\nexport function useHistory(options: UseHistoryOptions = {}): UseHistory\n{\n\tconst commonSnapshotHandler = (newState) => {\n\t\treturn markRaw({\n\t\t\tblocks: markRaw(JSON.parse(JSON.stringify(newState.blocks))),\n\t\t\tconnections: markRaw(JSON.parse(JSON.stringify(newState.connections))),\n\t\t});\n\t};\n\n\tconst commonRevertHandler = (snapshot): void => {\n\t\thooks.changedBlocks.trigger(\n\t\t\tcommandToArray.commandReplace(snapshot.blocks),\n\t\t);\n\t\thooks.changedConnections.trigger(\n\t\t\tcommandToArray.commandReplace(snapshot.connections),\n\t\t);\n\t};\n\n\tconst commonEmptyHistorySnapshot = {\n\t\tblocks: [],\n\t\tconnections: [],\n\t};\n\n\tconst instance = useBlockDiagram();\n\tconst {\n\t\theadSnapshot,\n\t\ttailSnapshot,\n\t\tcurrentSnapshot,\n\t\tmaxCountSnapshots,\n\t\thooks,\n\t\tsnapshotHandler,\n\t\trevertHandler,\n\t\tsetHistoryHandlers,\n\t\thistoryCurrentState,\n\t} = instance;\n\n\tconst {\n\t\tsnapshotHandler: newSnapshotHandler = null,\n\t\trevertHandler: newRevertHandler = null,\n\t\temptyHistorySnapshot = commonEmptyHistorySnapshot,\n\t\tmaxCount,\n\t} = options;\n\tsetHandlers({ newSnapshotHandler, newRevertHandler });\n\tmaxCountSnapshots.value = maxCount || toValue(maxCountSnapshots);\n\n\tconst hasNext = computed(() => toValue(currentSnapshot) && toValue(currentSnapshot).next !== null);\n\tconst hasPrev = computed(() => toValue(currentSnapshot) && toValue(currentSnapshot).prev !== null);\n\n\tfunction setHandlers(newHandlerOptions: HandlerOptions): void\n\t{\n\t\tconst handlerOptions = {\n\t\t\tsnapshotHandler: newHandlerOptions.snapshotHandler ?? toValue(snapshotHandler) ?? commonSnapshotHandler,\n\t\t\trevertHandler: newHandlerOptions.revertHandler ?? toValue(revertHandler) ?? commonRevertHandler,\n\t\t};\n\n\t\tsetHistoryHandlers(handlerOptions);\n\t}\n\n\tfunction getCountSnapshots(): number\n\t{\n\t\tlet count = 0;\n\t\tlet current: Snapshot | null = toValue(headSnapshot);\n\n\t\twhile (current)\n\t\t{\n\t\t\tcurrent = current.next;\n\t\t\tcount += 1;\n\t\t}\n\n\t\treturn count;\n\t}\n\n\tfunction makeSnapshot(options: HandlerOptions = {}): void\n\t{\n\t\tconst {\n\t\t\tsnapshotHandler: newSnapshotHandler = null,\n\t\t\trevertHandler: newRevertHandler = null,\n\t\t\temptySnapshot: newEmptySnapshot = null,\n\t\t} = options;\n\n\t\tconst snapshotHistoryHandler = newSnapshotHandler || toValue(snapshotHandler);\n\t\tconst revertHistoryHandler = newRevertHandler || toValue(revertHandler);\n\t\tconst emptySnapshot = newEmptySnapshot || emptyHistorySnapshot;\n\n\t\tconst newSnapshot = markRaw({\n\t\t\tsnapshot: snapshotHistoryHandler(toValue(historyCurrentState)),\n\t\t\trevertHandler: revertHistoryHandler,\n\t\t\temptySnapshot,\n\t\t\tnext: null,\n\t\t\tprev: tailSnapshot.value,\n\t\t});\n\n\t\tif (toValue(currentSnapshot) && toValue(currentSnapshot)?.next !== null)\n\t\t{\n\t\t\tcurrentSnapshot.value.next = newSnapshot;\n\t\t\tnewSnapshot.prev = currentSnapshot.value;\n\t\t\ttailSnapshot.value.prev = null;\n\t\t\ttailSnapshot.value.next = null;\n\t\t\ttailSnapshot.value = newSnapshot;\n\t\t}\n\t\telse if (toValue(headSnapshot) === null)\n\t\t{\n\t\t\theadSnapshot.value = newSnapshot;\n\t\t\ttailSnapshot.value = newSnapshot;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttailSnapshot.value.next = newSnapshot;\n\t\t\ttailSnapshot.value = newSnapshot;\n\t\t}\n\n\t\tcurrentSnapshot.value = newSnapshot;\n\n\t\tif (getCountSnapshots() <= toValue(maxCountSnapshots) + 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst firstSnapshot = headSnapshot.value;\n\t\theadSnapshot.value = firstSnapshot.next;\n\t\theadSnapshot.value.prev = null;\n\t\tfirstSnapshot.next = null;\n\t}\n\n\tasync function revertState({ revertHandler, snapshot, emptySnapshot }): void\n\t{\n\t\trevertHandler(emptySnapshot);\n\t\tawait nextTick();\n\t\trevertHandler(snapshot);\n\t}\n\n\tasync function next(): void\n\t{\n\t\tif (toValue(currentSnapshot) === null || toValue(currentSnapshot).next === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait revertState(toValue(currentSnapshot).next);\n\t\tcurrentSnapshot.value = toValue(currentSnapshot).next;\n\t}\n\n\tasync function prev(): void\n\t{\n\t\tif (toValue(currentSnapshot) === null || toValue(currentSnapshot).prev === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait revertState(toValue(currentSnapshot).prev);\n\t\tcurrentSnapshot.value = toValue(currentSnapshot).prev;\n\t}\n\n\tfunction clear(): void\n\t{\n\t\theadSnapshot.value = null;\n\t\ttailSnapshot.value = null;\n\t\tcurrentSnapshot.value = null;\n\t}\n\n\treturn {\n\t\thasNext,\n\t\thasPrev,\n\t\tsetHandlers,\n\t\tmakeSnapshot: () => nextTick(() => makeSnapshot()),\n\t\tnext,\n\t\tprev,\n\t\tclear,\n\t\tcommonSnapshotHandler,\n\t\tcommonRevertHandler,\n\t};\n}\n","import { toValue, toRaw } from 'ui.vue3';\nimport {\n\tSTICKING_DISTANCE,\n\tNODE_HEADER_HEIGHT,\n\tNODE_CONTENT_HEADER_HEIGHT,\n\tNODE_TYPES,\n} from '../constants';\nimport { commandToArray } from '../utils';\nimport { Text } from 'main.core';\nimport { HandlerOptions } from './history';\nimport type {\n\tDiagramBlockId,\n\tDiagramBlock,\n\tDiagramConnectionId,\n\tDiagramConnection,\n\tDiagramPortId,\n\tDiagramPort,\n\tPoint,\n} from '../types';\n\nexport type UseActions = {\n\tsetState: () => void,\n\tisExistConnection: (connection: DiagramConnection) => boolean,\n\taddConnection: (connection: DiagramConnection) => void,\n\tdeleteConnectionById: (connectionId: DiagramConnectionId) => void,\n\taddBlock: (block: DiagramBlock) => void,\n\tupdateBlockPositionByIndex: (index: number, x: number, y: number) => void,\n\tupdateBlock: (newBlock: DiagramBlock) => void,\n\tdeleteBlockById: (blockId: DiagramBlockId) => void,\n\tgetPortAbsolutePosition: (block: DiagramBlock, port: DiagramPort) => Point,\n\tfindNearestPort: (clientX: number, clientY: number) => DiagramPort | null,\n\ttransformEventToPoint: (point: { clientX: number, clientY: number }) => Point,\n\tsetMovingBlock: (block: DiagramBlock) => void,\n\tupdateMovingBlockPosition: (x: number, y: number) => void,\n\tresetMovingBlock: () => void,\n\tsetHistoryHandlers: (HandlerOptions) => void,\n\tsetPortOffsetByBlockId: (blockId: string, offsets: { x: number, y: number }) => void;\n};\n\n/* eslint-disable no-param-reassign */\n// eslint-disable-next-line max-lines-per-function\nexport function useActions({ state, getters, hooks }): UseActions\n{\n\tfunction setState(options): void\n\t{\n\t\tstate.blocks = toValue(options.blocks);\n\t\tstate.connections = toValue(options.connections);\n\t\tstate.transformX = options.transform.x;\n\t\tstate.transformY = options.transfrom.y;\n\t\tstate.zoom = toValue(options.zoom);\n\t}\n\n\tfunction updateCanvasTransform(transform: Transform): void\n\t{\n\t\tconst {\n\t\t\tx = 0,\n\t\t\ty = 0,\n\t\t\tzoom = 1,\n\t\t\tviewportX = 0,\n\t\t\tviewportY = 0,\n\t\t} = transform;\n\t\tstate.transformX = x;\n\t\tstate.transformY = y;\n\t\tstate.viewportX = viewportX;\n\t\tstate.viewportY = viewportY;\n\t\tstate.zoom = zoom;\n\t}\n\n\tconst isExistConnection = (connection: DiagramConnection): boolean => {\n\t\tconst {\n\t\t\tsourceBlockId,\n\t\t\tsourcePortId,\n\t\t\ttargetBlockId,\n\t\t\ttargetPortId,\n\t\t} = connection;\n\n\t\treturn state.connections.some(({\n\t\t\tsourceBlockId: exSourceBlockId,\n\t\t\tsourcePortId: exSourcePortId,\n\t\t\ttargetBlockId: exTargetBlockId,\n\t\t\ttargetPortId: exTargetPortId,\n\t\t}) => {\n\t\t\tconst isSource = (\n\t\t\t\texSourceBlockId === sourceBlockId\n\t\t\t\t&& exSourcePortId === sourcePortId\n\t\t\t\t&& exTargetBlockId === targetBlockId\n\t\t\t\t&& exTargetPortId === targetPortId\n\t\t\t);\n\t\t\tconst isTarget = (\n\t\t\t\texSourceBlockId === targetBlockId\n\t\t\t\t&& exSourcePortId === targetPortId\n\t\t\t\t&& exTargetBlockId === sourceBlockId\n\t\t\t\t&& exTargetPortId === sourcePortId\n\t\t\t);\n\n\t\t\treturn isSource || isTarget;\n\t\t});\n\t};\n\n\tconst addConnection = (newConnection: DiagramConnection): void => {\n\t\tif (!isExistConnection(newConnection))\n\t\t{\n\t\t\thooks.changedConnections.trigger(\n\t\t\t\tcommandToArray.commandPush({\n\t\t\t\t\tid: Text.getRandom(),\n\t\t\t\t\t...newConnection,\n\t\t\t\t}),\n\t\t\t);\n\t\t\thooks.createConnection.trigger(newConnection);\n\t\t}\n\t};\n\n\tconst deleteConnectionById = (connectionId: DiagramConnectionId): void => {\n\t\tconst connections = state.connections\n\t\t\t.filter((connection) => connection.id !== connectionId);\n\n\t\thooks.changedConnections.trigger(\n\t\t\tcommandToArray.commandReplace(connections),\n\t\t);\n\t\thooks.deleteConnection.trigger(connectionId);\n\t};\n\n\tconst deleteConnectionByBlockIdAndPortId = (blockId: DiagramBlockId, portId: DiagramPortId): void => {\n\t\tconst block = state.blocks.find((stateBlock) => stateBlock.id === blockId);\n\n\t\tif (!block)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst portIdMap = new Set(\n\t\t\t[\n\t\t\t\t...(block.ports?.input ?? []),\n\t\t\t\t...(block.ports?.output ?? []),\n\t\t\t].map((port) => port.id),\n\t\t);\n\t\tconst newConnections = state.connections.filter((connection) => {\n\t\t\tconst {\n\t\t\t\tsourceBlockId,\n\t\t\t\tsourcePortId,\n\t\t\t\ttargetBlockId,\n\t\t\t\ttargetPortId,\n\t\t\t} = connection;\n\t\t\tconst isSource = sourceBlockId === blockId && portIdMap.has(sourcePortId);\n\t\t\tconst isTarget = targetBlockId === blockId && portIdMap.has(targetPortId);\n\n\t\t\treturn !isSource && !isTarget;\n\t\t});\n\n\t\thooks.changedConnections.trigger(\n\t\t\tcommandToArray.commandReplace(newConnections),\n\t\t);\n\t};\n\n\tconst deleteBlockById = (blockId: DiagramBlockId): void => {\n\t\tconst blockIndex = state.blocks.findIndex((block) => block.id === blockId);\n\n\t\tif (blockIndex === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdeleteConnectionByBlockIdAndPortId(blockId);\n\n\t\thooks.changedBlocks.trigger(\n\t\t\tcommandToArray.commandDeleteByIndex(blockIndex),\n\t\t);\n\t\thooks.deleteBlock.trigger(blockId);\n\t};\n\n\tconst addBlock = (block: DiagramBlock): void => {\n\t\thooks.changedBlocks.trigger(\n\t\t\tcommandToArray.commandPush(block),\n\t\t);\n\t\thooks.addBlock.trigger(block);\n\t};\n\n\tconst updateBlockPositionByIndex = (index: number, x: number, y: nubmer): void => {\n\t\tstate.blocks[index].position.x = x;\n\t\tstate.blocks[index].position.y = y;\n\t};\n\n\tconst updateBlock = (newBlock: DiagramBlock): void => {\n\t\tconst blockIndex = state.blocks.findIndex((block) => block.id === newBlock.id);\n\n\t\tif (blockIndex === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\thooks.changedBlocks.trigger(\n\t\t\tcommandToArray.commandUpdateByIndex(blockIndex, newBlock),\n\t\t);\n\t\thooks.updateBlock.trigger(newBlock);\n\t};\n\n\tconst getPortAbsolutePosition = (block: DiagramBlock, port: DiagramPort): Point => {\n\t\tconst {\n\t\t\tposition: { x: blockX, y: blockY },\n\t\t\tdimensions: { width },\n\t\t\tports: { output },\n\t\t\tnode: { type: nodeType },\n\t\t} = block;\n\t\tconst { position, id: portId } = port;\n\n\t\tlet portOffsetY: number = position * NODE_HEADER_HEIGHT / 2;\n\t\tif (nodeType === NODE_TYPES.COMPLEX)\n\t\t{\n\t\t\tportOffsetY += NODE_CONTENT_HEADER_HEIGHT + NODE_HEADER_HEIGHT;\n\t\t}\n\t\tlet portX: number = blockX;\n\n\t\tconst isOutputPort = output.some((outputPort): boolean => outputPort.id === portId);\n\n\t\tif (isOutputPort)\n\t\t{\n\t\t\tportX = Number(blockX) + Number(width);\n\t\t}\n\n\t\treturn { x: portX, y: Number(blockY) + portOffsetY };\n\t};\n\n\tconst findNearestPort = (clientX: number, clientY: number): { block: DiagramBlock, port: DiagramPort } | null => {\n\t\tlet nearest = null;\n\t\tlet nearestDistance: number = Infinity;\n\n\t\tstate.blocks.forEach((block): void => {\n\t\t\tconst allPorts: Array = [...block.ports.input, ...block.ports.output];\n\n\t\t\tallPorts.forEach((port): void => {\n\t\t\t\tconst { x, y } = getPortAbsolutePosition(block, port);\n\t\t\t\tconst dx: number = clientX - x;\n\t\t\t\tconst dy: number = clientY - y;\n\t\t\t\tconst distance: number = Math.hypot(dx, dy);\n\n\t\t\t\tif (distance < STICKING_DISTANCE && distance < nearestDistance)\n\t\t\t\t{\n\t\t\t\t\tnearest = { block, port };\n\t\t\t\t\tnearestDistance = distance;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn nearest;\n\t};\n\n\tconst transformEventToPoint = (point: { clientX: number, clientY: number }): Point => {\n\t\tlet transformedX: number = Math.round(point.clientX / toValue(state.zoom));\n\t\tlet transformedY: number = Math.round(point.clientY / toValue(state.zoom));\n\n\t\tconst { top, left } = toValue(state.blockDiagramRef)?.getBoundingClientRect() ?? { top: 0, left: 0 };\n\n\t\ttransformedX -= Math.round(left / toValue(state.zoom));\n\t\ttransformedY -= Math.round(top / toValue(state.zoom));\n\n\t\treturn { x: transformedX, y: transformedY };\n\t};\n\n\tconst setMovingBlock = (block: DiagramBlock): void => {\n\t\tstate.movingBlock = toRaw({ ...block });\n\t\tconst movingConnections = [];\n\n\t\tconst allPorts = [...block.ports.input, ...block.ports.output];\n\n\t\tallPorts.forEach((port) => {\n\t\t\tconst connections = state.connections.filter((connection) => {\n\t\t\t\tconst {\n\t\t\t\t\ttargetBlockId,\n\t\t\t\t\ttargetPortId,\n\t\t\t\t\tsourceBlockId,\n\t\t\t\t\tsourcePortId,\n\t\t\t\t} = connection;\n\t\t\t\tconst isTarget = targetBlockId === block.id && targetPortId === port.id;\n\t\t\t\tconst isSource = sourceBlockId === block.id && sourcePortId === port.id;\n\n\t\t\t\treturn isTarget || isSource;\n\t\t\t});\n\n\t\t\tmovingConnections.push(...connections);\n\t\t});\n\n\t\tstate.movingConnections = movingConnections;\n\t};\n\n\tconst updateMovingBlockPosition = (x: number, y: number): void => {\n\t\tstate.movingBlock.position.x = x;\n\t\tstate.movingBlock.position.y = y;\n\t};\n\n\tconst resetMovingBlock = (): void => {\n\t\tstate.movingBlock = null;\n\t\tstate.movingConnections = [];\n\t};\n\n\tconst setHistoryHandlers = ({\n\t\tsnapshotHandler: newSnapshotHandler = null,\n\t\trevertHandler: newRevertHandler = null,\n\t}: HandlerOptions): void => {\n\t\tstate.snapshotHandler = newSnapshotHandler || state.snapshotHandler;\n\t\tstate.revertHandler = newRevertHandler || state.revertHandler;\n\t};\n\n\tconst setPortOffsetByBlockId = (blockId: string, offsets: { x: number, y: number }): void => {\n\t\tconst ports = toValue(state.portsRectMap)?.[blockId] ?? {};\n\n\t\tObject.entries(ports)\n\t\t\t.forEach(([id, portRect]) => {\n\t\t\t\tports[id].x = portRect.x - offsets.x;\n\t\t\t\tports[id].y = portRect.y - offsets.y;\n\t\t\t});\n\t};\n\n\tconst updatePortPosition = (blockId: DigramBlockId, portId: DiagramPortId): void => {\n\t\tconst {\n\t\t\tportsElMap,\n\t\t\tblockDiagramLeft,\n\t\t\tblockDiagramTop,\n\t\t\tzoom,\n\t\t\ttransformX,\n\t\t\ttransformY,\n\t\t} = state;\n\t\tconst hasBlock = toValue(portsElMap).has(blockId);\n\t\tconst hasPort = hasBlock && toValue(portsElMap).get(blockId).has(portId);\n\n\t\tif (!hasBlock || !hasPort)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tx = 0,\n\t\t\ty = 0,\n\t\t\twidth = 0,\n\t\t\theight = 0,\n\t\t} = portsElMap.get(blockId)?.get(portId)?.getBoundingClientRect() ?? {};\n\n\t\tstate.portsRectMap[blockId][portId].x = (x / zoom) + toValue(transformX) - (toValue(blockDiagramLeft) / zoom);\n\t\tstate.portsRectMap[blockId][portId].y = (y / zoom) + toValue(transformY) - (toValue(blockDiagramTop) / zoom);\n\t\tstate.portsRectMap[blockId][portId].width = width;\n\t\tstate.portsRectMap[blockId][portId].height = height;\n\t};\n\n\treturn {\n\t\tsetState,\n\t\tupdateCanvasTransform,\n\t\tisExistConnection,\n\t\taddConnection,\n\t\tdeleteConnectionById,\n\t\taddBlock,\n\t\tupdateBlockPositionByIndex,\n\t\tupdateBlock,\n\t\tdeleteBlockById,\n\t\tgetPortAbsolutePosition,\n\t\tfindNearestPort,\n\t\ttransformEventToPoint,\n\t\tsetMovingBlock,\n\t\tupdateMovingBlockPosition,\n\t\tresetMovingBlock,\n\t\tsetHistoryHandlers,\n\t\tsetPortOffsetByBlockId,\n\t\tupdatePortPosition,\n\t};\n}\n","import { computed, toValue } from 'ui.vue3';\nimport { BLOCK_GROUP_DEFAULT_NAME, CONNECTION_GROUP_DEFAULT_NAME } from '../constants';\nimport type {\n\tGroupedBlocks,\n\tBlockGroupNames,\n\tGroupedConnections,\n\tConnectionGroupNames,\n\tDiagramConnectionId,\n\tTransform,\n} from '../types';\n\nexport type UseGetters = {\n\ttransform: Transform;\n\tcanvasId: string | null;\n\tgroupedBlocks: GroupedBlocks;\n\tblockGroupNames: BlockGroupNames;\n\tgroupedConnections: GroupedConnections;\n\tconnectionGroupNames: ConnectionGroupNames;\n\tisAnimate: boolean;\n\tisDisabledBlockDiagram: boolean;\n};\n\nexport function useGetters(state): UseGetters\n{\n\tconst transform = computed((): Transform => ({\n\t\tx: state.transformX,\n\t\ty: state.transformY,\n\t\tzoom: state.zoom,\n\t\tviewportX: state.viewportX,\n\t\tviewportY: state.viewportY,\n\t}));\n\n\tconst canvasId = computed((): string | null => {\n\t\treturn state.canvasRef?.canvasId ?? null;\n\t});\n\n\tconst groupedBlocks = computed((): GroupedBlocks => {\n\t\treturn state.blocks\n\t\t\t.reduce((acc, block) => {\n\t\t\t\tconst type = block?.type ?? BLOCK_GROUP_DEFAULT_NAME;\n\n\t\t\t\tif (type in acc)\n\t\t\t\t{\n\t\t\t\t\tacc[type] = [...acc[type], block];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tacc[type] = [block];\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, { [BLOCK_GROUP_DEFAULT_NAME]: [] });\n\t});\n\n\tconst blockGroupNames = computed((): BlockGroupNames => {\n\t\treturn Object.keys(toValue(groupedBlocks));\n\t});\n\n\tconst groupedConnections = computed((): GroupedConnections => {\n\t\treturn state.connections\n\t\t\t.reduce((acc, connection) => {\n\t\t\t\tconst type = connection?.type ?? CONNECTION_GROUP_DEFAULT_NAME;\n\n\t\t\t\tif (type in acc)\n\t\t\t\t{\n\t\t\t\t\tacc[type] = [...acc[type], connection];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tacc[type] = [connection];\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, { [CONNECTION_GROUP_DEFAULT_NAME]: [] });\n\t});\n\n\tconst connectionGroupNames = computed((): ConnectionGroupNames => {\n\t\treturn Object.keys(toValue(groupedConnections));\n\t});\n\n\tconst isAnimate = computed((): boolean => {\n\t\treturn state.animationQueue !== null;\n\t});\n\n\tconst isDisabledBlockDiagram = computed((): boolean => {\n\t\treturn state.isDisabled || toValue(isAnimate);\n\t});\n\n\treturn {\n\t\ttransform,\n\t\tcanvasId,\n\t\tgroupedBlocks,\n\t\tblockGroupNames,\n\t\tgroupedConnections,\n\t\tconnectionGroupNames,\n\t\tisAnimate,\n\t\tisDisabledBlockDiagram,\n\t};\n}\n","import { createHook, CreateHook } from '../utils';\nimport { HOOK_NAMES } from '../constants';\n\nexport type UseHooks = Record<$Values<HOOK_NAMES>, CreateHook>;\n\nexport function useHooks(): UseHooks\n{\n\treturn {\n\t\t[HOOK_NAMES.START_DRAG_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.MOVE_DRAG_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.END_DRAG_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.ADD_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.UPDATE_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.DELETE_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.CREATE_CONNECTION]: createHook(),\n\t\t[HOOK_NAMES.DELETE_CONNECTION]: createHook(),\n\t\t[HOOK_NAMES.CHANGED_BLOCKS]: createHook(),\n\t\t[HOOK_NAMES.CHANGED_CONNECTIONS]: createHook(),\n\t\t[HOOK_NAMES.BLOCK_TRANSITION_START]: createHook(),\n\t\t[HOOK_NAMES.BLOCK_TRANSITION_END]: createHook(),\n\t\t[HOOK_NAMES.CONNECTION_TRANSITION_START]: createHook(),\n\t\t[HOOK_NAMES.CONNECTION_TRANSITION_END]: createHook(),\n\t\t[HOOK_NAMES.DROP_NEW_BLOCK]: createHook(),\n\t};\n}\n","import { getCurrentInstance, reactive, toRefs } from 'ui.vue3';\nimport { State } from '../types';\nimport { useState } from './state';\nimport { useActions, UseActions } from './actions';\nimport { useGetters, UseGetters } from './getters';\nimport { useHooks, UseHooks } from './hooks';\n\nexport type UseBlockDiagran = {\n\t...State,\n\t...UseGetters,\n\t...UseHooks,\n\t...UseActions,\n};\n\nexport function useBlockDiagram(options): UseBlockDiagran\n{\n\tconst app = getCurrentInstance()?.appContext.app;\n\tconst blockDiagramState = app?.config?.globalProperties?.$blockDiagram ?? null;\n\n\tif (blockDiagramState !== null)\n\t{\n\t\treturn blockDiagramState;\n\t}\n\n\tconst state = useState(options);\n\tconst reactiveState = reactive(state);\n\tconst getters = useGetters(reactiveState);\n\tconst hooks = useHooks();\n\tconst actions = useActions({ state: reactiveState, getters, hooks });\n\n\tif (options)\n\t{\n\t\tactions.setState(options);\n\t}\n\n\tapp.config.globalProperties.$blockDiagram = {\n\t\t...toRefs(reactiveState),\n\t\t...getters,\n\t\t...actions,\n\t\thooks,\n\t};\n\n\tapp.config.globalProperties.$blockDiagramTestId = (id: string, ...args: Array<string>): string => {\n\t\tif (!id)\n\t\t{\n\t\t\tthrow new Error('ui.block-diagram not found test id');\n\t\t}\n\n\t\tconst preparedArgs = args.reduce((acc, arg) => {\n\t\t\treturn `${acc}-${arg}`;\n\t\t}, '');\n\n\t\treturn `${id}${preparedArgs}`;\n\t};\n\n\treturn app.config.globalProperties?.$blockDiagram;\n}\n","import { ref, toValue, shallowRef } from 'ui.vue3';\nimport { Type } from 'main.core';\nimport { MenuItemOptions, MenuOptions, MenuManager } from 'main.popup';\nimport { useBlockDiagram } from './block-diagram';\n\nexport type UseContextMenu = {\n\tisOpen: boolean,\n\tshowContextMenu: (payload: { clientX: number, clientY: number }) => void,\n\tcloseContextMenu: () => void,\n\tsetOptions: (options: MenuOptions) => void,\n};\n\nexport function useContextMenu(menuItems: MenuItemOptions[] = []): UseContextMenu\n{\n\tconst {\n\t\tcontextMenuLayerRef,\n\t\ttargetContainerRef,\n\t\tisOpenContextMenu,\n\t\tpositionContextMenu,\n\t\tcontextMenuInstance,\n\t\tzoom,\n\t} = useBlockDiagram();\n\n\tcontextMenuInstance.value = toValue(contextMenuInstance) || shallowRef(MenuManager.create(getMenuOptions()));\n\tconst isOpen = ref(false);\n\tlet options: MenuOptions = { items: menuItems };\n\n\tfunction setOptions(newOptions: MenuOptions): void\n\t{\n\t\toptions = getMenuOptions(newOptions);\n\t}\n\n\tfunction getItems(items: MenuItemOptions[] = []): MenuItemOptions[]\n\t{\n\t\treturn items.map((item) => {\n\t\t\treturn {\n\t\t\t\t...item,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tif (Type.isFunction(item.onclick))\n\t\t\t\t\t{\n\t\t\t\t\t\titem.onclick();\n\t\t\t\t\t}\n\n\t\t\t\t\tcloseMenu();\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\t}\n\n\tfunction getMenuOptions(additionalOptions: MenuOptions): MenuOptions\n\t{\n\t\treturn {\n\t\t\tid: 'block-diagram-context-menu',\n\t\t\tbindElement: {\n\t\t\t\tleft: 0,\n\t\t\t\ttop: 0,\n\t\t\t},\n\t\t\tminWidth: 200,\n\t\t\tautoHide: true,\n\t\t\tdraggable: false,\n\t\t\tcacheable: false,\n\t\t\ttargetContainer: toValue(targetContainerRef),\n\t\t\t...additionalOptions,\n\t\t\titems: getItems(additionalOptions?.items ?? []),\n\t\t};\n\t}\n\n\tfunction setDestroyHandler(handler: () => void): void\n\t{\n\t\ttoValue(contextMenuInstance)\n\t\t\t?.popupWindow\n\t\t\t?.subscribeOnce('onDestroy', handler);\n\t}\n\n\tfunction showMenu(menuOptions: MenuOptions): void\n\t{\n\t\ttoValue(contextMenuInstance)?.destroy();\n\t\tcontextMenuInstance.value = shallowRef(MenuManager.create(\n\t\t\tgetMenuOptions(menuOptions),\n\t\t));\n\t\ttoValue(contextMenuInstance).show();\n\t}\n\n\tfunction closeMenu(): void\n\t{\n\t\ttoValue(contextMenuInstance)?.close();\n\t}\n\n\tfunction showContextMenu(payload: { clientX: number, clientY: number }): void\n\t{\n\t\tconst { clientX = 0, clientY = 0 } = payload;\n\t\tconst { left, top } = toValue(contextMenuLayerRef)?.getBoundingClientRect() ?? { top: 0, left: 0 };\n\t\tpositionContextMenu.value.top = (clientY - top) / toValue(zoom);\n\t\tpositionContextMenu.value.left = (clientX - left) / toValue(zoom);\n\n\t\tshowMenu(options);\n\t\tsetDestroyHandler(() => {\n\t\t\tisOpen.value = false;\n\t\t});\n\n\t\tisOpen.value = true;\n\t\tisOpenContextMenu.value = true;\n\t}\n\n\tfunction closeContextMenu(): void\n\t{\n\t\tisOpen.value = false;\n\t\tisOpenContextMenu.value = false;\n\n\t\tcloseMenu();\n\t}\n\n\treturn {\n\t\tisOpen,\n\t\tshowContextMenu,\n\t\tcloseContextMenu,\n\t\tsetOptions,\n\t};\n}\n","import { toValue, ref } from 'ui.vue3';\nimport { Event } from 'main.core';\nimport { useBlockDiagram } from './block-diagram';\nimport type { DiagramBlock, DiagramPort } from '../types';\n\nexport type UseNewConnection = {\n\tisSourcePort: boolean;\n\tonMouseDownPort: (event: MouseEvent) => void;\n\tonMouseOverPort: () => void;\n\tonMouseLeavePort: () => void;\n};\n\n// eslint-disable-next-line max-lines-per-function\nexport function useNewConnection(block: DiagramBlock, port: DiagramPort): UseNewConnection\n{\n\tconst {\n\t\tisDisabledBlockDiagram,\n\t\tnewConnection,\n\t\tportsRectMap,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t\tzoom,\n\t\ttransformX,\n\t\ttransformY,\n\t\taddConnection,\n\t} = useBlockDiagram();\n\tconst isSourcePort = ref(false);\n\n\tfunction onMouseDownPort(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tisSourcePort.value = true;\n\t\tconst portRect = toValue(portsRectMap)?.[toValue(block).id]?.[toValue(port).id];\n\t\tconst startPosition = {\n\t\t\tx: portRect.x + (portRect.width / 2),\n\t\t\ty: portRect.y + (portRect.height / 2),\n\t\t};\n\n\t\tnewConnection.value = {\n\t\t\tsourceBlockId: toValue(block).id,\n\t\t\tsourcePortId: toValue(port).id,\n\t\t\ttargetBlockId: null,\n\t\t\ttargetPortId: null,\n\t\t\tstart: startPosition,\n\t\t\tend: startPosition,\n\t\t};\n\n\t\tEvent.bind(document, 'mousemove', onMouseMove);\n\t\tEvent.bind(document, 'mouseup', onMouseUp);\n\t}\n\n\tfunction onMouseMove(event: MouseEvent): void\n\t{\n\t\tif (!toValue(newConnection) || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst x: number = event.clientX / toValue(zoom);\n\t\tconst y: number = event.clientY / toValue(zoom);\n\n\t\tnewConnection.value.end = {\n\t\t\tx: x + toValue(transformX) - (toValue(blockDiagramLeft) / toValue(zoom)),\n\t\t\ty: y + toValue(transformY) - (toValue(blockDiagramTop) / toValue(zoom)),\n\t\t};\n\t}\n\n\tfunction onMouseUp(event: MouseEvent): void\n\t{\n\t\tif (toValue(newConnection) === null || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tsourceBlockId = null,\n\t\t\tsourcePortId = null,\n\t\t\ttargetBlockId = null,\n\t\t\ttargetPortId = null,\n\t\t} = toValue(newConnection);\n\n\t\tconst isSamePort = sourceBlockId === targetBlockId && sourcePortId === targetPortId;\n\t\tconst hasSourceIds = sourceBlockId !== null && sourcePortId !== null;\n\t\tconst hasTargetIds = targetBlockId !== null && targetPortId !== null;\n\n\t\tif (!isSamePort && hasSourceIds && hasTargetIds)\n\t\t{\n\t\t\taddConnection({\n\t\t\t\tsourceBlockId,\n\t\t\t\tsourcePortId,\n\t\t\t\ttargetBlockId,\n\t\t\t\ttargetPortId,\n\t\t\t});\n\t\t}\n\n\t\tnewConnection.value = null;\n\t\tisSourcePort.value = false;\n\t\tEvent.unbind(document, 'mousemove', onMouseMove);\n\t\tEvent.unbind(document, 'mouseup', onMouseUp);\n\t}\n\n\tfunction onMouseOverPort(): void\n\t{\n\t\tif (toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (toValue(newConnection) !== null)\n\t\t{\n\t\t\tnewConnection.value.targetBlockId = toValue(block).id;\n\t\t\tnewConnection.value.targetPortId = toValue(port).id;\n\t\t}\n\t}\n\n\tfunction onMouseLeavePort(): void\n\t{\n\t\tif (toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (toValue(newConnection) !== null)\n\t\t{\n\t\t\tnewConnection.value.targetBlockId = null;\n\t\t\tnewConnection.value.targetPortId = null;\n\t\t}\n\t}\n\n\treturn {\n\t\tisSourcePort,\n\t\tonMouseDownPort,\n\t\tonMouseOverPort,\n\t\tonMouseLeavePort,\n\t};\n}\n","import { computed, toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport { BLOCK_INDEXES } from '../constants';\nimport type { DiagramPort } from '../types';\n\nexport type UseBlockState = {\n\tisHiglitedBlock: boolean;\n\tisDisabled: boolean;\n\tupdatePortsPositions: () => void;\n};\n\nexport function useBlockState(block): UseBlockState\n{\n\tconst {\n\t\thighlitedBlockIds,\n\t\tisDisabledBlockDiagram,\n\t\tmovingBlock,\n\t\tupdatePortPosition,\n\t} = useBlockDiagram();\n\n\tconst isHiglitedBlock = computed(() => {\n\t\treturn highlitedBlockIds.value.includes(toValue(block).id);\n\t});\n\n\tconst isDisabled = computed(() => {\n\t\treturn toValue(isDisabledBlockDiagram);\n\t});\n\n\tconst blockZindex = computed(() => {\n\t\tif (toValue(movingBlock)?.id === toValue(block).id)\n\t\t{\n\t\t\treturn { zIndex: BLOCK_INDEXES.MOVABLE };\n\t\t}\n\n\t\tif (toValue(isHiglitedBlock))\n\t\t{\n\t\t\treturn { zIndex: BLOCK_INDEXES.HIGHLITED };\n\t\t}\n\n\t\treturn { zIndex: BLOCK_INDEXES.STANDING };\n\t});\n\n\tfunction updatePortsPositions()\n\t{\n\t\t([...toValue(block).ports.input, ...toValue(block).ports.output])\n\t\t\t.forEach((port: DiagramPort) => {\n\t\t\t\tupdatePortPosition(toValue(block).id, port.id);\n\t\t\t});\n\t}\n\n\treturn {\n\t\tisHiglitedBlock,\n\t\tisDisabled,\n\t\tblockZindex,\n\t\tupdatePortsPositions,\n\t};\n}\n","import { Event } from 'main.core';\nimport {\n\tref,\n\ttoValue,\n\tonMounted,\n\tonBeforeUnmount,\n\tcomputed,\n\twatchEffect,\n} from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\n\nexport type UseBlockReturnType = {\n\tisDragged: boolean,\n\tblockPositionStyle: {\n\t\ttop: string,\n\t\tleft: string,\n\t\twidth: string,\n\t},\n};\n\n// eslint-disable-next-line max-lines-per-function\nexport function useMoveableBlock(blockRef, block): UseBlockReturnType\n{\n\tconst isDragged = ref(false);\n\tconst {\n\t\tisDisabledBlockDiagram,\n\t\tzoom,\n\t\tupdateBlock,\n\t\thooks,\n\t\tsetMovingBlock,\n\t\tupdateMovingBlockPosition,\n\t\tresetMovingBlock,\n\t\tsetPortOffsetByBlockId,\n\t} = useBlockDiagram();\n\n\tlet prevValueBlockX = 0;\n\tlet prevValueBlockY = 0;\n\n\tconst offsetBlockX = ref(0);\n\tconst offsetBlockY = ref(0);\n\n\tconst x = ref(toValue(block).position.x);\n\tconst y = ref(toValue(block).position.y);\n\n\twatchEffect(() => {\n\t\tx.value = toValue(block).position.x;\n\t\ty.value = toValue(block).position.y;\n\t});\n\n\tconst blockPositionStyle = computed(() => {\n\t\treturn {\n\t\t\ttop: `${y.value}px`,\n\t\t\tleft: `${x.value}px`,\n\t\t};\n\t});\n\n\tonMounted(() => {\n\t\tEvent.bind(toValue(blockRef), 'mousedown', onMouseDown);\n\t});\n\n\tonBeforeUnmount(() => {\n\t\tEvent.unbind(toValue(blockRef), 'mousedown', onMouseDown);\n\t});\n\n\tconst onMouseDown = (event: MouseEvent): void => {\n\t\tif (event.button !== 0 || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\n\t\tsetMovingBlock(toValue(block));\n\t\thooks.startDragBlock.trigger(block);\n\n\t\tprevValueBlockX = toValue(block).position.x;\n\t\tprevValueBlockY = toValue(block).position.y;\n\n\t\toffsetBlockX.value = Math.round(event.clientX - (toValue(block).position.x * toValue(zoom)));\n\t\toffsetBlockY.value = Math.round(event.clientY - (toValue(block).position.y * toValue(zoom)));\n\n\t\tisDragged.value = true;\n\t\tEvent.bind(document, 'mousemove', onMouseMove);\n\t\tEvent.bind(document, 'mouseup', onMouseUp);\n\t};\n\n\tconst onMouseMove = (event: MouseEvent): void => {\n\t\tif (!toValue(isDragged) || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\t\thooks.moveDragBlock.trigger(block);\n\n\t\tx.value = Math.round((event.clientX - toValue(offsetBlockX)) / toValue(zoom));\n\t\ty.value = Math.round((event.clientY - toValue(offsetBlockY)) / toValue(zoom));\n\n\t\tupdateMovingBlockPosition(x.value, y.value);\n\t\tsetPortOffsetByBlockId(\n\t\t\ttoValue(block).id,\n\t\t\t{\n\t\t\t\tx: prevValueBlockX - x.value,\n\t\t\t\ty: prevValueBlockY - y.value,\n\t\t\t},\n\t\t);\n\t\tprevValueBlockX = x.value;\n\t\tprevValueBlockY = y.value;\n\t};\n\n\tconst onMouseUp = (event: MouseEvent): void => {\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isDragged) || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst positionX: number = Math.round((event.clientX - toValue(offsetBlockX)) / toValue(zoom));\n\t\tconst positionY: number = Math.round((event.clientY - toValue(offsetBlockY)) / toValue(zoom));\n\n\t\tconst newBlock = {\n\t\t\t...toValue(block),\n\t\t\tposition: {\n\t\t\t\t...toValue(block).position,\n\t\t\t\tx: positionX,\n\t\t\t\ty: positionY,\n\t\t\t},\n\t\t};\n\n\t\tsetPortOffsetByBlockId(\n\t\t\ttoValue(block).id,\n\t\t\t{\n\t\t\t\tx: prevValueBlockX - positionX,\n\t\t\t\ty: prevValueBlockY - positionY,\n\t\t\t},\n\t\t);\n\t\tupdateBlock(newBlock);\n\n\t\tif (toValue(block).position.x !== newBlock.position.x || toValue(block).position.y !== newBlock.position.y)\n\t\t{\n\t\t\thooks.endDragBlock.trigger(newBlock);\n\t\t}\n\n\t\tresetMovingBlock();\n\n\t\toffsetBlockX.value = 0;\n\t\toffsetBlockY.value = 0;\n\t\tisDragged.value = false;\n\t\tEvent.unbind(document, 'mousemove', onMouseMove);\n\t\tEvent.unbind(document, 'mouseup', onMouseUp);\n\t};\n\n\treturn {\n\t\tisDragged,\n\t\tblockPositionStyle,\n\t};\n}\n","import { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport { HOOK_NAMES } from '../constants';\nimport { commandToArray, CommandPayload } from '../utils';\n\nexport type UseModelValue = { dispose: () => void };\n\nexport function useModelValue(emit): UseModelValue\n{\n\tconst {\n\t\tblocks,\n\t\tconnections,\n\t\thistoryCurrentState,\n\t\thooks,\n\t} = useBlockDiagram();\n\n\tconst handlersMap: { [$Values<typeof HOOK_NAMES>]: (command: CommandPayload) => void } = {\n\t\t[HOOK_NAMES.CHANGED_BLOCKS]: handleChangeBlocks,\n\t\t[HOOK_NAMES.CHANGED_CONNECTIONS]: handleChangeConnections,\n\t};\n\n\tObject.entries(handlersMap)\n\t\t.forEach(([hookName, handler]) => {\n\t\t\thooks[hookName].on(handler);\n\t\t});\n\n\tfunction handleChangeBlocks(command: CommandPayload): void\n\t{\n\t\tcommandToArray.runCommand(\n\t\t\ttoValue(historyCurrentState.value.blocks),\n\t\t\tcommand,\n\t\t\t(value) => {\n\t\t\t\thistoryCurrentState.value.blocks = value;\n\t\t\t\temit('update:blocks', value);\n\t\t\t},\n\t\t);\n\t}\n\n\tfunction handleChangeConnections(command: CommandPayload): void\n\t{\n\t\tcommandToArray.runCommand(\n\t\t\ttoValue(historyCurrentState.value.connections),\n\t\t\tcommand,\n\t\t\t(value) => {\n\t\t\t\thistoryCurrentState.value.connections = value;\n\t\t\t\temit('update:connections', value);\n\t\t\t},\n\t\t);\n\t}\n\n\tfunction dispose(): void\n\t{\n\t\tObject.entries(handlersMap)\n\t\t\t.forEach(([hookName, handler]) => {\n\t\t\t\thooks[hookName].off(handler);\n\t\t\t});\n\t}\n\n\treturn {\n\t\tdispose,\n\t};\n}\n","import { watch, effectScope, markRaw } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\n\nexport type UseWatchProps = {\n\tdispose: () => void,\n};\n\nexport function useWatchProps(props): UseWatchProps\n{\n\tconst {\n\t\tblocks,\n\t\tconnections,\n\t\thistoryCurrentState,\n\t\tzoom,\n\t\tisDisabled,\n\t} = useBlockDiagram();\n\tconst scope = effectScope(true);\n\n\tscope.run(() => {\n\t\twatch([() => props.blocks, () => props.blocks.length], ([newBlocks]) => {\n\t\t\tif (newBlocks && Array.isArray(newBlocks))\n\t\t\t{\n\t\t\t\thistoryCurrentState.value.blocks = markRaw(JSON.parse(JSON.stringify(newBlocks)));\n\t\t\t\tblocks.value = newBlocks;\n\t\t\t}\n\t\t}, { immediate: true, deep: true });\n\n\t\twatch([() => props.connections, () => props.connections.length], ([newConnections]) => {\n\t\t\thistoryCurrentState.value.connections = markRaw(JSON.parse(JSON.stringify(newConnections)));\n\t\t\tconnections.value = [...newConnections];\n\t\t}, { immediate: true, deep: true });\n\n\t\twatch(() => props.zoom, (newZoom) => {\n\t\t\tzoom.value = newZoom;\n\t\t}, { immediate: true });\n\n\t\twatch(() => props.minZoom, (newMinZoom) => {\n\t\t\tzoom.value = newMinZoom;\n\t\t}, { immediate: true });\n\n\t\twatch(() => props.maxZoom, (newMaxZoom) => {\n\t\t\tzoom.value = newMaxZoom;\n\t\t}, { immediate: true });\n\n\t\twatch(() => props.disabled, (disabled) => {\n\t\t\tisDisabled.value = disabled;\n\t\t}, { immediate: true });\n\t});\n\n\tfunction dispose(): void\n\t{\n\t\tscope.stop();\n\t}\n\n\treturn {\n\t\tdispose,\n\t};\n}\n","import { Type } from 'main.core';\nimport { useBlockDiagram } from './block-diagram';\n\nexport type UseRegisterHooks = {\n\tdispose: () => void,\n};\n\nexport function useRegisterHooks(...hooksMaps): UseRegisterHooks\n{\n\tconst { hooks } = useBlockDiagram();\n\n\tconst mergedHookMaps = ([...hooksMaps])\n\t\t.reduce((accHookMaps, hookMap) => {\n\t\t\tconst result = { ...accHookMaps };\n\n\t\t\tObject.entries(hookMap)\n\t\t\t\t.forEach(([hookName, handler]) => {\n\t\t\t\t\tif (hookName in accHookMaps)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult[hookName].push(\n\t\t\t\t\t\t\t...(Type.isFunction(handler) ? [handler] : handler),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult[hookName] = [\n\t\t\t\t\t\t\t...(Type.isFunction(handler) ? [handler] : handler),\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\treturn result;\n\t\t}, {});\n\n\tObject.entries(mergedHookMaps)\n\t\t.forEach(([hookName, handlers]) => {\n\t\t\thandlers.forEach((handler) => {\n\t\t\t\thooks?.[hookName]?.on(handler);\n\t\t\t});\n\t\t});\n\n\tfunction dispose()\n\t{\n\t\tObject.entries(mergedHookMaps)\n\t\t\t.forEach(([hookName, handlers]) => {\n\t\t\t\thandlers.forEach((handler) => {\n\t\t\t\t\thooks?.[hookName]?.off(handler);\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\treturn {\n\t\tdispose,\n\t};\n}\n","import { debounce } from 'main.core';\nimport { ref, toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type { DiagramBlock } from '../types';\n\ntype UseSearchBlocksOptions = {\n\tsearchCallback: (item: {...}, searchText: string) => boolean;\n\tdelay: number;\n};\n\ntype UseSearchBlocks = {\n\tseachText: string;\n\tfoundBlocks: Array<DiagramBlock>;\n\tonSearchBlocks: (searchText: string) => void;\n\tonClearSearch: () => void;\n};\n\nconst DEFAULT_OPTIONS: UseSearchBlocksOptions = {\n\tsearchCallback: () => false,\n\tdelay: 300,\n};\n\nexport function useSearchBlocks(optionParams: UseSearchBlocksOptions): UseSearchBlocks\n{\n\tconst {\n\t\tblocks,\n\t} = useBlockDiagram();\n\tconst options: UseSearchBlocksOptions = { ...DEFAULT_OPTIONS, ...optionParams };\n\tconst seachText: string = ref('');\n\tconst foundBlocks: Array<DiagramBlock> = ref([]);\n\n\tfunction onSearchBlocks(searchText: string): void\n\t{\n\t\tseachText.value = searchText;\n\t\tfoundBlocks.value = [];\n\n\t\tif (toValue(seachText).trim() === '')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tblocks.value.forEach((block) => {\n\t\t\tif (options.searchCallback(block, toValue(seachText)))\n\t\t\t{\n\t\t\t\tfoundBlocks.value.push(block);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction onClearSearch(): void\n\t{\n\t\tseachText.value = '';\n\t\tfoundBlocks.value = [];\n\t}\n\n\treturn {\n\t\tseachText,\n\t\tfoundBlocks,\n\t\tonSearchBlocks: debounce(onSearchBlocks, options.delay),\n\t\tonClearSearch,\n\t};\n}\n","import { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type { DiagramBlockId } from '../types';\n\nexport type UseCanvas = {\n\tzoomIn: (zoomStep: number) => void,\n\tzoomOut: (zoomStep: number) => void,\n\tsetCamera: (params: { x: number, y: number, zoom: number}) => void,\n\tgoToBlockById: (id: DiagramBlockId) => void,\n};\n\nexport function useCanvas(): UseCanvas\n{\n\tconst {\n\t\tzoom,\n\t\tblocks,\n\t\tcanvasWidth,\n\t\tcanvasHeight,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t\tcanvasInstance,\n\t} = useBlockDiagram();\n\n\tfunction zoomIn(zoomStep: number): void\n\t{\n\t\ttoValue(canvasInstance)?.zoomIn(zoomStep);\n\t}\n\n\tfunction zoomOut(zoomStep: number): void\n\t{\n\t\ttoValue(canvasInstance)?.zoomOut(zoomStep);\n\t}\n\n\tfunction setCamera(params: { x: number, y: number, zoom: number}): void\n\t{\n\t\ttoValue(canvasInstance)?.setCamera(params);\n\t}\n\n\tfunction goToBlockById(id: DiagramBlockId): void\n\t{\n\t\tconst block = toValue(blocks).find((block) => block.id === id);\n\n\t\tif (!block)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { x, y } = block.position;\n\t\tconst { width, height } = block.dimensions;\n\t\tconst centerX = x + (width / 2);\n\t\tconst centerY = y + (height / 2);\n\n\t\tsetCamera({\n\t\t\tx: centerX - (toValue(canvasWidth) / 2 / toValue(zoom)) - toValue(blockDiagramLeft) / toValue(zoom),\n\t\t\ty: centerY - (toValue(canvasHeight) / 2 / toValue(zoom)) - toValue(blockDiagramTop) / toValue(zoom),\n\t\t});\n\t}\n\n\treturn {\n\t\tzoomIn,\n\t\tzoomOut,\n\t\tsetCamera,\n\t\tgoToBlockById,\n\t};\n}\n","import { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type { DiagramBlockId } from '../types';\n\nexport type UseHighlightedBlocks = {\n\thighlitedBlockIds: Array<DiagramBlockId>;\n\tset: (blockIds: Array<DiagramBlockId>) => void;\n\tadd: (blockId: DiagramBlockId) => void;\n\tremove: (blockId: DiagramBlockId) => void;\n\tclear: () => void;\n};\n\nexport function useHighlightedBlocks(): UseHighlightedBlocks\n{\n\tconst { highlitedBlockIds } = useBlockDiagram();\n\n\tfunction set(blockIds: Array<DiagramBlockId>): void\n\t{\n\t\ttoValue(highlitedBlockIds).push(...blockIds);\n\t}\n\n\tfunction add(blockId: DiagramBlockId): void\n\t{\n\t\ttoValue(highlitedBlockIds).push(blockId);\n\t}\n\n\tfunction remove(blockId: DiagramBlockId)\n\t{\n\t\tconst highlitedIndx: number = highlitedBlockIds.value.indexOf(blockId);\n\n\t\tif (highlitedIndx > -1)\n\t\t{\n\t\t\thighlitedBlockIds.value.splice(highlitedIndx, 1);\n\t\t}\n\t}\n\n\tfunction clear(): void\n\t{\n\t\thighlitedBlockIds.value = [];\n\t}\n\n\treturn {\n\t\thighlitedBlockIds,\n\t\tset,\n\t\tadd,\n\t\tremove,\n\t\tclear,\n\t};\n}\n","import { getCurrentInstance } from 'ui.vue3';\n\nexport type UseLoc = {\n\tgetMessage: (messageId: string, replacements: string) => string,\n};\n\nexport function useLoc(): UseLoc\n{\n\tconst app = getCurrentInstance()?.appContext.app;\n\tconst bitrix = app?.config?.globalProperties?.$bitrix ?? null;\n\n\treturn {\n\t\tgetMessage: (messageId: string, replacements: string): string => {\n\t\t\treturn bitrix?.Loc?.getMessage(messageId, replacements);\n\t\t},\n\t};\n}\n","import { toValue, computed } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type { DiagramBlockId, DiagramPortId } from '../types';\nimport { PORT_POSITION } from '../constants';\n\ntype UsePortState = {\n\tisDisabled: boolean;\n\tonMountedPort: () => void;\n\tonUnmountedPort: () => void;\n};\n\n// eslint-disable-next-line max-lines-per-function\nexport function usePortState(options): UsePortState\n{\n\tconst {\n\t\tportRef,\n\t\tblock,\n\t\tport,\n\t\tposition = PORT_POSITION.LEFT,\n\t} = options;\n\n\tconst {\n\t\tportsElMap,\n\t\tportsRectMap,\n\t\tzoom,\n\t\ttransformX,\n\t\ttransformY,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t\tisDisabledBlockDiagram,\n\t} = useBlockDiagram();\n\n\tconst isDisabled = computed((): boolean => {\n\t\treturn toValue(isDisabledBlockDiagram);\n\t});\n\n\tfunction addPortElement(blockId: DiagramBlockId, portId: DiagramPortId, portEl: HTMLElement): void\n\t{\n\t\tif (!toValue(portsElMap).has(blockId))\n\t\t{\n\t\t\ttoValue(portsElMap).set(blockId, new Map());\n\t\t}\n\n\t\ttoValue(portsElMap)\n\t\t\t.get(blockId)\n\t\t\t.set(portId, toValue(portEl));\n\t}\n\n\tfunction deletePortElement(blockId: DiagramBlockId, portId: DiagramPortId): void\n\t{\n\t\tif (!toValue(portsElMap).has(blockId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttoValue(portsElMap)\n\t\t\t.get(blockId)\n\t\t\t.delete(portId);\n\t}\n\n\tfunction addPortRect(\n\t\tblockId: DiagramBlockId,\n\t\tportId: DiagramPortId,\n\t\tportEl: HTMLElement,\n\t): void\n\t{\n\t\tif (!(blockId in toValue(portsRectMap)))\n\t\t{\n\t\t\ttoValue(portsRectMap)[blockId] = {};\n\t\t}\n\n\t\tconst {\n\t\t\tx = 0,\n\t\t\ty = 0,\n\t\t\twidth = 0,\n\t\t\theight = 0,\n\t\t} = toValue(portEl)?.getBoundingClientRect() ?? {};\n\n\t\ttoValue(portsRectMap)[blockId][portId] = {\n\t\t\tx: (x / toValue(zoom)) + toValue(transformX) - (toValue(blockDiagramLeft) / toValue(zoom)),\n\t\t\ty: (y / toValue(zoom)) + toValue(transformY) - (toValue(blockDiagramTop) / toValue(zoom)),\n\t\t\twidth,\n\t\t\theight,\n\t\t\tposition,\n\t\t};\n\t}\n\n\tfunction deletePortRect(blockId: DiagramBlockId, portId: DiagramPortId): void\n\t{\n\t\tif (!(blockId in toValue(portsRectMap)))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst portsMap = toValue(portsRectMap)[blockId];\n\n\t\tif (Object.keys(portsMap).length === 1)\n\t\t{\n\t\t\tdelete toValue(portsRectMap)[blockId];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdelete toValue(portsMap)[portId];\n\t\t}\n\t}\n\n\tfunction onMountedPort(): void\n\t{\n\t\taddPortElement(\n\t\t\ttoValue(block).id,\n\t\t\ttoValue(port).id,\n\t\t\tportRef,\n\t\t);\n\t\taddPortRect(\n\t\t\ttoValue(block).id,\n\t\t\ttoValue(port).id,\n\t\t\tportRef,\n\t\t);\n\t}\n\n\tfunction onUnmountedPort(): void\n\t{\n\t\tdeletePortElement(toValue(block).id, toValue(port).id);\n\t\tdeletePortRect(toValue(block).id, toValue(port).id);\n\t}\n\n\treturn {\n\t\tisDisabled,\n\t\tonMountedPort,\n\t\tonUnmountedPort,\n\t};\n}\n","import { toValue, computed } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport { getBeziePath, getSmoothStepPath } from '../utils';\nimport type { PathInfo } from '../utils';\nimport { CONNECTION_VIEW_TYPE } from '../constants';\n// eslint-disable-next-line no-unused-vars\nimport type { DiagramConnection, DiagramConnectionId } from '../types';\n\ntype PortPosition = {\n\tx: number;\n\ty: number;\n};\n\ntype ConnectionPortPosition = {\n\tsourcePort: PortPosition;\n\ttargetPort: PortPosition;\n};\n\ntype UseConnectionState = {\n\tconnectionPortsPosition: ConnectionPortPosition | null;\n\tconnectionPathInfo: PathInfo;\n\tisDisabled: boolean;\n}\n\n// eslint-disable-next-line max-lines-per-function\nexport function useConnectionState(options): UseConnectionState\n{\n\tconst {\n\t\tportsRectMap,\n\t\tisDisabledBlockDiagram,\n\t} = useBlockDiagram();\n\tconst { connection, viewType } = options;\n\n\tconst connectionPortsPosition = computed((): ConnectionPortPosition | null => {\n\t\tconst {\n\t\t\tsourceBlockId,\n\t\t\tsourcePortId,\n\t\t\ttargetBlockId,\n\t\t\ttargetPortId,\n\t\t} = toValue(connection);\n\n\t\tconst hasSourceBlockId = sourceBlockId in toValue(portsRectMap);\n\t\tconst hasSourcePortId = hasSourceBlockId && (sourcePortId in toValue(portsRectMap)[sourceBlockId]);\n\t\tconst hasTargetBlockId = targetBlockId in toValue(portsRectMap);\n\t\tconst hasTargetPortId = hasTargetBlockId && (targetPortId in toValue(portsRectMap)[targetBlockId]);\n\n\t\tif (\n\t\t\t!hasSourceBlockId\n\t\t\t|| !hasSourcePortId\n\t\t\t|| !hasTargetBlockId\n\t\t\t|| !hasTargetPortId\n\t\t)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst {\n\t\t\tx: sourceX,\n\t\t\ty: sourceY,\n\t\t\twidth: sourceWidth,\n\t\t\theight: sourceHeight,\n\t\t\tposition: sourcePosition,\n\t\t} = toValue(portsRectMap)[sourceBlockId][sourcePortId];\n\t\tconst {\n\t\t\tx: targetX,\n\t\t\ty: targetY,\n\t\t\twidth: targetWidth,\n\t\t\theight: targetHeight,\n\t\t\tposition: targetPosition,\n\t\t} = toValue(portsRectMap)[targetBlockId][targetPortId];\n\n\t\treturn {\n\t\t\tsourcePort: {\n\t\t\t\tx: sourceX + (sourceWidth / 2),\n\t\t\t\ty: sourceY + (sourceHeight / 2),\n\t\t\t\tposition: sourcePosition,\n\t\t\t},\n\t\t\ttargetPort: {\n\t\t\t\tx: targetX + (targetWidth / 2),\n\t\t\t\ty: targetY + (targetHeight / 2),\n\t\t\t\tposition: targetPosition,\n\t\t\t},\n\t\t};\n\t});\n\n\tconst connectionPathInfo = computed((): PathInfo => {\n\t\tif (toValue(connectionPortsPosition) === null)\n\t\t{\n\t\t\treturn {\n\t\t\t\tpath: '',\n\t\t\t\tcenter: {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tif (toValue(viewType) === CONNECTION_VIEW_TYPE.BEZIER)\n\t\t{\n\t\t\treturn getBeziePath(\n\t\t\t\ttoValue(connectionPortsPosition).sourcePort,\n\t\t\t\ttoValue(connectionPortsPosition).targetPort,\n\t\t\t);\n\t\t}\n\n\t\treturn getSmoothStepPath({\n\t\t\tsourceX: toValue(connectionPortsPosition).sourcePort.x,\n\t\t\tsourceY: toValue(connectionPortsPosition).sourcePort.y,\n\t\t\tsourcePosition: toValue(connectionPortsPosition).sourcePort.position,\n\t\t\ttargetX: toValue(connectionPortsPosition).targetPort.x,\n\t\t\ttargetY: toValue(connectionPortsPosition).targetPort.y,\n\t\t\ttargetPosition: toValue(connectionPortsPosition).targetPort.position,\n\t\t\tborderRadius: 10,\n\t\t\toffset: 30,\n\t\t});\n\t});\n\n\tconst isDisabled = computed((): boolean => {\n\t\treturn toValue(isDisabledBlockDiagram);\n\t});\n\n\treturn {\n\t\tconnectionPortsPosition,\n\t\tconnectionPathInfo,\n\t\tisDisabled,\n\t};\n}\n","import 'main.polyfill.intersectionobserver';\nimport { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\n\ntype UseInitAppElements = {\n\tonMountedAppElements: () => void;\n\tonUnmountedAppElements: () => void;\n}\n\ntype Options = {\n\tblockDiagramRef: HTMLElement;\n}\n\nexport function useInitAppElements(options: Options): UseInitAppElements\n{\n\tconst {\n\t\tblockDiagramRef: newBlockDiagramRef,\n\t} = options;\n\tconst {\n\t\tblockDiagramRef,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t} = useBlockDiagram();\n\n\tlet observer: typeof IntersectionObserver | null = null;\n\n\tfunction handleInterObserver(entries): void\n\t{\n\t\tentries.forEach((entry) => {\n\t\t\tconst { top, left } = entry.boundingClientRect;\n\n\t\t\tblockDiagramTop.value = top;\n\t\t\tblockDiagramLeft.value = left;\n\t\t});\n\t}\n\n\tfunction onMountedAppElements()\n\t{\n\t\tblockDiagramRef.value = toValue(newBlockDiagramRef);\n\n\t\tconst { left, top } = toValue(newBlockDiagramRef).getBoundingClientRect();\n\n\t\tblockDiagramTop.value = top;\n\t\tblockDiagramLeft.value = left;\n\n\t\tobserver = new IntersectionObserver(handleInterObserver);\n\t\tobserver.observe(toValue(blockDiagramRef));\n\t}\n\n\tfunction onUnmountedAppElements(): void\n\t{\n\t\tobserver.unobserve(toValue(blockDiagramRef));\n\t}\n\n\treturn {\n\t\tonMountedAppElements,\n\t\tonUnmountedAppElements,\n\t};\n}\n","import { computed, toValue } from 'ui.vue3';\nimport { getBeziePath, getLinePath } from '../utils';\nimport type { PathInfo } from '../utils';\nimport { useBlockDiagram } from './block-diagram';\nimport { CONNECTION_VIEW_TYPE } from '../constants';\nimport type { DiagramConnectionViewType } from '../types';\n\nexport type useNewConnectionStateOptions = {\n\tviewType: DiagramConnectionViewType;\n};\n\nexport type UseNewConnectionState = {\n\thasNewConnection: boolean;\n\tnewConnectionPathInfo: PathInfo;\n};\n\nexport function useNewConnectionState(options: useNewConnectionStateOptions): UseNewConnectionState\n{\n\tconst { newConnection } = useBlockDiagram();\n\tconst { viewType } = options;\n\n\tconst hasNewConnection = computed((): boolean => {\n\t\treturn toValue(newConnection) !== null;\n\t});\n\n\tconst newConnectionPathInfo = computed((): PathInfo => {\n\t\tif (!toValue(hasNewConnection))\n\t\t{\n\t\t\treturn {\n\t\t\t\tpath: '',\n\t\t\t\tcenter: {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tif (toValue(viewType) === CONNECTION_VIEW_TYPE.BEZIER)\n\t\t{\n\t\t\treturn getBeziePath(\n\t\t\t\ttoValue(newConnection).start,\n\t\t\t\ttoValue(newConnection).end,\n\t\t\t);\n\t\t}\n\n\t\treturn getLinePath(\n\t\t\ttoValue(newConnection).start,\n\t\t\ttoValue(newConnection).end,\n\t\t);\n\t});\n\n\treturn {\n\t\thasNewConnection,\n\t\tnewConnectionPathInfo,\n\t};\n}\n","import { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type {\n\tAnimationItem,\n} from '../types';\n\nimport { ANIMATED_TYPES } from '../constants';\n\ntype Options = {\n\titems: Array<AnimationItem>;\n\tzoom: number;\n};\n\ntype UseAnimatedQueue = {\n\tstart: (options: Options) => void;\n\tpause: () => void;\n\tplay: () => void;\n\tstop: () => void;\n};\n\nexport function useAnimationQueue(): UseAnimatedQueue\n{\n\tconst {\n\t\tzoom,\n\t\tisPauseAnimation,\n\t\tisStopAnimation,\n\t\tanimationQueue,\n\t\tcurrentAnimationItem,\n\t\taddConnection,\n\t\tdeleteConnectionById,\n\t\taddBlock,\n\t\tdeleteBlockById,\n\t} = useBlockDiagram();\n\n\tfunction animateItem(animatedItem: AnimationItem): void\n\t{\n\t\tswitch (animatedItem.type)\n\t\t{\n\t\t\tcase ANIMATED_TYPES.BLOCK: {\n\t\t\t\taddBlock(animatedItem.item);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase ANIMATED_TYPES.CONNECTION: {\n\t\t\t\taddConnection(animatedItem.item);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase ANIMATED_TYPES.REMOVE_BLOCK: {\n\t\t\t\tdeleteBlockById(animatedItem.item.id);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase ANIMATED_TYPES.REMOVE_CONNECTION: {\n\t\t\t\tdeleteConnectionById(animatedItem.item.id);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tfunction* animationQueueFn(animatedQueueItems: Array<AnimationItem>): Generator<AnimationItem | undefined>\n\t{\n\t\tfor (const animatedItem: AnimationItem of animatedQueueItems)\n\t\t{\n\t\t\tif (toValue(isPauseAnimation))\n\t\t\t{\n\t\t\t\tyield;\n\t\t\t}\n\n\t\t\tif (toValue(isStopAnimation))\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcurrentAnimationItem.value = animatedItem;\n\n\t\t\tif (animatedItem.type && animatedItem.item)\n\t\t\t{\n\t\t\t\tanimateItem(animatedItem);\n\n\t\t\t\tyield animatedItem;\n\t\t\t}\n\t\t}\n\n\t\tstop();\n\t}\n\n\tfunction start(options: Options): void\n\t{\n\t\tconst {\n\t\t\titems: shouldAnimatedItems = [],\n\t\t} = options ?? {};\n\n\t\tzoom.value = 1;\n\t\tisStopAnimation.value = false;\n\n\t\tanimationQueue.value = animationQueueFn(shouldAnimatedItems);\n\t\tif (shouldAnimatedItems.length > 0)\n\t\t{\n\t\t\tsetTimeout((): void => play(), 100);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstop();\n\t\t}\n\t}\n\n\tfunction pause(): void\n\t{\n\t\tisPauseAnimation.value = true;\n\t}\n\n\tfunction play(): void\n\t{\n\t\tisPauseAnimation.value = false;\n\t\tanimationQueue.value?.next();\n\t}\n\n\tfunction stop(): void\n\t{\n\t\tisStopAnimation.value = true;\n\t\tisPauseAnimation.value = false;\n\t\tcurrentAnimationItem.value = null;\n\t\tanimationQueue.value = null;\n\t}\n\n\treturn {\n\t\tstart,\n\t\tpause,\n\t\tplay,\n\t\tstop,\n\t};\n}\n","import { ref, toValue, markRaw } from 'ui.vue3';\nimport { Dom } from 'main.core';\nimport { useBlockDiagram } from './block-diagram';\nimport { Canvas, Grid } from '../utils';\n\nexport type UseCanvasTransform = {\n\tisDragging: boolean,\n\tonMounted: () => void,\n\tonUnmounted: () => void,\n\tonMouseDown: (event: MouseEvent) => void,\n};\n\nexport type UseCanvasTransformOptions = {\n\tcanvasRef: HTMLElement,\n\ttransformLayoutRef: HTMLElement,\n\tcanvasStyle: newCanvasStyle,\n};\n\nconst CANVAS_STYLE_DEFAULT_OPTIONS: {...} = {\n\tgrid: {\n\t\toptions: {\n\t\t\tsize: 64,\n\t\t\tgridColor: '#A1B8D9',\n\t\t\tbackgroundColor: '#ECF0F2',\n\t\t\tzoomStep: 4,\n\t\t\tzoomSteps: [\n\t\t\t\t{\n\t\t\t\t\tzoom: 1.1,\n\t\t\t\t\tsize: 64,\n\t\t\t\t\tzoomStep: 4,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tzoom: 1,\n\t\t\t\t\tsize: 64,\n\t\t\t\t\tzoomStep: 4,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tzoom: 0.99,\n\t\t\t\t\tsize: 64,\n\t\t\t\t\tzoomStep: 4,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tzoom: 0.5,\n\t\t\t\t\tsize: 64 * 5,\n\t\t\t\t\tzoomStep: 0.5,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tzoom: 0.25,\n\t\t\t\t\tsize: 64 * 25,\n\t\t\t\t\tzoomStep: 0.25,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tzoom: 0.125,\n\t\t\t\t\tsize: 64 * 125,\n\t\t\t\t\tzoomStep: 0.125,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tinstance: Grid,\n\t},\n};\n\n// eslint-disable-next-line max-lines-per-function\nexport function useCanvasTransfrom(options: UseCanvasTransformOptions): UseCanvasTransform\n{\n\tconst {\n\t\tcanvasRef: newCanvasRef,\n\t\ttransformLayoutRef: newTransformLayoutRef,\n\t\tcanvasStyle: newCanvasStyle,\n\t\tzoomSensitivity,\n\t\tzoomSensitivityMouse,\n\t} = options;\n\n\tconst {\n\t\tisDisabledBlockDiagram,\n\t\ttransformX,\n\t\ttransformY,\n\t\tzoom,\n\t\tminZoom,\n\t\tmaxZoom,\n\t\tcanvasRef,\n\t\ttransformLayoutRef,\n\t\tcanvasWidth,\n\t\tcanvasHeight,\n\t\tcanvasInstance,\n\t} = useBlockDiagram();\n\n\tconst dragOn = ref(false);\n\tconst isDragging = ref(false);\n\tconst zooming = ref(false);\n\n\tlet requestAnimationId = null;\n\n\tfunction getCanvasStyleOptions(canvasStyle: CanvasStyle): CanvasStyle | null\n\t{\n\t\tif (canvasStyle && canvasStyle.style in CANVAS_STYLE_DEFAULT_OPTIONS)\n\t\t{\n\t\t\treturn {\n\t\t\t\tinstance: CANVAS_STYLE_DEFAULT_OPTIONS[canvasStyle.style].instance,\n\t\t\t\toptions: {\n\t\t\t\t\t...CANVAS_STYLE_DEFAULT_OPTIONS[canvasStyle.style].options,\n\t\t\t\t\t...canvasStyle,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction onMounted(): void\n\t{\n\t\tcanvasRef.value = newCanvasRef;\n\t\ttransformLayoutRef.value = newTransformLayoutRef;\n\n\t\tcanvasInstance.value = markRaw(new Canvas({\n\t\t\tcanvas: toValue(newCanvasRef),\n\t\t\tcanvasStyle: getCanvasStyleOptions(newCanvasStyle),\n\t\t\tminZoom: toValue(minZoom),\n\t\t\tmaxZoom: toValue(maxZoom),\n\t\t}));\n\n\t\ttoValue(canvasInstance).camera.setChangeTransformCallback((payload) => {\n\t\t\ttransformX.value = payload.x;\n\t\t\ttransformY.value = payload.y;\n\t\t\tzoom.value = payload.zoom;\n\t\t\tcanvasWidth.value = payload.width;\n\t\t\tcanvasHeight.value = payload.height;\n\t\t});\n\n\t\trender();\n\t}\n\n\tfunction onUnmounted(): void\n\t{\n\t\ttoValue(canvasInstance)?.destroy();\n\t\tcancelAnimationFrame(requestAnimationId);\n\t}\n\n\tfunction onMouseDown(event: MouseEvent): void\n\t{\n\t\tif (toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdragOn.value = true;\n\t\ttoValue(canvasInstance)?.setCameraPositionByMouseDown(event);\n\t}\n\n\tfunction onMouseMove(event: MouseEvent): void\n\t{\n\t\tif (!toValue(dragOn) || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.buttons !== 1)\n\t\t{\n\t\t\tdragOn.value = false;\n\t\t\tisDragging.value = false;\n\n\t\t\treturn;\n\t\t}\n\n\t\tisDragging.value = true;\n\t\ttoValue(canvasInstance)?.setCameraPositionByMouseMove(event);\n\t}\n\n\tfunction onMouseUp(): void\n\t{\n\t\tdragOn.value = false;\n\t\tisDragging.value = false;\n\t}\n\n\tfunction onWheel(event: WheelEvent): void\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isTrackpad = event.wheelDeltaY\n\t\t\t? event.wheelDeltaY === -3 * event.deltaY\n\t\t\t: event.deltaMode === 0;\n\n\t\tif (event.ctrlKey)\n\t\t{\n\t\t\tconst zoomChange = isTrackpad\n\t\t\t\t? -event.deltaY * toValue(zoomSensitivity)\n\t\t\t\t: -Math.sign(event.deltaY) * toValue(zoomSensitivityMouse);\n\n\t\t\tzooming.value = true;\n\t\t\ttoValue(canvasInstance)?.setCameraZoomByWheel(event, zoomChange);\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tzooming.value = false;\n\t\t\t}, 200);\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttoValue(canvasInstance)?.setCameraPositionByWheel(event);\n\t\t}\n\t}\n\n\tfunction render(): void\n\t{\n\t\tif (canvasInstance)\n\t\t{\n\t\t\ttoValue(canvasInstance)?.render();\n\t\t\tconst viewMatrix = toValue(canvasInstance).viewMatrix;\n\n\t\t\tDom.style(\n\t\t\t\ttoValue(transformLayoutRef),\n\t\t\t\t'transform',\n\t\t\t\t`\n\t\t\t\t\tmatrix(\n\t\t\t\t\t\t${viewMatrix[0]}, 0, 0, ${viewMatrix[4]}, ${viewMatrix[6]}, ${viewMatrix[7]}\n\t\t\t\t\t)\n\t\t\t\t`,\n\t\t\t);\n\t\t}\n\n\t\trequestAnimationId = requestAnimationFrame(render);\n\t}\n\n\treturn {\n\t\tisDragging,\n\t\tonMounted,\n\t\tonUnmounted,\n\t\tonMouseDown,\n\t\tonMouseMove,\n\t\tonMouseUp,\n\t\tonWheel,\n\t};\n}\n","import { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type { DiagramBlock } from '../types';\n\nexport function useDragAndDrop(): {...}\n{\n\tconst {\n\t\tzoom,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t\ttransformX,\n\t\ttransformY,\n\t\taddBlock,\n\t\thooks,\n\t} = useBlockDiagram();\n\n\tfunction onDrop(event: DragEvent): void\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst dataString = event.dataTransfer.getData('text/plain');\n\t\tconst receivedData = JSON.parse(dataString);\n\n\t\tconst { width, height } = receivedData.dimensions;\n\n\t\treceivedData.position.x = (event.clientX - (width * toValue(zoom) / 2)) / toValue(zoom);\n\t\treceivedData.position.y = (event.clientY - (height * toValue(zoom) / 2)) / toValue(zoom);\n\n\t\treceivedData.position.x += toValue(transformX);\n\t\treceivedData.position.y += toValue(transformY);\n\n\t\treceivedData.position.x -= toValue(blockDiagramLeft) / toValue(zoom);\n\t\treceivedData.position.y -= toValue(blockDiagramTop) / toValue(zoom);\n\n\t\taddBlock(receivedData);\n\t\thooks.dropNewBlock.trigger(receivedData);\n\t}\n\n\tfunction setBlockData(event, addedBlock: DiagramBlock): void\n\t{\n\t\tevent.dataTransfer.setData('text/plain', JSON.stringify(addedBlock));\n\t}\n\n\treturn {\n\t\tsetBlockData,\n\t\tonDrop,\n\t};\n}\n","import { Event } from 'main.core';\nimport { toValue, ref, computed } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport { CURSOR_TYPES } from '../constants';\n\n// eslint-disable-next-line max-lines-per-function\nexport function useResizableBlock(options): {...}\n{\n\tconst {\n\t\tcursorType,\n\t\tresizingBlock,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t\ttransformX,\n\t\ttransformY,\n\t\tzoom,\n\t\tupdateBlock,\n\t} = useBlockDiagram();\n\tconst {\n\t\tblock,\n\t\tminWidth,\n\t\tminHeight,\n\t\tleftSideRef,\n\t\ttopSideRef,\n\t\trightSideRef,\n\t\tbottomSideRef,\n\t\tleftTopCornerRef,\n\t\trightTopCornerRef,\n\t\trightBottomCornerRef,\n\t\tleftBottomCornerRef,\n\t} = options;\n\n\tconst isResize = ref(false);\n\tlet prevBlockX = 0;\n\tlet prevBlockY = 0;\n\tlet prevBlockWidth = 0;\n\tlet prevBlockHeight = 0;\n\n\tconst sizeBlockStyle = computed(() => {\n\t\tif (toValue(isResize))\n\t\t{\n\t\t\treturn {\n\t\t\t\twidth: `${toValue(resizingBlock).dimensions.width}px`,\n\t\t\t\theight: `${toValue(resizingBlock).dimensions.height}px`,\n\t\t\t\tcursor: toValue(cursorType),\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\twidth: `${toValue(block).dimensions.width}px`,\n\t\t\theight: `${toValue(block).dimensions.height}px`,\n\t\t\tcursor: toValue(cursorType),\n\t\t};\n\t});\n\n\tfunction updateResizableBlock(): void\n\t{\n\t\tupdateBlock({\n\t\t\t...toValue(block),\n\t\t\tposition: {\n\t\t\t\tx: toValue(resizingBlock).position.x,\n\t\t\t\ty: toValue(resizingBlock).position.y,\n\t\t\t},\n\t\t\tdimensions: {\n\t\t\t\twidth: toValue(resizingBlock).dimensions.width,\n\t\t\t\theight: toValue(resizingBlock).dimensions.height,\n\t\t\t},\n\t\t});\n\t}\n\n\tfunction onMounted(): void\n\t{\n\t\tEvent.bind(toValue(rightSideRef), 'mousedown', onMouseDownRightSide);\n\t\tEvent.bind(toValue(bottomSideRef), 'mousedown', onMouseDownBottomSide);\n\t\tEvent.bind(toValue(leftSideRef), 'mousedown', onMouseDownLeftSide);\n\t\tEvent.bind(toValue(topSideRef), 'mousedown', onMouseDownTopSide);\n\n\t\tEvent.bind(toValue(rightTopCornerRef), 'mousedown', onMouseDownRightTopCorner);\n\t\tEvent.bind(toValue(rightBottomCornerRef), 'mousedown', onMouseDownRightBottomCorner);\n\t\tEvent.bind(toValue(leftTopCornerRef), 'mousedown', onMouseDownLeftTopCorner);\n\t\tEvent.bind(toValue(leftBottomCornerRef), 'mousedown', onMouseDownLeftBottomCorner);\n\t}\n\n\tfunction onUnmounted(): void\n\t{\n\t\tEvent.unbind(toValue(rightSideRef), 'mousedown', onMouseDownRightSide);\n\t\tEvent.unbind(toValue(bottomSideRef), 'mousedown', onMouseDownBottomSide);\n\t\tEvent.unbind(toValue(leftSideRef), 'mousedown', onMouseDownLeftSide);\n\t\tEvent.unbind(toValue(topSideRef), 'mousedown', onMouseDownTopSide);\n\n\t\tEvent.unbind(toValue(rightTopCornerRef), 'mousedown', onMouseDownRightTopCorner);\n\t\tEvent.unbind(toValue(rightBottomCornerRef), 'mousedown', onMouseDownRightBottomCorner);\n\t\tEvent.unbind(toValue(leftTopCornerRef), 'mousedown', onMouseDownLeftTopCorner);\n\t\tEvent.unbind(toValue(leftBottomCornerRef), 'mousedown', onMouseDownLeftBottomCorner);\n\t}\n\n\tfunction startResize(event: MouseEvent, curType: string): void\n\t{\n\t\tevent.stopPropagation();\n\t\tcursorType.value = curType;\n\t\tresizingBlock.value = { ...toValue(block) };\n\t\tprevBlockX = toValue(block).position.x;\n\t\tprevBlockY = toValue(block).position.y;\n\t\tprevBlockWidth = toValue(block).dimensions.width;\n\t\tprevBlockHeight = toValue(block).dimensions.height;\n\t\tisResize.value = true;\n\t}\n\n\tfunction endResize(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\t\tcursorType.value = 'default';\n\t\tupdateResizableBlock();\n\t\tisResize.value = false;\n\t\tresizingBlock.value = null;\n\t}\n\n\tfunction resizeTopSide(event: MouseEvent): void\n\t{\n\t\tlet newY = event.clientY / toValue(zoom);\n\t\tnewY += toValue(transformY);\n\t\tnewY -= toValue(blockDiagramTop) / toValue(zoom);\n\n\t\tlet newHeight = event.clientY / toValue(zoom);\n\t\tnewHeight += toValue(transformY);\n\t\tnewHeight -= toValue(blockDiagramTop) / toValue(zoom);\n\t\tnewHeight -= prevBlockY + prevBlockHeight;\n\t\tnewHeight = Math.abs(newHeight);\n\n\t\tconst fixedPositionY = prevBlockY + prevBlockHeight - toValue(minHeight);\n\n\t\tresizingBlock.value.position.y = newHeight < toValue(minHeight) || newY >= fixedPositionY\n\t\t\t? fixedPositionY\n\t\t\t: newY;\n\n\t\tresizingBlock.value.dimensions.height = newHeight < toValue(minHeight) || newY >= fixedPositionY\n\t\t\t? toValue(minHeight)\n\t\t\t: newHeight;\n\t}\n\n\tfunction resizeRightSide(event: MouseEvent): void\n\t{\n\t\tlet cursorX = event.clientX / toValue(zoom);\n\t\tcursorX += toValue(transformX);\n\t\tcursorX -= toValue(blockDiagramLeft) / toValue(zoom);\n\n\t\tlet newWidth = prevBlockX;\n\t\tnewWidth -= event.clientX / toValue(zoom);\n\t\tnewWidth -= toValue(transformX);\n\t\tnewWidth -= toValue(blockDiagramLeft) / toValue(zoom);\n\t\tnewWidth = Math.abs(newWidth);\n\n\t\tresizingBlock.value.dimensions.width = newWidth < toValue(minWidth) || cursorX <= prevBlockX\n\t\t\t? toValue(minWidth)\n\t\t\t: newWidth;\n\t}\n\n\tfunction resizeBottomSide(event: MouseEvent): void\n\t{\n\t\tlet cursorX = event.clientY / toValue(zoom);\n\t\tcursorX += toValue(transformY);\n\t\tcursorX -= toValue(blockDiagramTop) / toValue(zoom);\n\n\t\tlet newHeight = event.clientY / toValue(zoom);\n\t\tnewHeight -= prevBlockY;\n\t\tnewHeight += toValue(transformY);\n\t\tnewHeight -= toValue(blockDiagramTop) / toValue(zoom);\n\t\tnewHeight = Math.abs(newHeight);\n\n\t\tresizingBlock.value.dimensions.height = newHeight < toValue(minHeight) || cursorX <= prevBlockY\n\t\t\t? toValue(minHeight)\n\t\t\t: newHeight;\n\t}\n\n\tfunction resizeLeftSide(event: MouseEvent): void\n\t{\n\t\tlet newX = event.clientX / toValue(zoom);\n\t\tnewX += toValue(transformX);\n\t\tnewX -= toValue(blockDiagramLeft) / toValue(zoom);\n\n\t\tlet newWidth = event.clientX / toValue(zoom);\n\t\tnewWidth += toValue(transformX);\n\t\tnewWidth -= toValue(blockDiagramLeft) / toValue(zoom);\n\t\tnewWidth -= (prevBlockX + prevBlockWidth);\n\t\tnewWidth = Math.abs(newWidth);\n\n\t\tconst fixedPositionX = prevBlockX + prevBlockWidth - toValue(minWidth);\n\n\t\tresizingBlock.value.position.x = newWidth < toValue(minWidth) || newX >= fixedPositionX\n\t\t\t? fixedPositionX\n\t\t\t: newX;\n\n\t\tresizingBlock.value.dimensions.width = newWidth < toValue(minWidth) || newX >= fixedPositionX\n\t\t\t? toValue(minWidth)\n\t\t\t: newWidth;\n\t}\n\n\tfunction onMouseDownRightSide(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.EW_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveRightSide);\n\t\tEvent.bind(document, 'mouseup', onMouseUpRightSide);\n\t}\n\n\tfunction onMouseMoveRightSide(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeRightSide(event);\n\t}\n\n\tfunction onMouseUpRightSide(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveRightSide);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpRightSide);\n\t}\n\n\tfunction onMouseDownBottomSide(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NS_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveBottomSide);\n\t\tEvent.bind(document, 'mouseup', onMouseUpBottomSide);\n\t}\n\n\tfunction onMouseMoveBottomSide(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeBottomSide(event);\n\t}\n\n\tfunction onMouseUpBottomSide(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveBottomSide);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpBottomSide);\n\t}\n\n\tfunction onMouseDownLeftSide(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.EW_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveLeftSide);\n\t\tEvent.bind(document, 'mouseup', onMouseUpLeftSide);\n\t}\n\n\tfunction onMouseMoveLeftSide(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeLeftSide(event);\n\t}\n\n\tfunction onMouseUpLeftSide(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveLeftSide);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpLeftSide);\n\t}\n\n\tfunction onMouseDownTopSide(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NS_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveTopSide);\n\t\tEvent.bind(document, 'mouseup', onMouseUpTopSide);\n\t}\n\n\tfunction onMouseMoveTopSide(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeTopSide(event);\n\t}\n\n\tfunction onMouseUpTopSide(event: MouseEvent)\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveTopSide);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpTopSide);\n\t}\n\n\tfunction onMouseDownRightBottomCorner(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NWSE_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveRightBottomCorner);\n\t\tEvent.bind(document, 'mouseup', onMouseUpRightBottomCorner);\n\t}\n\n\tfunction onMouseMoveRightBottomCorner(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeRightSide(event);\n\t\tresizeBottomSide(event);\n\t}\n\n\tfunction onMouseUpRightBottomCorner(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveRightBottomCorner);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpRightBottomCorner);\n\t}\n\n\tfunction onMouseDownRightTopCorner(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NESW_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveRightTopCorner);\n\t\tEvent.bind(document, 'mouseup', onMouseUpRightTopCorner);\n\t}\n\n\tfunction onMouseMoveRightTopCorner(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeTopSide(event);\n\t\tresizeRightSide(event);\n\t}\n\n\tfunction onMouseUpRightTopCorner(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveRightTopCorner);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpRightTopCorner);\n\t}\n\n\tfunction onMouseDownLeftBottomCorner(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NESW_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveLeftBottomCorner);\n\t\tEvent.bind(document, 'mouseup', onMouseUpLeftBottomCorner);\n\t}\n\n\tfunction onMouseMoveLeftBottomCorner(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeLeftSide(event);\n\t\tresizeBottomSide(event);\n\t}\n\n\tfunction onMouseUpLeftBottomCorner(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveLeftBottomCorner);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpLeftBottomCorner);\n\t}\n\n\tfunction onMouseDownLeftTopCorner(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NWSE_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveLeftTopCorner);\n\t\tEvent.bind(document, 'mouseup', onMouseUpLeftTopCorner);\n\t}\n\n\tfunction onMouseMoveLeftTopCorner(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeLeftSide(event);\n\t\tresizeTopSide(event);\n\t}\n\n\tfunction onMouseUpLeftTopCorner(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveLeftTopCorner);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpLeftTopCorner);\n\t}\n\n\treturn {\n\t\tisResize,\n\t\tsizeBlockStyle,\n\t\tonMounted,\n\t\tonUnmounted,\n\t};\n}\n","import './canvas-transform.css';\nimport {\n\tcomputed,\n\ttoValue,\n\tuseTemplateRef,\n\tonMounted,\n\tonUnmounted,\n} from 'ui.vue3';\nimport { useCanvasTransfrom } from '../../composables';\nimport type { UseCanvasTransform } from '../../composables';\n\ntype CanvasTransformSetup = {\n\tcanvasTransformClassNames: { [string]: boolean },\n\tonMouseDown: Pick<UseCanvasTransform, 'onMouseDown'>,\n\tonMouseMove: Pick<UseCanvasTransform, 'onMouseMove'>,\n\tonMouseUp: Pick<UseCanvasTransform, 'onMouseUp'>,\n\tonWheel: Pick<UseCanvasTransform, 'onWheel'>,\n};\n\nconst CANVAS_TRANSFORM_CLASS_NAMES = {\n\tbase: 'ui-block-diagram-canvas-transform',\n\tdragging: '--dragging',\n};\n\n// @vue/component\nexport const CanvasTransform = {\n\tname: 'canvas-transform',\n\tprops: {\n\t\tcanvasStyle: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tzoomSensitivity: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.01,\n\t\t},\n\t\tzoomSensitivityMouse: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.04,\n\t\t},\n\t},\n\tsetup(props): CanvasTransformSetup\n\t{\n\t\tconst {\n\t\t\tisDragging,\n\t\t\tonMounted: onMountedCanvasTransform,\n\t\t\tonUmounted: onUnmountedCanvasTransform,\n\t\t\tonMouseDown,\n\t\t\tonMouseMove,\n\t\t\tonMouseUp,\n\t\t\tonWheel,\n\t\t} = useCanvasTransfrom({\n\t\t\tcanvasRef: useTemplateRef('canvasLayout'),\n\t\t\ttransformLayoutRef: useTemplateRef('transformLayout'),\n\t\t\tcanvasStyle: props.canvasStyle,\n\t\t\tzoomSensitivity: props.zoomSensitivity,\n\t\t\tzoomSensitivityMouse: props.zoomSensitivityMouse,\n\t\t});\n\n\t\tconst canvasTransformClassNames = computed((): { [string]: boolean } => ({\n\t\t\t[CANVAS_TRANSFORM_CLASS_NAMES.base]: true,\n\t\t\t[CANVAS_TRANSFORM_CLASS_NAMES.dragging]: toValue(isDragging),\n\t\t}));\n\n\t\tonMounted(() => {\n\t\t\tonMountedCanvasTransform();\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\tonUnmountedCanvasTransform();\n\t\t});\n\n\t\treturn {\n\t\t\tcanvasTransformClassNames,\n\t\t\tonMouseDown,\n\t\t\tonMouseMove,\n\t\t\tonMouseUp,\n\t\t\tonWheel,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"canvasTransformClassNames\"\n\t\t\t@mousedown=\"onMouseDown\"\n\t\t\t@mousemove=\"onMouseMove\"\n\t\t\t@mouseup=\"onMouseUp\"\n\t\t\t@wheel=\"onWheel\"\n\t\t\t@contextmenu.prevent\n\t\t>\n\t\t\t<canvas\n\t\t\t\tref=\"canvasLayout\"\n\t\t\t\tclass=\"ui-block-diagram-canvas-transform__canvas\"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tref=\"transformLayout\"\n\t\t\t\tclass=\"ui-block-diagram-canvas-transform__transform\"\n\t\t\t>\n\t\t\t\t<slot/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './connection.css';\nimport { computed, toValue } from 'ui.vue3';\nimport {\n\tuseConnectionState,\n\tuseContextMenu,\n\tuseBlockDiagram,\n\tuseLoc,\n} from '../../composables';\nimport type { UseConnectionState } from '../../composables';\nimport { CONNECTION_VIEW_TYPE } from '../../constants';\nimport type { DiagramConnection, DiagramConnectionViewType } from '../../types';\n\ntype ConnectionSetup = {\n\tconnectionPathInfo: Pick<UseConnectionState, 'connectionPathInfo'>;\n\ttargetConnectionClasses: { [string]: boolean };\n\tbarStyle: { [string]: string };\n\tonOpenContextMenu: () => void;\n}\n\nconst TARGET_CONNECTION_CLASSES = {\n\tbase: 'ui-block-diagram-connection__target',\n\tactive: '--active',\n};\n\n// @vue/component\nexport const Connection = {\n\tname: 'diagram-connection',\n\tprops: {\n\t\t/** @type DiagramConnection */\n\t\tconnection: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type DiagramConnectionViewType */\n\t\tviewType: {\n\t\t\ttype: String,\n\t\t\tdefault: CONNECTION_VIEW_TYPE.SMOOTHSTEP,\n\t\t\tvalidator(viewType): boolean\n\t\t\t{\n\t\t\t\treturn Object.values(CONNECTION_VIEW_TYPE).includes(viewType);\n\t\t\t},\n\t\t},\n\t\tbarWidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 22,\n\t\t},\n\t\tbarHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 22,\n\t\t},\n\t\tcontextMenuItems: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): ConnectionSetup\n\t{\n\t\tconst {\n\t\t\tconnectionPathInfo,\n\t\t\tisDisabled,\n\t\t} = useConnectionState({\n\t\t\tconnection: props.connection,\n\t\t\tviewType: props.viewType,\n\t\t});\n\t\tconst { deleteConnectionById } = useBlockDiagram();\n\t\tconst loc = useLoc();\n\t\tconst { isOpen, showContextMenu } = useContextMenu([\n\t\t\t{\n\t\t\t\tid: 'deleteConnection',\n\t\t\t\ttext: loc.getMessage('UI_BLOCK_DIAGRAM_DELETE_CONNECTION_CONTEXT_MENU_ITEM'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tdeleteConnectionById(props.connection.id);\n\t\t\t\t},\n\t\t\t},\n\t\t]);\n\n\t\tconst targetConnectionClasses = computed((): { [string]: boolean } => ({\n\t\t\t[TARGET_CONNECTION_CLASSES.base]: true,\n\t\t\t[TARGET_CONNECTION_CLASSES.active]: toValue(isOpen),\n\t\t}));\n\n\t\tconst barPosition = computed((): { [string]: number } => {\n\t\t\tconst { x: centerX = 0, y: centerY = 0 } = toValue(connectionPathInfo).center ?? {};\n\n\t\t\treturn {\n\t\t\t\tx: centerX - (props.barWidth / 2),\n\t\t\t\ty: centerY - (props.barHeight / 2),\n\t\t\t};\n\t\t});\n\n\t\tfunction onOpenContextMenu(event: MouseEvent): void\n\t\t{\n\t\t\tif (toValue(isDisabled) || props.disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\t\t\tshowContextMenu(event);\n\t\t}\n\n\t\treturn {\n\t\t\tisDisabled,\n\t\t\tconnectionPathInfo,\n\t\t\ttargetConnectionClasses,\n\t\t\tbarPosition,\n\t\t\tonOpenContextMenu,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<svg class=\"ui-block-diagram-connection\">\n\t\t\t<g class=\"ui-block-diagram-connection__group\">\n\t\t\t\t<path\n\t\t\t\t\t:d=\"connectionPathInfo.path\"\n\t\t\t\t\t:class=\"targetConnectionClasses\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('connectionLine', connection.id)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\t:d=\"connectionPathInfo.path\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('connectionHoveredLine', connection.id)\"\n\t\t\t\t\tclass=\"ui-block-diagram-connection__hovered\"\n\t\t\t\t\tstroke=\"transparent\"\n\t\t\t\t\tfill=\"transparent\"\n\t\t\t\t\t@contextmenu=\"onOpenContextMenu\"\n\t\t\t\t/>\n\t\t\t\t<foreignObject\n\t\t\t\t\t:x=\"barPosition.x\"\n\t\t\t\t\t:y=\"barPosition.y\"\n\t\t\t\t\t:width=\"barWidth\"\n\t\t\t\t\t:height=\"barHeight\"\n\t\t\t\t\tclass=\"ui-block-diagram-connection__bar\"\n\t\t\t\t>\n\t\t\t\t\t<slot :isDisabled=\"isDisabled || disabled\" />\n\t\t\t\t</foreignObject>\n\t\t\t</g>\n\t\t</svg>\n\t`,\n};\n","import './delete-connection-btn.css';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { useBlockDiagram } from '../../composables';\n\ntype DeleteConnectionBtnSetup = {\n\ticonSet: string,\n\tonDeleteConnection: () => void,\n};\n\n// @vue/component\nexport const DeleteConnectionBtn = {\n\tname: 'delete-connection-btn',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\tconnectionId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): DeleteConnectionBtnSetup\n\t{\n\t\tconst { deleteConnectionById } = useBlockDiagram();\n\n\t\tfunction onDeleteConnection(): void\n\t\t{\n\t\t\tif (props.disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdeleteConnectionById(props.connectionId);\n\t\t}\n\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t\tonDeleteConnection,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\tclass=\"ui-block-diagram-delete-connection-btn\"\n\t\t\t:data-test-id=\"$blockDiagramTestId('connectionDeleteBtn', connectionId)\"\n\t\t\t@click=\"onDeleteConnection\"\n\t\t>\n\t\t\t<div class=\"ui-block-diagram-delete-connection-btn__icon-wrap\">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"iconSet.TRASHCAN\"\n\t\t\t\t\t:size=\"14\"\n\t\t\t\t\tclass=\"ui-block-diagram-delete-connection-btn__icon\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</button>\n\t`,\n};\n","import './context-menu-layout.css';\nimport { computed, toValue } from 'ui.vue3';\nimport { useBlockDiagram } from '../../composables';\nimport type { UseBlockDiagran } from '../../composables';\n\nexport type ContextMenuLayoutSetup = {\n\tinstance: UseBlockDiagran,\n\ttargetContainerStyle: { [string]: string },\n};\n\n// @vue/component\nexport const ContextMenuLayout = {\n\tname: 'ContextMenuLayout',\n\tsetup(): ContextMenuLayoutSetup\n\t{\n\t\tconst instance = useBlockDiagram();\n\n\t\tconst targetContainerStyle = computed(() => ({\n\t\t\ttop: `${toValue(instance.positionContextMenu).top}px`,\n\t\t\tleft: `${toValue(instance.positionContextMenu).left}px`,\n\t\t}));\n\n\t\treturn {\n\t\t\tinstance,\n\t\t\ttargetContainerStyle,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:ref=\"instance.contextMenuLayerRef\"\n\t\t\tclass=\"ui-block-diagram-context-menu__layout\"\n\t\t>\n\t\t\t<slot/>\n\t\t\t<div\n\t\t\t\t:ref=\"instance.targetContainerRef\"\n\t\t\t\t:style=\"targetContainerStyle\"\n\t\t\t\tclass=\"ui-block-diagram-context-menu__target-container\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import './blocks-queue-transition.css';\nimport { toValue } from 'ui.vue3';\nimport { useBlockDiagram, useCanvas, useHistory, useHighlightedBlocks } from '../../composables';\n\ntype BlocksQueueTransitionSetup = {\n\tisAnimate: boolean;\n\tonEnter: () => void;\n\tonAfterEnter: () => void;\n\tonBeforeEnter: () => void;\n\tonAfterLeave: () => void;\n};\n\n// @vue/component\nexport const BlocksQueueTransition = {\n\tname: 'blocks-queue-transition',\n\tsetup(): BlocksQueueTransitionSetup\n\t{\n\t\tconst {\n\t\t\tisAnimate,\n\t\t\tcurrentAnimationItem,\n\t\t\tanimationQueue,\n\t\t\thooks,\n\t\t} = useBlockDiagram();\n\t\tconst canvas = useCanvas();\n\t\tconst history = useHistory();\n\t\tconst highlighted = useHighlightedBlocks();\n\n\t\tfunction nextAnimationItem()\n\t\t{\n\t\t\tconst { done = false } = toValue(animationQueue)?.next() ?? {};\n\n\t\t\tif (done)\n\t\t\t{\n\t\t\t\tanimationQueue.value = null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thistory.makeSnapshot();\n\t\t\t}\n\t\t}\n\n\t\tfunction onBeforeEnter(): void\n\t\t{\n\t\t\thooks.blockTransitionStart.trigger(toValue(currentAnimationItem)?.item);\n\t\t}\n\n\t\tfunction onEnter(): void\n\t\t{\n\t\t\thighlighted.clear();\n\t\t\thighlighted.add(toValue(currentAnimationItem).item.id);\n\t\t\tcanvas.goToBlockById(toValue(currentAnimationItem).item.id);\n\t\t}\n\n\t\tfunction onAfterEnter(): void\n\t\t{\n\t\t\thooks.blockTransitionEnd.trigger(toValue(currentAnimationItem)?.item);\n\t\t\tnextAnimationItem();\n\t\t}\n\n\t\tfunction onAfterLeave(): void\n\t\t{\n\t\t\tnextAnimationItem();\n\t\t}\n\n\t\treturn {\n\t\t\tisAnimate,\n\t\t\tonBeforeEnter,\n\t\t\tonEnter,\n\t\t\tonAfterEnter,\n\t\t\tonAfterLeave,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<TransitionGroup\n\t\t\tv-if=\"isAnimate\"\n\t\t\tname=\"ui-block-diagram-blocks-queue-transition\"\n\t\t\t@before-enter=\"onBeforeEnter\"\n\t\t\t@enter=\"onEnter\"\n\t\t\t@after-enter=\"onAfterEnter\"\n\t\t\t@after-leave=\"onAfterLeave\"\n\t\t>\n\t\t\t<slot/>\n\t\t</TransitionGroup>\n\t\t<template v-else>\n\t\t\t<slot/>\n\t\t</template>\n\t`,\n};\n","import './grouped-blocks.css';\nimport { useBlockDiagram } from '../../composables';\nimport { getGroupBlockSlotName } from '../../utils';\nimport { BlocksQueueTransition } from '../blocks-queue-transition/blocks-queue-transition';\nimport type {\n\tGroupedBlocks as TGroupedBlocks,\n\tBlockGroupNames,\n} from '../../types';\n\ntype GroupedBlocksSetup = {\n\tblockGroupNames: BlockGroupNames;\n\tgroupedBlocks: TGroupedBlocks;\n\tgetGroupBlockSlotName: typeof getGroupBlockSlotName;\n};\n\n// @vue/component\nexport const GroupedBlocks = {\n\tname: 'grouped-blocks',\n\tcomponents: {\n\t\tBlocksQueueTransition,\n\t},\n\tsetup(): GroupedBlocksSetup\n\t{\n\t\tconst { groupedBlocks, blockGroupNames } = useBlockDiagram();\n\n\t\treturn {\n\t\t\tblockGroupNames,\n\t\t\tgroupedBlocks,\n\t\t\tgetGroupBlockSlotName,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<BlocksQueueTransition>\n\t\t\t<slot\n\t\t\t\tv-for=\"group in blockGroupNames\"\n\t\t\t\t:key=\"group\"\n\t\t\t\t:name=\"getGroupBlockSlotName(group)\"\n\t\t\t\t:blocks=\"groupedBlocks[group]\"\n\t\t\t/>\n\t\t</BlocksQueueTransition>\n\t`,\n};\n","import './new-connection.css';\nimport { useNewConnectionState } from '../../composables';\nimport type { UseNewConnectionState } from '../../composables';\nimport { NEW_CONNECTION_VIEW_TYPE } from '../../constants';\nimport type { DiagramNewConnectionViewType } from '../../types';\n\ntype NewConnectionSetup = {\n\thasNewConnection: boolean;\n\tnewConnectionPathInfo: Pick<UseNewConnectionState, 'newConnectionPathInfo'>;\n};\n\n// @vue/component\nexport const NewConnection = {\n\tname: 'new-connection',\n\tprops: {\n\t\t/** @type DiagramNewConnectionViewType */\n\t\tviewType: {\n\t\t\ttype: String,\n\t\t\tdefault: NEW_CONNECTION_VIEW_TYPE.BEZIER,\n\t\t\tvalidator(viewType): boolean {\n\t\t\t\treturn Object.values(NEW_CONNECTION_VIEW_TYPE).includes(viewType);\n\t\t\t},\n\t\t},\n\t},\n\tsetup(props): NewConnectionSetup\n\t{\n\t\tconst {\n\t\t\thasNewConnection,\n\t\t\tnewConnectionPathInfo,\n\t\t} = useNewConnectionState({\n\t\t\tviewType: props.viewType,\n\t\t});\n\n\t\treturn {\n\t\t\thasNewConnection,\n\t\t\tnewConnectionPathInfo,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<svg\n\t\t\tv-if=\"hasNewConnection\"\n\t\t\tclass=\"ui-block-diagram-new-connection\"\n\t\t>\n\t\t\t<path\n\t\t\t\t:d=\"newConnectionPathInfo.path\"\n\t\t\t\tclass=\"ui-block-diagram-new-connection__path\"\n\t\t\t/>\n\t\t</svg>\n\t`,\n};\n","import './connections-queue-transition.css';\nimport { toValue } from 'ui.vue3';\nimport { useBlockDiagram, useHistory } from '../../composables';\n\ntype ConnectionsQueueTransitionSetup = {\n\tisAnimate: boolean;\n\tonBeforeEnter: () => void;\n\tonAfterEnter: () => void;\n\tonAfterLeave: () => void;\n};\n\n// @vue/component\nexport const ConnectionsQueueTransition = {\n\tname: 'connections-queue-transition',\n\tsetup(): ConnectionsQueueTransitionSetup\n\t{\n\t\tconst {\n\t\t\tisAnimate,\n\t\t\tcurrentAnimationItem,\n\t\t\tanimationQueue,\n\t\t\tupdatePortPosition,\n\t\t\thooks,\n\t\t} = useBlockDiagram();\n\t\tconst history = useHistory();\n\n\t\tfunction onBeforeEnter(): void\n\t\t{\n\t\t\tconst { item: connection } = toValue(currentAnimationItem) ?? {};\n\t\t\thooks.connectionTransitionStart.trigger(connection);\n\t\t\tconst {\n\t\t\t\tsourceBlockId,\n\t\t\t\tsourcePortId,\n\t\t\t\ttargetBlockId,\n\t\t\t\ttargetPortId,\n\t\t\t} = connection;\n\n\t\t\tupdatePortPosition(sourceBlockId, sourcePortId);\n\t\t\tupdatePortPosition(targetBlockId, targetPortId);\n\t\t}\n\n\t\tfunction nextAnimatedItem(): void\n\t\t{\n\t\t\tconst { done = false } = toValue(animationQueue)?.next() ?? {};\n\n\t\t\tif (done)\n\t\t\t{\n\t\t\t\tanimationQueue.value = null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thistory.makeSnapshot();\n\t\t\t}\n\t\t}\n\n\t\tfunction onAfterEnter(): void\n\t\t{\n\t\t\thooks.connectionTransitionEnd.trigger(toValue(currentAnimationItem)?.item);\n\t\t\tnextAnimatedItem();\n\t\t}\n\n\t\tfunction onAfterLeave(): void\n\t\t{\n\t\t\tnextAnimatedItem();\n\t\t}\n\n\t\treturn {\n\t\t\tisAnimate,\n\t\t\tonBeforeEnter,\n\t\t\tonAfterEnter,\n\t\t\tonAfterLeave,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<TransitionGroup\n\t\t\tv-if=\"isAnimate\"\n\t\t\tname=\"ui-block-diagram-connections-queue-transition\"\n\t\t\t@before-enter=\"onBeforeEnter\"\n\t\t\t@after-enter=\"onAfterEnter\"\n\t\t\t@after-leave=\"onAfterLeave\"\n\t\t>\n\t\t\t<slot/>\n\t\t</TransitionGroup>\n\t\t<template v-else>\n\t\t\t<slot/>\n\t\t</template>\n\t`,\n};\n","import './grouped-connections.css';\nimport { useBlockDiagram } from '../../composables';\nimport { Connection } from '../connection/connection';\nimport { NewConnection } from '../new-connection/new-connection';\nimport { ConnectionsQueueTransition } from '../connections-queue-transition/connections-queue-transition';\nimport { getGroupConnectionSlotName } from '../../utils';\nimport type {\n\tGroupedConnections as TGroupedConnections,\n\tConnectionGroupNames,\n} from '../../types';\n\ntype GroupedConnectionsSetup = {\n\tgroupedConnections: TGroupedConnections;\n\tconnectionGroupNames: ConnectionGroupNames;\n\tgetGroupConnectionSlotName: typeof getGroupConnectionSlotName;\n};\n\n// @vue/component\nexport const GroupedConnections = {\n\tname: 'grouped-connections',\n\tcomponents: {\n\t\tConnection,\n\t\tNewConnection,\n\t\tConnectionsQueueTransition,\n\t},\n\tsetup(): GroupedConnectionsSetup\n\t{\n\t\tconst {\n\t\t\tgroupedConnections,\n\t\t\tconnectionGroupNames,\n\t\t} = useBlockDiagram();\n\n\t\treturn {\n\t\t\tgroupedConnections,\n\t\t\tconnectionGroupNames,\n\t\t\tgetGroupConnectionSlotName,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<ConnectionsQueueTransition>\n\t\t\t<slot\n\t\t\t\tv-for=\"connection in connectionGroupNames\"\n\t\t\t\t:key=\"connection\"\n\t\t\t\t:name=\"getGroupConnectionSlotName(connection)\"\n\t\t\t\t:connections=\"groupedConnections[connection]\"\n\t\t\t/>\n\t\t\t<NewConnection/>\n\t\t</ConnectionsQueueTransition>\n\t`,\n};\n","import './moveable-block.css';\nimport { toRefs, useTemplateRef, watch, onUnmounted, computed, toValue } from 'ui.vue3';\nimport { useMoveableBlock, useBlockState, useHighlightedBlocks } from '../../composables';\n// eslint-disable-next-line no-unused-vars\nimport type { DiagramBlock } from '../../types';\n\ntype MoveableBlockSetup = {\n\tisDragged: boolean;\n\tisHiglitedBlock: boolean;\n\tblockPositionStyle: { [string]: string };\n\tisDisabled: boolean;\n\tonMouseDownSelectBlock: () => void;\n};\n\n// @vue/component\nexport const MoveableBlock = {\n\tname: 'moveable-block',\n\tprops: {\n\t\t/** @type DiagramBlock */\n\t\tblock: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\thighlighted: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): MoveableBlockSetup\n\t{\n\t\tconst { block } = toRefs(props);\n\t\tconst {\n\t\t\tblockZindex,\n\t\t\tisHiglitedBlock,\n\t\t\tisDisabled,\n\t\t} = useBlockState(block);\n\t\tconst highlightedBlocks = useHighlightedBlocks();\n\t\tconst { isDragged, blockPositionStyle } = useMoveableBlock(\n\t\t\tuseTemplateRef('blockEl'),\n\t\t\tblock,\n\t\t);\n\n\t\twatch(() => props.highlighted, (value) => {\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\thighlightedBlocks.add(props.block.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thighlightedBlocks.remove(props.block.id);\n\t\t\t}\n\t\t});\n\n\t\tconst blockStyle = computed((): { [string]: string } => ({\n\t\t\t...toValue(blockPositionStyle),\n\t\t\t...toValue(blockZindex),\n\t\t}));\n\n\t\tonUnmounted(() => {\n\t\t\thighlightedBlocks.remove(props.block.id);\n\t\t});\n\n\t\tfunction onMouseDownSelectBlock(): void\n\t\t{\n\t\t\thighlightedBlocks.clear();\n\t\t\thighlightedBlocks.add(props.block.id);\n\t\t}\n\n\t\treturn {\n\t\t\tisHiglitedBlock,\n\t\t\tisDisabled,\n\t\t\tisDragged,\n\t\t\tblockStyle,\n\t\t\tblockZindex,\n\t\t\tblockPositionStyle,\n\t\t\tonMouseDownSelectBlock,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"ui-block-diagram-moveable-block\"\n\t\t\t:style=\"blockStyle\"\n\t\t\tref=\"blockEl\"\n\t\t\t:data-test-id=\"$blockDiagramTestId('block', block.id)\"\n\t\t\t@mousedown=\"onMouseDownSelectBlock\"\n\t\t>\n\t\t\t<slot\n\t\t\t\t:block=\"block\"\n\t\t\t\t:isHighlighted=\"isHiglitedBlock\"\n\t\t\t\t:isDragged=\"isDragged\"\n\t\t\t\t:isDisabled=\"isDisabled\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import './port.css';\nimport {\n\tuseTemplateRef,\n\tcomputed,\n\ttoValue,\n\tonMounted,\n\tonUnmounted,\n} from 'ui.vue3';\nimport { usePortState, useNewConnection } from '../../composables';\nimport { PORT_POSITION } from '../../constants';\nimport type {\n\t// eslint-disable-next-line no-unused-vars\n\tDiagramPortPosition,\n\t// eslint-disable-next-line no-unused-vars\n\tDiagramBlock,\n\t// eslint-disable-next-line no-unused-vars\n\tDiagramPort,\n} from '../../types';\n\ntype PortSetup = {\n\tportClassNames: { [string]: boolean },\n\tonMouseDownPort: (event: MouseEvent) => void;\n\tonMouseOverPort: () => void;\n\tonMouseLeavePort: () => void;\n};\n\nconst PORT_CLASS_NAMES = {\n\tbase: 'ui-block-diagram-port',\n\tdisabled: '--disabled',\n\tactive: '--active',\n};\n\n// @vue/component\nexport const Port = {\n\tname: 'diagram-port',\n\tprops: {\n\t\t/** @type DiagramBlock */\n\t\tblock: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type DiagramPort */\n\t\tport: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type DiagramPortPosition */\n\t\tposition: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tvalidator(position): boolean\n\t\t\t{\n\t\t\t\treturn Object.values(PORT_POSITION).includes(position);\n\t\t\t},\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): PortSetup\n\t{\n\t\tconst {\n\t\t\tisDisabled,\n\t\t\tonMountedPort,\n\t\t\tonUnmountedPort,\n\t\t} = usePortState({\n\t\t\tportRef: useTemplateRef('port'),\n\t\t\tblock: props.block,\n\t\t\tport: props.port,\n\t\t\tposition: props.position,\n\t\t});\n\t\tconst {\n\t\t\tisSourcePort,\n\t\t\tonMouseDownPort,\n\t\t\tonMouseOverPort,\n\t\t\tonMouseLeavePort,\n\t\t} = useNewConnection(props.block, props.port);\n\n\t\tconst portClassNames = computed((): { [string]: boolean } => ({\n\t\t\t[PORT_CLASS_NAMES.base]: true,\n\t\t\t[PORT_CLASS_NAMES.active]: toValue(isSourcePort),\n\t\t\t[PORT_CLASS_NAMES.disabled]: toValue(isDisabled),\n\t\t}));\n\n\t\tonMounted(() => {\n\t\t\tonMountedPort();\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\tonUnmountedPort();\n\t\t});\n\n\t\treturn {\n\t\t\tportClassNames,\n\t\t\tonMouseDownPort,\n\t\t\tonMouseOverPort,\n\t\t\tonMouseLeavePort,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tref=\"port\"\n\t\t\t:class=\"portClassNames\"\n\t\t\t:data-test-id=\"$blockDiagramTestId('port', port.id)\"\n\t\t\t@mousedown=\"onMouseDownPort\"\n\t\t\t@mouseover=\"onMouseOverPort\"\n\t\t\t@mouseleave=\"onMouseLeavePort\"\n\t\t/>\n\t`,\n};\n","import './block-content-stub.css';\nimport { computed } from 'ui.vue3';\nimport { Port } from '../port/port';\nimport { useBlockDiagram, useContextMenu, useLoc } from '../../composables';\nimport type { DiagramBlock } from '../../type';\n\ntype BlockContentStubSetup = {\n\tblockContentClassNames: { [string]: boolean };\n};\n\nconst BLOCK_CONTENT_STUB_CLASS_NAMES = {\n\tbase: 'ui-block-diagram-block-content-stub',\n\thighlighted: '--highlighted',\n};\n\n// @vue/component\nexport const BlockContentStub = {\n\tname: 'block-content-stub',\n\tcomponents: {\n\t\tPort,\n\t},\n\tprops: {\n\t\t/* @type DiagramBlock */\n\t\tblock: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\thighlighted: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdragged: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): BlockContentStubSetup\n\t{\n\t\tconst { deleteBlockById } = useBlockDiagram();\n\t\tconst loc = useLoc();\n\t\tconst { showContextMenu } = useContextMenu([\n\t\t\t{\n\t\t\t\tid: 'deleteConnection',\n\t\t\t\ttext: loc.getMessage('UI_BLOCK_DIAGRAM_DELETE_BLOCK_CONTEXT_MENU_ITEM'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tdeleteBlockById(props.block.id);\n\t\t\t\t},\n\t\t\t},\n\t\t]);\n\n\t\tconst blockContentClassNames = computed((): { [string]: boolean } => ({\n\t\t\t[BLOCK_CONTENT_STUB_CLASS_NAMES.base]: true,\n\t\t\t[BLOCK_CONTENT_STUB_CLASS_NAMES.highlighted]: props.highlighted,\n\t\t}));\n\n\t\tfunction onShowContextMenu(event: MouseEvent): void\n\t\t{\n\t\t\tevent.preventDefault();\n\n\t\t\tif (props.disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { clientX, clientY } = event;\n\n\t\t\tshowContextMenu({\n\t\t\t\tclientX,\n\t\t\t\tclientY,\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tblockContentClassNames,\n\t\t\tonShowContextMenu,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"blockContentClassNames\"\n\t\t\t@contextmenu=\"onShowContextMenu\"\n\t\t>\n\t\t\t<div class=\"ui-block-diagram-block-content-stub__id\">\n\t\t\t\t{{ block.id }}\n\t\t\t</div>\n\n\t\t\t<div class=\"ui-block-diagram-block-content-stub__left-column\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"port in block.ports.input\"\n\t\t\t\t\t:key=\"port.id\"\n\t\t\t\t\tclass=\"ui-block-diagram-block-content-stub__port-line\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"ui-block-diagram-block-content-stub__port --left\">\n\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t\t\t:port=\"port\"\n\t\t\t\t\t\t\t:styled=\"false\"\n\t\t\t\t\t\t\t:portsToShow=\"null\"\n\t\t\t\t\t\t\tposition=\"left\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"ui-block-diagram-block-content-stub__right-column\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"port in block.ports.output\"\n\t\t\t\t\t:key=\"port.id\"\n\t\t\t\t\tclass=\"ui-block-diagram-block-content-stub__port-line\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"ui-block-diagram-block-content-stub__port --right\">\n\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t\t\t:port=\"port\"\n\t\t\t\t\t\t\t:styled=\"false\"\n\t\t\t\t\t\t\t:portsToShow=\"null\"\n\t\t\t\t\t\t\tposition=\"right\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './block-diagram.css';\nimport { onMounted, onUnmounted, useTemplateRef, computed, ref, toValue } from 'ui.vue3';\nimport { CanvasTransform } from '../canvas-transform/canvas-transform';\nimport { Connection } from '../connection/connection';\nimport { DeleteConnectionBtn } from '../delete-connection-btn/delete-connection-btn';\nimport { ContextMenuLayout } from '../context-menu-layout/context-menu-layout';\nimport { GroupedBlocks } from '../grouped-blocks/grouped-blocks';\nimport { GroupedConnections } from '../grouped-connections/grouped-connections';\nimport { MoveableBlock } from '../moveable-block/moveable-block';\nimport { BlockContentStub } from '../block-content-stub/block-content-stub';\nimport {\n\tuseHistory,\n\tuseBlockDiagram,\n\tuseModelValue,\n\tuseWatchProps,\n\tuseRegisterHooks,\n\tuseInitAppElements,\n\tuseDragAndDrop,\n} from '../../composables';\nimport { getGroupBlockSlotName, getGroupConnectionSlotName } from '../../utils';\n\nimport { HOOK_NAMES, CURSOR_TYPES } from '../../constants';\nimport type {\n\tBlockGroupNames,\n\tConnectionGroupNames,\n} from '../../types';\n\ntype BlockDiagramSetup = {\n\tblockGroupNames: BlockGroupNames;\n\tconnectionGroupNames: ConnectionGroupNames;\n\tgetGroupBlockSlotName: typeof getGroupBlockSlotName;\n\tgetGroupConnectionSlotName: typeof getGroupConnectionSlotName;\n};\n\nconst UI_CANVAS_GRID_COLOR = '#A1B8D9';\nconst UI_CANVAS_BACKGROUND_COLOR = '#ECF0F2';\n\nconst BLOCK_DIAGRAM_CLASS_NAMES = {\n\tbase: 'ui-block-diagram',\n\tewResize: '--cursor-ew-resize',\n\tnsResize: '--cursor-ns-resize',\n\tnwSeResize: '--cursor-nwse-resize',\n\tneSwResize: '--cursor-nesw-resize',\n\tgrabbing: '--grabbing',\n};\n\n// @vue/component\nexport const BlockDiagram = {\n\tname: 'block-diagram',\n\tcomponents: {\n\t\tCanvasTransform,\n\t\tContextMenuLayout,\n\t\tGroupedBlocks,\n\t\tGroupedConnections,\n\t\tConnection,\n\t\tDeleteConnectionBtn,\n\t\tMoveableBlock,\n\t\tBlockContentStub,\n\t},\n\tprops: {\n\t\t/** @type Array<DiagramBlock> */\n\t\tblocks: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type Array<DiagramConnection> */\n\t\tconnections: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tcanvasStyle: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({\n\t\t\t\tstyle: 'grid',\n\t\t\t\tsize: 64,\n\t\t\t\tgridColor: UI_CANVAS_GRID_COLOR,\n\t\t\t\tbackgroundColor: UI_CANVAS_BACKGROUND_COLOR,\n\t\t\t}),\n\t\t},\n\t\tzoomSensitivity: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.01,\n\t\t},\n\t\tzoomSensitivityMouse: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.04,\n\t\t},\n\t\tzoom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 1,\n\t\t},\n\t\tminZoom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.2,\n\t\t},\n\t\tmaxZoom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 4,\n\t\t},\n\t\thistoryHooks: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => ([\n\t\t\t\tHOOK_NAMES.END_DRAG_BLOCK,\n\t\t\t\tHOOK_NAMES.ADD_BLOCK,\n\t\t\t\tHOOK_NAMES.DELETE_BLOCK,\n\t\t\t\tHOOK_NAMES.CREATE_CONNECTION,\n\t\t\t\tHOOK_NAMES.DELETE_CONNECTION,\n\t\t\t]),\n\t\t},\n\t\tsnapshotHandler: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t\trevertHandler: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: [\n\t\t'update:blocks',\n\t\t'update:connections',\n\t\tHOOK_NAMES.CHANGED_BLOCKS,\n\t\tHOOK_NAMES.CHANGED_CONNECTIONS,\n\t\tHOOK_NAMES.START_DRAG_BLOCK,\n\t\tHOOK_NAMES.MOVE_DRAG_BLOCK,\n\t\tHOOK_NAMES.END_DRAG_BLOCK,\n\t\tHOOK_NAMES.ADD_BLOCK,\n\t\tHOOK_NAMES.UPDATE_BLOCK,\n\t\tHOOK_NAMES.DELETE_BLOCK,\n\t\tHOOK_NAMES.CREATE_CONNECTION,\n\t\tHOOK_NAMES.DELETE_CONNECTION,\n\t\tHOOK_NAMES.BLOCK_TRANSITION_START,\n\t\tHOOK_NAMES.BLOCK_TRANSITION_END,\n\t\tHOOK_NAMES.CONNECTION_TRANSITION_START,\n\t\tHOOK_NAMES.CONNECTION_TRANSITION_END,\n\t\tHOOK_NAMES.DROP_NEW_BLOCK,\n\t],\n\tsetup(props, { emit }): BlockDiagramSetup\n\t{\n\t\tconst {\n\t\t\tblockGroupNames,\n\t\t\tconnectionGroupNames,\n\t\t\tcursorType,\n\t\t} = useBlockDiagram(props);\n\t\tconst initAppElements = useInitAppElements({\n\t\t\tblockDiagramRef: useTemplateRef('blockDiagram'),\n\t\t});\n\t\tconst { makeSnapshot } = useHistory();\n\t\tconst { dispose: disposeModelValue } = useModelValue(emit);\n\t\tconst { dispose: disposeWatchProps } = useWatchProps(props);\n\t\tconst { dispose: disposeRegisterHooks } = useRegisterHooks(\n\t\t\t{\n\t\t\t\t...Object.entries(HOOK_NAMES)\n\t\t\t\t\t.reduce((acc, [name, hookName]) => {\n\t\t\t\t\t\tacc[hookName] = (...args) => {\n\t\t\t\t\t\t\temit(hookName, ...args);\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn acc;\n\t\t\t\t\t}, {}),\n\t\t\t},\n\t\t\t{\n\t\t\t\t...props.historyHooks.reduce((acc, hookName) => {\n\t\t\t\t\tacc[hookName] = () => makeSnapshot();\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {}),\n\t\t\t},\n\t\t);\n\t\tconst { onDrop } = useDragAndDrop();\n\n\t\tconst isGrabbing = ref(false);\n\n\t\tconst blockDiagramClassNames = computed(() => ({\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.base]: true,\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.grabbing]: isGrabbing.value,\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.ewResize]: toValue(cursorType) === CURSOR_TYPES.EW_RESIZE,\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.nsResize]: toValue(cursorType) === CURSOR_TYPES.NS_RESIZE,\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.nwSeResize]: toValue(cursorType) === CURSOR_TYPES.NWSE_RESIZE,\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.neSwResize]: toValue(cursorType) === CURSOR_TYPES.NESW_RESIZE,\n\t\t}));\n\n\t\tonMounted(() => {\n\t\t\tinitAppElements.onMountedAppElements();\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\tdisposeModelValue();\n\t\t\tdisposeWatchProps();\n\t\t\tdisposeRegisterHooks();\n\t\t\tinitAppElements.onUnmountedAppElements();\n\t\t});\n\n\t\tfunction onDragEnter(event)\n\t\t{\n\t\t\tisGrabbing.value = true;\n\t\t}\n\n\t\tfunction onDragLeave(event)\n\t\t{\n\t\t\tisGrabbing.value = false;\n\t\t}\n\n\t\tfunction onDragDrop(event): void\n\t\t{\n\t\t\tisGrabbing.value = false;\n\t\t\tonDrop(event);\n\t\t}\n\n\t\treturn {\n\t\t\tblockDiagramClassNames,\n\t\t\tblockGroupNames,\n\t\t\tconnectionGroupNames,\n\t\t\tgetGroupBlockSlotName,\n\t\t\tgetGroupConnectionSlotName,\n\t\t\tonDragDrop,\n\t\t\tonDragEnter,\n\t\t\tonDragLeave,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"blockDiagramClassNames\"\n\t\t\tref=\"blockDiagram\"\n\t\t\t@dragover.prevent\n\t\t\t@dragenter=\"onDragEnter\"\n\t\t\t@dragleave=\"onDragLeave\"\n\t\t\t@drop=\"onDragDrop\"\n\t\t>\n\t\t\t<CanvasTransform\n\t\t\t\t:canvasStyle=\"canvasStyle\"\n\t\t\t\t:zoomSensitivity=\"zoomSensitivity\"\n\t\t\t\t:zoomSensitivityMouse=\"zoomSensitivityMouse\"\n\t\t\t>\n\t\t\t\t<ContextMenuLayout>\n\t\t\t\t\t<GroupedConnections>\n\t\t\t\t\t\t<template\n\t\t\t\t\t\t\tv-for=\"groupName in connectionGroupNames\"\n\t\t\t\t\t\t\t#[getGroupConnectionSlotName(groupName)]=\"{ connections }\"\n\t\t\t\t\t\t\t:key=\"groupName\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\tv-for=\"connection in connections\"\n\t\t\t\t\t\t\t\t:name=\"getGroupConnectionSlotName(groupName)\"\n\t\t\t\t\t\t\t\t:key=\"connection.id\"\n\t\t\t\t\t\t\t\t:connection=\"connection\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Connection\n\t\t\t\t\t\t\t\t\t:connection=\"connection\"\n\t\t\t\t\t\t\t\t\t:key=\"connection.id\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #default=\"{ isDisabled }\">\n\t\t\t\t\t\t\t\t\t\t<DeleteConnectionBtn \n\t\t\t\t\t\t\t\t\t\t\t:connectionId=\"connection.id\"\n\t\t\t\t\t\t\t\t\t\t\t:disabled=\"isDisabled\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</Connection>\n\t\t\t\t\t\t\t</slot>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #new-connection>\n\t\t\t\t\t\t\t<slot name=\"new-connection\"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</GroupedConnections>\n\t\t\t\t\t<GroupedBlocks>\n\t\t\t\t\t\t<template\n\t\t\t\t\t\t\tv-for=\"groupName in blockGroupNames\"\n\t\t\t\t\t\t\t#[getGroupBlockSlotName(groupName)]=\"{ blocks }\"\n\t\t\t\t\t\t\t:key=\"groupName\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\tv-for=\"block in blocks\"\n\t\t\t\t\t\t\t\t:name=\"getGroupBlockSlotName(groupName)\"\n\t\t\t\t\t\t\t\t:key=\"block.id\"\n\t\t\t\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<MoveableBlock\n\t\t\t\t\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t\t\t\t\t:key=\"block.id\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #default=\"{ isHighlighted, isDragged, isDisabled }\">\n\t\t\t\t\t\t\t\t\t\t<BlockContentStub\n\t\t\t\t\t\t\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t\t\t\t\t\t\t:highlighted=\"isHighlighted\"\n\t\t\t\t\t\t\t\t\t\t\t:dragged=\"isDragged\"\n\t\t\t\t\t\t\t\t\t\t\t:disabled=\"isDisabled\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</MoveableBlock>\n\t\t\t\t\t\t\t</slot>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</GroupedBlocks>\n\t\t\t\t</ContextMenuLayout>\n\t\t\t</CanvasTransform>\n\t\t</div>\n\t`,\n};\n","import './icon-button.css';\nimport { computed, toRefs, toValue } from 'ui.vue3';\nimport { BIcon } from 'ui.icon-set.api.vue';\n\nexport type IconButtonSetup = {\n\ticonName: string,\n\tcolor: string,\n\tsize: number,\n\tbuttonClassNames: { [string]: boolean },\n\tbuttonStyle: { [string]: string },\n\ticonClassNames: { [string]: boolean },\n};\n\n// @vue/component\nexport const IconButton = {\n\tname: 'icon-button',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\ticonName: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsize: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 16,\n\t\t},\n\t\tcolor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#959CA4',\n\t\t},\n\t\tactive: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tactiveColor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#4A9DFF',\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): IconButtonSetup\n\t{\n\t\tconst { size, active, disabled } = toRefs(props);\n\t\tconst buttonClassNames = computed(() => ({\n\t\t\t'ui-block-diagram-icon-button': true,\n\t\t\t'--disabled': toValue(disabled),\n\t\t}));\n\t\tconst buttonStyle = computed(() => ({\n\t\t\twidth: `${toValue(size)}px`,\n\t\t\theight: `${toValue(size)}px`,\n\t\t}));\n\t\tconst iconClassNames = computed(() => ({\n\t\t\t'ui-block-diagram-icon-button__icon': true,\n\t\t\t'--active': toValue(active),\n\t\t}));\n\n\t\treturn {\n\t\t\tbuttonClassNames,\n\t\t\tbuttonStyle,\n\t\t\ticonClassNames,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\t:class=\"buttonClassNames\"\n\t\t\t:style=\"buttonStyle\"\n\t\t>\n\t\t\t<slot>\n\t\t\t\t<BIcon\n\t\t\t\t\t:class=\"iconClassNames\"\n\t\t\t\t\t:name=\"iconName\"\n\t\t\t\t\t:color=\"color\"\n\t\t\t\t\t:size=\"size\"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t</button>\n\t`,\n};\n","import './history-bar.css';\nimport { toValue } from 'ui.vue3';\nimport { useHistory, useBlockDiagram } from '../../composables';\nimport { IconButton } from '../icon-button/icon-button';\nimport { Outline } from 'ui.icon-set.api.vue';\n\nexport type HistoryBarSetup = {\n\thasNext: boolean,\n\thasPrev: boolean,\n\tonNext: () => void,\n\tonPrev: () => void,\n\tOutline: {...},\n};\n\n// @vue/component\nexport const HistoryBar = {\n\tname: 'history-bar',\n\tcomponents: {\n\t\tIconButton,\n\t},\n\tprops: {\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): HistoryBarSetup\n\t{\n\t\tconst { isDisabledBlockDiagram } = useBlockDiagram();\n\t\tconst {\n\t\t\thasNext,\n\t\t\thasPrev,\n\t\t\tnext,\n\t\t\tprev,\n\t\t} = useHistory();\n\n\t\tfunction onNext(): void\n\t\t{\n\t\t\tif (props.disabled || toValue(isDisabledBlockDiagram))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnext();\n\t\t}\n\n\t\tfunction onPrev(): void\n\t\t{\n\t\t\tif (props.disabled || toValue(isDisabledBlockDiagram))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tprev();\n\t\t}\n\n\t\treturn {\n\t\t\thasNext,\n\t\t\thasPrev,\n\t\t\tonNext,\n\t\t\tonPrev,\n\t\t\tOutline,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-block-diagram-histoy-bar\">\n\t\t\t<slot>\n\t\t\t\t<IconButton\n\t\t\t\t\tclass=\"ui-block-diagram-histoy-bar__prev-button\"\n\t\t\t\t\t:icon-name=\"Outline.FORWARD\"\n\t\t\t\t\t:size=\"22\"\n\t\t\t\t\t:disabled=\"!hasPrev\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('historyPrevBtn')\"\n\t\t\t\t\t@click=\"onPrev\"\n\t\t\t\t/>\n\t\t\t\t<IconButton\n\t\t\t\t\t:icon-name=\"Outline.FORWARD\"\n\t\t\t\t\t:size=\"22\"\n\t\t\t\t\t:disabled=\"!hasNext\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('historyNextBtn')\"\n\t\t\t\t\t@click=\"onNext\"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t</div>\n\t`,\n};\n","import './zoom-btn.css';\nimport { toValue, toRefs } from 'ui.vue3';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { useBlockDiagram, useCanvas } from '../../composables';\n\ntype ZoomType = 'in' | 'out';\n\nconst ZOOM_TYPES = {\n\tin: 'in',\n\tout: 'out',\n};\n\n// @vue/component\nexport const ZoomBtn = {\n\tname: 'zoom-btn',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\tstepZoom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.2,\n\t\t},\n\t\t/** @type ZoomType */\n\t\ttypeZoom: {\n\t\t\ttype: String,\n\t\t\tdefault: ZOOM_TYPES.in,\n\t\t\tvalidator(value): boolean\n\t\t\t{\n\t\t\t\treturn value === ZOOM_TYPES.in || value === ZOOM_TYPES.out;\n\t\t\t},\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['zoom-change'],\n\tsetup(props, { emit }): {...}\n\t{\n\t\tconst { isDisabledBlockDiagram } = useBlockDiagram();\n\t\tconst { zoomIn, zoomOut } = useCanvas();\n\n\t\tconst {\n\t\t\tstepZoom,\n\t\t\ttypeZoom,\n\t\t} = toRefs(props);\n\n\t\tfunction onZoom()\n\t\t{\n\t\t\tif (props.disabled || toValue(isDisabledBlockDiagram))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (toValue(typeZoom) === ZOOM_TYPES.in)\n\t\t\t{\n\t\t\t\tzoomIn(toValue(stepZoom));\n\t\t\t}\n\t\t\telse if (toValue(typeZoom) === ZOOM_TYPES.out)\n\t\t\t{\n\t\t\t\tzoomOut(toValue(stepZoom));\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t\tzoomTypes: ZOOM_TYPES,\n\t\t\tonZoom,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\tclass=\"ui-block-diagram-control-btn__btn\"\n\t\t\t@click=\"onZoom\"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tv-if=\"typeZoom === zoomTypes.in\"\n\t\t\t\t:name=\"iconSet.PLUS_M\"\n\t\t\t\t:size=\"22\"\n\t\t\t\tclass=\"ui-block-diagram-control-btn__icon\"\n\t\t\t/>\n\t\t\t<BIcon\n\t\t\t\tv-else\n\t\t\t\t:name=\"iconSet.MINUS_M\"\n\t\t\t\t:size=\"22\"\n\t\t\t\tclass=\"ui-block-diagram-control-btn__icon\"\n\t\t\t/>\n\t\t</button>\n\t`,\n};\n","import './zoom-percent.css';\nimport { computed, toValue } from 'ui.vue3';\nimport { useBlockDiagram } from '../../composables';\n\ntype ZoomPercentSetup = {\n\tpercent: number,\n}\n\n// @vue/component\nexport const ZoomPercent = {\n\tname: 'zoom-percent',\n\tsetup(props): ZoomPercentSetup\n\t{\n\t\tconst { zoom } = useBlockDiagram();\n\n\t\tconst percent = computed(() => {\n\t\t\treturn ((toValue(zoom) ?? 0) * 100).toFixed(0);\n\t\t});\n\n\t\treturn {\n\t\t\tpercent,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<span class=\"ui-block-diagram-percent\">{{ percent }}</span>\n\t`,\n};\n","import './canvas-map.css';\nimport { Type } from 'main.core';\nimport { toValue, ref, computed, toRefs, useTemplateRef } from 'ui.vue3';\nimport { useBlockDiagram, useCanvas } from '../../composables';\nimport type { DiagramBlock } from '../../types';\n\ntype CursorRectPosition = {\n\tx: number;\n\ty: number;\n\twidth: number;\n\theight: number;\n}\n\ntype CanvasMapSetup = {\n\tmapWidth: number;\n\tmapHeight: number;\n\tpreparedBlock: Array<DiagramBlock>,\n\tcanvasMapStyle: { [string]: string };\n\tstartDiagramX: number;\n\tstartDiagramY: number;\n\tscaleMap: number;\n\tcursorRectPosition: CursorRectPosition;\n\tonMapMouseDown: (event: MouseEvent) => void;\n\tonMapMouseMove: (event: MouseEvent) => void;\n\tonMapMouseUp: (event: MouseEvent) => void;\n};\n\nconst CURSOR_RECT_STROKE_WIDTH: number = 2;\n\nconst FIRST_EMPTY_BLOCK_ID = 'firstCanvasBlock';\nconst LAST_EMPTY_BLOCK_ID = 'lastCanvasBlock';\n\n// @vue/component\nexport const CanvasMap = {\n\tname: 'canvas-map',\n\tprops: {\n\t\tmapWidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 310,\n\t\t},\n\t\tmapHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 183,\n\t\t},\n\t},\n\t// eslint-disable-next-line max-lines-per-function\n\tsetup(props, { emit }): CanvasMapSetup\n\t{\n\t\tconst {\n\t\t\tblocks,\n\t\t\tcanvasWidth,\n\t\t\tcanvasHeight,\n\t\t\ttransformX,\n\t\t\ttransformY,\n\t\t\tzoom,\n\t\t} = useBlockDiagram();\n\t\tconst { setCamera } = useCanvas();\n\t\tconst { mapWidth, mapHeight } = toRefs(props);\n\t\tconst mapEl = useTemplateRef('map');\n\n\t\tlet mapElLeft: number = 0;\n\t\tlet mapElTop: number = 0;\n\n\t\tconst isDragged = ref(false);\n\n\t\tconst canvasMapStyle = computed((): { [string]: string } => ({\n\t\t\twidth: `${toValue(mapWidth)}px`,\n\t\t\theight: `${toValue(mapHeight)}px`,\n\t\t}));\n\n\t\tconst preparedBlock = computed((): Array<DiagramBlock> => {\n\t\t\tif (toValue(blocks).length === 1)\n\t\t\t{\n\t\t\t\treturn [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: FIRST_EMPTY_BLOCK_ID,\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdimensions: {\n\t\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\t\theight: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{ ...toValue(blocks)[0] },\n\t\t\t\t\t{\n\t\t\t\t\t\tid: LAST_EMPTY_BLOCK_ID,\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tx: props.mapWidth,\n\t\t\t\t\t\t\ty: props.mapHeight,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdimensions: {\n\t\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\t\theight: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn toValue(blocks);\n\t\t});\n\n\t\tconst startDiagramX = computed((): number => {\n\t\t\treturn toValue(preparedBlock)\n\t\t\t\t.reduce((min, block) => Math.min(min, block.position.x), Infinity);\n\t\t});\n\n\t\tconst startDiagramY = computed((): number => {\n\t\t\treturn toValue(preparedBlock)\n\t\t\t\t.reduce((min, block) => Math.min(min, block.position.y), Infinity);\n\t\t});\n\n\t\tconst diagramWidth = computed((): number => {\n\t\t\tif (!Type.isArrayFilled(toValue(blocks)))\n\t\t\t{\n\t\t\t\treturn props.mapWidth;\n\t\t\t}\n\n\t\t\tconst maxX: number = toValue(preparedBlock).reduce(\n\t\t\t\t(max, block): number => Math.max(max, block.position.x + block.dimensions.width),\n\t\t\t\t-Infinity,\n\t\t\t);\n\n\t\t\treturn maxX - toValue(startDiagramX);\n\t\t});\n\n\t\tconst diagramHeight = computed((): number => {\n\t\t\tif (!Type.isArrayFilled(toValue(blocks)))\n\t\t\t{\n\t\t\t\treturn props.mapHeight;\n\t\t\t}\n\n\t\t\tconst maxY: number = toValue(preparedBlock).reduce(\n\t\t\t\t(max, block) => Math.max(max, block.position.y + block.dimensions.height),\n\t\t\t\t-Infinity,\n\t\t\t);\n\n\t\t\treturn maxY - toValue(startDiagramY);\n\t\t});\n\n\t\tconst scaleMap = computed((): number => {\n\t\t\treturn Math.min(\n\t\t\t\ttoValue(mapWidth) / toValue(diagramWidth),\n\t\t\t\ttoValue(mapHeight) / toValue(diagramHeight),\n\t\t\t);\n\t\t});\n\n\t\tconst cursorRectWidth = computed((): number => {\n\t\t\treturn toValue(canvasWidth) * toValue(scaleMap) / toValue(zoom);\n\t\t});\n\n\t\tconst cursorRectHeight = computed((): number => {\n\t\t\treturn toValue(canvasHeight) * toValue(scaleMap) / toValue(zoom);\n\t\t});\n\n\t\tconst cursorRectPosition = computed((): CursorRectPosition => {\n\t\t\tlet width = toValue(cursorRectWidth);\n\t\t\tlet height = toValue(cursorRectHeight);\n\n\t\t\tlet x = (toValue(transformX) - toValue(startDiagramX)) * toValue(scaleMap);\n\t\t\tlet y = (toValue(transformY) - toValue(startDiagramY)) * toValue(scaleMap);\n\n\t\t\t[x, width] = width > toValue(mapWidth)\n\t\t\t\t? [1, toValue(mapWidth) - CURSOR_RECT_STROKE_WIDTH]\n\t\t\t\t: [x, width];\n\n\t\t\t[y, height] = height > toValue(mapHeight)\n\t\t\t\t? [1, toValue(mapHeight) - CURSOR_RECT_STROKE_WIDTH]\n\t\t\t\t: [y, height];\n\n\t\t\tx = x < 0 ? 1 : x;\n\t\t\ty = y < 0 ? 1 : y;\n\n\t\t\tx = (x + width) > toValue(mapWidth)\n\t\t\t\t? toValue(mapWidth) - width - CURSOR_RECT_STROKE_WIDTH\n\t\t\t\t: x;\n\t\t\ty = (y + height) > toValue(mapHeight)\n\t\t\t\t? toValue(mapHeight) - height - CURSOR_RECT_STROKE_WIDTH\n\t\t\t\t: y;\n\n\t\t\treturn {\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t};\n\t\t});\n\n\t\tfunction updateCameraPosition(event: MouseEvent): void\n\t\t{\n\t\t\tconst x: number = event.clientX - mapElLeft;\n\t\t\tconst y: number = event.clientY - mapElTop;\n\n\t\t\tconst canvasX: number = x / toValue(scaleMap) + toValue(startDiagramX);\n\t\t\tconst canvasY: number = y / toValue(scaleMap) + toValue(startDiagramY);\n\n\t\t\tsetCamera({\n\t\t\t\tx: canvasX - (toValue(canvasWidth) / toValue(zoom) / 2),\n\t\t\t\ty: canvasY - (toValue(canvasHeight) / toValue(zoom) / 2),\n\t\t\t\tzoom: toValue(zoom),\n\t\t\t\tviewportX: 0,\n\t\t\t\tviewportY: 0,\n\t\t\t});\n\t\t}\n\n\t\tfunction onMapMouseDown(event: MouseEvent): void\n\t\t{\n\t\t\tisDragged.value = true;\n\n\t\t\tif (toValue(mapEl))\n\t\t\t{\n\t\t\t\tconst { left, top } = toValue(mapEl).getBoundingClientRect();\n\t\t\t\t[mapElLeft, mapElTop] = [left, top];\n\t\t\t}\n\n\t\t\tupdateCameraPosition(event);\n\t\t}\n\n\t\tfunction onMapMouseMove(event: MouseEvent): void\n\t\t{\n\t\t\tif (!toValue(isDragged))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdateCameraPosition(event);\n\t\t}\n\n\t\tfunction onMapMouseUp(event: MouseEvent): void\n\t\t{\n\t\t\tisDragged.value = false;\n\t\t\tupdateCameraPosition(event);\n\t\t}\n\n\t\treturn {\n\t\t\tpreparedBlock,\n\t\t\tcanvasMapStyle,\n\t\t\tstartDiagramX,\n\t\t\tstartDiagramY,\n\t\t\tscaleMap,\n\t\t\tcursorRectPosition,\n\t\t\tonMapMouseDown,\n\t\t\tonMapMouseMove,\n\t\t\tonMapMouseUp,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div :style=\"canvasMapStyle\">\n\t\t\t<svg\n\t\t\t\t:width=\"mapWidth\"\n\t\t\t\t:height=\"mapHeight\"\n\t\t\t\tref=\"map\"\n\t\t\t\tclass=\"ui-block-diagram-canvas-map\"\n\t\t\t\t@mousedown=\"onMapMouseDown\"\n\t\t\t\t@mousemove=\"onMapMouseMove\"\n\t\t\t\t@mouseup=\"onMapMouseUp\"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tv-for=\"block in preparedBlock\"\n\t\t\t\t\t:key=\"block.id\"\n\t\t\t\t\t:x=\"(block.position.x - startDiagramX) * scaleMap\"\n\t\t\t\t\t:y=\"(block.position.y - startDiagramY) * scaleMap\"\n\t\t\t\t\t:width=\"block.dimensions.width * scaleMap\"\n\t\t\t\t\t:height=\"block.dimensions.height * scaleMap\"\n\t\t\t\t\t:rx=\"2\"\n\t\t\t\t\tclass=\"ui-block-diagram-canvas-map__block\"\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\t:x=\"cursorRectPosition.x\"\n\t\t\t\t\t:y=\"cursorRectPosition.y\"\n\t\t\t\t\t:width=\"cursorRectPosition.width\"\n\t\t\t\t\t:height=\"cursorRectPosition.height\"\n\t\t\t\t\t:rx=\"3\"\n\t\t\t\t\tclass=\"ui-block-diagram-canvas-map__cursor\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</div>\n\t`,\n};\n","import './canvas-map-btn.css';\nimport { Type } from 'main.core';\nimport { toValue, computed } from 'ui.vue3';\nimport { useBlockDiagram } from '../../composables';\nimport type { DiagramBlock } from '../../types';\n\ntype CanvasMapBtnSetup = {\n\tblocks: Array<DiagramBlock>,\n\tbtnStyle: { [string]: string};\n\tstartDiagramX: number;\n\tstartDiagramY: number;\n\tscaleButton: number;\n};\n\n// @vue/component\nexport const CanvasMapBtn = {\n\tname: 'canvas-map-btn',\n\tprops: {\n\t\twidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 75,\n\t\t},\n\t\theight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 32,\n\t\t},\n\t},\n\tsetup(props): CanvasMapBtnSetup\n\t{\n\t\tconst { blocks } = useBlockDiagram();\n\n\t\tconst btnStyle = computed(() => ({\n\t\t\twidth: `${props.width}px`,\n\t\t\theight: `${props.height}px`,\n\t\t}));\n\n\t\tconst startDiagramX = computed((): number => {\n\t\t\treturn toValue(blocks)\n\t\t\t\t.reduce((min, block) => Math.min(min, block.position.x), Infinity);\n\t\t});\n\n\t\tconst startDiagramY = computed((): number => {\n\t\t\treturn toValue(blocks)\n\t\t\t\t.reduce((min, block) => Math.min(min, block.position.y), Infinity);\n\t\t});\n\n\t\tconst diagramWidth = computed((): number => {\n\t\t\tif (!Type.isArrayFilled(toValue(blocks)))\n\t\t\t{\n\t\t\t\treturn props.width;\n\t\t\t}\n\n\t\t\tconst maxX: number = toValue(blocks).reduce(\n\t\t\t\t(max, block): number => Math.max(max, block.position.x + block.dimensions.width),\n\t\t\t\t-Infinity,\n\t\t\t);\n\n\t\t\treturn maxX - toValue(startDiagramX);\n\t\t});\n\n\t\tconst diagramHeight = computed((): number => {\n\t\t\tif (!Type.isArrayFilled(toValue(blocks)))\n\t\t\t{\n\t\t\t\treturn props.height;\n\t\t\t}\n\n\t\t\tconst maxY: number = toValue(blocks).reduce(\n\t\t\t\t(max, block) => Math.max(max, block.position.y + block.dimensions.height),\n\t\t\t\t-Infinity,\n\t\t\t);\n\n\t\t\treturn maxY - toValue(startDiagramY);\n\t\t});\n\n\t\tconst scaleButton = computed((): number => {\n\t\t\treturn Math.min(props.width / toValue(diagramWidth), props.height / toValue(diagramHeight));\n\t\t});\n\n\t\treturn {\n\t\t\tblocks,\n\t\t\tbtnStyle,\n\t\t\tstartDiagramX,\n\t\t\tstartDiagramY,\n\t\t\tscaleButton,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\t:style=\"btnStyle\"\n\t\t\tclass=\"ui-block-diagram-canvas-map-btn\"\n\t\t>\n\t\t\t<svg\n\t\t\t\t:width=\"width\"\n\t\t\t\t:height=\"height\"\n\t\t\t\tclass=\"ui-block-diagram-canvas-map-btn__icon\"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tv-for=\"block in blocks\"\n\t\t\t\t\t:key=\"block.id\"\n\t\t\t\t\t:x=\"(block.position.x - startDiagramX) * scaleButton\"\n\t\t\t\t\t:y=\"(block.position.y - startDiagramY) * scaleButton\"\n\t\t\t\t\t:width=\"block.dimensions.width * scaleButton\"\n\t\t\t\t\t:height=\"block.dimensions.height * scaleButton\"\n\t\t\t\t\t:rx=\"1\"\n\t\t\t\t\tclass=\"ui-block-diagram-canvas-map-btn__rect\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</button>\n\t`,\n};\n","import './zoom-bar.css';\nimport { ref, toValue, computed } from 'ui.vue3';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { ZoomBtn } from '../zoom-btn/zoom-btn';\nimport { ZoomPercent } from '../zoom-percent/zoom-percent';\nimport { CanvasMap } from '../canvas-map/canvas-map';\nimport { CanvasMapBtn } from '../canvas-map-btn/canvas-map-btn';\n\ntype ZoomBarSetup = {\n\ticonSet: { [string]: string };\n\tmapPositionClasses: { [string]: boolean };\n\tisShowMap: boolean;\n\tonToggleMap: () => void,\n};\n\nconst VERTICAL_MAP_POSITION: { [string]: string } = {\n\tleft: 'left',\n\tright: 'right',\n};\n\nconst GORIZONTAL_MAP_POSITION: { [string]: string } = {\n\ttop: 'top',\n\tbottom: 'bottom',\n};\n\nconst MAP_CLASSES: { [string]: string } = {\n\tbase: 'ui-block-diagram-canvas-zoom-bar__map',\n\ttop: '--top',\n\tbottom: '--bottom',\n\tleft: '--left',\n\tright: '--right',\n};\n\nconst POSITION_MAP_DEFAULT_VALUES: string = 'top right';\n\n// @vue/component\nexport const ZoomBar = {\n\tname: 'zoom-bar',\n\tcomponents: {\n\t\tBIcon,\n\t\tZoomBtn,\n\t\tZoomPercent,\n\t\tCanvasMap,\n\t\tCanvasMapBtn,\n\t},\n\tprops: {\n\t\tstepZoom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.2,\n\t\t},\n\t\tpositionMap: {\n\t\t\ttype: String,\n\t\t\tdefault: POSITION_MAP_DEFAULT_VALUES,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['update:modelValue'],\n\tsetup(props): ZoomBarSetup\n\t{\n\t\tconst isShowMap = ref(false);\n\n\t\tconst mapPositionClasses = computed((): { [string]: boolean } => {\n\t\t\tconst isTop = props.positionMap\n\t\t\t\t.toLowerCase()\n\t\t\t\t.includes(GORIZONTAL_MAP_POSITION.top);\n\t\t\tconst isLeft = props.positionMap\n\t\t\t\t.toLowerCase()\n\t\t\t\t.includes(VERTICAL_MAP_POSITION.left);\n\n\t\t\treturn {\n\t\t\t\t[MAP_CLASSES.base]: true,\n\t\t\t\t[MAP_CLASSES.top]: isTop,\n\t\t\t\t[MAP_CLASSES.bottom]: !isTop,\n\t\t\t\t[MAP_CLASSES.left]: isLeft,\n\t\t\t\t[MAP_CLASSES.right]: !isLeft,\n\t\t\t};\n\t\t});\n\n\t\tfunction onToggleMap(): void\n\t\t{\n\t\t\tif (props.disabled)\n\t\t\t{\n\t\t\t\tisShowMap.value = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisShowMap.value = !toValue(isShowMap);\n\t\t}\n\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t\tmapPositionClasses,\n\t\t\tisShowMap,\n\t\t\tonToggleMap,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-block-diagram-canvas-zoom-bar\">\n\t\t\t<div class=\"ui-block-diagram-canvas-zoom-bar__locate\">\n\t\t\t\t<CanvasMapBtn\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('zoomOpenMapBtn')\"\n\t\t\t\t\t@click=\"onToggleMap\"\n\t\t\t\t/>\n\t\t\t\t<transition name=\"editor-large-map-fade\" mode=\"in-out\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"isShowMap\"\n\t\t\t\t\t\tclass=\"ui-block-diagram-canvas-zoom-bar__map\"\n\t\t\t\t\t\t:class=\"mapPositionClasses\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-block-diagram-canvas-zoom-bar__map-header\">\n\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\t:name=\"iconSet.CROSS_M\"\n\t\t\t\t\t\t\t\t:size=\"24\"\n\t\t\t\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('zoomCloseMapBtn')\"\n\t\t\t\t\t\t\t\tclass=\"ui-block-diagram-canvas-zoom-bar__map-close-icon\"\n\t\t\t\t\t\t\t\tcolor=\"#2FC6F6\"\n\t\t\t\t\t\t\t\t@click=\"onToggleMap\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<CanvasMap\n\t\t\t\t\t\t\t:mapSize=\"310\"\n\t\t\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('zoomCanvasMap')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</transition>\n\t\t\t</div>\n\t\t\t<div class=\"ui-block-diagram-canvas-zoom-bar__separator\"/>\n\t\t\t<div class=\"ui-block-diagram-canvas-zoom-bar__zoom\">\n\t\t\t\t<ZoomBtn\n\t\t\t\t\t:stepZoom=\"stepZoom\"\n\t\t\t\t\t:disabled=\"disabled\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('zoomOutBtn')\"\n\t\t\t\t\ttypeZoom=\"out\"\n\t\t\t\t/>\n\t\t\t\t<ZoomPercent/>\n\t\t\t\t<ZoomBtn\n\t\t\t\t\t:stepZoom=\"stepZoom\"\n\t\t\t\t\t:disabled=\"disabled\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('zoomInBtn')\"\n\t\t\t\t\ttypeZoom=\"in\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './search-result.css';\n\n// @vue/component\nexport const SearchResult = {\n\tname: 'search-result',\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tcount: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-block-diagram-search-result\">\n\t\t\t<div class=\"ui-block-diagram-search-result__left-col\">\n\t\t\t\t<p class=\"ui-block-diagram-search-result__title\">{{ title }}</p>\n\t\t\t</div>\n\t\t\t<div class=\"ui-block-diagram-search-result__right-col\">\n\t\t\t\t<span class=\"ui-block-diagram-search-result__count\">{{ count }}</span>\n\t\t\t\t<div class=\"ui-block-diagram-search-result__nav\">\n\t\t\t\t\t<slot/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './search-nav-btn.css';\n\n// @vue/component\nexport const SearchNavBtn = {\n\tname: 'search-nav-btn',\n\ttemplate: `\n\t\t<button class=\"ui-block-diagram-search-nav-btn\">\n\t\t\t<slot/>\n\t\t</button>\n\t`,\n};\n","import './search-input.css';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { onMounted, useTemplateRef, toValue, computed } from 'ui.vue3';\nimport { useLoc } from '../../composables';\n\ntype SearchInputSetup = {\n\ticonSet: {...};\n\tplaceholderOrDefaultValue: string;\n\tonInput: (event: InputEvent) => void;\n\tonClear: () => void;\n};\n\n// @vue/component\nexport const SearchInput = {\n\tname: 'search-input',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\tvalue: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tfocusable: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temit: ['update:value', 'clear'],\n\tsetup(props, { emit }): SearchInputSetup\n\t{\n\t\tconst loc = useLoc();\n\t\tconst searchInput = useTemplateRef('searchInput');\n\n\t\tconst placeholderOrDefaultValue = computed((): string => {\n\t\t\tif (props.placeholder)\n\t\t\t{\n\t\t\t\treturn props.placeholder;\n\t\t\t}\n\n\t\t\treturn loc.getMessage('UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_PLACEHOLDER');\n\t\t});\n\n\t\tonMounted(() => {\n\t\t\tif (toValue(props.focusable))\n\t\t\t{\n\t\t\t\ttoValue(searchInput).focus();\n\t\t\t}\n\t\t});\n\n\t\tfunction onInput(event: InputEvent): void\n\t\t{\n\t\t\tif (props.disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\temit('update:value', event.target.value);\n\t\t}\n\n\t\tfunction onClear(): void\n\t\t{\n\t\t\tif (props.disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\temit('clear');\n\t\t}\n\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t\tplaceholderOrDefaultValue,\n\t\t\tonInput,\n\t\t\tonClear,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-block-diagram-search-input\">\n\t\t\t<BIcon\n\t\t\t\t:name=\"iconSet.SEARCH\"\n\t\t\t\t:size=\"24\"\n\t\t\t\tclass=\"ui-block-diagram-search-input__icon\"\n\t\t\t/>\n\t\t\t<input\n\t\t\t\t:value=\"value\"\n\t\t\t\t:placeholder=\"placeholderOrDefaultValue\"\n\t\t\t\t:data-test-id=\"$blockDiagramTestId('searchInput')\"\n\t\t\t\tref=\"searchInput\"\n\t\t\t\ttype=\"text\"\n\t\t\t\tclass=\"ui-block-diagram-search-input__input\"\n\t\t\t\t@input=\"onInput\"\n\t\t\t/>\n\t\t\t<button\n\t\t\t\tclass=\"ui-block-diagram-search-input__clear-btn\"\n\t\t\t\t:data-test-id=\"$blockDiagramTestId('searchClearInputBtn')\"\n\t\t\t\t@click=\"onClear\"\n\t\t\t>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"iconSet.CROSS_L\"\n\t\t\t\t\t:size=\"24\"\n\t\t\t\t\tclass=\"ui-block-diagram-search-input__clear-btn-icon\"\n\t\t\t\t/>\n\t\t\t</button>\n\t\t</div>\n\t`,\n};\n","import './open-search-btn.css';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\n\ntype OpenSearchBtnSetup = {\n\ticonSet: {...};\n};\n\n// @vue/component\nexport const OpenSearchBtn = {\n\tname: 'open-search-btn',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tsetup(): OpenSearchBtnSetup\n\t{\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<button class=\"ui-block-diagram-open-search-btn\">\n\t\t\t<BIcon\n\t\t\t\t:name=\"iconSet.SEARCH\"\n\t\t\t\t:size=\"24\"\n\t\t\t\tclass=\"ui-block-diagram-open-search-btn__icon\"\n\t\t\t/>\n\t\t</button>\n\t`,\n};\n","import './search-bar.css';\nimport { Event } from 'main.core';\nimport {\n\tref,\n\twatch,\n\ttoValue,\n\tcomputed,\n\tonMounted,\n\tonUnmounted,\n\tuseTemplateRef,\n} from 'ui.vue3';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport {\n\tuseBlockDiagram,\n\tuseSearchBlocks,\n\tuseCanvas,\n\tuseHighlightedBlocks,\n\tuseLoc,\n} from '../../composables';\nimport type { DiagramBlock } from '../../types';\nimport { SearchResult } from './search-result';\nimport { SearchNavBtn } from './search-nav-btn';\nimport { SearchInput } from './search-input';\nimport { OpenSearchBtn } from './open-search-btn';\n\ntype SearchBarSetup = {\n\ticonSet: { ... };\n\tplaceholderOrDefaultValue: string;\n\tsearchResultTitleOrDefaultValue: string;\n\tseachText: string;\n\tlabelResult: string;\n\tisShowSearchBar: boolean;\n\tfoundBlocks: Array<DiagramBlock>;\n\tonOpenSearchBar: () => void;\n\tonInputSearchText: (event: MouseEvent) => void;\n\tonClearSearch: () => void;\n\tgoToNextBlock: () => void;\n\tgoToPrevBlock: () => void;\n}\n\n// @vue/component\nexport const SearchBar = {\n\tname: 'search-bar',\n\tcomponents: {\n\t\tBIcon,\n\t\tSearchResult,\n\t\tSearchNavBtn,\n\t\tSearchInput,\n\t\tOpenSearchBtn,\n\t},\n\tprops: {\n\t\tsearchResultTitle: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsearchCallback: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t\tdefault: (block, text) => {\n\t\t\t\treturn block.node.title\n\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t.includes(text.toLowerCase());\n\t\t\t},\n\t\t},\n\t\tsearchDelay: {\n\t\t\ttype: Number,\n\t\t\tdefault: 300,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\t// eslint-disable-next-line max-lines-per-function\n\tsetup(props): SearchBarSetup\n\t{\n\t\tconst {\n\t\t\tseachText,\n\t\t\tfoundBlocks,\n\t\t\tonSearchBlocks,\n\t\t\tonClearSearch,\n\t\t} = useSearchBlocks({\n\t\t\tsearchCallback: props.searchCallback,\n\t\t\tdelay: props.searchDelay,\n\t\t});\n\t\tconst { isDisabledBlockDiagram } = useBlockDiagram();\n\t\tconst highlitedBlocks = useHighlightedBlocks();\n\t\tconst loc = useLoc();\n\t\tconst { goToBlockById } = useCanvas();\n\t\tconst searchPanel = useTemplateRef('searchPanel');\n\t\tconst isShowSearchBar = ref(false);\n\t\tconst isShowOpenBtn = ref(true);\n\t\tconst currentBlockIndex = ref(0);\n\n\t\tconst isDisabled = computed((): boolean => {\n\t\t\treturn props.disabled || toValue(isDisabledBlockDiagram);\n\t\t});\n\n\t\tconst labelResult = computed(() => {\n\t\t\treturn `${currentBlockIndex.value + 1} / ${toValue(foundBlocks).length}`;\n\t\t});\n\n\t\tconst placeholderOrDefaultValue = computed((): string => {\n\t\t\tif (props.placeholder)\n\t\t\t{\n\t\t\t\treturn props.placeholder;\n\t\t\t}\n\n\t\t\treturn loc.getMessage('UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_PLACEHOLDER');\n\t\t});\n\n\t\tconst searchResultTitleOrDefaultValue = computed((): string => {\n\t\t\tif (props.searchResultTitle)\n\t\t\t{\n\t\t\t\treturn props.searchResultTitle;\n\t\t\t}\n\n\t\t\treturn loc.getMessage('UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_RESULT_TITLE');\n\t\t});\n\n\t\twatch(foundBlocks, (newBlocks) => {\n\t\t\tcurrentBlockIndex.value = 0;\n\n\t\t\tif (toValue(newBlocks).length > 0)\n\t\t\t{\n\t\t\t\tconst id = toValue(newBlocks)[0].id;\n\t\t\t\thighlitedBlocks.clear();\n\t\t\t\thighlitedBlocks.add(id);\n\t\t\t\tgoToBlockById(id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thighlitedBlocks.clear();\n\t\t\t}\n\t\t});\n\n\t\tonMounted(() => {\n\t\t\tEvent.bind(document, 'mousedown', onClickOutside);\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\tEvent.unbind(document, 'mousedown', onClickOutside);\n\t\t});\n\n\t\tfunction onOpenSearchBar(): void\n\t\t{\n\t\t\tif (toValue(isDisabled))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisShowOpenBtn.value = false;\n\t\t\tisShowSearchBar.value = true;\n\t\t}\n\n\t\tfunction onLeaveTransition()\n\t\t{\n\t\t\tisShowOpenBtn.value = true;\n\t\t}\n\n\t\tfunction onGoToNextBlock(): void\n\t\t{\n\t\t\tif (toValue(isDisabled))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcurrentBlockIndex.value += 1;\n\n\t\t\tif (toValue(currentBlockIndex) > toValue(foundBlocks).length - 1)\n\t\t\t{\n\t\t\t\tcurrentBlockIndex.value = 0;\n\t\t\t}\n\n\t\t\tconst id = toValue(foundBlocks)[toValue(currentBlockIndex)].id;\n\t\t\thighlitedBlocks.clear();\n\t\t\thighlitedBlocks.add(id);\n\t\t\tgoToBlockById(id);\n\t\t}\n\n\t\tfunction onGoToPrevBlock(): void\n\t\t{\n\t\t\tif (toValue(isDisabled))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcurrentBlockIndex.value -= 1;\n\n\t\t\tif (toValue(currentBlockIndex) < 0)\n\t\t\t{\n\t\t\t\tcurrentBlockIndex.value = toValue(foundBlocks).length - 1;\n\t\t\t}\n\n\t\t\tconst id = toValue(foundBlocks)[toValue(currentBlockIndex)].id;\n\t\t\thighlitedBlocks.clear();\n\t\t\thighlitedBlocks.add(id);\n\t\t\tgoToBlockById(toValue(foundBlocks)[toValue(currentBlockIndex)].id);\n\t\t}\n\n\t\tfunction closeAndResetSearch(): void\n\t\t{\n\t\t\thighlitedBlocks.clear();\n\t\t\tonClearSearch();\n\t\t\tisShowSearchBar.value = false;\n\t\t\tcurrentBlockIndex.value = 0;\n\t\t}\n\n\t\tfunction onClickOutside(event: MouseEvent): void\n\t\t{\n\t\t\tif (toValue(searchPanel) && !toValue(searchPanel).contains(event.target))\n\t\t\t{\n\t\t\t\tcloseAndResetSearch();\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t\tisDisabled,\n\t\t\tplaceholderOrDefaultValue,\n\t\t\tsearchResultTitleOrDefaultValue,\n\t\t\tseachText,\n\t\t\tlabelResult,\n\t\t\tisShowOpenBtn,\n\t\t\tisShowSearchBar,\n\t\t\tfoundBlocks,\n\t\t\tonOpenSearchBar,\n\t\t\tonLeaveTransition,\n\t\t\tonSearchBlocks,\n\t\t\tonClearSearch,\n\t\t\tcloseAndResetSearch,\n\t\t\tonGoToNextBlock,\n\t\t\tonGoToPrevBlock,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"{ '--opened': isShowSearchBar }\"\n\t\t\tclass=\"ui-block-diagram-search-bar\"\n\t\t\tref=\"searchPanel\"\n\t\t>\n\t\t\t<OpenSearchBtn\n\t\t\t\tv-if=\"isShowOpenBtn\"\n\t\t\t\t:data-test-id=\"$blockDiagramTestId('searchOpenBtn')\"\n\t\t\t\t@click=\"onOpenSearchBar\"\n\t\t\t/>\n\t\t\t<transition\n\t\t\t\tname=\"ui-block-diagram-search-bar-fade\"\n\t\t\t\tmode=\"in-out\"\n\t\t\t\t@after-leave=\"onLeaveTransition\"\n\t\t\t>\n\t\t\t\t<SearchInput\n\t\t\t\t\tv-if=\"isShowSearchBar\"\n\t\t\t\t\t:value=\"seachText\"\n\t\t\t\t\t:placeholder=\"placeholderOrDefaultValue\"\n\t\t\t\t\t:disabled=\"isDisabled\"\n\t\t\t\t\tfocusable\n\t\t\t\t\t@update:value=\"onSearchBlocks\"\n\t\t\t\t\t@clear=\"closeAndResetSearch\"\n\t\t\t\t/>\n\t\t\t</transition>\n\t\t\t<div\n\t\t\t\tv-if=\"isShowSearchBar && foundBlocks.length > 0\"\n\t\t\t\tclass=\"ui-block-diagram-search-bar__search-result\"\n\t\t\t>\n\t\t\t\t<SearchResult\n\t\t\t\t\t:title=\"searchResultTitleOrDefaultValue\"\n\t\t\t\t\t:count=\"labelResult\"\n\t\t\t\t>\n\t\t\t\t\t<SearchNavBtn\n\t\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('searchResultPrevBtn')\"\n\t\t\t\t\t\t@click=\"onGoToPrevBlock\"\n\t\t\t\t\t>\n\t\t\t\t\t\t&lt;\n\t\t\t\t\t</SearchNavBtn>\n\t\t\t\t\t<SearchNavBtn\n\t\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('searchResultNextBtn')\"\n\t\t\t\t\t\t@click=\"onGoToNextBlock\"\n\t\t\t\t\t>\n\t\t\t\t\t\t&gt;\n\t\t\t\t\t</SearchNavBtn>\n\t\t\t\t</SearchResult>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './resizable-block.css';\nimport {\n\ttoValue,\n\ttoRefs,\n\tuseTemplateRef,\n\tcomputed,\n\twatch,\n\tonMounted,\n\tonUnmounted,\n} from 'ui.vue3';\nimport {\n\tuseMoveableBlock,\n\tuseResizableBlock,\n\tuseBlockState,\n\tuseHighlightedBlocks,\n} from '../../composables';\nimport type { DiagramBlock } from '../../types';\n\n// @vue/component\nexport const ResizableBlock = {\n\tname: 'resizable-block',\n\tprops: {\n\t\t/** @type DiagramBlock */\n\t\tblock: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tminWidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 100,\n\t\t},\n\t\tminHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 100,\n\t\t},\n\t\thighlighted: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): {...}\n\t{\n\t\tconst { block, minWidth, minHeight } = toRefs(props);\n\t\tconst { isHiglitedBlock, isDisabled } = useBlockState(block);\n\t\tconst highlightedBlocks = useHighlightedBlocks();\n\t\tconst { isDragged, blockPositionStyle } = useMoveableBlock(\n\t\t\tuseTemplateRef('blockEl'),\n\t\t\tblock,\n\t\t);\n\t\tconst {\n\t\t\tisResize,\n\t\t\tsizeBlockStyle,\n\t\t\tonMounted: onMountedResizableBlock,\n\t\t\tonUnmounted: onUnmountedResizableBlock,\n\t\t} = useResizableBlock({\n\t\t\tblock,\n\t\t\tminWidth,\n\t\t\tminHeight,\n\t\t\tleftSideRef: useTemplateRef('leftSide'),\n\t\t\ttopSideRef: useTemplateRef('topSide'),\n\t\t\trightSideRef: useTemplateRef('rightSide'),\n\t\t\tbottomSideRef: useTemplateRef('bottomSide'),\n\t\t\tleftTopCornerRef: useTemplateRef('leftTopCorner'),\n\t\t\trightTopCornerRef: useTemplateRef('rightTopCorner'),\n\t\t\trightBottomCornerRef: useTemplateRef('rightBottomCorner'),\n\t\t\tleftBottomCornerRef: useTemplateRef('leftBottomCorner'),\n\t\t});\n\n\t\tconst blockStyle = computed(() => {\n\t\t\treturn {\n\t\t\t\t...toValue(blockPositionStyle),\n\t\t\t\t...toValue(sizeBlockStyle),\n\t\t\t};\n\t\t});\n\n\t\twatch(() => props.highlighted, (value) => {\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\thighlightedBlocks.add(props.block.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thighlightedBlocks.remove(props.block.id);\n\t\t\t}\n\t\t});\n\n\t\tonMounted(() => {\n\t\t\tonMountedResizableBlock();\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\thighlightedBlocks.remove(props.block.id);\n\t\t\tonUnmountedResizableBlock();\n\t\t});\n\n\t\tfunction onMouseDownSelectBlock(): void\n\t\t{\n\t\t\thighlightedBlocks.clear();\n\t\t\thighlightedBlocks.add(props.block.id);\n\t\t}\n\n\t\treturn {\n\t\t\tisHiglitedBlock,\n\t\t\tisDisabled,\n\t\t\tisResize,\n\t\t\tisDragged,\n\t\t\tblockStyle,\n\t\t\tonMouseDownSelectBlock,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:style=\"blockStyle\"\n\t\t\tref=\"blockEl\"\n\t\t\tclass=\"ui-block-diagram-resizable-block\"\n\t\t\t@mousedown=\"onMouseDownSelectBlock\"\n\t\t>\n\t\t\t<div class=\"ui-block-diagram-resizable-block__container\">\n\t\t\t\t<div\n\t\t\t\t\tref=\"leftSide\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__left-side\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"topSide\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__top-side\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"rightSide\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__right-side\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"bottomSide\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__bottom-side\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"leftTopCorner\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__top-left-corner\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"rightTopCorner\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__top-right-corner\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"rightBottomCorner\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__bottom-right-corner\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"leftBottomCorner\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__bottom-left-corner\"\n\t\t\t\t/>\n\n\t\t\t\t<slot\n\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t:isHighlighted=\"isHiglitedBlock\"\n\t\t\t\t\t:isDragged=\"isDragged\"\n\t\t\t\t\t:isResize=\"isResize\"\n\t\t\t\t\t:isDisabled=\"isDisabled\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Dom, Type, Event, Tag } from 'main.core';\nimport { toValue } from 'ui.vue3';\nimport type { DragData } from '../types';\n\nlet copiedDragItem = null;\n\nfunction onDragStart(event: MouseEvent, value: DragData | () => DragData): void\n{\n\tconst { dragData, dragImage } = Type.isFunction(value)\n\t\t? value()\n\t\t: value;\n\n\tcopiedDragItem = toValue(dragImage).cloneNode(true).children[0];\n\n\tconst wrapper = document.getElementById('blockDiagramDragWrapper');\n\tDom.append(copiedDragItem, wrapper);\n\n\tDom.style(copiedDragItem, {\n\t\tdisplay: 'block',\n\t\tposition: 'absolute',\n\t\ttop: 0,\n\t\tleft: 0,\n\t});\n\n\tconst { width, height } = copiedDragItem.getBoundingClientRect();\n\n\tevent.dataTransfer.setDragImage(\n\t\tcopiedDragItem,\n\t\twidth / 2,\n\t\theight / 2,\n\t);\n\n\tevent.dataTransfer.setData('text/plain', JSON.stringify({\n\t\t...toValue(dragData),\n\t\tdimensions: {\n\t\t\twidth,\n\t\t\theight,\n\t\t},\n\t}));\n}\n\nfunction onDragEnd(event: MouseEvent): void\n{\n\tDom.remove(copiedDragItem);\n\tcopiedDragItem = null;\n}\n\nfunction initDragItemWrapper(): void\n{\n\tconst hasWrapper = document.getElementById('blockDiagramDragWrapper');\n\n\tif (hasWrapper)\n\t{\n\t\treturn;\n\t}\n\n\tconst wrapper = Tag.render`\n\t\t<div>\n\t\t\t<div\n\t\t\t\tid=\"blockDiagramDragWrapper\"\n\t\t\t\tstyle=\"position: relative; width: 100%; height: 100%;\"\n\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\t`;\n\tDom.append(wrapper, document.body);\n\tDom.style(wrapper, {\n\t\tposition: 'absolute',\n\t\ttransform: 'translate(-100%, -100%)',\n\t\ttop: 0,\n\t\tright: 0,\n\t});\n}\n\nexport const DragBlock = {\n\tmounted(el, { arg, value }): void\n\t{\n\t\tinitDragItemWrapper();\n\t\tDom.attr(el, 'draggable', 'true');\n\t\tEvent.bind(el, 'dragstart', (event: MouseEvent) => onDragStart(event, value));\n\t\tEvent.bind(el, 'dragend', (event: MouseEvent) => onDragEnd());\n\t},\n\tunmounted(el, { arg, value })\n\t{\n\t\tEvent.unbind(el, 'dragstart', (event: MouseEvent) => onDragStart(event, value));\n\t\tEvent.unbind(el, 'dragend', (event: MouseEvent) => onDragEnd(event));\n\t},\n};\n"],"names":["useState","blockDiagramRef","blockDiagramTop","blockDiagramLeft","cursorType","isResizing","isDisabled","blocks","connections","portsElMap","markRaw","Map","portsRectMap","newConnection","movingBlock","movingConnections","resizingBlock","canvasRef","transformLayoutRef","canvasInstance","canvasWidth","canvasHeight","transformX","transformY","viewportX","viewportY","zoom","minZoom","maxZoom","contextMenuLayerRef","targetContainerRef","isOpenContextMenu","contextMenuInstance","positionContextMenu","top","left","historyCurrentState","headSnapshot","tailSnapshot","currentSnapshot","maxCountSnapshots","snapshotHandler","revertHandler","highlitedBlockIds","animationQueue","currentAnimationItem","isPauseAnimation","isStopAnimation","NODE_HEADER_HEIGHT","NODE_CONTENT_HEADER_HEIGHT","STICKING_DISTANCE","HOOK_NAMES","CHANGED_BLOCKS","CHANGED_CONNECTIONS","START_DRAG_BLOCK","MOVE_DRAG_BLOCK","END_DRAG_BLOCK","ADD_BLOCK","UPDATE_BLOCK","DELETE_BLOCK","CREATE_CONNECTION","DELETE_CONNECTION","BLOCK_TRANSITION_START","BLOCK_TRANSITION_END","CONNECTION_TRANSITION_START","CONNECTION_TRANSITION_END","DROP_NEW_BLOCK","NODE_TYPES","SIMPLE","TRIGGER","COMPLEX","BLOCK_GROUP_DEFAULT_NAME","CONNECTION_GROUP_DEFAULT_NAME","PORT_POSITION","TOP","BOTTOM","RIGHT","LEFT","CONNECTION_VIEW_TYPE","BEZIER","SMOOTHSTEP","NEW_CONNECTION_VIEW_TYPE","LINE","ANIMATED_TYPES","BLOCK","CONNECTION","REMOVE_BLOCK","REMOVE_CONNECTION","CURSOR_TYPES","EW_RESIZE","NS_RESIZE","NWSE_RESIZE","NESW_RESIZE","BLOCK_INDEXES","HIGHLITED","MOVABLE","STANDING","RESIZABLE","DIR_ACCESSOR_X","DIR_ACCESSOR_Y","DIRECTIONS_BY_POSITION","x","y","getLinePath","start","end","getConnectionCenter","sourceX","sourceY","targetX","targetY","path","center","getBeziePath","midX","centerX","centerY","transformPoint","point","transform","viewport","transformedX","Math","round","transformedY","xOffset","abs","yOffset","getDirection","source","sourcePosition","target","distance","a","b","sqrt","getPoints","targetPosition","offset","sourceDir","targetDir","sourceGapped","targetGapped","dir","dirAccessor","currDir","points","sourceGapOffset","targetGapOffset","defaultCenterX","defaultCenterY","defaultOffsetX","defaultOffsetY","verticalSplit","horizontalSplit","sourceTarget","targetSource","diff","gapOffset","min","dirSource","dirTarget","dirAccessorOpposite","isSameDir","sourceGtTargetOppo","sourceLtTargetOppo","isFlipSourceTarget","sourceGapPoint","targetGapPoint","maxXDistance","max","maxYDistance","pathPoints","offsetX","offsetY","getBend","c","size","bendSize","xDir","yDir","getSmoothStepPath","params","borderRadius","pointsCenterX","pointsCenterY","reduce","res","p","i","segment","length","ARRAY_COMMANDS","Object","freeze","REPLACE","PUSH","UPDATE_BY_INDEX","DELETE_BY_INDEX","commandExecMap","payload","result","push","index","splice","command","commandType","args","commandReplace","commandPush","commandUpdateByIndex","commandDeleteByIndex","runCommand","sourceArray","commandPayload","callback","createHook","handlers","Set","on","handler","Type","isFunction","has","add","off","delete","trigger","getGroupBlockSlotName","group","getGroupConnectionSlotName","EPSILON","ARRAY_TYPE","Float32Array","Array","degree","PI","hypot","arguments","create","out","glMatrix","copy","identity","invert","a00","a01","a02","a10","a11","a12","a20","a21","a22","b01","b11","b21","det","multiply","b00","b02","b10","b12","b20","b22","translate","v","rotate","rad","s","sin","cos","scale","projection","width","height","z","fromValues","normalize","len","dot","cross","ax","ay","az","bx","by","bz","forEach","vec","stride","count","fn","arg","l","w","setAxisAngle","axis","slerp","t","aw","bw","omega","cosom","sinom","scale0","scale1","acos","fromMat3","m","fTrace","fRoot","j","k","vec4","rotationTo","tmpvec3","vec3","xUnitVec3","yUnitVec3","sqlerp","temp1","temp2","d","setAxes","matr","mat3","view","right","up","transformMat3","Camera","constructor","options","onChangeCallback","updateMatrix","projectionMatrix","viewMatrix","viewProjectionMatrix","viewProjectionMatrixInv","matrix","rotation","setChangeTransformCallback","clone","camera","updateViewProjectionMatrix","zoomScale","createLandmark","viewportToCanvas","canvas","vec2","applyLandmark","landmark","useFixedViewport","preZoomX","preZoomY","postZoomX","postZoomY","Canvas","window","devicePixelRatio","ref","canvasStyle","clientToViewport","getBoundingClientRect","viewportToClient","render","setCamera","zoomIn","zoomStep","zoomOut","setCameraZoomByWheel","event","zoomChange","newZoom","deltaY","clientX","clientY","setCameraPositionByWheel","deltaX","setCameraPositionByMouseDown","setCameraPositionByMouseMove","pos","destroy","unobserve","StyleInstance","instance","ResizeObserver","entries","entry","contentRect","observe","Number","toFixed","cssX","cssY","normalizedX","clientWidth","normalizedY","clientHeight","clipX","clipY","vertexShader","fragmentShader","compileShader","gl","shaderSource","shaderType","shader","createShader","success","getShaderParameter","COMPILE_STATUS","Error","getShaderInfoLog","createProgram","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","createBufferFromTypedArray","array","type","drawType","bufferType","ARRAY_BUFFER","buffer","createBuffer","bindBuffer","bufferData","STATIC_DRAW","convHex","hex","preHex","replace","r","parseInt","slice","g","Grid","clearColor","clear","COLOR_BUFFER_BIT","useProgram","gridColor","uniformMatrix3fv","uniform4f","uniform1f","enableVertexAttribArray","vertexAttribPointer","FLOAT","drawArrays","TRIANGLE_STRIP","deleteProgram","deleteShader","getContext","getExtension","gridShaders","VERTEX_SHADER","FRAGMENT_SHADER","getAttribLocation","getUniformLocation","zoomSteps","sort","stepA","stepB","map","step","gridColorAlpha","backgroundColor","useHistory","commonSnapshotHandler","newState","JSON","parse","stringify","commonRevertHandler","snapshot","hooks","changedBlocks","commandToArray","changedConnections","commonEmptyHistorySnapshot","useBlockDiagram","setHistoryHandlers","newSnapshotHandler","newRevertHandler","emptyHistorySnapshot","maxCount","setHandlers","value","toValue","hasNext","computed","next","hasPrev","prev","newHandlerOptions","handlerOptions","getCountSnapshots","current","makeSnapshot","emptySnapshot","newEmptySnapshot","snapshotHistoryHandler","revertHistoryHandler","newSnapshot","firstSnapshot","revertState","nextTick","useActions","state","getters","setState","transfrom","updateCanvasTransform","isExistConnection","connection","sourceBlockId","sourcePortId","targetBlockId","targetPortId","some","exSourceBlockId","exSourcePortId","exTargetBlockId","exTargetPortId","isSource","isTarget","addConnection","id","Text","getRandom","createConnection","deleteConnectionById","connectionId","filter","deleteConnection","deleteConnectionByBlockIdAndPortId","blockId","portId","block","find","stateBlock","portIdMap","ports","input","output","port","newConnections","deleteBlockById","blockIndex","findIndex","deleteBlock","addBlock","updateBlockPositionByIndex","position","updateBlock","newBlock","getPortAbsolutePosition","blockX","blockY","dimensions","node","nodeType","portOffsetY","portX","isOutputPort","outputPort","findNearestPort","nearest","nearestDistance","Infinity","allPorts","dx","dy","transformEventToPoint","setMovingBlock","toRaw","updateMovingBlockPosition","resetMovingBlock","setPortOffsetByBlockId","offsets","portRect","updatePortPosition","hasBlock","hasPort","get","useGetters","canvasId","groupedBlocks","acc","blockGroupNames","keys","groupedConnections","connectionGroupNames","isAnimate","isDisabledBlockDiagram","useHooks","app","getCurrentInstance","appContext","blockDiagramState","config","globalProperties","$blockDiagram","reactiveState","reactive","actions","toRefs","$blockDiagramTestId","preparedArgs","useContextMenu","menuItems","shallowRef","MenuManager","getMenuOptions","isOpen","items","setOptions","newOptions","getItems","item","onclick","closeMenu","additionalOptions","bindElement","minWidth","autoHide","draggable","cacheable","targetContainer","setDestroyHandler","popupWindow","subscribeOnce","showMenu","menuOptions","show","close","showContextMenu","closeContextMenu","useNewConnection","isSourcePort","onMouseDownPort","stopPropagation","startPosition","Event","bind","document","onMouseMove","onMouseUp","isSamePort","hasSourceIds","hasTargetIds","unbind","onMouseOverPort","onMouseLeavePort","useBlockState","isHiglitedBlock","includes","blockZindex","zIndex","updatePortsPositions","useMoveableBlock","blockRef","isDragged","prevValueBlockX","prevValueBlockY","offsetBlockX","offsetBlockY","watchEffect","blockPositionStyle","onMounted","onMouseDown","onBeforeUnmount","button","startDragBlock","moveDragBlock","positionX","positionY","endDragBlock","useModelValue","emit","handlersMap","handleChangeBlocks","handleChangeConnections","hookName","dispose","useWatchProps","props","scope","effectScope","run","watch","newBlocks","isArray","immediate","deep","newMinZoom","newMaxZoom","disabled","stop","useRegisterHooks","hooksMaps","mergedHookMaps","accHookMaps","hookMap","DEFAULT_OPTIONS","searchCallback","delay","useSearchBlocks","optionParams","seachText","foundBlocks","onSearchBlocks","searchText","trim","onClearSearch","debounce","useCanvas","goToBlockById","useHighlightedBlocks","set","blockIds","remove","highlitedIndx","indexOf","useLoc","bitrix","$bitrix","getMessage","messageId","replacements","Loc","usePortState","portRef","addPortElement","portEl","deletePortElement","addPortRect","deletePortRect","portsMap","onMountedPort","onUnmountedPort","useConnectionState","viewType","connectionPortsPosition","hasSourceBlockId","hasSourcePortId","hasTargetBlockId","hasTargetPortId","sourceWidth","sourceHeight","targetWidth","targetHeight","sourcePort","targetPort","connectionPathInfo","useInitAppElements","newBlockDiagramRef","observer","handleInterObserver","boundingClientRect","onMountedAppElements","IntersectionObserver","onUnmountedAppElements","useNewConnectionState","hasNewConnection","newConnectionPathInfo","useAnimationQueue","animateItem","animatedItem","animationQueueFn","animatedQueueItems","shouldAnimatedItems","setTimeout","play","pause","CANVAS_STYLE_DEFAULT_OPTIONS","grid","useCanvasTransfrom","newCanvasRef","newTransformLayoutRef","newCanvasStyle","zoomSensitivity","zoomSensitivityMouse","dragOn","isDragging","zooming","requestAnimationId","getCanvasStyleOptions","style","onUnmounted","cancelAnimationFrame","buttons","onWheel","preventDefault","isTrackpad","wheelDeltaY","deltaMode","ctrlKey","sign","Dom","requestAnimationFrame","useDragAndDrop","onDrop","dataString","dataTransfer","getData","receivedData","dropNewBlock","setBlockData","addedBlock","setData","useResizableBlock","minHeight","leftSideRef","topSideRef","rightSideRef","bottomSideRef","leftTopCornerRef","rightTopCornerRef","rightBottomCornerRef","leftBottomCornerRef","isResize","prevBlockX","prevBlockY","prevBlockWidth","prevBlockHeight","sizeBlockStyle","cursor","updateResizableBlock","onMouseDownRightSide","onMouseDownBottomSide","onMouseDownLeftSide","onMouseDownTopSide","onMouseDownRightTopCorner","onMouseDownRightBottomCorner","onMouseDownLeftTopCorner","onMouseDownLeftBottomCorner","startResize","curType","endResize","resizeTopSide","newY","newHeight","fixedPositionY","resizeRightSide","cursorX","newWidth","resizeBottomSide","resizeLeftSide","newX","fixedPositionX","onMouseMoveRightSide","onMouseUpRightSide","onMouseMoveBottomSide","onMouseUpBottomSide","onMouseMoveLeftSide","onMouseUpLeftSide","onMouseMoveTopSide","onMouseUpTopSide","onMouseMoveRightBottomCorner","onMouseUpRightBottomCorner","onMouseMoveRightTopCorner","onMouseUpRightTopCorner","onMouseMoveLeftBottomCorner","onMouseUpLeftBottomCorner","onMouseMoveLeftTopCorner","onMouseUpLeftTopCorner","CANVAS_TRANSFORM_CLASS_NAMES","base","dragging","CanvasTransform","name","required","default","setup","onMountedCanvasTransform","onUmounted","onUnmountedCanvasTransform","useTemplateRef","canvasTransformClassNames","template","TARGET_CONNECTION_CLASSES","active","Connection","String","validator","values","barWidth","barHeight","contextMenuItems","Boolean","loc","text","targetConnectionClasses","barPosition","onOpenContextMenu","DeleteConnectionBtn","components","BIcon","onDeleteConnection","iconSet","Outline","ContextMenuLayout","targetContainerStyle","BlocksQueueTransition","history","highlighted","nextAnimationItem","done","onBeforeEnter","blockTransitionStart","onEnter","onAfterEnter","blockTransitionEnd","onAfterLeave","GroupedBlocks","NewConnection","ConnectionsQueueTransition","connectionTransitionStart","nextAnimatedItem","connectionTransitionEnd","GroupedConnections","MoveableBlock","highlightedBlocks","blockStyle","onMouseDownSelectBlock","PORT_CLASS_NAMES","Port","portClassNames","BLOCK_CONTENT_STUB_CLASS_NAMES","BlockContentStub","dragged","blockContentClassNames","onShowContextMenu","UI_CANVAS_GRID_COLOR","UI_CANVAS_BACKGROUND_COLOR","BLOCK_DIAGRAM_CLASS_NAMES","ewResize","nsResize","nwSeResize","neSwResize","grabbing","BlockDiagram","historyHooks","Function","emits","initAppElements","disposeModelValue","disposeWatchProps","disposeRegisterHooks","isGrabbing","blockDiagramClassNames","onDragEnter","onDragLeave","onDragDrop","IconButton","iconName","color","activeColor","buttonClassNames","buttonStyle","iconClassNames","HistoryBar","onNext","onPrev","ZOOM_TYPES","in","ZoomBtn","stepZoom","typeZoom","onZoom","zoomTypes","ZoomPercent","percent","CURSOR_RECT_STROKE_WIDTH","FIRST_EMPTY_BLOCK_ID","LAST_EMPTY_BLOCK_ID","CanvasMap","mapWidth","mapHeight","mapEl","mapElLeft","mapElTop","canvasMapStyle","preparedBlock","startDiagramX","startDiagramY","diagramWidth","isArrayFilled","maxX","diagramHeight","maxY","scaleMap","cursorRectWidth","cursorRectHeight","cursorRectPosition","updateCameraPosition","canvasX","canvasY","onMapMouseDown","onMapMouseMove","onMapMouseUp","CanvasMapBtn","btnStyle","scaleButton","VERTICAL_MAP_POSITION","GORIZONTAL_MAP_POSITION","bottom","MAP_CLASSES","POSITION_MAP_DEFAULT_VALUES","ZoomBar","positionMap","isShowMap","mapPositionClasses","isTop","toLowerCase","isLeft","onToggleMap","SearchResult","title","SearchNavBtn","SearchInput","placeholder","focusable","searchInput","placeholderOrDefaultValue","focus","onInput","onClear","OpenSearchBtn","SearchBar","searchResultTitle","searchDelay","highlitedBlocks","searchPanel","isShowSearchBar","isShowOpenBtn","currentBlockIndex","labelResult","searchResultTitleOrDefaultValue","onClickOutside","onOpenSearchBar","onLeaveTransition","onGoToNextBlock","onGoToPrevBlock","closeAndResetSearch","contains","ResizableBlock","onMountedResizableBlock","onUnmountedResizableBlock","copiedDragItem","onDragStart","dragData","dragImage","cloneNode","children","wrapper","getElementById","append","display","setDragImage","onDragEnd","initDragItemWrapper","hasWrapper","Tag","body","DragBlock","mounted","el","attr","unmounted"],"mappings":"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"}