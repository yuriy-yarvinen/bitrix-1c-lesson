{"version":3,"file":"script.js","sources":["src/config.es6.js","src/config-item.es6.js","script.es6.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { Button } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n/**\n * @bxjs_lang_path template.php\n */\n\nexport class Config\n{\n\tstatic isOpen = false;\n\tstatic subscribedItems = [];\n\n\tstatic popupIsOpen(): boolean\n\t{\n\t\treturn this.isOpen;\n\t}\n\n\tstatic setPopupClose(): void\n\t{\n\t\tthis.isOpen = false;\n\t}\n\n\tstatic setPopupOpen(): void\n\t{\n\t\tthis.isOpen = true;\n\t}\n\n\tstatic isSubscribed(scopeId): boolean\n\t{\n\t\treturn Config.subscribedItems.includes(scopeId);\n\t}\n\n\tstatic addSubscribed(scopeId): void\n\t{\n\t\tConfig.subscribedItems.push(scopeId);\n\t}\n\n\tstatic showConfirmDialog(title, acceptButtonText, acceptFunc): void\n\t{\n\t\tMessageBox.confirm(\n\t\t\ttitle,\n\t\t\tacceptFunc,\n\t\t\tacceptButtonText,\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\ttrue,\n\t\t);\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Button } from 'ui.buttons';\nimport { Dialog, type Item, type ItemId } from 'ui.entity-selector';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { Config } from './config.es6';\n\n/**\n * @bxjs_lang_path template.php\n */\n\ntype Member = {\n\tid: string,\n\taccessCode: ?string,\n\ttype: string,\n\tname: string,\n\tavatar: ?string,\n};\n\nconst MAX_SHOWN_MEMBERS = 3;\n\nexport class ConfigItem extends EventEmitter\n{\n\t#scopeId;\n\t#members;\n\t#node;\n\t#selectedItems: ItemId[] = [];\n\t#moduleId;\n\t#config: Config;\n\t#entityTypeId: ?number;\n\t#memberSelector: Dialog;\n\t#useHumanResourcesModule;\n\n\tconstructor(options: Object)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Ui.Form');\n\n\t\tthis.#scopeId = (options.scopeId || null);\n\t\tthis.#members = (options.members || null);\n\t\tthis.#node = BX(`ui-editor-config-${this.#scopeId}`);\n\t\tthis.#moduleId = (options.moduleId || null);\n\t\tthis.#config = Config;\n\t\tthis.#entityTypeId = (options.entityTypeId || null);\n\t\tthis.#useHumanResourcesModule = BX.prop.getBoolean(options, 'useHumanResourcesModule', false);\n\n\t\tthis.#drawMembers();\n\t\tthis.#memberSelector = this.#getMemberSelector();\n\n\t\tthis.#subscribeEvents();\n\t}\n\n\t#subscribeEvents()\n\t{\n\t\tif (!this.#config.isSubscribed(this.#scopeId))\n\t\t{\n\t\t\tEventEmitter.subscribe('BX.Ui.Form.ConfigItem:copyContextAction', this.#copyContextAction);\n\t\t\tEventEmitter.subscribe('BX.Ui.Form.ConfigItem:deleteContextAction', this.#deleteContextAction);\n\t\t\tthis.#config.addSubscribed(this.#scopeId);\n\t\t}\n\t}\n\n\t#getMemberSelector(): Dialog\n\t{\n\t\treturn new Dialog({\n\t\t\ttargetNode: this.#node,\n\t\t\tenableSearch: true,\n\t\t\tcontext: 'EDITOR_CONFIG_USER_CONTEXT',\n\t\t\tpreselectedItems: this.#getSelectedItems(),\n\t\t\titems: [],\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'project',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: this.#useHumanResourcesModule ? 'structure-node' : 'department',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tselectMode: 'usersAndDepartments',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': this.#onMemberAdd,\n\t\t\t\t'Item:onDeselect': this.#onMemberRemove,\n\t\t\t\tonHide: this.#onClosePopup,\n\t\t\t},\n\t\t});\n\t}\n\n\t#getSelectedItems(): Array\n\t{\n\t\tif (this.#members && !Type.isArrayFilled(Object.keys(this.#selectedItems)))\n\t\t{\n\t\t\tconst items = [];\n\t\t\tconst members = this.#members;\n\t\t\tObject.entries(members).forEach(([key: string, value: string]): void => {\n\t\t\t\titems.push(this.#getItemIdByAccessCode(key));\n\t\t\t});\n\n\t\t\tthis.#selectedItems = items;\n\t\t}\n\n\t\treturn (this.#selectedItems || []);\n\t}\n\n\t#drawMembers(withClean: boolean): void\n\t{\n\t\tif (!this.#members)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (withClean)\n\t\t{\n\t\t\tDom.clean(this.#node);\n\t\t}\n\n\t\tlet shownMembers = this.#members;\n\t\tlet notShownMembersCount = 0;\n\t\tif (Object.values(this.#members).length > MAX_SHOWN_MEMBERS)\n\t\t{\n\t\t\tshownMembers = Object.values(this.#members).slice(0, MAX_SHOWN_MEMBERS);\n\n\t\t\tnotShownMembersCount = Object.values(this.#members).length - MAX_SHOWN_MEMBERS;\n\t\t}\n\n\t\tObject.values(shownMembers).forEach((item) => {\n\t\t\tDom.append(this.#createMemberElement(item), this.#node);\n\t\t});\n\n\t\tif (notShownMembersCount > 0)\n\t\t{\n\t\t\tDom.append(this.#createNumberButton(notShownMembersCount), this.#node);\n\t\t}\n\n\t\tDom.append(this.#createPlusButton(), this.#node);\n\t}\n\n\t#createMemberElement(member: Object): HTMLElement\n\t{\n\t\tconst children = (member.avatar\n\t\t\t? Tag.render`<a href=\"${member.url}\" class=\"ui-editor-config-item-avatar\"  title=\"${Text.encode(member.name)}\" style=\"background-image: url('${encodeURI(Text.encode(member.avatar))}')\"></a>`\n\t\t\t: Tag.render`<a href=\"${member.url}\" class=\"ui-icon ui-icon-xs ui-icon-common-user\" title=\"${Text.encode(member.name)}\"><i></i></a>`\n\t\t);\n\n\t\treturn Dom.create('div', {\n\t\t\tattrs: {\n\t\t\t\tclass: 'ui-editor-config-item',\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tchildren,\n\t\t\t],\n\t\t});\n\t}\n\n\t#createPlusButton(): HTMLElement\n\t{\n\t\treturn Dom.create('div', {\n\t\t\tevents: {\n\t\t\t\tclick: (event) => {\n\t\t\t\t\tif (!this.#config.popupIsOpen())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#showPopup();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tattrs: {\n\t\t\t\tclass: 'ui-editor-config-item ui-editor-config-item--add',\n\t\t\t},\n\t\t});\n\t}\n\n\t#createNumberButton(number: number): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"ui-editor-config-item\"><span href=\"#\" class=\"ui-editor-config-item--number\">+${number}</span></div>`;\n\t}\n\n\t#showPopup(): void\n\t{\n\t\tthis.#config.setPopupOpen();\n\t\tthis.#memberSelector.show();\n\t}\n\n\t#onMemberAdd = (event: BaseEvent): void => {\n\t\tconst member = this.#getMemberFromEvent(event);\n\n\t\tthis.#selectedItems.push([member.type, member.id]);\n\t\tthis.#members[member.accessCode] = member;\n\n\t\tthis.#drawMembers(true);\n\t};\n\n\t#onMemberRemove = (event: BaseEvent): void => {\n\t\tconst member = this.#getMemberFromEvent(event);\n\n\t\tthis.#selectedItems = this.#memberSelector.getSelectedItems();\n\t\tdelete this.#members[member.accessCode];\n\n\t\tthis.#drawMembers(true);\n\t};\n\n\t#getMemberFromEvent = (event: BaseEvent): ?Member => {\n\t\tconst { item } = event.getData();\n\n\t\treturn {\n\t\t\tid: item.id,\n\t\t\taccessCode: this.#getAccessCodeByItem(item),\n\t\t\ttype: item.entityId,\n\t\t\tname: item.title.text,\n\t\t\tavatar: Type.isStringFilled(item.avatar) ? item.avatar : null,\n\t\t};\n\t};\n\n\t#onClosePopup = (): void => {\n\t\tif (BX.type.isNotEmptyObject(this.#members))\n\t\t{\n\t\t\tthis.#updateScopeAccessCodes();\n\t\t\tthis.#config.setPopupClose();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#showAlertDialog();\n\t\t}\n\t};\n\n\t#showAlertDialog(): void\n\t{\n\t\tconst alert = MessageBox.create({\n\t\t\tmessage: Loc.getMessage('UI_SCOPE_LIST_ALERT_EMPTY_CODES'),\n\t\t\tuseAirDesign: true,\n\t\t\tbuttons: MessageBoxButtons.OK,\n\t\t\tonOk: (messagebox) => {\n\t\t\t\tmessagebox.close();\n\t\t\t\tthis.#memberSelector.show();\n\t\t\t},\n\t\t});\n\n\t\talert.show();\n\t}\n\n\t#getItemIdByAccessCode(accessCode: string): ItemId\n\t{\n\t\tif (/^I?U(\\d+)$/.test(accessCode))\n\t\t{\n\t\t\tconst match = accessCode.match(/^I?U(\\d+)$/) || null;\n\t\t\tconst userId = match ? match[1] : null;\n\n\t\t\treturn ['user', userId];\n\t\t}\n\n\t\tif (/^DR(\\d+)$/.test(accessCode))\n\t\t{\n\t\t\tconst match = accessCode.match(/^DR(\\d+)$/) || null;\n\t\t\tconst departmentId = match ? match[1] : null;\n\n\t\t\treturn ['department', departmentId];\n\t\t}\n\n\t\tif (/^D(\\d+)$/.test(accessCode))\n\t\t{\n\t\t\tconst match = accessCode.match(/^D(\\d+)$/) || null;\n\t\t\tconst departmentId = match ? match[1] : null;\n\n\t\t\treturn ['department', `${departmentId}:F`];\n\t\t}\n\n\t\tif (/^G(\\d+)$/.test(accessCode))\n\t\t{\n\t\t\tconst match = accessCode.match(/^G(\\d+)$/) || null;\n\t\t\tconst groupId = match ? match[1] : null;\n\n\t\t\treturn ['site-groups', groupId];\n\t\t}\n\n\t\tif (accessCode.at(0) === 'A')\n\t\t{\n\t\t\treturn ['user-groups', accessCode];\n\t\t}\n\n\t\tif (/^SG(\\d+)_([AEK])$/.test(accessCode))\n\t\t{\n\t\t\treturn ['project-access-codes', accessCode];\n\t\t}\n\n\t\tif (/^SND(\\d+)$/.test(accessCode))\n\t\t{\n\t\t\tconst match = accessCode.match(/^SND(\\d+)$/) || null;\n\t\t\tconst structureNodeId = match ? match[1] : null;\n\n\t\t\treturn ['structure-node', `${structureNodeId}:F`];\n\t\t}\n\n\t\tif (/^SNDR(\\d+)$/.test(accessCode))\n\t\t{\n\t\t\tconst match = accessCode.match(/^SNDR(\\d+)$/) || null;\n\t\t\tconst structureNodeId = match ? match[1] : null;\n\n\t\t\treturn ['structure-node', structureNodeId];\n\t\t}\n\n\t\treturn ['unknown', accessCode];\n\t}\n\n\t#getAccessCodeByItem(item: Item): string\n\t{\n\t\tconst entityId = item.entityId;\n\n\t\tif (entityId === 'user')\n\t\t{\n\t\t\treturn `U${item.id}`;\n\t\t}\n\n\t\tif (entityId === 'department')\n\t\t{\n\t\t\tif (Type.isString(item.id) && item.id.endsWith(':F'))\n\t\t\t{\n\t\t\t\tconst match = item.id.match(/^(\\d+):F$/);\n\t\t\t\tconst originalId = match ? match[1] : null;\n\n\t\t\t\t// only members of the department itself\n\t\t\t\treturn `D${originalId}`;\n\t\t\t}\n\n\t\t\t// whole department recursively\n\t\t\treturn `DR${item.id}`;\n\t\t}\n\n\t\tif (entityId === 'structure-node')\n\t\t{\n\t\t\tif (Type.isString(item.id) && item.id.endsWith(':F'))\n\t\t\t{\n\t\t\t\tconst match = item.id.match(/^(\\d+):F$/);\n\t\t\t\tconst originalId = match ? match[1] : null;\n\n\t\t\t\treturn `SND${originalId}`;\n\t\t\t}\n\n\t\t\treturn `SNDR${item.id}`;\n\t\t}\n\n\t\tif (entityId === 'site-groups')\n\t\t{\n\t\t\treturn `G${item.id}`;\n\t\t}\n\n\t\tif (entityId === 'user-groups')\n\t\t{\n\t\t\treturn item.id;\n\t\t}\n\n\t\tif (entityId === 'project-access-codes')\n\t\t{\n\t\t\treturn item.id;\n\t\t}\n\n\t\treturn '';\n\t}\n\n\t#onError(response): void\n\t{\n\t\tif (response.status === 'error')\n\t\t{\n\t\t\tthis.#notifyStatus(response.data[0]);\n\t\t}\n\t}\n\n\t#updateScopeAccessCodes = (): void => {\n\t\tBX.ajax.runComponentAction('bitrix:ui.form.config', 'updateScopeAccessCodes', {\n\t\t\tdata: {\n\t\t\t\tmoduleId: this.#moduleId,\n\t\t\t\tscopeId: this.#scopeId,\n\t\t\t\taccessCodes: this.#members,\n\t\t\t},\n\t\t}).then((result) => {\n\t\t\tthis.#responseAction();\n\t\t}).catch(this.#onError.bind(this));\n\t};\n\n\t#copyContextAction = (event: Object): void => {\n\t\tif (event.data.scopeId !== Text.toInteger(this.#scopeId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#config.showConfirmDialog(\n\t\t\tLoc.getMessage('UI_SCOPE_LIST_CONFIRM_TITLE_COPY'),\n\t\t\tLoc.getMessage('UI_SCOPE_LIST_CONFIRM_ACCEPT_COPY'),\n\t\t\t() => {\n\t\t\t\tBX.ajax.runComponentAction('bitrix:ui.form.config', 'copyScope', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tmoduleId: this.#moduleId,\n\t\t\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\t\t\tscopeId: this.#scopeId,\n\t\t\t\t\t},\n\t\t\t\t}).then((result) => {\n\t\t\t\t\tthis.#responseAction();\n\t\t\t\t}).catch(this.#onError.bind(this));\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t);\n\t};\n\n\t#deleteContextAction = (event: Object): void => {\n\t\tif (event.data.scopeId !== Text.toInteger(this.#scopeId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#config.showConfirmDialog(\n\t\t\tLoc.getMessage('UI_SCOPE_LIST_CONFIRM_TITLE_DELETE'),\n\t\t\tLoc.getMessage('UI_SCOPE_LIST_CONFIRM_ACCEPT_DELETE'),\n\t\t\t() => {\n\t\t\t\tBX.ajax.runComponentAction('bitrix:ui.form.config', 'removeScope', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tmoduleId: this.#moduleId,\n\t\t\t\t\t\tscopeId: this.#scopeId,\n\t\t\t\t\t},\n\t\t\t\t}).then((result) => {\n\t\t\t\t\tthis.#responseAction();\n\t\t\t\t}).catch(this.#onError.bind(this));\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t);\n\t};\n\n\t#responseAction(result)\n\t{\n\t\tBX.Main.gridManager.getInstanceById('editor_scopes').reload();\n\t}\n\n\t#notifyStatus(err: { code: string, message: string, customData: any }): void\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: err?.message,\n\t\t\tautoHideDelay: 5000,\n\t\t});\n\t}\n}\n","import { Reflection } from 'main.core';\nimport { ConfigItem } from './src/config-item.es6';\nimport { Config } from './src/config.es6';\n\nconst namespace = Reflection.namespace('BX.Ui.Form');\n\nnamespace.Config = Config;\nnamespace.ConfigItem = ConfigItem;\n"],"names":["Config","isOpen","scopeId","subscribedItems","includes","push","title","acceptButtonText","acceptFunc","MessageBox","confirm","undefined","MAX_SHOWN_MEMBERS","ConfigItem","options","event","member","type","id","accessCode","getSelectedItems","getData","item","entityId","name","text","avatar","Type","isStringFilled","BX","isNotEmptyObject","setPopupClose","ajax","runComponentAction","data","moduleId","accessCodes","then","result","bind","Text","toInteger","showConfirmDialog","Loc","getMessage","entityTypeId","setEventNamespace","members","prop","getBoolean","EventEmitter","isSubscribed","subscribe","addSubscribed","Dialog","targetNode","enableSearch","context","preselectedItems","items","entities","selectMode","events","onHide","isArrayFilled","Object","keys","entries","forEach","key","value","withClean","Dom","clean","shownMembers","notShownMembersCount","values","length","slice","append","children","Tag","render","url","encode","encodeURI","create","attrs","click","popupIsOpen","number","setPopupOpen","show","alert","message","useAirDesign","buttons","MessageBoxButtons","OK","onOk","messagebox","close","test","match","userId","departmentId","groupId","at","structureNodeId","isString","endsWith","originalId","response","status","Main","gridManager","getInstanceById","reload","err","UI","Notification","Center","notify","content","autoHideDelay","namespace","Reflection"],"mappings":"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"}