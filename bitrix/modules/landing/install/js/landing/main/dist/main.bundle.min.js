this.BX=this.BX||{};(function(e,t,n,o,a,i,r,l,s,c){"use strict";function d(e,t){f(e,t);t.add(e)}function u(e,t,n){f(e,t);t.set(e,n)}function f(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function h(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var g=new WeakMap;var v=new WeakMap;var p=new WeakMap;var m=new WeakMap;var k=new WeakMap;var b=new WeakMap;var B=new WeakSet;var y=new WeakSet;var C=new WeakSet;var E=new WeakSet;var w=function(){function e(){babelHelpers.classCallCheck(this,e);d(this,E);d(this,C);d(this,y);d(this,B);u(this,g,{writable:true,value:{mode:"mode",register:"register",changeState:"changestate",editorEnable:"editorenable",showControls:"showcontrols",showBlockControls:"showblockcontrols",hideAll:"hideall",backendAction:"backendaction"}});u(this,v,{writable:true,value:-1});u(this,p,{writable:true,value:false});u(this,m,{writable:true,value:false});u(this,k,{writable:true,value:0});u(this,b,{writable:true,value:[]});if(M.isExternalControlsEnabled()){h(this,B,L).call(this)}}babelHelpers.createClass(e,[{key:"onBackendAction",value:function e(t,n){babelHelpers.classPrivateFieldSet(this,m,false);this.postExternalCommand(babelHelpers.classPrivateFieldGet(this,g).backendAction,{action:t,data:n})}},{key:"isControlsExternal",value:function e(){return c.Dom.hasClass(document.body,"landing-ui-external-controls")}},{key:"recalculateTops",value:function e(t){var n=this;babelHelpers.classPrivateFieldSet(this,b,[]);if(t){babelHelpers.classPrivateFieldSet(this,v,-1)}babelHelpers.toConsumableArray(document.body.querySelectorAll(".block-wrapper")).map((function(e){var t=e.getBoundingClientRect();if(t.height>1){babelHelpers.classPrivateFieldGet(n,b).push({blockId:parseInt(e.getAttribute("data-id")),top:t.top,height:t.height})}}));this.onMobileMouseMove(babelHelpers.classPrivateFieldGet(this,k))}},{key:"recalculateTopsIfExternals",value:function e(t){if(this.isControlsExternal()){this.recalculateTops(t)}}},{key:"onMobileMouseMove",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,m)||!this.isControlsExternal()){return}if(t<=0){babelHelpers.classPrivateFieldSet(this,v,-1);return}babelHelpers.classPrivateFieldSet(this,k,t);for(var n=0,o=babelHelpers.classPrivateFieldGet(this,b).length;n<o;n++){if(t>=babelHelpers.classPrivateFieldGet(this,b)[n]["top"]&&(!babelHelpers.classPrivateFieldGet(this,b)[n+1]||t<babelHelpers.classPrivateFieldGet(this,b)[n+1]["top"])){if(babelHelpers.classPrivateFieldGet(this,b)[n]["top"]!==babelHelpers.classPrivateFieldGet(this,v)){babelHelpers.classPrivateFieldSet(this,v,babelHelpers.classPrivateFieldGet(this,b)[n]["top"]);this.postExternalCommand(babelHelpers.classPrivateFieldGet(this,g).showControls,{blockId:babelHelpers.classPrivateFieldGet(this,b)[n]["blockId"],top:babelHelpers.classPrivateFieldGet(this,b)[n]["top"],height:babelHelpers.classPrivateFieldGet(this,b)[n]["height"]})}break}}}},{key:"postExternalCommand",value:function e(t,n){if(window.parent){window.parent.postMessage({action:t,payload:n},window.location.origin)}}},{key:"listenExternalCommands",value:function e(t,n){var o=this;var a=BX.Landing.PageObject.getBlocks().get(n!==null&&n!==void 0&&n.blockId?n.blockId:-1);if(n!==null&&n!==void 0&&n.blockId&&!a){return}var i=function e(){setTimeout((function(){babelHelpers.classPrivateFieldSet(o,k,0);o.recalculateTops()}),300)};switch(t){case"onDesignerBlockClick":{a.onDesignerBlockClick();break}case"onEditBlockClick":{a.onShowContentPanel();break}case"onStyleBlockClick":{a.onStyleShow();break}case"onSortDownBlockClick":{a.moveDown();i();break}case"onSortUpBlockClick":{a.moveUp();i();break}case"onRemoveBlockClick":{a.deleteBlock();break}case"onChangeStateBlockClick":{a.onStateChange();break}case"onCutBlockClick":{M.getInstance().onCutBlock.bind(M.getInstance(),a)();break}case"onCopyBlockClick":{M.getInstance().onCopyBlock.bind(M.getInstance(),a)();break}case"onPasteBlockClick":{M.getInstance().onPasteBlock.bind(M.getInstance(),a,(function(e){setTimeout((function(){h(o,E,A).call(o,e)}),300)}))();break}case"onFeedbackClick":{a.showFeedbackForm();break}case"onSaveInLibraryClick":{a.saveBlock();break}case"onHideEditorPanel":{BX.Landing.UI.Panel.EditorPanel.getInstance().hide();break}}}}]);return e}();function L(){var e=this;setTimeout((function(){h(e,C,P).call(e)}),0);window.addEventListener("message",(function(t){if(e.isControlsExternal()){e.listenExternalCommands(t.data.action,t.data.payload)}}));document.addEventListener("mouseenter",(function(t){babelHelpers.classPrivateFieldSet(e,p,true)}));document.addEventListener("mouseleave",(function(t){babelHelpers.classPrivateFieldSet(e,p,false)}));document.addEventListener("mousemove",(function(t){e.onMobileMouseMove(t.y)}));document.addEventListener("scroll",(function(){if(babelHelpers.classPrivateFieldGet(e,p)){e.recalculateTopsIfExternals()}}));BX.addCustomEvent("BX.Landing.Main:changeControls",(function(t,n){if(t==="internal"){e.postExternalCommand(babelHelpers.classPrivateFieldGet(e,g).hideAll,{})}else{setTimeout((function(){e.recalculateTops(true)}),400)}}));BX.addCustomEvent("BX.Landing.Editor:enable",(function(){babelHelpers.classPrivateFieldSet(e,m,true);if(e.isControlsExternal()){e.postExternalCommand(babelHelpers.classPrivateFieldGet(e,g).hideAll,{})}}));BX.addCustomEvent("BX.Landing.Editor:disable",(function(){babelHelpers.classPrivateFieldSet(e,m,false);e.recalculateTopsIfExternals(true)}));BX.addCustomEvent("BX.Landing.Block:onAfterAdd",(function(t){setTimeout((function(){var n=t.getData();h(e,E,A).call(e,n.id)}),500)}));BX.addCustomEvent("BX.Landing.Block:changeState",(function(t,n){e.postExternalCommand(babelHelpers.classPrivateFieldGet(e,g).changeState,{blockId:t,state:n})}));BX.addCustomEvent("BX.Landing.Block:onFormSettingsOpen",(function(){if(e.isControlsExternal()){e.postExternalCommand(babelHelpers.classPrivateFieldGet(e,g).hideAll,{})}babelHelpers.classPrivateFieldSet(e,m,true)}));BX.addCustomEvent("BX.Landing.Block:onFormSettingsClose",(function(t){setTimeout((function(){babelHelpers.classPrivateFieldSet(e,m,false);e.recalculateTopsIfExternals(true)}),400);e.postExternalCommand(babelHelpers.classPrivateFieldGet(e,g).hideAll,{})}));BX.addCustomEvent("BX.Landing.Block:onAfterFormSave",(function(t){setTimeout((function(){e.postExternalCommand(babelHelpers.classPrivateFieldGet(e,g).backendAction,{action:"Landing\\Block::saveForm",data:{block:t}})}),1e3)}));BX.addCustomEvent("BX.Landing.Block:onBlockEditClose",(function(){babelHelpers.classPrivateFieldSet(e,m,false);e.recalculateTopsIfExternals(true)}));BX.addCustomEvent("BX.Landing.Block:onContentSave",this.recalculateTopsIfExternals.bind(this));BX.addCustomEvent("BX.Landing.Block:onDesignerBlockSave",this.recalculateTopsIfExternals.bind(this));BX.addCustomEvent("BX.Landing.Block:Card:add",this.recalculateTopsIfExternals.bind(this));BX.addCustomEvent("BX.Landing.Block:Card:remove",this.recalculateTopsIfExternals.bind(this));BX.addCustomEvent("BX.Landing.Block:afterRemove",this.recalculateTopsIfExternals.bind(this));BX.addCustomEvent("BX.Landing.Backend:action",this.onBackendAction.bind(this));BX.addCustomEvent("BX.Landing.Backend:batch",this.onBackendAction.bind(this))}function T(e){return{id:parseInt(e.id),state:e.isEnabled(),permissions:{allowDesignBlock:e.isDesignBlockAllowed(),allowModifyStyles:e.isStyleModifyAllowed(),allowEditContent:e.isEditBlockAllowed(),allowSorting:e.isEditBlockAllowed(),allowRemove:e.isRemoveBlockAllowed(),allowChangeState:e.isChangeStateBlockAllowed(),allowPaste:e.isPasteBlockAllowed(),allowSaveInLibrary:e.isSaveBlockInLibraryAllowed()}}}function P(){var e=this;var t=BX.Landing.PageObject.getBlocks();var n=[];babelHelpers.toConsumableArray(t).map((function(t){return n.push(h(e,y,T).call(e,t))}));this.postExternalCommand(babelHelpers.classPrivateFieldGet(this,g).register,{blocks:n})}function A(e){var t=BX.Landing.PageObject.getBlocks().get(e);if(t){this.postExternalCommand(babelHelpers.classPrivateFieldGet(this,g).register,{blocks:[h(this,y,T).call(this,t)]});if(this.isControlsExternal()){this.recalculateTops()}else{this.postExternalCommand(babelHelpers.classPrivateFieldGet(this,g).hideAll,{})}}}function S(e){return!!e&&!!e.querySelector(".block-wrapper")}function x(e){return!!e&&!!e.querySelector('button[data-id="insert_first_block"]')}function I(e,t){return new Promise((function(n){var o=function o(a){if(!t||a.animationName===t){n(a);c.Event.bind(e,"animationend",o)}};c.Event.bind(e,"animationend",o)}))}function D(e){if(c.Type.isNil(e)){return true}if(c.Type.isArrayLike(e)){return!e.length}if(c.Type.isObject(e)){return Object.keys(e).length<=0}return true}var X,_,O,F;function H(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */H=function t(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",r=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function e(t,n,o){return t[n]=o}}function c(e,t,n,a){var i=t&&t.prototype instanceof f?t:f,r=Object.create(i.prototype),l=new L(a||[]);return o(r,"_invoke",{value:y(e,n,l)}),r}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function f(){}function h(){}function g(){}var v={};s(v,i,(function(){return this}));var p=Object.getPrototypeOf,m=p&&p(p(T([])));m&&m!==t&&n.call(m,i)&&(v=m);var k=g.prototype=f.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function B(e,t){function a(o,i,r,l){var s=d(e[o],e,i);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==babelHelpers["typeof"](u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){a("next",e,r,l)}),(function(e){a("throw",e,r,l)})):t.resolve(u).then((function(e){c.value=e,r(c)}),(function(e){return a("throw",e,r,l)}))}l(s.arg)}var i;o(this,"_invoke",{value:function e(n,o){function r(){return new t((function(e,t){a(n,o,e,t)}))}return i=i?i.then(r,r):r()}})}function y(e,t,n){var o="suspendedStart";return function(a,i){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===a)throw i;return P()}for(n.method=a,n.arg=i;;){var r=n.delegate;if(r){var l=C(r,n);if(l){if(l===u)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===o)throw o="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o="executing";var s=d(e,t,n);if("normal"===s.type){if(o=n.done?"completed":"suspendedYield",s.arg===u)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o="completed",n.method="throw",n.arg=s.arg)}}}function C(e,t){var n=t.method,o=e.iterator[n];if(undefined===o)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=undefined,C(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var a=d(o,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,u;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function t(){for(;++o<e.length;)if(n.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=undefined,t.done=!0,t};return a.next=a}}return{next:P}}function P(){return{value:undefined,done:!0}}return h.prototype=g,o(k,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:h,configurable:!0}),h.displayName=s(g,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,s(e,l,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},b(B.prototype),s(B.prototype,r,(function(){return this})),e.AsyncIterator=B,e.async=function(t,n,o,a,i){void 0===i&&(i=Promise);var r=new B(c(t,n,o,a),i);return e.isGeneratorFunction(n)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},b(k),s(k,l,"Generator"),s(k,i,(function(){return this})),s(k,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},e.values=T,L.prototype={constructor:L,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(w),!t)for(var o in this)"t"===o.charAt(0)&&n.call(this,o)&&!isNaN(+o.slice(1))&&(this[o]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var o=this;function a(e,n){return l.type="throw",l.arg=t,o.next=e,n&&(o.method="next",o.arg=undefined),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],l=r.completion;if("root"===r.tryLoc)return a("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),c=n.call(r,"finallyLoc");if(s&&c){if(this.prev<r.catchLoc)return a(r.catchLoc,!0);if(this.prev<r.finallyLoc)return a(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return a(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return a(r.finallyLoc)}}}},abrupt:function e(t,o){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=o&&o<=r.finallyLoc&&(r=null);var l=r?r.completion:{};return l.type=t,l.arg=o,r?(this.method="next",this.next=r.finallyLoc,u):this.complete(l)},complete:function e(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),u},finish:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),w(o),u}},catch:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;w(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function e(t,n,o){return this.delegate={iterator:T(t),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=undefined),u}},e}BX.Landing.getMode=function(){return"edit"};var M=function(e){babelHelpers.inherits(t,e);babelHelpers.createClass(t,null,[{key:"getMode",value:function e(){return"edit"}},{key:"createInstance",value:function e(t){var n=BX.Landing.PageObject.getRootWindow();if(n.BX.Landing.Main.instance){n.BX.Landing.Main.instance.clear()}n.BX.Landing.Main.instance=new BX.Landing.Main(t)}},{key:"getInstance",value:function e(){var n=BX.Landing.PageObject.getRootWindow();n.BX.Reflection.namespace("BX.Landing.Main");if(n.BX.Landing.Main.instance){return n.BX.Landing.Main.instance}n.BX.Landing.Main.instance=new t(-1);return n.BX.Landing.Main.instance}},{key:"isEditorMode",value:function e(){return c.Dom.hasClass(document.body,"landing-editor")}},{key:"isExternalControlsEnabled",value:function e(){return c.Dom.hasClass(document.body,"enable-external-controls")}},{key:"topInPercent",value:function e(){var t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);var n=document.documentElement.scrollTop||document.body.scrollTop;return n/t*100}},{key:"getAnalyticsCategoryByType",value:function e(){var t=BX.Landing.Env.getInstance().getType();switch(t){case"STORE":return"shop";case"KNOWLEDGE":case"GROUP":return"kb";case"MAINPAGE":return"vibe";default:return"site"}}}]);function t(e){var o;babelHelpers.classCallCheck(this,t);o=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));o.setEventNamespace("BX.Landing.Main");var a=n.Env.getInstance().getOptions();o.id=e;o.options=Object.freeze(a);o.blocks=o.options.blocks;o.currentBlock=null;o.isDesignBlockModeFlag=o.options["design_block"]===true;o.loadedDeps={};o.cache=new c.Cache.MemoryCache;o.externalControls=new w;o.onSliderFormLoaded=o.onSliderFormLoaded.bind(babelHelpers.assertThisInitialized(o));o.onBlockDelete=o.onBlockDelete.bind(babelHelpers.assertThisInitialized(o));BX.addCustomEvent("Landing.Block:onAfterDelete",o.onBlockDelete);o.adjustEmptyAreas();BX.Landing.UI.Panel.StatusPanel.setLastModified(a.lastModified);if(!o.isDesignBlockModeFlag){BX.Landing.UI.Panel.StatusPanel.getInstance().show()}var i=n.Env.getInstance().getType();if(i===t.TYPE_KNOWLEDGE||i===t.TYPE_GROUP){var r=document.querySelector(".landing-main");if(c.Type.isDomNode(r)){c.Dom.addClass(r,"landing-ui-collapse")}}return o}babelHelpers.createClass(t,[{key:"clear",value:function e(){BX.removeCustomEvent("Landing.Block:onAfterDelete",this.onBlockDelete)}},{key:"isCrmFormPage",value:function e(){return n.Env.getInstance().getSpecialType()==="crm_forms"}},{key:"isDesignBlockMode",value:function e(){return this.isDesignBlockModeFlag}},{key:"getSaveBlockPanel",value:function e(){var t=new i.SaveBlock("save_block_panel",{block:this.currentBlock});t.layout.hidden=true;t.content.hidden=false;c.Dom.append(t.layout,window.parent.document.body);return t}},{key:"getBlocksPanel",value:function e(){var t=this;return this.cache.remember("blockPanel",(function(){var e=t.createBlocksPanel();setTimeout((function(){if(e.sidebarButtons.get(t.options.default_section)){e.sidebarButtons.get(t.options.default_section).layout.click()}else{babelHelpers.toConsumableArray(e.sidebarButtons)[0].layout.click()}}));e.layout.hidden=true;e.content.hidden=false;c.Dom.append(e.layout,window.parent.document.body);return e}))}},{key:"getBlocksPanelContent",value:function e(){return this.getBlocksPanel().content}},{key:"hideBlocksPanel",value:function e(){if(this.getBlocksPanel()){return this.getBlocksPanel().hide()}return Promise.resolve()}},{key:"getLayoutAreas",value:function e(){return this.cache.remember("layoutAreas",(function(){return[].concat(babelHelpers.toConsumableArray(document.body.querySelectorAll(".landing-header")),babelHelpers.toConsumableArray(document.body.querySelectorAll(".landing-sidebar")),babelHelpers.toConsumableArray(document.body.querySelectorAll(".landing-main")),babelHelpers.toConsumableArray(document.body.querySelectorAll(".landing-footer")))}))}},{key:"createInsertBlockButton",value:function e(t){var n=new BX.Landing.UI.Button.Plus("insert_first_block",{text:o.Loc.getMessage("ACTION_BUTTON_CREATE")});n.on("click",this.showBlocksPanel.bind(this,null,t,n));n.on("mouseover",this.onCreateButtonMouseover.bind(this,t,n));n.on("mouseout",this.onCreateButtonMouseout.bind(this,t,n));return n}},{key:"onCreateButtonMouseover",value:function e(t,n){if(c.Dom.hasClass(t,"landing-header")||c.Dom.hasClass(t,"landing-footer")){var a=this.getLayoutAreas();if(a.length>1){var i=o.Loc.getMessage("ACTION_BUTTON_CREATE");if(c.Dom.hasClass(t,"landing-main")){n.setText("".concat(i," ").concat(o.Loc.getMessage("LANDING_ADD_BLOCK_TO_MAIN")))}if(c.Dom.hasClass(t,"landing-header")){n.setText("".concat(i," ").concat(o.Loc.getMessage("LANDING_ADD_BLOCK_TO_HEADER")))}if(c.Dom.hasClass(t,"landing-sidebar")){n.setText("".concat(i," ").concat(o.Loc.getMessage("LANDING_ADD_BLOCK_TO_SIDEBAR")))}if(c.Dom.hasClass(t,"landing-footer")){n.setText("".concat(i," ").concat(o.Loc.getMessage("LANDING_ADD_BLOCK_TO_FOOTER")))}clearTimeout(this.fadeTimeout);this.fadeTimeout=setTimeout((function(){c.Dom.addClass(t,"landing-area-highlight");a.filter((function(e){return e!==t})).forEach((function(e){c.Dom.addClass(e,"landing-area-fade")}))}),400)}}}},{key:"onCreateButtonMouseout",value:function e(t,n){clearTimeout(this.fadeTimeout);if(c.Dom.hasClass(t,"landing-header")||c.Dom.hasClass(t,"landing-footer")){var a=this.getLayoutAreas();if(a.length>1){n.setText(o.Loc.getMessage("ACTION_BUTTON_CREATE"));a.forEach((function(e){c.Dom.removeClass(e,"landing-area-highlight");c.Dom.removeClass(e,"landing-area-fade")}))}}}},{key:"initEmptyArea",value:function e(t){if(t){t.innerHTML="";c.Dom.append(this.createInsertBlockButton(t).layout,t);c.Dom.addClass(t,"landing-empty")}}},{key:"destroyEmptyArea",value:function e(t){if(t){var n=t.querySelector('button[data-id="insert_first_block"]');if(n){c.Dom.remove(n)}c.Dom.removeClass(t,"landing-empty")}}},{key:"adjustEmptyAreas",value:function e(){this.getLayoutAreas().filter((function(e){return S(e)&&x(e)})).forEach(this.destroyEmptyArea,this);this.getLayoutAreas().filter((function(e){return!S(e)&&!x(e)})).forEach(this.initEmptyArea,this);var t=document.body.querySelector("main.landing-edit-mode");var n=!this.getLayoutAreas().some(S);if(t){if(n){c.Dom.addClass(t,"landing-empty");return}c.Dom.removeClass(t,"landing-empty")}}},{key:"enableControls",value:function e(){c.Dom.removeClass(document.body,"landing-ui-hide-controls")}},{key:"disableControls",value:function e(){c.Dom.addClass(document.body,"landing-ui-hide-controls")}},{key:"isControlsEnabled",value:function e(){return!c.Dom.hasClass(document.body,"landing-ui-hide-controls")}},{key:"makeControlsInternal",value:function e(){BX.onCustomEvent("BX.Landing.Main:changeControls",["internal",t.topInPercent()]);c.Dom.removeClass(document.body,"landing-ui-external-controls")}},{key:"makeControlsExternal",value:function e(){BX.onCustomEvent("BX.Landing.Main:changeControls",["external",t.topInPercent()]);c.Dom.addClass(document.body,"landing-ui-external-controls")}},{key:"isControlsExternal",value:function e(){return c.Dom.hasClass(document.body,"landing-ui-external-controls")}},{key:"setDeviceCode",value:function e(t){document.body.setAttribute("data-device",t)}},{key:"getDeviceCode",value:function e(){return document.body.getAttribute("data-device")}},{key:"setTouchDevice",value:function e(){c.Dom.removeClass(document.documentElement,"bx-no-touch");c.Dom.addClass(document.documentElement,"bx-touch")}},{key:"setNoTouchDevice",value:function e(){c.Dom.removeClass(document.documentElement,"bx-touch");c.Dom.addClass(document.documentElement,"bx-no-touch")}},{key:"appendBlock",value:function e(t,n){if(!this.isAllowedAppendBlock(t)){return c.Tag.render(X||(X=babelHelpers.taggedTemplateLiteral([""])))}var o=c.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(["",""])),t.content);o.id="block".concat(t.id);if(!n){c.Dom.addClass(o,"landing-ui-show");I(o,"showBlock").then((function(){c.Dom.removeClass(o,"landing-ui-show")}))}this.insertToBlocksFlow(o);return o}},{key:"isAllowedAppendBlock",value:function e(t){var n;var o=BX.Landing.Env.getInstance().getType().toLowerCase();var a=(n=t.manifest.block.type)!==null&&n!==void 0?n:[];if(o==="mainpage"||a.includes("mainpage")){if(c.Type.isString(a)){a=[a]}if(!a.includes(o)){return false}}return true}},{key:"showBlocksPanel",value:function e(t,n,o,a){BX.UI.Analytics.sendData({tool:"landing",category:BX.Landing.Main.getAnalyticsCategoryByType(),event:"open_list"});this.currentBlock=t;this.currentArea=n;this.insertBefore=a;BX.Landing.UI.Panel.EditorPanel.getInstance().hide();if(this.isCrmFormPage()||this.isControlsExternal()){var i=l.PageObject.getRootWindow();c.Dom.append(this.getBlocksPanel().layout,i.document.body);c.Dom.append(this.getBlocksPanel().overlay,i.document.body)}this.getBlocksPanel().show();this.disableAddBlockButtons();if(!!n&&!!o){this.onCreateButtonMouseout(n,o)}}},{key:"showSaveBlock",value:function e(t){this.currentBlock=t;this.getSaveBlockPanel().show()}},{key:"disableAddBlockButtons",value:function e(){l.PageObject.getBlocks().forEach((function(e){var t=e.panels.get("create_action");if(t){var n=t.buttons.get("insert_after");if(n){n.disable()}}}))}},{key:"enableAddBlockButtons",value:function e(){l.PageObject.getBlocks().forEach((function(e){var t=e.panels.get("create_action");if(t){var n=t.buttons.get("insert_after");if(n){n.enable()}}}))}},{key:"createBlocksPanel",value:function e(){var t=this;var n=this.options.blocks;var i=Object.keys(n);var r=new a.Content("blocks_panel",{title:o.Loc.getMessage("LANDING_CONTENT_BLOCKS_TITLE"),className:"landing-ui-panel-block-list",scrollAnimation:true});r.subscribe("onCancel",(function(){t.enableAddBlockButtons()}));i.forEach((function(e){var o=!D(n[e].items);var a=e==="popular";var i=n[e].separator;var l=e==="favourite";if(o&&!a||i||l){r.appendSidebarButton(t.createBlockPanelSidebarButton(e,n[e]))}}));r.appendSidebarButton(new BX.Landing.UI.Button.SidebarButton("feedback_button",{className:"landing-ui-button-sidebar-feedback",text:o.Loc.getMessage("LANDING_BLOCKS_LIST_FEEDBACK_BUTTON"),onClick:this.showFeedbackForm.bind(this)}));return r}},{key:"showSliderFeedbackForm",value:function e(){var n=this;c.Runtime.loadExtension("ui.feedback.form").then((function(){var e={};e.bitrix24=n.options.server_name;e.siteId=n.options.site_id;e.siteUrl=n.options.url;e.siteTemplate=n.options.xml_id;e.productType=n.options.productType||"Undefined";e.typeproduct=function(){if(n.options.params.type===t.TYPE_GROUP){return"KNOWLEDGE_GROUP"}return n.options.params.type}();BX.UI.Feedback.Form.open({id:Math.random()+"",forms:n.getFeedbackFormOptions(),presets:e})}))}},{key:"getFeedbackFormOptions",value:function e(){return[{zones:["en","eu","in","uk"],id:16,lang:"en",sec:"3h483y"},{zones:["ru","by","kz"],id:8,lang:"ru",sec:"x80yjw"},{zones:["ua"],id:18,lang:"ua",sec:"d9e09o"},{zones:["la","co","mx"],id:14,lang:"la",sec:"wu561i"},{zones:["de"],id:10,lang:"de",sec:"eraz2q"},{zones:["com.br","br"],id:12,lang:"br",sec:"r6wvge"}]}},{key:"onSliderFormLoaded",value:function e(){this.sliderFormLoader.hide()}},{key:"showFeedbackForm",value:function e(){this.showSliderFeedbackForm({target:"blocksList"})}},{key:"createBlockPanelSidebarButton",value:function e(t,n){return new BX.Landing.UI.Button.SidebarButton(t,{text:n.name,child:!n.separator,className:n["new"]?"landing-ui-new-section":"",onClick:this.onBlocksListCategoryChange.bind(this,t)})}},{key:"addNewBlockToCategory",value:function e(t,n){if(this.blocks[t]){var o=n["codeOriginal"]||n["code"];if(t==="last"){if(!this.lastBlocks){this.lastBlocks=Object.keys(this.blocks.last.items)}this.lastBlocks.unshift(o)}else{this.blocks[t].items[o]=n}this.onBlocksListCategoryChange(t)}}},{key:"removeBlockFromList",value:function e(t){var n=false;for(var o in this.blocks){if(this.blocks[o].items[t]!==undefined){delete this.blocks[o].items[t];n=true}}if(this.lastBlocks.indexOf(t)!==-1){this.lastBlocks.splice(this.lastBlocks.indexOf(t),1);n=true}if(n){var a=this.getBlocksPanel().sidebarButtons.find((function(e){return c.Dom.hasClass(e.layout,"landing-ui-active")}));if(a){this.onBlocksListCategoryChange(a.id)}}}},{key:"getTemplateCode",value:function e(){var t=n.Env.getInstance().getOptions(),o=t.tplCode;if(o.indexOf("@")>0){o=o.split("@")[1]}if(!o||o.length<=0){o=null}return o}},{key:"onBlocksListCategoryChange",value:function(){var e=babelHelpers.asyncToGenerator(H().mark((function e(t){var n=this;var o,a,i;return H().wrap((function e(r){while(1)switch(r.prev=r.next){case 0:this.currentCategory=t;if(this.currentCategory==="favourite"){BX.UI.Analytics.sendData({tool:"landing",category:BX.Landing.Main.getAnalyticsCategoryByType(),event:"click_on_favourite"})}o=this.getTemplateCode();this.getBlocksPanel().content.hidden=false;this.getBlocksPanel().sidebarButtons.forEach((function(e){var n=e.id===t?"add":"remove";e.layout.classList[n]("landing-ui-active")}));this.getBlocksPanel().content.innerHTML="";a=new BX.Loader({target:this.getBlocksPanel().content,size:90});a.show();r.prev=8;r.next=11;return BX.Landing.Backend.getInstance().action("Landing::getFavouriteBlocks");case 11:this.favouriteBlocks=r.sent;r.next=18;break;case 14:r.prev=14;r.t0=r["catch"](8);console.warn("Failed to fetch favourite blocks",r.t0);this.favouriteBlocks=[];case 18:a.hide();if(!(t==="last")){r.next=24;break}if(!this.lastBlocks){this.lastBlocks=Object.keys(this.blocks.last.items)}this.lastBlocks=babelHelpers.toConsumableArray(new Set(this.lastBlocks));this.lastBlocks.forEach((function(e){var o=n.getBlockFromRepository(e);if(o){o.currentCategory=t;n.getBlocksPanel().appendCard(n.createBlockCard(e,o))}}));return r.abrupt("return");case 24:if(!(t==="favourite")){r.next=34;break}if(!this.favouriteBlocks){this.favouriteBlocks=Object.keys(this.blocks.favourite.items)}i=[];this.favouriteBlocks=babelHelpers.toConsumableArray(new Set(this.favouriteBlocks));this.favouriteBlocks.forEach((function(e){var o=n.getBlockFromRepository(e);if(o){o.currentCategory=t;i.push(n.createBlockCard(e,o))}}));if(!(i.length===0)){r.next=32;break}c.Dom.append(this.createFavouriteCategoryEmptyState(),this.getBlocksPanelContent());return r.abrupt("return");case 32:i.forEach((function(e){n.getBlocksPanel().appendCard(e)}));return r.abrupt("return");case 34:Object.keys(this.blocks[t].items).forEach((function(e){var a=n.blocks[t].items[e];var i=a["tpl_code"]&&a["tpl_code"].length>0?a["tpl_code"]:null;if(!o||!i||i&&i===o){a.currentCategory=t;n.getBlocksPanel().appendCard(n.createBlockCard(e,a))}}));if(this.getBlocksPanel().content.scrollTop){requestAnimationFrame((function(){n.getBlocksPanel().content.scrollTop=0}))}case 36:case"end":return r.stop()}}),e,this,[[8,14]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getBlockFromRepository",value:function e(t){var n=this.options.blocks;var o=Object.keys(n);var a=o.find((function(e){return t in n[e].items}));if(a){return n[a].items[t]}}},{key:"onCopyBlock",value:function e(t){window.localStorage.landingBlockId=t.id;window.localStorage.landingBlockName=t.manifest.block.name;window.localStorage.landingBlockAction="copy";try{window.localStorage.requiredUserAction=JSON.stringify(t.requiredUserActionOptions)}catch(e){window.localStorage.requiredUserAction=""}}},{key:"onCutBlock",value:function e(t){window.localStorage.landingBlockId=t.id;window.localStorage.landingBlockName=t.manifest.block.name;window.localStorage.landingBlockAction="cut";try{window.localStorage.requiredUserAction=JSON.stringify(t.requiredUserActionOptions)}catch(e){window.localStorage.requiredUserAction=""}BX.Landing.PageObject.getBlocks().remove(t);c.Dom.remove(t.node);BX.onCustomEvent("Landing.Block:onAfterDelete",[t])}},{key:"onPasteBlock",value:function e(t,n){var o=this;if(window.localStorage.landingBlockId){var a="Landing::copyBlock";if(window.localStorage.landingBlockAction==="cut"){a="Landing::moveBlock"}var i={};i[a]={action:a,data:{lid:t.lid||BX.Landing.Main.getInstance().id,block:window.localStorage.landingBlockId,params:{AFTER_ID:t.id,RETURN_CONTENT:"Y"}}};s.Backend.getInstance().batch(a,i,{action:a}).then((function(e){o.currentBlock=t;return o.addBlock(e[a].result.content,false,false,n)}))}}},{key:"addBlock",value:function e(t,n){var o=arguments.length>3?arguments[3]:undefined;if(this.lastBlocks){this.lastBlocks.unshift(t.manifest.codeOriginal||t.manifest.code)}var a=this;var i=this.appendBlock(t,n);return this.loadBlockDeps(t).then((function(e){a.currentBlock=null;a.currentArea=null;var n=parseInt(t.id);var r=BX.Landing.PageObject.getBlocks();if(r){r.forEach((function(e){if(e.id===n){c.Dom.remove(e.node);BX.Landing.PageObject.getBlocks().remove(e)}}))}void new BX.Landing.Block(i,{id:n,sections:t.sections,requiredUserAction:t.requiredUserAction,manifest:t.manifest,access:t.access,active:c.Text.toBoolean(t.active),php:t.php,designed:t.designed,anchor:t.anchor,dynamicParams:t.dynamicParams,repoId:t.repoId});return a.runBlockScripts(t).then((function(){if(o){o(n)}return i}))}))["catch"]((function(e){console.warn(e)}))}},{key:"onAddBlock",value:function e(t,n){var o=this;var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var i=c.Text.toNumber(n);this.hideBlocksPanel();return this.showBlockLoader().then(this.loadBlock(t,i,a)).then((function(e){return new Promise((function(t){setTimeout((function(){t(e)}),500)}))})).then((function(e){e.manifest.codeOriginal=t;var n=o.addBlock(e,false,o.insertBefore);o.insertBefore=false;o.adjustEmptyAreas();void o.hideBlockLoader();o.enableAddBlockButtons();BX.onCustomEvent("BX.Landing.Block:onAfterAdd",e);return n}))}},{key:"insertToBlocksFlow",value:function e(t){var n=this.currentBlock&&this.currentBlock.node&&this.currentBlock.node.parentNode;if(n&&!this.insertBefore){c.Dom.insertAfter(t,this.currentBlock.node);return}if(n&&this.insertBefore){c.Dom.insertBefore(t,this.currentBlock.node)}c.Dom.prepend(t,this.currentArea)}},{key:"getBlockLoader",value:function e(){if(!this.blockLoader){this.blockLoader=new BX.Loader({size:60});this.blockLoaderContainer=c.Dom.create("div",{props:{className:"landing-block-loader-container"},children:[this.blockLoader.layout]})}return this.blockLoaderContainer}},{key:"showBlockLoader",value:function e(){this.insertToBlocksFlow(this.getBlockLoader());this.blockLoader.show();return Promise.resolve()}},{key:"hideBlockLoader",value:function e(){c.Dom.remove(this.getBlockLoader());this.blockLoader=null;return Promise.resolve()}},{key:"loadBlockDeps",value:function e(t){var n=this;var a=BX.processHTML(t.content_ext);if(BX.type.isArray(a.SCRIPT)){a.SCRIPT=a.SCRIPT.filter((function(e){return!e.isInternal}))}if(BX.type.isObject(t.lang)){o.Loc.setMessage(t.lang)}var i=0;var r=t.js.length+a.SCRIPT.length+a.STYLE.length+t.css.length;var l=null;if(!this.loadedDeps[t.manifest.code]&&r>0){l=new Promise((function(e){function o(){i+=1;if(i===r){e(t)}}if(r>i){a.SCRIPT.forEach((function(e){if(!e.isInternal){BX.loadScript(e.JS,o)}}));a.STYLE.forEach((function(e){BX.loadScript(e,o)}));t.css.forEach((function(e){BX.loadScript(e,o)}));t.js.forEach((function(e){BX.loadScript(e,o)}))}else{o()}n.loadedDeps[t.manifest.code]=true}))}else{l=Promise.resolve(t)}return l.then((function(e){if(BX.type.isArray(e.assetStrings)){var t=document.head;e.assetStrings.forEach((function(e){var n=c.Tag.render(O||(O=babelHelpers.taggedTemplateLiteral(["",""])),e);c.Dom.insertAfter(n,t.lastChild)}))}return e}))}},{key:"runBlockScripts",value:function e(t){return new Promise((function(e){var n=BX.processHTML(t.content).SCRIPT;if(n.length){BX.ajax.processScripts(n,undefined,(function(){e(t)}))}else{e(t)}}))}},{key:"loadBlock",value:function e(t,n,o){var a=this;return function(){var e=a.id;var i=a.options.site_id;if(a.currentBlock){e=a.currentBlock.lid;i=a.currentBlock.siteId}if(a.currentArea){e=c.Dom.attr(a.currentArea,"data-landing");i=c.Dom.attr(a.currentArea,"data-site")}var r={lid:e,siteId:i,preventHistory:o?1:0};var l={ACTIVE:"Y",CODE:t,AFTER_ID:a.currentBlock?a.currentBlock.id:0,RETURN_CONTENT:"Y",CATEGORY:a.currentCategory};if(!c.Type.isBoolean(o)||o===false){BX.Landing.History.getInstance().push()}if(!n){r.fields=l;return s.Backend.getInstance().action("Landing::addBlock",r,{code:t}).then((function(t){if(a.insertBefore){return s.Backend.getInstance().action("Landing::upBlock",{lid:e,siteId:i,block:t.id}).then((function(){return t}))}return t}))}return s.Backend.getInstance().action("Block::getContent",{block:n,lid:e,fields:l,editMode:1}).then((function(e){e.id=n;return e}))}}},{key:"createBlockCard",value:function e(t,n,o){return new BX.Landing.UI.Card.BlockPreviewCard({title:n.name,image:n.preview,code:t,app_expired:n.app_expired,favorite:!!n.favorite,favoriteMy:!!n.favoriteMy,repo_id:n.repo_id,mode:o,isNew:n["new"]===true,onClick:this.onAddBlock.bind(this,t),currentCategory:n.currentCategory,useFavouriteBadge:true,isFavorite:Array.isArray(this.favouriteBlocks)&&this.favouriteBlocks.includes(t)})}},{key:"createFavouriteCategoryEmptyState",value:function e(){return c.Tag.render(F||(F=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="landing-favourite-category-empty-state text-center">\n\t\t\t\t<img \n\t\t\t\t\tclass="landing-favourite-category-empty-state--image" \n\t\t\t\t\tsrc="/bitrix/images/landing/empty-favourite.png" \n\t\t\t\t\tstyle="margin-bottom: 14px;"\n\t\t\t\t/>\n\t\t\t\t<p \n\t\t\t\t\tclass="landing-favourite-category-empty-state--title"\n\t\t\t\t\tstyle="color: #333333; font-weight: 500; font-size: 19px; line-height: 26px; margin-bottom: 10px;"\n\t\t\t\t>\n\t\t\t\t\t','\n\t\t\t\t</p>\n\t\t\t\t<p \n\t\t\t\t\tclass="landing-favourite-category-empty-state--text"\n\t\t\t\t\tstyle="color: #414A56; font-weight: 400; font-size: 16px; line-height: 21px; max-width: 340px; margin: auto;"\n\t\t\t\t>\n\t\t\t\t\t',"\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t"])),o.Loc.getMessage("LANDING_SECTION_FAVOURITE_EMPTY_STATE_TITLE"),o.Loc.getMessage("LANDING_SECTION_FAVOURITE_EMPTY_STATE_TEXT"))}},{key:"onBlockDelete",value:function e(t){if(!t.parent.querySelector(".block-wrapper")){this.adjustEmptyAreas()}}},{key:"showOverlay",value:function e(){var t=document.querySelector("main.landing-edit-mode");if(t){c.Dom.addClass(t,"landing-ui-overlay")}}},{key:"hideOverlay",value:function e(){var t=document.querySelector("main.landing-edit-mode");if(t){c.Dom.removeClass(t,"landing-ui-overlay")}}},{key:"reloadSlider",value:function e(t){return r.SliderHacks.reloadSlider(t,window.parent)}}]);return t}(t.EventEmitter);babelHelpers.defineProperty(M,"TYPE_PAGE","PAGE");babelHelpers.defineProperty(M,"TYPE_STORE","STORE");babelHelpers.defineProperty(M,"TYPE_KNOWLEDGE","KNOWLEDGE");babelHelpers.defineProperty(M,"TYPE_GROUP","GROUP");e.Main=M})(this.BX.Landing=this.BX.Landing||{},BX.Event,BX.Landing,BX.Landing,BX.Landing.UI.Panel,BX.Landing.UI.Panel,BX.Landing,BX.Landing,BX.Landing,BX);
//# sourceMappingURL=main.bundle.map.js