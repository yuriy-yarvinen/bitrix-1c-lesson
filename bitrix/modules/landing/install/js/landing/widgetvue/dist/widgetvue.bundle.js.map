{"version":3,"file":"widgetvue.bundle.js","sources":["../src/logger.js","../src/widgetvue.js"],"sourcesContent":["export class Logger\n{\n\t#enable: boolean = false;\n\n\tconstructor(enable: boolean = false): void\n\t{\n\t\tthis.#enable = enable;\n\t}\n\n\tlog(...message: string)\n\t{\n\t\tif (this.#enable)\n\t\t{\n\t\t\tconsole.log(...message);\n\t\t}\n\t}\n}\n","import { WidgetOptions } from './internal/types';\nimport { Logger } from './logger';\nimport { Dom, Event, Loc, Text, Type, ajax as Ajax } from 'main.core';\n\nimport './css/style.css';\n\nexport class WidgetVue\n{\n\tstatic runningAppNodes: Set<HTMLElement> = new Set();\n\n\t#rootNode: ?HTMLElement = null;\n\t#template: string;\n\t#style: ?string;\n\t#lang: {[key: string]: string} = {};\n\t#appId: number = 0;\n\t#appAllowedByTariff: boolean = true;\n\t#fetchable: boolean = false;\n\t#clickable: boolean = false;\n\n\t/**\n\t * Unique string for every widget\n\t * @type {string}\n\t */\n\t#uniqueId: string;\n\t#frame: ?HTMLIFrameElement = null;\n\t#logger: Logger;\n\n\t#demoData: ?{} = null;\n\t#useDemoData: boolean = false;\n\t#blockId: number = 0;\n\n\tconstructor(options: WidgetOptions): void\n\t{\n\t\tthis.#uniqueId = `widget_${Text.getRandom(8)}`;\n\t\tthis.#logger = new Logger(options.debug || false);\n\n\t\tthis.#rootNode = Type.isString(options.rootNode)\n\t\t\t? document.querySelector(options.rootNode)\n\t\t\t: null\n\t\t;\n\n\t\tthis.#template = Type.isString(options.template) ? options.template : '';\n\n\t\tthis.#style = Type.isString(options.style) ? options.style : null;\n\n\t\tthis.#demoData = Type.isObject(options.demoData) ? options.demoData : null;\n\t\tthis.#useDemoData = Type.isBoolean(options.useDemoData) ? options.useDemoData : false;\n\n\t\tthis.#lang = options.lang || {};\n\t\tthis.#blockId = options.blockId ? Text.toNumber(options.blockId) : 0;\n\n\t\tthis.#appId = options.appId ? Text.toNumber(options.appId) : 0;\n\t\tthis.#appAllowedByTariff = (this.#appId && Type.isBoolean(options.appAllowedByTariff))\n\t\t\t? options.appAllowedByTariff\n\t\t\t: true\n\t\t;\n\n\t\tthis.#fetchable = Type.isBoolean(options.fetchable) ? options.fetchable : false;\n\t\tconst isEditMode = Type.isFunction(BX.Landing.getMode) && BX.Landing.getMode() === 'edit';\n\t\tthis.#clickable = !isEditMode;\n\t}\n\n\t/**\n\t * Create frame with widget content\n\t * @returns {Promise|*}\n\t */\n\tmount(): Promise\n\t{\n\t\treturn this.#getFrameContent()\n\t\t\t.then((srcDoc) => {\n\t\t\t\tthis.#frame = document.createElement('iframe');\n\t\t\t\tthis.#frame.className = 'landing-widgetvue-iframe';\n\t\t\t\tthis.#frame.sandbox = 'allow-scripts';\n\t\t\t\tthis.#frame.srcdoc = srcDoc;\n\n\t\t\t\tthis.#frame.onload = () => {\n\t\t\t\t\tthis.#message('getSize', {}, this.#frame.contentWindow);\n\t\t\t\t};\n\n\t\t\t\tif (\n\t\t\t\t\tthis.#blockId > 0\n\t\t\t\t\t&& this.#rootNode\n\t\t\t\t\t&& !WidgetVue.runningAppNodes.has(this.#rootNode)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst blockWrapper = this.#rootNode.parentElement;\n\t\t\t\t\tDom.clean(blockWrapper);\n\t\t\t\t\tDom.append(this.#frame, blockWrapper);\n\n\t\t\t\t\tWidgetVue.runningAppNodes.add(this.#rootNode);\n\n\t\t\t\t\tthis.#bindEvents();\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\tasync #getFrameContent(): Promise<string>\n\t{\n\t\tlet content = '';\n\n\t\tconst core = await this.#getCoreConfigs();\n\t\tcontent += this.#parseExtensionConfig(core.data);\n\n\t\tconst assets = await this.#getAssetsConfigs();\n\t\tcontent += this.#parseExtensionConfig(assets.data);\n\n\t\tcontent += this.#parseExtensionConfig({\n\t\t\tlang_additional: this.#lang,\n\t\t});\n\t\tif (this.#style)\n\t\t{\n\t\t\tcontent += `<link rel=\"stylesheet\" href=\"${this.#style}\">`;\n\t\t}\n\n\t\tconst engineParams = await this.#getEngineParams();\n\n\t\tconst appInit = `\n\t\t\t<script>\n\t\t\t\tBX.ready(function() {\n\t\t\t\t\t(new BX.Landing.WidgetVue.Engine(\n\t\t\t\t\t\t${JSON.stringify(engineParams)},\n\t\t\t\t\t)).render();\n\t\t\t\t});\n\t\t\t</script>\n\n\t\t\t<div id=\"${this.#uniqueId}\">${this.#template}</div>\n\t\t`;\n\n\t\tcontent += appInit;\n\n\t\treturn content;\n\t}\n\n\tasync #getEngineParams(): Promise<Object>\n\t{\n\t\tconst engineParams = {\n\t\t\tid: this.#uniqueId,\n\t\t\torigin: window.location.origin,\n\t\t\tfetchable: this.#fetchable,\n\t\t\tclickable: this.#clickable,\n\t\t};\n\n\t\tif (this.#appAllowedByTariff)\n\t\t{\n\t\t\tif (this.#useDemoData)\n\t\t\t{\n\t\t\t\tif (!this.#demoData)\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.log('Widget haven\\'t demo data and can be render correctly');\n\t\t\t\t}\n\n\t\t\t\tengineParams.data = this.#demoData || {};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tengineParams.data = await this.#fetchData();\n\t\t\t\t}\n\t\t\t\tcatch (error)\n\t\t\t\t{\n\t\t\t\t\tengineParams.error = error.message || 'error';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tengineParams.error = Loc.getMessage('LANDING_WIDGETVUE_ERROR_PAYMENT_MSGVER_1');\n\t\t}\n\n\t\treturn engineParams;\n\t}\n\n\tasync #getCoreConfigs(): Promise<Object>\n\t{\n\t\treturn Ajax.runAction('landing.vibe.getCoreConfig');\n\t}\n\n\tasync #getAssetsConfigs(): Promise<Object>\n\t{\n\t\tconst extCodes = [\n\t\t\t'landing.widgetvue.engine',\n\t\t];\n\n\t\treturn Ajax.runAction('landing.vibe.getAssetsConfig', {\n\t\t\tdata: {\n\t\t\t\textCodes,\n\t\t\t},\n\t\t});\n\t}\n\n\t#parseExtensionConfig(ext: Object): string\n\t{\n\t\tconst domain = `${document.location.protocol}//${document.location.host}`;\n\t\tlet html = '';\n\n\t\tif (ext.lang_additional !== undefined)\n\t\t{\n\t\t\thtml += `<script>BX.message(${JSON.stringify(ext.lang_additional)})</script>`;\n\t\t}\n\n\t\t(ext.js || []).forEach((js) => {\n\t\t\thtml += `<script src=\"${domain}${js}\"></script>`;\n\t\t});\n\n\t\t(ext.css || []).forEach((css) => {\n\t\t\thtml += `<link href=\"${domain}${css}\" type=\"text/css\" rel=\"stylesheet\" />`;\n\t\t});\n\n\t\treturn html;\n\t}\n\n\t#fetchData(params = {}): Promise<Object>\n\t{\n\t\tif (!this.#fetchable)\n\t\t{\n\t\t\tthis.#logger.log('Fetch data is impossible now (haven`t handler)');\n\n\t\t\treturn Promise.resolve({});\n\t\t}\n\n\t\tif (this.#useDemoData)\n\t\t{\n\t\t\treturn Promise.resolve(this.#demoData || {});\n\t\t}\n\n\t\treturn Ajax.runAction('landing.vibe.fetchData', {\n\t\t\tdata: {\n\t\t\t\tblockId: this.#blockId,\n\t\t\t\tparams,\n\t\t\t},\n\t\t})\n\t\t\t.then((jsonData) => {\n\t\t\t\tconst data = JSON.parse(jsonData.data || []);\n\t\t\t\tif (data.error)\n\t\t\t\t{\n\t\t\t\t\tthrow new Error(data.error);\n\t\t\t\t}\n\n\t\t\t\treturn data;\n\t\t\t})\n\n\t\t\t.catch((fail) => {\n\t\t\t\tconst logMessages = [`Fetch data error!\\nWidget ID: ${this.#blockId}`];\n\t\t\t\tif (Object.keys(params) > 0)\n\t\t\t\t{\n\t\t\t\t\tlogMessages.push('\\nFetch request params:', params);\n\t\t\t\t}\n\n\t\t\t\tif (Type.isString(fail))\n\t\t\t\t{\n\t\t\t\t\tlogMessages.push(`\\nError in JSON data: ${fail}`);\n\t\t\t\t}\n\t\t\t\telse if (\n\t\t\t\t\tType.isObject(fail)\n\t\t\t\t\t&& 'errors' in fail\n\t\t\t\t\t&& Type.isArray(fail.errors)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tfail.errors.forEach(error => {\n\t\t\t\t\t\tif (error.message !== undefined)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlogMessages.push(`\\nJavaScript error: ${error.message}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.#logger.log(...logMessages);\n\t\t\t\tthrow new Error(Loc.getMessage('LANDING_WIDGETVUE_ERROR_FETCH'));\n\t\t\t});\n\t}\n\n\t#message(name: string, params: {} = {}, target: Window = window)\n\t{\n\t\ttarget.postMessage(\n\t\t\t{\n\t\t\t\tname,\n\t\t\t\tparams,\n\t\t\t\torigin: this.#uniqueId,\n\t\t\t},\n\t\t\t'*',\n\t\t);\n\t}\n\n\t#bindEvents()\n\t{\n\t\tEvent.bind(window, 'message', this.#onMessage.bind(this));\n\t}\n\n\t#onMessage(event)\n\t{\n\t\t// todo: need check origin manually?\n\n\t\tif (\n\t\t\tevent.data\n\t\t\t&& event.data.origin\n\t\t\t&& event.data.name\n\t\t\t&& event.data.params\n\t\t\t&& Type.isObject(event.data.params)\n\t\t)\n\t\t{\n\t\t\tif (event.data.origin !== this.#uniqueId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.data.name === 'fetchData')\n\t\t\t{\n\t\t\t\tthis.#fetchData(event.data.params)\n\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\tthis.#message('setData', {data}, event.source);\n\t\t\t\t\t})\n\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\tthis.#message('setError', {error}, event.source);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tevent.data.name === 'setSize'\n\t\t\t\t&& event.data.params.size !== undefined\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.#frame.height = parseInt(event.data.params.size, 10);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tevent.data.name === 'openApplication'\n\t\t\t\t&& this.#appId > 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst params = Type.isObject(event.data.params) ? event.data.params : {};\n\t\t\t\tBX.rest.AppLayout.openApplication(\n\t\t\t\t\tthis.#appId,\n\t\t\t\t\tparams,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tevent.data.name === 'openPath'\n\t\t\t\t&& Type.isString(event.data.params.path)\n\t\t\t)\n\t\t\t{\n\t\t\t\tBX.rest.AppLayout.openPath(\n\t\t\t\t\tthis.#appId,\n\t\t\t\t\t{\n\t\t\t\t\t\tpath: event.data.params.path,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["Logger","constructor","enable","log","message","console","WidgetVue","options","Text","getRandom","debug","Type","isString","rootNode","document","querySelector","template","style","isObject","demoData","isBoolean","useDemoData","lang","blockId","toNumber","appId","appAllowedByTariff","fetchable","isEditMode","isFunction","BX","Landing","getMode","mount","then","srcDoc","createElement","className","sandbox","srcdoc","onload","contentWindow","runningAppNodes","has","blockWrapper","parentElement","Dom","clean","append","add","content","core","data","assets","lang_additional","engineParams","appInit","JSON","stringify","id","origin","window","location","clickable","error","Loc","getMessage","Ajax","runAction","extCodes","ext","domain","protocol","host","html","undefined","js","forEach","css","params","Promise","resolve","jsonData","parse","Error","catch","fail","logMessages","Object","keys","push","isArray","errors","name","target","postMessage","Event","bind","event","source","size","height","parseInt","rest","AppLayout","openApplication","path","openPath","Set"],"mappings":"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"}