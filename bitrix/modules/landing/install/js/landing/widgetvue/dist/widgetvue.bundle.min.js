this.BX=this.BX||{};(function(e,s){"use strict";var a=babelHelpers.classPrivateFieldLooseKey("enable");class t{constructor(e=false){Object.defineProperty(this,a,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,a)[a]=e}log(...e){if(babelHelpers.classPrivateFieldLooseBase(this,a)[a]){console.log(...e)}}}var l=babelHelpers.classPrivateFieldLooseKey("rootNode");var i=babelHelpers.classPrivateFieldLooseKey("template");var r=babelHelpers.classPrivateFieldLooseKey("style");var o=babelHelpers.classPrivateFieldLooseKey("lang");var b=babelHelpers.classPrivateFieldLooseKey("appId");var n=babelHelpers.classPrivateFieldLooseKey("appAllowedByTariff");var d=babelHelpers.classPrivateFieldLooseKey("fetchable");var c=babelHelpers.classPrivateFieldLooseKey("clickable");var p=babelHelpers.classPrivateFieldLooseKey("uniqueId");var v=babelHelpers.classPrivateFieldLooseKey("frame");var h=babelHelpers.classPrivateFieldLooseKey("logger");var P=babelHelpers.classPrivateFieldLooseKey("demoData");var u=babelHelpers.classPrivateFieldLooseKey("useDemoData");var L=babelHelpers.classPrivateFieldLooseKey("blockId");var F=babelHelpers.classPrivateFieldLooseKey("getFrameContent");var f=babelHelpers.classPrivateFieldLooseKey("getEngineParams");var H=babelHelpers.classPrivateFieldLooseKey("getCoreConfigs");var B=babelHelpers.classPrivateFieldLooseKey("getAssetsConfigs");var y=babelHelpers.classPrivateFieldLooseKey("parseExtensionConfig");var g=babelHelpers.classPrivateFieldLooseKey("fetchData");var m=babelHelpers.classPrivateFieldLooseKey("message");var w=babelHelpers.classPrivateFieldLooseKey("bindEvents");var O=babelHelpers.classPrivateFieldLooseKey("onMessage");class j{constructor(e){Object.defineProperty(this,O,{value:I});Object.defineProperty(this,w,{value:$});Object.defineProperty(this,m,{value:S});Object.defineProperty(this,g,{value:N});Object.defineProperty(this,y,{value:A});Object.defineProperty(this,B,{value:D});Object.defineProperty(this,H,{value:E});Object.defineProperty(this,f,{value:T});Object.defineProperty(this,F,{value:K});Object.defineProperty(this,l,{writable:true,value:null});Object.defineProperty(this,i,{writable:true,value:void 0});Object.defineProperty(this,r,{writable:true,value:void 0});Object.defineProperty(this,o,{writable:true,value:{}});Object.defineProperty(this,b,{writable:true,value:0});Object.defineProperty(this,n,{writable:true,value:true});Object.defineProperty(this,d,{writable:true,value:false});Object.defineProperty(this,c,{writable:true,value:false});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:null});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:null});Object.defineProperty(this,u,{writable:true,value:false});Object.defineProperty(this,L,{writable:true,value:0});babelHelpers.classPrivateFieldLooseBase(this,p)[p]=`widget_${s.Text.getRandom(8)}`;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=new t(e.debug||false);babelHelpers.classPrivateFieldLooseBase(this,l)[l]=s.Type.isString(e.rootNode)?document.querySelector(e.rootNode):null;babelHelpers.classPrivateFieldLooseBase(this,i)[i]=s.Type.isString(e.template)?e.template:"";babelHelpers.classPrivateFieldLooseBase(this,r)[r]=s.Type.isString(e.style)?e.style:null;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=s.Type.isObject(e.demoData)?e.demoData:null;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=s.Type.isBoolean(e.useDemoData)?e.useDemoData:false;babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e.lang||{};babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e.blockId?s.Text.toNumber(e.blockId):0;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.appId?s.Text.toNumber(e.appId):0;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=babelHelpers.classPrivateFieldLooseBase(this,b)[b]&&s.Type.isBoolean(e.appAllowedByTariff)?e.appAllowedByTariff:true;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=s.Type.isBoolean(e.fetchable)?e.fetchable:false;const a=s.Type.isFunction(BX.Landing.getMode)&&BX.Landing.getMode()==="edit";babelHelpers.classPrivateFieldLooseBase(this,c)[c]=!a}mount(){return babelHelpers.classPrivateFieldLooseBase(this,F)[F]().then((e=>{babelHelpers.classPrivateFieldLooseBase(this,v)[v]=document.createElement("iframe");babelHelpers.classPrivateFieldLooseBase(this,v)[v].className="landing-widgetvue-iframe";babelHelpers.classPrivateFieldLooseBase(this,v)[v].sandbox="allow-scripts";babelHelpers.classPrivateFieldLooseBase(this,v)[v].srcdoc=e;babelHelpers.classPrivateFieldLooseBase(this,v)[v].onload=()=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]("getSize",{},babelHelpers.classPrivateFieldLooseBase(this,v)[v].contentWindow)};if(babelHelpers.classPrivateFieldLooseBase(this,L)[L]>0&&babelHelpers.classPrivateFieldLooseBase(this,l)[l]&&!j.runningAppNodes.has(babelHelpers.classPrivateFieldLooseBase(this,l)[l])){const e=babelHelpers.classPrivateFieldLooseBase(this,l)[l].parentElement;s.Dom.clean(e);s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,v)[v],e);j.runningAppNodes.add(babelHelpers.classPrivateFieldLooseBase(this,l)[l]);babelHelpers.classPrivateFieldLooseBase(this,w)[w]()}}))}}async function K(){let e="";const s=await babelHelpers.classPrivateFieldLooseBase(this,H)[H]();e+=babelHelpers.classPrivateFieldLooseBase(this,y)[y](s.data);const a=await babelHelpers.classPrivateFieldLooseBase(this,B)[B]();e+=babelHelpers.classPrivateFieldLooseBase(this,y)[y](a.data);e+=babelHelpers.classPrivateFieldLooseBase(this,y)[y]({lang_additional:babelHelpers.classPrivateFieldLooseBase(this,o)[o]});if(babelHelpers.classPrivateFieldLooseBase(this,r)[r]){e+=`<link rel="stylesheet" href="${babelHelpers.classPrivateFieldLooseBase(this,r)[r]}">`}const t=await babelHelpers.classPrivateFieldLooseBase(this,f)[f]();const l=`\n\t\t\t<script>\n\t\t\t\tBX.ready(function() {\n\t\t\t\t\t(new BX.Landing.WidgetVue.Engine(\n\t\t\t\t\t\t${JSON.stringify(t)},\n\t\t\t\t\t)).render();\n\t\t\t\t});\n\t\t\t<\/script>\n\n\t\t\t<div id="${babelHelpers.classPrivateFieldLooseBase(this,p)[p]}">${babelHelpers.classPrivateFieldLooseBase(this,i)[i]}</div>\n\t\t`;e+=l;return e}async function T(){const e={id:babelHelpers.classPrivateFieldLooseBase(this,p)[p],origin:window.location.origin,fetchable:babelHelpers.classPrivateFieldLooseBase(this,d)[d],clickable:babelHelpers.classPrivateFieldLooseBase(this,c)[c]};if(babelHelpers.classPrivateFieldLooseBase(this,n)[n]){if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]){if(!babelHelpers.classPrivateFieldLooseBase(this,P)[P]){babelHelpers.classPrivateFieldLooseBase(this,h)[h].log("Widget haven't demo data and can be render correctly")}e.data=babelHelpers.classPrivateFieldLooseBase(this,P)[P]||{}}else{try{e.data=await babelHelpers.classPrivateFieldLooseBase(this,g)[g]()}catch(s){e.error=s.message||"error"}}}else{e.error=s.Loc.getMessage("LANDING_WIDGETVUE_ERROR_PAYMENT_MSGVER_1")}return e}async function E(){return s.ajax.runAction("landing.vibe.getCoreConfig")}async function D(){const e=["landing.widgetvue.engine"];return s.ajax.runAction("landing.vibe.getAssetsConfig",{data:{extCodes:e}})}function A(e){const s=`${document.location.protocol}//${document.location.host}`;let a="";if(e.lang_additional!==undefined){a+=`<script>BX.message(${JSON.stringify(e.lang_additional)})<\/script>`}(e.js||[]).forEach((e=>{a+=`<script src="${s}${e}"><\/script>`}));(e.css||[]).forEach((e=>{a+=`<link href="${s}${e}" type="text/css" rel="stylesheet" />`}));return a}function N(e={}){if(!babelHelpers.classPrivateFieldLooseBase(this,d)[d]){babelHelpers.classPrivateFieldLooseBase(this,h)[h].log("Fetch data is impossible now (haven`t handler)");return Promise.resolve({})}if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]){return Promise.resolve(babelHelpers.classPrivateFieldLooseBase(this,P)[P]||{})}return s.ajax.runAction("landing.vibe.fetchData",{data:{blockId:babelHelpers.classPrivateFieldLooseBase(this,L)[L],params:e}}).then((e=>{const s=JSON.parse(e.data||[]);if(s.error){throw new Error(s.error)}return s})).catch((a=>{const t=[`Fetch data error!\nWidget ID: ${babelHelpers.classPrivateFieldLooseBase(this,L)[L]}`];if(Object.keys(e)>0){t.push("\nFetch request params:",e)}if(s.Type.isString(a)){t.push(`\nError in JSON data: ${a}`)}else if(s.Type.isObject(a)&&"errors"in a&&s.Type.isArray(a.errors)){a.errors.forEach((e=>{if(e.message!==undefined){t.push(`\nJavaScript error: ${e.message}`)}}))}babelHelpers.classPrivateFieldLooseBase(this,h)[h].log(...t);throw new Error(s.Loc.getMessage("LANDING_WIDGETVUE_ERROR_FETCH"))}))}function S(e,s={},a=window){a.postMessage({name:e,params:s,origin:babelHelpers.classPrivateFieldLooseBase(this,p)[p]},"*")}function $(){s.Event.bind(window,"message",babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this))}function I(e){if(e.data&&e.data.origin&&e.data.name&&e.data.params&&s.Type.isObject(e.data.params)){if(e.data.origin!==babelHelpers.classPrivateFieldLooseBase(this,p)[p]){return}if(e.data.name==="fetchData"){babelHelpers.classPrivateFieldLooseBase(this,g)[g](e.data.params).then((s=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]("setData",{data:s},e.source)})).catch((s=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]("setError",{error:s},e.source)}))}if(e.data.name==="setSize"&&e.data.params.size!==undefined){babelHelpers.classPrivateFieldLooseBase(this,v)[v].height=parseInt(e.data.params.size,10)}if(e.data.name==="openApplication"&&babelHelpers.classPrivateFieldLooseBase(this,b)[b]>0){const a=s.Type.isObject(e.data.params)?e.data.params:{};BX.rest.AppLayout.openApplication(babelHelpers.classPrivateFieldLooseBase(this,b)[b],a)}if(e.data.name==="openPath"&&s.Type.isString(e.data.params.path)){BX.rest.AppLayout.openPath(babelHelpers.classPrivateFieldLooseBase(this,b)[b],{path:e.data.params.path})}}}j.runningAppNodes=new Set;e.WidgetVue=j})(this.BX.Landing=this.BX.Landing||{},BX);
//# sourceMappingURL=widgetvue.bundle.map.js