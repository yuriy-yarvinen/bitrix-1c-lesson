this.BX=this.BX||{};this.BX.Landing=this.BX.Landing||{};this.BX.Landing.Node=this.BX.Landing.Node||{};(function(e,t,l){"use strict";function n(e,t){var l=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!l){if(Array.isArray(e)||(l=a(e))||t&&e&&typeof e.length==="number"){if(l)e=l;var n=0;var i=function e(){};return{s:i,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d=true,r=false,s;return{s:function t(){l=l.call(e)},n:function e(){var t=l.next();d=t.done;return t},e:function e(t){r=true;s=t},f:function e(){try{if(!d&&l["return"]!=null)l["return"]()}finally{if(r)throw s}}}}function a(e,t){if(!e)return;if(typeof e==="string")return i(e,t);var l=Object.prototype.toString.call(e).slice(8,-1);if(l==="Object"&&e.constructor)l=e.constructor.name;if(l==="Map"||l==="Set")return Array.from(e);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return i(e,t)}function i(e,t){if(t==null||t>e.length)t=e.length;for(var l=0,n=new Array(t);l<t;l++)n[l]=e[l];return n}var d=function(){function e(t,l){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;babelHelpers.classCallCheck(this,e);this.textNode=l;this.table=t.querySelector(".landing-table");if(!this.table){return}this.node=t;this.tBody=this.node.getElementsByTagName("tbody")[0];if(n===true){this.init()}}babelHelpers.createClass(e,[{key:"init",value:function e(){this.addTitles(this.node);this.enableEditCells(this.table);this.dragAndDropRows(this);this.dragAndDropCols(this);this.resizeColumn(this);this.buildLines(this);this.addRow(this);this.addCol(this);this.onUnselect(this);this.unselect(this);this.bindSelectAllHandler(this);this.selectRow(this);this.selectCol(this);this.onCopyTable(this);this.onDeleteElementTable(this);this.onShowPopupMenu(this)}},{key:"addTitles",value:function e(t){if(!t.hasAttribute("title-added")){t.title="";t.querySelector(".landing-table-th-select-all").title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_SELECT_TABLE"));t.querySelectorAll(".landing-table-div-col-dnd").forEach((function(e){e.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_DND_COLS"))}));t.querySelectorAll(".landing-table-col-resize").forEach((function(e){e.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_RESIZE_COLS"))}));t.querySelectorAll(".landing-table-col-add").forEach((function(e){e.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_BUTTON_ADD_COL"))}));t.querySelectorAll(".landing-table-row-dnd").forEach((function(e){e.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_DND_ROWS"))}));t.querySelectorAll(".landing-table-row-add").forEach((function(e){e.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_BUTTON_ADD_ROW"))}));t.setAttribute("title-added","true")}}},{key:"unselect",value:function e(t){var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(t.table){if(!l){t.table.classList.remove("table-selected-all");this.removeClasses(t.table,"landing-table-th-select-all-selected");this.removeClasses(t.table,"landing-table-cell-selected")}this.removeClasses(t.table,"landing-table-row-selected");this.removeClasses(t.table,"landing-table-th-selected");this.removeClasses(t.table,"landing-table-th-selected-cell");this.removeClasses(t.table,"landing-table-th-selected-top");this.removeClasses(t.table,"landing-table-th-selected-x");this.removeClasses(t.table,"landing-table-tr-selected-left");this.removeClasses(t.table,"landing-table-tr-selected-y");this.removeClasses(t.table,"landing-table-col-selected");this.removeClasses(t.table,"landing-table-tr-selected");this.removeClasses(t.table,"table-selected-all-right");this.removeClasses(t.table,"table-selected-all-bottom")}}},{key:"onUnselect",value:function e(t){l.Event.bind(t.table,"click",(function(){var e=new Set(["landing-table-th-select-all","landing-table-row-dnd","landing-table-row-add"]);var l=babelHelpers.toConsumableArray(event.target.classList).some((function(t){return e.has(t)}));if(!l){var n=new Set(["landing-table-col-dnd"]);l=babelHelpers.toConsumableArray(event.target.parentElement.classList).some((function(e){return n.has(e)}));if(!l){t.unselect(t)}}}))}},{key:"bindSelectAllHandler",value:function e(){var t=this;var n=this.table.querySelector(".landing-table-th-select-all");if(n){l.Event.bind(n,"click",(function(){t.toggleSelectAll()}))}}},{key:"toggleSelectAll",value:function e(){var t=false;if(this.table.classList.contains("table-selected-all")){t=true}this.unselect(this,true);var l=this.table.querySelectorAll(".landing-table-tr");var n=0;l.forEach((function(e){var a=e.childNodes;var i=0;var d=0;e.childNodes.forEach((function(e){if(e.nodeType===1){d=i}i++}));if(n>0){var r=a[d];if(t){r.classList.remove("table-selected-all-right")}else{r.classList.add("table-selected-all-right")}}n++;if(n===l.length){a.forEach((function(e){if(e.nodeType===1){if(t){e.classList.remove("table-selected-all-bottom")}else{e.classList.add("table-selected-all-bottom")}}}))}}));var a=this.table.querySelector(".landing-table-th-select-all");if(a){a.classList.toggle("landing-table-th-select-all-selected")}this.table.classList.toggle("table-selected-all");this.table.querySelectorAll(".landing-table-col-dnd").forEach((function(e){e.classList.toggle("landing-table-cell-selected")}));this.table.querySelectorAll(".landing-table-row-dnd").forEach((function(e){e.classList.toggle("landing-table-cell-selected")}))}},{key:"selectRow",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var a=t.table.querySelectorAll(".landing-table-row-dnd");if(n!==null){var i=[];i[0]=a[n];a=i}a.forEach((function(e){l.Event.bind(e,"click",(function(){if(!event.target.classList.contains("landing-table-row-add")){t.unselect(t);var l=e.parentElement.childNodes;var n=0;l.forEach((function(e){if(e.nodeType===1){if(n===1){e.classList.add("landing-table-tr-selected-left")}if(n>=1){e.classList.add("landing-table-tr-selected-y")}n++}}));e.parentElement.classList.add("landing-table-row-selected");t.tBody.classList.add("landing-table-tr-selected")}}))}))}},{key:"selectCol",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var a=t.table.querySelectorAll(".landing-table-col-dnd");if(n!==null){var i=[];i[0]=a[n];a=i}a.forEach((function(e){l.Event.bind(e,"click",(function(){if(!event.target.classList.contains("landing-table-col-add")&&!event.target.classList.contains("landing-table-col-resize")){t.unselect(t);var l=e.cellIndex;var n=0;t.tBody.childNodes.forEach((function(e){if(e.nodeType===1){var t=0;var a=0;var i=0;e.childNodes.forEach((function(e){if(e.nodeType===1){if(l===a){i=t}a++}t++}));if(n===0){e.classList.add("landing-table-col-selected");e.childNodes[i].classList.add("landing-table-th-selected-cell")}if(n===1){e.childNodes[i].classList.add("landing-table-th-selected-top")}if(n>=1){e.childNodes[i].classList.add("landing-table-th-selected-x")}n++;e.childNodes[i].classList.add("landing-table-th-selected")}}))}}))}))}},{key:"buildLines",value:function e(t){if(t.node){var l=t.node.querySelector(".landing-table").getBoundingClientRect().width;var n=t.node.querySelector(".landing-table").getBoundingClientRect().height;var a=5;var i=document.querySelectorAll(".landing-table-row-add-line");i.forEach((function(e){e.style.width="".concat(l+a,"px")}));var d=document.querySelectorAll(".landing-table-col-add-line");d.forEach((function(e){e.style.height="".concat(n+a,"px")}))}}},{key:"getButtonsAddRow",value:function e(t){return t.querySelectorAll(".landing-table-row-add")}},{key:"addRow",value:function e(t){var n=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var i=t.getButtonsAddRow(t.node);if(a===null){i=Array.prototype.slice.call(i,0)}else{var d=i[a];i=[];i[0]=d}i=Array.prototype.slice.call(i,0);i.forEach((function(e){l.Event.bind(e,"click",(function(){var l=t.table.querySelector(".landing-table-th-selected-cell");var a=0;var i=0;if(l){l.parentNode.childNodes.forEach((function(e){if(a===0&&e===l){a=i}if(e.nodeType===1){i++}}))}var d=document.createElement("th");d.classList.add("landing-table-th","landing-table-row-dnd");if(t.table.classList.contains("table-selected-all")){d.classList.add("landing-table-cell-selected")}var r=e.parentNode.parentNode;var s=babelHelpers.toConsumableArray(r.parentNode.children).indexOf(e.parentNode.parentNode);var o=0;var c=0;t.tBody.childNodes.forEach((function(e){if(e.nodeType===1){c=o}o++}));var g=t.tBody.childNodes[c];var u=document.createElement("td");u.classList.add("landing-table-th","landing-table-td");u.style.width="50px";var f=t.node.querySelector(".landing-table");if(f.hasAttribute("bg-color")){u.style.backgroundColor=f.getAttribute("bg-color")}if(f.hasAttribute("text-color")){u.style.color=f.getAttribute("text-color")}var b=document.createElement("tr");b.classList.add("landing-table-tr");d.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_DND_ROWS"));d.style.width="16px";var h=document.createElement("div");h.classList.add("landing-table-row-add");h.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_BUTTON_ADD_COL"));var v=document.createElement("div");v.classList.add("landing-table-row-add-line");var y=document.createElement("div");y.classList.add("landing-table-div-row-dnd");h.appendChild(v);d.appendChild(h);d.appendChild(y);if(g){var p=g.children.length;var L=[];e.parentNode.parentNode.childNodes.forEach((function(e){if(e.nodeType===1){L.push(e)}}));for(var E=0;E<p;E++){var B=u.cloneNode(true);if(E===a){B.classList.add("landing-table-th-selected","landing-table-th-selected-x")}if(E===0){b.appendChild(d)}else{B.style.width=L[E].style.width;B.style.height=L[E].style.height;b.appendChild(B)}}}e.parentNode.parentNode.parentNode.insertBefore(b,e.parentNode.parentNode.nextSibling);t.buildLines(t);t.enableEditCells(t.node);n.textNode.onChange(true);t.selectRow(t,s);t.addRow(t,s);t.unselect(t);BX.Landing.UI.Panel.EditorPanel.getInstance().hide()}))}))}},{key:"getButtonsAddCol",value:function e(t){return t.querySelectorAll(".landing-table-col-add")}},{key:"addCol",value:function e(t){var n=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var i=t.getButtonsAddCol(t.node);if(a===null){i=Array.prototype.slice.call(i,0)}else{var d=i[a];i=[];i[0]=d}i.forEach((function(e){l.Event.bind(e,"click",(function(){var l=t.table.querySelector(".landing-table-row-selected");var a=0;var i=0;if(l){l.parentNode.childNodes.forEach((function(e){if(e===l&&a===0){a=i}if(e.nodeType===1){i++}}))}var d;var r;d=document.createElement("th");d.classList.add("landing-table-th","landing-table-col-dnd");d.style.width="50px";if(t.table.classList.contains("table-selected-all")){d.classList.add("landing-table-cell-selected")}var s=e.parentNode.parentNode;var o=babelHelpers.toConsumableArray(s.children).indexOf(e.parentNode);if(t.tBody.childNodes.length>0){var c=0;t.tBody.childNodes.forEach((function(e){if(e.nodeType===1){r=d.cloneNode(true);var l=document.createElement("div");l.classList.add("landing-table-div-col-dnd");l.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_DND_COLS"));var n=document.createElement("div");n.classList.add("landing-table-col-resize");n.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_RESIZE_COLS"));var i=document.createElement("div");i.classList.add("landing-table-col-add");i.title=BX.Landing.Utils.escapeText(BX.Landing.Loc.getMessage("LANDING_TABLE_BUTTON_ADD_COL"));var s=document.createElement("div");s.classList.add("landing-table-col-add-line");i.appendChild(s);r.appendChild(l);r.appendChild(n);r.appendChild(i);var g=document.createElement("td");g.classList.add("landing-table-th","landing-table-td");g.style.width="50px";var u=t.node.querySelector(".landing-table");if(u.hasAttribute("bg-color")){g.style.backgroundColor=u.getAttribute("bg-color")}if(u.hasAttribute("text-color")){g.style.color=u.getAttribute("text-color")}if(a>0&&a===c){g.classList.add("landing-table-tr-selected-y")}var f=0;var b=0;var h=0;e.childNodes.forEach((function(e){if(e.nodeType===1){if(b===o){h=f}b++}f++}));if(c===0){e.childNodes[h].parentNode.insertBefore(r,e.childNodes[h].nextSibling)}else{e.childNodes[h].parentNode.insertBefore(g,e.childNodes[h].nextSibling)}c++}}))}t.buildLines(t);t.enableEditCells(t.node);n.textNode.onChange(true);t.selectCol(t,o);t.addCol(t,o);t.unselect(t);BX.Landing.UI.Panel.EditorPanel.getInstance().hide()}))}))}},{key:"dragAndDropRows",value:function e(l){var a=this;this.draggableRows=new t.Draggable({container:l.tBody,draggable:".landing-table-tr",dragElement:".landing-table-row-dnd",type:t.Draggable.HEADLESS});var i=[];var d;var r;var s;var o=0;var c;var g;var u;var f;var b;var h;var v;this.draggableRows.subscribe("start",(function(e){v=a.draggableRows.dragStartEvent.data.originalSource;g=l.tBody.getBoundingClientRect().left;u=l.tBody.getBoundingClientRect().top;d=[];r=[];c=0;s=e.getData().sourceIndex;i=l.tBody.querySelectorAll(".landing-table-tr");i.forEach((function(e){d.push(e.getBoundingClientRect().y);r.push(e.getBoundingClientRect().height)}));f=i[s].getBoundingClientRect().x;b=i[s].getBoundingClientRect().y;h=document.createElement("tr");h.classList.add("landing-table-tr-draggable");i[s].childNodes.forEach((function(e){h.append(e.cloneNode(true))}));if(i[s].classList.contains("landing-table-row-selected")){h.classList.add("landing-table-row-selected")}var t;var n=0;while(!t){if(i[s].childNodes[n].nodeType===1){t=n}n++}h.childNodes[t].style.borderRadius=getComputedStyle(i[s].childNodes[t]).borderRadius})).subscribe("move",(function(e){if(!v.classList.contains("landing-table-row-add")){l.tBody.classList.add("landing-table-draggable");i[s].classList.add("landing-table-tr-taken");c=e.getData().offsetY;l.tBody.append(h);h.style.position="absolute";h.style.top="".concat(b-u+c-.5,"px");h.style.left="".concat(f-g-.5,"px");if(c>0){h.style.transform="rotate(-1deg)"}else{h.style.transform="rotate(1deg)"}}})).subscribe("end",(function(){h.remove();i[s].classList.remove("landing-table-tr-taken");i[s].style="";var e=b+c;var t=e+i[s].getBoundingClientRect().height;if(c<0){var g=n(d.entries()),u;try{for(g.s();!(u=g.n()).done;){var f=babelHelpers.slicedToArray(u.value,2),v=f[0],y=f[1];if(v===s){y-=r[v-1]/2}if(e>=y){o=v}}}catch(e){g.e(e)}finally{g.f()}}if(c===0){o=s}if(c>0){var p=n(d.entries()),L;try{for(p.s();!(L=p.n()).done;){var E=babelHelpers.slicedToArray(L.value,2),B=E[0],m=E[1];var A=m+r[B]/2;if(B===s){A=m}if(t>=A){o=B}}}catch(e){p.e(e)}finally{p.f()}}if(o===0){o++}if(s!==o){var N=null;var C=null;if(i[o]){N=i[o];C=N.nextSibling;while(C&&C.nodeType!==1){C=C.nextSibling}}if(s>o){l.tBody.insertBefore(i[s],N)}if(s<o){l.tBody.insertBefore(i[s],C)}}l.tBody.classList.remove("landing-table-draggable");a.textNode.onChange(true)}))}},{key:"dragAndDropCols",value:function e(l){var a=this;this.draggableCols=new t.Draggable({container:l.tBody,draggable:".landing-table-div-col-dnd",type:t.Draggable.HEADLESS});var i;var d=0;var r;var s;var o=[];var c;var g;var u;var f;var b;var h;var v;this.draggableCols.subscribe("start",(function(e){f=l.tBody.getBoundingClientRect().left;c=[];g=[];h=[];r=0;s=0;i=e.getData().originalSource.parentNode.cellIndex;if(i){o=babelHelpers.toConsumableArray(l.tBody.querySelectorAll(".landing-table-tr")).map((function(e){return e.children[i]}));u=l.tBody.querySelectorAll(".landing-table-tr");u[0].childNodes.forEach((function(e){if(e.nodeType===1){c.push(e.getBoundingClientRect().x);g.push(e.getBoundingClientRect().width)}}))}b=o[0].getBoundingClientRect().x;v=document.createElement("div");o.forEach((function(e){h.push(e.getAttribute("style"));v.append(e.cloneNode(true));v.lastChild.style.borderRadius=getComputedStyle(e).borderRadius;v.lastChild.style.height="".concat(e.getBoundingClientRect().height,"px");v.lastChild.style.width="".concat(e.getBoundingClientRect().width,"px")}));v.hidden=true;v.classList.add("landing-table-col-draggable");l.tBody.append(v)})).subscribe("move",(function(e){l.tBody.classList.add("landing-table-draggable");o.forEach((function(e){e.classList.add("landing-table-col-taken")}));r=e.getData().offsetX;s=e.getData().offsetY;v.hidden=false;v.style.position="absolute";v.style.left="".concat(b-f+r,"px");v.style.top="".concat(0,"px");if(r<0){v.style.transform="rotate(-1deg)"}if(r>0){v.style.transform="rotate(1deg)"}})).subscribe("end",(function(){v.remove();o.forEach((function(e){e.hidden=false}));if(i){var e=c[i]+r;var t=c[i]+r+o[0].getBoundingClientRect().width;var s=0;o.forEach((function(e){e.style=h[s];e.classList.remove("landing-table-col-taken");s++}));if(r<0){var f=n(c.entries()),b;try{for(f.s();!(b=f.n()).done;){var y=babelHelpers.slicedToArray(b.value,2),p=y[0],L=y[1];if(p>0){L-=g[p-1]/2}if(e>L){d=p}}}catch(e){f.e(e)}finally{f.f()}}if(r===0){d=i}if(r>0){var E=n(c.entries()),B;try{for(E.s();!(B=E.n()).done;){var m=babelHelpers.slicedToArray(B.value,2),A=m[0],N=m[1];var C=N+g[A]/2;if(A===i){C=N}if(t>C){d=A}}}catch(e){E.e(e)}finally{E.f()}}if(d===0){d++}if(i!==d){u.forEach((function(e){var t=[];e.childNodes.forEach((function(e){if(e.nodeType===1){t.push(e)}}));var l=null;var n=null;if(t[d]){l=t[d];n=l.nextSibling;while(n&&n.nodeType!==1){n=n.nextSibling}}if(i>d){e.insertBefore(t[i],l)}if(i<d){e.insertBefore(t[i],n)}}))}l.tBody.classList.remove("landing-table-draggable");a.textNode.onChange(true)}}))}},{key:"resizeColumn",value:function e(l){var n=this;var a=this.tBody;this.resizeElement=new t.Draggable({container:a,draggable:".landing-table-col-resize",type:t.Draggable.HEADLESS});var i;var d;this.resizeElement.subscribe("start",(function(e){d=[];var t=e.getData().draggable.parentNode;i=t.getBoundingClientRect().width;var l=t.cellIndex;var n=a.querySelectorAll(".landing-table-tr");n.forEach((function(e){d.push(e.children[l])}))})).subscribe("move",(function(e){var t=e.getData().offsetX;var l=i+t;d.forEach((function(e){BX.Dom.style(e,"width","".concat(l,"px"))}))})).subscribe("end",(function(){var e=a.getBoundingClientRect().width;var t=a.parentElement.parentElement.getBoundingClientRect().width;if(t>e){a.parentElement.parentElement.classList.add("landing-table-scroll-hidden")}else{a.parentElement.parentElement.classList.remove("landing-table-scroll-hidden")}l.buildLines(l);n.textNode.onChange(true)}))}},{key:"enableEditCells",value:function e(t){var l=t.querySelectorAll(".landing-table-td");l.forEach((function(e){e.setAttribute("contenteditable","true")}))}},{key:"removeClasses",value:function e(t,l){var n=t.querySelectorAll(".".concat(l));n.forEach((function(e){e.classList.remove(l)}))}},{key:"onCopyTable",value:function e(t){BX.Event.EventEmitter.subscribe("BX.Landing.TableEditor:onCopyTable",(function(){t.unselect(t);BX.Landing.UI.Panel.EditorPanel.getInstance().hide()}))}},{key:"onShowPopupMenu",value:function e(t){BX.Event.EventEmitter.subscribe("BX.Landing.PopupMenuWindow:onShow",(function(){t.unselect(t);BX.Landing.UI.Panel.EditorPanel.getInstance().hide()}))}},{key:"onDeleteElementTable",value:function e(t){BX.Event.EventEmitter.subscribe("BX.Landing.TableEditor:onDeleteElementTable",(function(){t.buildLines(t)}))}}]);return e}();e.TableEditor=d})(this.BX.Landing.Node.TableEditor=this.BX.Landing.Node.TableEditor||{},BX.UI.DragAndDrop,BX);
//# sourceMappingURL=tableeditor.bundle.map.js