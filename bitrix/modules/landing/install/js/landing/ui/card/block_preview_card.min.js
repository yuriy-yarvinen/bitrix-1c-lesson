(function(){"use strict";BX.namespace("BX.Landing.UI.Card");BX.Runtime.loadExtension("ui.dialogs.messagebox");BX.Runtime.loadExtension("ui.notification");const e="--heart";const i="--o-heart";const t="remove";const a="add";const s="landing-ui-card-favorite-badge";const n="landing-ui-card-favorite-badge--on";var o=BX.Landing.Utils.addClass;var r=BX.Landing.Utils.append;var d=BX.Landing.Utils.create;BX.Landing.UI.Card.BlockPreviewCard=function(l){BX.Landing.UI.Card.BaseCard.apply(this,arguments);this.layout.classList.add("landing-ui-card-block-preview");if(getComputedStyle(this.layout).position==="static"){BX.Dom.style(this.layout,"position","relative")}this.mode=typeof l.mode==="string"?l.mode:"img";this.title=typeof l.title==="string"?l.title:"";this.appExpired=typeof l.app_expired==="boolean"?l.app_expired:false;this.repoId=l.repo_id||null;this.imageSrc=typeof l.image==="string"?l.image:"/bitrix/images/landing/empty-preview.png";this.code=typeof l.code==="string"?l.code:"";this.favorite=l.favorite;this.favoriteMy=l.favoriteMy;this.isNew=typeof l.isNew==="boolean"?l.isNew:false;this.imageContainer=BX.create("div",{props:{className:"landing-ui-card-block-preview-image-container"}});this.body.appendChild(this.imageContainer);this.header.innerText=this.title;this.layout.dataset.code=this.code;this.requiresUpdates=l.requires_updates;this.like=l.like;this.currentCategory=l.currentCategory;if(l.useFavouriteBadge===true){let o=s;let r="ui-icon-set";if(l.isFavorite){o=`${s} ${n}`;r=`${r} ${e}`}else{r=`${r} ${i}`}this.icon=BX.create("i",{props:{className:r}});this.favoriteBadge=BX.create("div",{props:{className:o},children:[this.icon]});BX.append(this.favoriteBadge,this.imageContainer);this.showFavoriteNotification=function(e){top.BX.UI.Notification.Center.notify({content:e,autoHideDelay:5e3,closeButton:false,useAirDesign:true})};BX.Event.bind(this.favoriteBadge,"click",(s=>{s.stopPropagation();let o="";if(BX.Dom.hasClass(this.favoriteBadge,n)){o=t;BX.Dom.removeClass(this.favoriteBadge,n);BX.Dom.addClass(this.icon,i);BX.Dom.removeClass(this.icon,e);if(this.currentCategory==="favourite"){const e=BX.Landing.Main.getInstance();const i=e.getBlocksPanelContent();BX.Dom.remove(this.layout);const t=i.querySelector(".landing-ui-card-block-preview");if(!t){BX.Dom.append(e.createFavouriteCategoryEmptyState(),i)}}}else{o=a;BX.Dom.addClass(this.favoriteBadge,n);BX.Dom.removeClass(this.icon,i);BX.Dom.addClass(this.icon,e)}const r=BX.Landing.Env.getInstance().getType();BX.Landing.Backend.getInstance().action("Landing::markFavouriteBlock",{codeBlock:this.code,action:o,type:r}).then((e=>{if(o===t){this.showFavoriteNotification(BX.Landing.Loc.getMessage("LANDING_SECTION_FAVOURITE_BALLOON_REMOVE"))}if(o===a){this.showFavoriteNotification(BX.Landing.Loc.getMessage("LANDING_SECTION_FAVOURITE_BALLOON_ADD"))}return e}))}))}if(this.isNew){this.title=BX.create("span",{props:{className:"landing-ui-new-inline"},text:BX.Landing.Loc.getMessage("LANDING_BLOCKS_LIST_PREVIEW_NEW")}).outerHTML+"&nbsp;"+this.title;this.header.innerHTML=this.title}if(this.repoId||this.favorite||this.appExpired){this.labels=BX.create("div",{props:{className:"landing-ui-card-labels"}});BX.insertAfter(this.labels,this.getHeader())}if(this.repoId||this.appExpired){const e=BX.create("div",{props:{className:"landing-ui-card-label landing-ui-card-label-repo"},text:BX.Landing.Loc.getMessage("LANDING_BLOCKS_LIST_PREVIEW_MARKET_MSGVER_1"),dataset:{hint:BX.Landing.Loc.getMessage("LANDING_BLOCKS_LIST_PREVIEW_MARKET_HINT_MSGVER_1"),hintNoIcon:"Y"}});BX.append(e,this.labels)}if(this.favorite){if(this.favoriteMy){BX.append(BX.create("div",{props:{className:"landing-ui-card-label landing-ui-card-label-my"},text:BX.Landing.Loc.getMessage("LANDING_BLOCKS_LIST_PREVIEW_MY_NEW")}),this.labels)}BX.append(BX.create("div",{props:{className:"landing-ui-card-label landing-ui-card-label-favorite"},text:BX.Landing.Loc.getMessage("LANDING_BLOCKS_LIST_PREVIEW_FAVORITE")}),this.labels);var c=this.code.split("@").length===2?this.code.split("@")[1]:false;if(c&&this.favoriteMy){const e=this.getRemoveButton();e.onclick=e=>{e.stopPropagation();BX.UI.Dialogs.MessageBox.show({message:BX.Landing.Loc.getMessage("LANDING_BLOCKS_LIST_PREVIEW_DELETE_MSG"),buttons:BX.UI.Dialogs.MessageBoxButtons.YES_CANCEL,popupOptions:{targetContainer:parent.document.body},onYes:()=>BX.Landing.Backend.getInstance().action("Landing::unFavoriteBlock",{blockId:c}).then((()=>{const e=BX.Landing.Main.getInstance();e.removeBlockFromList(this.code);return true})).catch((function(e){console.log("error",e);return false}))})};BX.append(e,this.getBody())}}if(this.appExpired){this.addWarning(BX.Landing.Loc.getMessage("LANDING_BLOCKS_LIST_PREVIEW_EXPIRED"));this.onClickHandler=function(){}}if(this.mode==="background"){this.imageContainer.style.backgroundImage="url("+this.imageSrc+")"}else{var g=this.imageSrc||"/bitrix/images/landing/empty-preview.png";this.image=BX.create("img",{props:{src:g},attrs:{style:"opacity: "+(this.imageSrc?1:.6)}});this.imageContainer.appendChild(this.image)}if(this.requiresUpdates){o(this.layout,"landing-ui-requires-update");const e=d("div",{props:{className:"landing-ui-requires-update-overlay"},children:[d("div",{props:{className:"landing-ui-requires-update-overlay-footer"},html:BX.Landing.Loc.getMessage("LANDING_BLOCK_REQUIRES_UPDATE_MESSAGE")})]});r(e,this.imageContainer);this.onClickHandler=function(){}}};BX.Landing.UI.Card.BlockPreviewCard.prototype={constructor:BX.Landing.UI.Card.BlockPreviewCard,__proto__:BX.Landing.UI.Card.BaseCard.prototype,onAppend:function(){if(this.labels!==undefined){let e=BX.UI.Hint;if(this.labels.ownerDocument.defaultView.BX&&this.labels.ownerDocument.defaultView.BX.UI&&this.labels.ownerDocument.defaultView.BX.UI.Hint){e=this.labels.ownerDocument.defaultView.BX.UI.Hint}e.init(this.labels)}}}})();
//# sourceMappingURL=block_preview_card.map.js