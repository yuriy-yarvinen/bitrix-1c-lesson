{"version":3,"file":"widget.bundle.js","sources":["../src/state.js","../src/mappopup/addressstring.js","../src/mappopup/popup.js","../src/mappopup/mappopup.js","../src/address/features/basefeature.js","../src/address/address.js","../src/autocomplete/menubottom.js","../src/autocomplete/menu.js","../src/autocomplete/prompt.js","../src/autocomplete/addressstring.js","../src/autocomplete/autocomplete.js","../src/mappopup/photo.js","../src/mappopup/gallery.js","../src/fields/field.js","../src/fields/fields.js","../src/address/features/mapfeature.js","../src/address/features/autocompletefeature.js","../src/address/features/fieldsfeature.js","../src/address/features/mapfeatureauto.js","../src/factory.js","../src/ui-address/switch.js","../src/ui-address/icon.js","../src/ui-address/ui-address.js","../src/widget.js"],"sourcesContent":["/**\n * Contains\n * */\nexport default class State\n{\n\tstatic INITIAL = 'INITIAL';\n\tstatic DATA_INPUTTING = 'DATA_INPUTTING';\n\tstatic DATA_SELECTED = 'DATA_SELECTED';\n\tstatic DATA_SUPPOSED = 'DATA_SUPPOSED';\n\tstatic DATA_LOADING = 'DATA_LOADING';\n\tstatic DATA_LOADED = 'DATA_LOADED';\n}","import {Tag} from 'main.core';\nimport {Address, Format, AddressStringConverter, FormatTemplateType} from 'location.core';\n\nexport default class AddressString\n{\n\t#address;\n\t#element;\n\t#stringElement;\n\t#addressFormat;\n\n\tconstructor(props)\n\t{\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new Error('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\t}\n\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\n\t\tif (!this.#stringElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#stringElement.innerHTML = this.#convertAddressToString(address);\n\n\t\tif (!address && !this.isHidden())\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t\telse if (address && this.isHidden())\n\t\t{\n\t\t\tthis.show();\n\t\t}\n\t}\n\n\t#convertAddressToString(address: ?Address): string\n\t{\n\t\tlet result = '';\n\n\t\tif (address)\n\t\t{\n\t\t\tresult = AddressStringConverter.convertAddressToStringTemplate(\n\t\t\t\taddress,\n\t\t\t\tthis.#addressFormat.getTemplate(FormatTemplateType.DEFAULT),\n\t\t\t\tAddressStringConverter.CONTENT_TYPE_HTML,\n\t\t\t\t', ',\n\t\t\t\tthis.#addressFormat\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\t\n\trender(props): Element\n\t{\n\t\tthis.#address = props.address;\n\t\tconst addresStr = this.#convertAddressToString(this.#address);\n\t\tthis.#stringElement = Tag.render`<div class=\"location-map-address-text\">${addresStr}</div>`;\n\n\t\tthis.#element = Tag.render`\n\t\t\t<div class=\"location-map-address-container\">\n\t\t\t\t<div class=\"location-map-address-icon\"></div>\n\t\t\t\t${this.#stringElement}\n\t\t\t</div>`;\n\n\t\tif (addresStr === '')\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\n\t\treturn this.#element;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.#element)\n\t\t{\n\t\t\tthis.#element.style.display = 'block';\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif (this.#element)\n\t\t{\n\t\t\tthis.#element.style.display = 'none';\n\t\t}\n\t}\n\n\tisHidden()\n\t{\n\t\treturn !this.#element || this.#element.style.display === 'none';\n\t}\n}","import {Popup as MainPopup} from 'main.popup';\nimport {Dom} from 'main.core';\n\n/**\n * Popup window, which contains map\n */\nexport default class Popup extends MainPopup\n{\n\tgetBindElement()\n\t{\n\t\treturn this.bindElement;\n\t}\n\n\tadjustPosition(bindOptions: {\n\t\tforceBindPosition?: boolean,\n\t\tforceLeft?: boolean,\n\t\tforceTop?: boolean,\n\t\tposition?: 'right' | 'top' | 'bootom'\n\t}): void\n\t{\n\t\tlet isCustomPosition, isCustomPositionSuccess;\n\n\t\tif (this.bindOptions.position && this.bindOptions.position === 'right')\n\t\t{\n\t\t\tisCustomPosition = true;\n\t\t\tisCustomPositionSuccess = this.#adjustRightPosition();\n\t\t}\n\n\t\tif (!(isCustomPosition && isCustomPositionSuccess))\n\t\t{\n\t\t\tsuper.adjustPosition(bindOptions);\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the popup in right position\n\t * @returns {boolean} an indicator whether or not we have managed to adjust the popup successfully\n\t */\n\t#adjustRightPosition(): boolean\n\t{\n\t\tconst bindElRect = this.bindElement.getBoundingClientRect();\n\t\tconst popupHeight = this.getPopupContainer().offsetHeight;\n\t\tconst popupWidth = this.getPopupContainer().offsetWidth;\n\n\t\t/**\n\t\t * Check if the popup fits in the viewport\n\t\t */\n\t\tif ((bindElRect.left + bindElRect.width + popupWidth) > document.documentElement.clientWidth)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet angleOffsetY = popupHeight / 2;\n\n\t\tconst left = bindElRect.left + bindElRect.width + 10;\n\t\tlet top = window.pageYOffset + bindElRect.top + bindElRect.height / 2 - popupHeight / 2;\n\n\t\tif(top < window.pageYOffset)\n\t\t{\n\t\t\tangleOffsetY -= window.pageYOffset - top;\n\t\t\ttop = window.pageYOffset;\n\t\t}\n\t\telse if(top > window.pageYOffset + document.body.clientHeight - popupHeight)\n\t\t{\n\t\t\tangleOffsetY += top - (window.pageYOffset + document.body.clientHeight - popupHeight);\n\t\t\ttop = window.pageYOffset + document.body.clientHeight - popupHeight;\n\t\t}\n\n\t\tthis.setAngle({position: 'left', offset: angleOffsetY});\n\n\t\tDom.adjust(this.popupContainer, {\n\t\t\tstyle: {\n\t\t\t\ttop: `${top}px`,\n\t\t\t\tleft: `${left}px`,\n\t\t\t\tzIndex: this.getZindex()\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n}\n","import {\n\tTag,\n\tType,\n\tDom,\n\tEvent,\n\tLoc,\n} from 'main.core';\nimport {\n\tAddress,\n\tFormat,\n\tLocation,\n\tControlMode,\n\tMapBase,\n\tAddressStringConverter,\n\tLocationType,\n} from 'location.core';\nimport { EventEmitter } from 'main.core.events';\nimport AddressString from './addressstring';\nimport Popup from './popup';\n\nimport 'ui.design-tokens';\nimport './css/mappopup.css';\n\nexport default class MapPopup extends EventEmitter\n{\n\tstatic #onChangedEvent = 'onChanged';\n\tstatic #onMouseOverEvent = 'onMouseOver';\n\tstatic #onMouseOutEvent = 'onMouseOut';\n\tstatic #onShowedEvent = 'onShow';\n\tstatic #onClosedEvent = 'onClose';\n\n\t#map;\n\t#mode;\n\t#address;\n\t#prevAddress;\n\t#popup;\n\t#addressString;\n\t#addressFormat;\n\t#gallery;\n\t#isMapRendered = false;\n\t#mapInnerContainer;\n\t#contentWrapper;\n\t#applyAddressElement;\n\t#applyAddressButtonElement;\n\t#addressApplyTextElement;\n\t#userLocationPoint;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.MapPopup');\n\n\t\tif (!(props.map instanceof MapBase))\n\t\t{\n\t\t\tBX.debug('map must be instance of Map');\n\t\t}\n\n\t\tthis.#map = props.map;\n\n\t\tthis.#map.onLocationChangedEventSubscribe(this.#onLocationChanged.bind(this));\n\n\t\tif (!(props.popup instanceof Popup))\n\t\t{\n\t\t\tBX.debug('popup must be instance of Popup');\n\t\t}\n\n\t\tthis.#popup = props.popup;\n\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tthis.#addressString = new AddressString({\n\t\t\taddressFormat: this.#addressFormat,\n\t\t});\n\n\t\tif (props.gallery)\n\t\t{\n\t\t\tthis.#gallery = props.gallery;\n\t\t}\n\n\t\tthis.#userLocationPoint = props.userLocationPoint;\n\t}\n\n\t#onLocationChanged(event: Event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst location = data.location;\n\t\tconst address = location.toAddress();\n\n\t\tif (!this.#address)\n\t\t{\n\t\t\tthis.#address = address;\n\t\t\tthis.#addressString.address = address;\n\t\t\tthis.emit(\n\t\t\t\tMapPopup.#onChangedEvent,\n\t\t\t\t{ address },\n\t\t\t);\n\t\t}\n\t\telse if (address.fieldCollection.isEqual(this.#address.fieldCollection, LocationType.ADDRESS_LINE_1))\n\t\t{\n\t\t\tthis.#address.latitude = address.latitude;\n\t\t\tthis.#address.longitude = address.longitude;\n\n\t\t\tif (this.#address.location)\n\t\t\t{\n\t\t\t\tthis.#address.location.latitude = address.latitude;\n\t\t\t\tthis.#address.location.longitude = address.longitude;\n\t\t\t}\n\n\t\t\tthis.emit(\n\t\t\t\tMapPopup.#onChangedEvent,\n\t\t\t\t{ address: this.#address },\n\t\t\t);\n\t\t\tthis.#hideApplyAddress();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#addressString.address = address;\n\t\t\tthis.#prevAddress = address;\n\t\t\tDom.adjust(this.#addressApplyTextElement, { text: this.#getAddressAsText(this.#prevAddress) });\n\t\t\tthis.#showApplyAddress();\n\t\t}\n\n\t\tif (this.#gallery)\n\t\t{\n\t\t\tthis.#gallery.location = location;\n\t\t}\n\t}\n\n\trender(props: object): void\n\t{\n\t\tthis.#address = props.address;\n\t\tthis.#mode = props.mode;\n\t\tthis.#isMapRendered = false;\n\t\tthis.#mapInnerContainer = Tag.render`<div class=\"location-map-inner\"></div>`;\n\t\tthis.#createApplyAddressElement();\n\t\tthis.#renderPopup(props.bindElement, this.#mapInnerContainer);\n\t}\n\n\t#renderPopup(bindElement: Element, mapInnerContainer: Element): Popup\n\t{\n\t\tlet gallery = '';\n\n\t\tif (this.#gallery)\n\t\t{\n\t\t\tgallery = this.#gallery.render();\n\t\t}\n\n\t\tconst thirdPartyWarningNode = Tag.render`\n\t\t\t<div class=\"location-map-address-third-party-warning\">\n\t\t\t\t${Loc.getMessage('LOCATION_WIDGET_THIRD_PARTY_WARNING')}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#contentWrapper = Tag.render`\n\t\t\t<div class=\"location-map-wrapper\">\n\t\t\t\t<div class=\"location-map-container\">\n\t\t\t\t\t${mapInnerContainer}\n\t\t\t\t\t${gallery}\n\t\t\t\t</div>\n\t\t\t\t${this.#mode === ControlMode.edit ? this.#addressString.render({ address: this.#address }) : ''}\n\t\t\t\t${thirdPartyWarningNode}\n\t\t\t\t${this.#mode === ControlMode.edit ? this.#applyAddressElement : ''}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.#contentWrapper, 'click', (e) => e.stopPropagation());\n\t\tEvent.bind(this.#contentWrapper, 'mouseover', (e) => this.emit(MapPopup.#onMouseOverEvent, e));\n\t\tEvent.bind(this.#contentWrapper, 'mouseout', (e) => this.emit(MapPopup.#onMouseOutEvent, e));\n\t\tthis.bindElement = bindElement;\n\t\tthis.#popup.setContent(this.#contentWrapper);\n\t\tthis.#hideApplyAddress();\n\t}\n\n\t#createApplyAddressElement(): void\n\t{\n\t\tthis.#applyAddressButtonElement = Tag.render`\n\t\t\t<button @click=\"handleApplyClick\" type=\"button\" class=\"location-map-address-apply-btn\">\n\t\t\t\t${Loc.getMessage('LOCATION_WIDGET_AUI_ADDRESS_APPLY')}\n\t\t\t</button>\n\t\t`;\n\t\tEvent.bind(this.#applyAddressButtonElement, 'click', this.#onApplyAddressClick.bind(this));\n\n\t\tthis.#addressApplyTextElement = Tag.render`\n\t\t\t<div class=\"location-map-address-changed-text\">\n\t\t\t\t${this.#getAddressAsText(this.#address)}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#applyAddressElement = Tag.render`\n\t\t\t<div class=\"location-map-address-changed\">\n\t\t\t\t<div class=\"location-map-address-changed-inner\">\n\t\t\t\t<div class=\"location-map-address-changed-title\">\n\t\t\t\t\t${Loc.getMessage('LOCATION_WIDGET_AUI_ADDRESS_CHANGED_NEW_ADDRESS')}\n\t\t\t\t</div>\n\t\t\t\t${this.#addressApplyTextElement}\n\t\t\t\t</div>\n\t\t\t\t${this.#applyAddressButtonElement}\n\t\t\t</div>\t\n\t\t`;\n\t}\n\n\t#onApplyAddressClick()\n\t{\n\t\tthis.#address = this.#prevAddress;\n\t\tthis.#addressString.address = this.#prevAddress;\n\t\tthis.#hideApplyAddress();\n\n\t\tthis.emit(\n\t\t\tMapPopup.#onChangedEvent,\n\t\t\t{ address: this.#prevAddress },\n\t\t);\n\t}\n\n\tget bindElement()\n\t{\n\t\treturn this.#popup.getBindElement();\n\t}\n\n\tset bindElement(bindElement: Element)\n\t{\n\t\tif (Type.isDomNode(bindElement))\n\t\t{\n\t\t\tthis.#popup.setBindElement(bindElement);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.debug('bindElement must be type of dom node');\n\t\t}\n\t}\n\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\t\tthis.#addressString.address = address;\n\n\t\tthis.#convertAddressToLocation(address)\n\t\t\t.then((location) => {\n\t\t\t\tthis.#setLocationInternal(location);\n\t\t\t});\n\t}\n\n\t#extractLatLon(address: Address): ?Array\n\t{\n\t\tlet result = null;\n\t\tlet lat;\n\t\tlet lon;\n\n\t\tif (address.latitude && address.longitude)\n\t\t{\n\t\t\tlat = address.latitude;\n\t\t\tlon = address.longitude;\n\t\t}\n\t\telse if (address.location\n\t\t\t&& address.location.latitude\n\t\t\t&& address.location.longitude\n\t\t)\n\t\t{\n\t\t\tlat = address.location.latitude;\n\t\t\tlon = address.location.longitude;\n\t\t}\n\n\t\tif (lat && lat !== '0' && lon && lon !== '0')\n\t\t{\n\t\t\tresult = [lat, lon];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#convertAddressToLocation(address: ?Address, useUserLocation: boolean = false): Promise<?Location>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif (useUserLocation)\n\t\t\t{\n\t\t\t\tresolve(\n\t\t\t\t\tthis.#userLocationPoint && this.#mode !== ControlMode.view\n\t\t\t\t\t\t? new Location({\n\t\t\t\t\t\t\tlatitude: this.#userLocationPoint.latitude,\n\t\t\t\t\t\t\tlongitude: this.#userLocationPoint.longitude,\n\t\t\t\t\t\t})\n\t\t\t\t\t\t: null,\n\t\t\t\t);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (address)\n\t\t\t{\n\t\t\t\tconst latLon = this.#extractLatLon(address);\n\n\t\t\t\tif (latLon)\n\t\t\t\t{\n\t\t\t\t\tresolve(new Location({\n\t\t\t\t\t\tlatitude: latLon[0],\n\t\t\t\t\t\tlongitude: latLon[1],\n\t\t\t\t\t\ttype: address.getType(),\n\t\t\t\t\t}));\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresolve(null);\n\t\t});\n\t}\n\n\t#setLocationInternal(location: ?Location): void\n\t{\n\t\tif (this.#map)\n\t\t{\n\t\t\tthis.#map.location = location;\n\t\t}\n\n\t\tif (this.#gallery)\n\t\t{\n\t\t\tthis.#gallery.location = location;\n\t\t}\n\t}\n\n\tset mode(mode: string): void\n\t{\n\t\tthis.#mode = mode;\n\t\tthis.#map.mode = mode;\n\t}\n\n\t#renderMap({ location })\n\t{\n\t\treturn this.#map.render({\n\t\t\tmapContainer: this.#mapInnerContainer,\n\t\t\tlocation,\n\t\t\tmode: this.#mode,\n\t\t});\n\t}\n\n\t#hideApplyAddress(): void\n\t{\n\t\tDom.style(this.#applyAddressElement, { display: 'none' });\n\t}\n\n\t#showApplyAddress(): void\n\t{\n\t\tDom.style(this.#applyAddressElement, { display: 'flex' });\n\t}\n\n\t#getAddressAsText(address: Address): string\n\t{\n\t\tif (!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(\n\t\t\tthis.#addressFormat,\n\t\t\tAddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA,\n\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT,\n\t\t);\n\t}\n\n\tshow(useUserLocation: boolean = false): void\n\t{\n\t\tthis.#convertAddressToLocation(this.#address, useUserLocation)\n\t\t\t.then((location) => {\n\t\t\t\tif (!location)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#popup.show();\n\n\t\t\t\tif (this.#isMapRendered)\n\t\t\t\t{\n\t\t\t\t\tthis.#map.location = location;\n\n\t\t\t\t\tif (this.#gallery)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#gallery.location = location;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.emit(MapPopup.#onShowedEvent);\n\t\t\t\t\tthis.#map.onMapShow();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#renderMap({ location })\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tif (this.#gallery)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#gallery.location = location;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.emit(MapPopup.#onShowedEvent);\n\t\t\t\t\t\t\tthis.#map.onMapShow();\n\t\t\t\t\t\t});\n\n\t\t\t\t\tthis.#isMapRendered = true;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#popup.isShown();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#popup.close();\n\t\tthis.#hideApplyAddress();\n\t\tthis.emit(MapPopup.#onClosedEvent);\n\t}\n\n\tonChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onChangedEvent, listener);\n\t}\n\n\tonMouseOverSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onMouseOverEvent, listener);\n\t}\n\n\tonMouseOutSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onMouseOutEvent, listener);\n\t}\n\n\tsubscribeOnShowedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onShowedEvent, listener);\n\t}\n\n\tsubscribeOnClosedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onClosedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#map = null;\n\t\tthis.#gallery = null;\n\t\tthis.#addressString = null;\n\n\t\tthis.#popup.destroy();\n\t\tthis.#popup = null;\n\t\tDom.remove(this.#contentWrapper);\n\t\tthis.#contentWrapper = null;\n\t\tEvent.unbindAll(this);\n\t}\n}\n","import {Address, MethodNotImplemented} from \"location.core\";\nimport MapPopup from \"../../mappopup/mappopup\";\n\n/**\n * Base class for the address widget feature\n */\nexport default class BaseFeature\n{\n\t_saveResourceStrategy = false;\n\n\tconstructor(props)\n\t{\n\t\tthis._saveResourceStrategy = props.saveResourceStrategy;\n\t}\n\n\trender(props)\n\t{\n\t\tthrow new MethodNotImplemented('Method render must be implemented');\n\t}\n\n\tsetAddressWidget(addressWidget): void\n\t{\n\t\tthrow new MethodNotImplemented('Method render must be implemented');\n\t}\n\n\tsetAddress(address: Address): void\n\t{\n\t\tthrow new MethodNotImplemented('Method set address must be implemented');\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\n\t}\n\n\tdestroy(): void\n\t{\n\n\t}\n\n\tresetView(): void\n\t{\n\n\t}\n}","import {Type, Event} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {\n\tAddress as AddressEntity,\n\tControlMode,\n\tFormat,\n\tAddressStringConverter,\n\tLocationRepository,\n\tErrorPublisher,\n\tFormatTemplateType,\n\tAddressType,\n\tStorage\n} from 'location.core';\nimport State from '../state';\nimport BaseFeature from './features/basefeature';\nimport {FeatureEvent} from './featurevent';\n\n/**\n * Props for the address widget constructor\n */\nexport type AddressConstructorProps = {\n\t/** @see ControlMode */\n\tmode: string,\n\taddressFormat: Format,\n\taddress?: AddressEntity,\n\tneedWarmBackendAfterAddressChanged?: boolean,\n\tlocationRepository?: LocationRepository,\n};\n\n/**\n * Props for the address widget render method\n */\nexport type AddressRenderProps = {\n\t/** Input control witch will be used by user to enter the address */\n\tinputNode: Element,\n\t/** Control wrapper witch could be used for mouseover event etc. */\n\tcontrolWrapper: Element,\n\t/** If map feature is used it could be used to bind map popup */\n\tmapBindElement: ?Element,\n\t/** If autocomplete feature is used it could be used to bind menu node */\n\tautocompleteMenuElement: ?Element\n};\n\n/**\n * Address widget\n */\nexport default class Address extends EventEmitter\n{\n\t/* If address was changed by user */\n\tstatic onAddressChangedEvent = 'onAddressChanged';\n\t/* If state of the widget was changed */\n\tstatic onStateChangedEvent = 'onStateChanged';\n\t/* Any feature-related events */\n\tstatic onFeatureEvent = 'onFeatureEvent';\n\n\t#mode;\n\t#state;\n\t#address;\n\t#addressFormat;\n\t#languageId;\n\n\t#features = [];\n\n\t#inputNode;\n\t#controlWrapper;\n\n\t#destroyed = false;\n\n\t#isAddressChangedByFeature = false;\n\t#isInputNodeValueUpdated = false;\n\n\t#needWarmBackendAfterAddressChanged = true;\n\t#locationRepository;\n\n\t/**\n\t * Constructor\n\t * @param {AddressConstructorProps} props\n\t */\n\tconstructor(props: AddressConstructorProps)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Address');\n\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tif (props.address && !(props.address instanceof AddressEntity))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = props.address || null;\n\n\t\tif (!(ControlMode.isValid(props.mode)))\n\t\t{\n\t\t\tBX.debug('mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tif (!Type.isString(props.languageId))\n\t\t{\n\t\t\tthrow new TypeError('props.languageId must be type of string');\n\t\t}\n\n\t\tthis.#languageId = props.languageId;\n\n\t\tif (props.features)\n\t\t{\n\t\t\tif (!Type.isArray(props.features))\n\t\t\t{\n\t\t\t\tthrow new TypeError('features must be an array');\n\t\t\t}\n\n\t\t\tprops.features.forEach((feature: BaseFeature) => {\n\t\t\t\tthis.#addFeature(feature);\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isBoolean(props.needWarmBackendAfterAddressChanged))\n\t\t{\n\t\t\tthis.#needWarmBackendAfterAddressChanged = props.needWarmBackendAfterAddressChanged;\n\t\t}\n\n\t\tif (props.locationRepository instanceof LocationRepository)\n\t\t{\n\t\t\tthis.#locationRepository = props.locationRepository;\n\t\t}\n\t\telse if (this.#needWarmBackendAfterAddressChanged)\n\t\t{\n\t\t\tthis.#locationRepository = new LocationRepository();\n\t\t}\n\n\t\tthis.#state = State.INITIAL;\n\t}\n\n\t/**\n\t * @param {AddressEntity} address\n\t * @param {BaseFeature} sourceFeature\n\t * @param {Array} excludeFeatures\n\t * @param {Object} options\n\t * @internal\n\t */\n\tsetAddressByFeature(\n\t\taddress: AddressEntity,\n\t\tsourceFeature: BaseFeature,\n\t\texcludeFeatures: Array = [],\n\t\toptions: Object = {}\n\t): void\n\t{\n\t\tconst addressId = this.#address ? this.#address.id : 0;\n\n\t\tif (\n\t\t\taddress\n\t\t\t&& !address.getFieldValue(AddressType.ADDRESS_LINE_1)\n\t\t\t&& this.#addressFormat.isTemplateExists(FormatTemplateType.ADDRESS_LINE_1)\n\t\t)\n\t\t{\n\t\t\taddress.setFieldValue(\n\t\t\t\tAddressType.ADDRESS_LINE_1,\n\t\t\t\tAddressStringConverter.convertAddressToStringTemplate(\n\t\t\t\t\taddress,\n\t\t\t\t\tthis.#addressFormat.getTemplate(FormatTemplateType.ADDRESS_LINE_1),\n\t\t\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT,\n\t\t\t\t\tnull,\n\t\t\t\t\tthis.#addressFormat\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tthis.#address = address;\n\n\t\tconst storeAsLastAddress = options.hasOwnProperty('storeAsLastAddress')\n\t\t\t? options.storeAsLastAddress\n\t\t\t: true;\n\t\tif (storeAsLastAddress)\n\t\t{\n\t\t\tthis.#storeAsLastAddress();\n\t\t}\n\n\t\tif (this.#address && addressId > 0)\n\t\t{\n\t\t\tthis.#address.id = addressId;\n\t\t}\n\n\t\tthis.#isAddressChangedByFeature = true;\n\t\tthis.#setInputValue(address);\n\n\t\tthis.#executeFeatureMethod(\n\t\t\t'setAddress',\n\t\t\t[address],\n\t\t\tsourceFeature,\n\t\t\texcludeFeatures\n\t\t);\n\n\t\tif (this.#state !== State.DATA_INPUTTING)\n\t\t{\n\t\t\tthis.#emitOnAddressChanged();\n\t\t}\n\t}\n\n\temitFeatureEvent(featureEvent: FeatureEvent)\n\t{\n\t\tthis.emit(\n\t\t\tAddress.onFeatureEvent,\n\t\t\tfeatureEvent\n\t\t);\n\t}\n\n\t/**\n\t * Add feature to the widget\n\t * @param {BaseFeature} feature\n\t */\n\t#addFeature(feature: BaseFeature)\n\t{\n\t\tif (!(feature instanceof BaseFeature))\n\t\t{\n\t\t\tBX.debug('feature must be instance of BaseFeature');\n\t\t}\n\n\t\tfeature.setAddressWidget(this);\n\t\tthis.#features.push(feature);\n\t}\n\n\tget features()\n\t{\n\t\treturn this.#features;\n\t}\n\n\t#executeFeatureMethod(method, params = [], sourceFeature = null, excludeFeatures = [])\n\t{\n\t\tlet result;\n\n\t\tfor(const feature of this.#features)\n\t\t{\n\t\t\tlet isExcluded = false;\n\t\t\tfor(const excludeFeature of excludeFeatures)\n\t\t\t{\n\t\t\t\tif (feature instanceof excludeFeature)\n\t\t\t\t{\n\t\t\t\t\tisExcluded = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!isExcluded && feature !== sourceFeature)\n\t\t\t{\n\t\t\t\tresult = feature[method].apply(feature, params);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#emitOnAddressChanged()\n\t{\n\t\tthis.emit(\n\t\t\tAddress.onAddressChangedEvent,\n\t\t\t{address: this.#address}\n\t\t);\n\n\t\tif (this.#address && this.#needWarmBackendAfterAddressChanged)\n\t\t{\n\t\t\tthis.#warmBackendAfterAddressChanged(this.#address);\n\t\t}\n\t}\n\n\t#warmBackendAfterAddressChanged(address: AddressEntity): void\n\t{\n\t\tif (address.location !== null && address.location.id <= 0)\n\t\t{\n\t\t\tthis.#locationRepository.findParents(address.location);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onInputFocus(e: KeyboardEvent)\n\t{\n\t\tconst value = this.#inputNode.value;\n\n\t\tif (value.length > 0)\n\t\t{\n\t\t\tBX.setCaretPosition(this.#inputNode, value.length);\n\t\t}\n\t}\n\n\t#convertAddressToString(\n\t\taddress: ?Address,\n\t\ttemplateType: string\n\t): string\n\t{\n\t\tlet result = '';\n\n\t\tif (address)\n\t\t{\n\t\t\tif (!this.#addressFormat.isTemplateExists(templateType))\n\t\t\t{\n\t\t\t\tconsole.error(`Address format \"${this.#addressFormat.code}\" does not have a template \"${templateType}\"`);\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tresult = AddressStringConverter.convertAddressToStringTemplate(\n\t\t\t\taddress,\n\t\t\t\tthis.#addressFormat.getTemplate(templateType),\n\t\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT,\n\t\t\t\t', ',\n\t\t\t\tthis.#addressFormat\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#setInputValue(address: ?Address)\n\t{\n\t\tif (this.#inputNode)\n\t\t{\n\t\t\tconst shortAddressString = this.#convertAddressToString(address, FormatTemplateType.AUTOCOMPLETE);\n\t\t\tconst fullAddressString = this.#convertAddressToString(address, FormatTemplateType.DEFAULT);\n\t\t\tthis.#inputNode.value = shortAddressString.trim() !== '' ? shortAddressString : fullAddressString;\n\t\t\tthis.#inputNode.title = fullAddressString;\n\t\t\tconst selectionStart = this.#inputNode.selectionStart;\n\t\t\tconst selectionEnd = shortAddressString.length;\n\t\t\tthis.#inputNode.setSelectionRange(selectionStart, selectionEnd);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onInputFocusOut(e: Event)\n\t{\n\t\t// Seems that we don't have any autocompleter feature\n\t\tif (this.#isInputNodeValueUpdated && !this.#isAddressChangedByFeature)\n\t\t{\n\t\t\tconst value = this.#inputNode.value.trim();\n\t\t\tconst address = new AddressEntity({languageId: this.#languageId});\n\t\t\taddress.setFieldValue(this.#addressFormat.fieldForUnRecognized, value);\n\t\t\tthis.address = address;\n\t\t\tthis.#emitOnAddressChanged();\n\t\t}\n\n\t\tthis.#isInputNodeValueUpdated = false;\n\t\tthis.#isAddressChangedByFeature = false;\n\t}\n\n\tonInputKeyup(e: KeyboardEvent)\n\t{\n\t\tswitch (e.code)\n\t\t{\n\t\t\tcase 'Tab':\n\t\t\tcase 'Esc':\n\t\t\tcase 'Enter':\n\t\t\tcase 'NumpadEnter':\n\t\t\t\tthis.resetView();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonInputInput(e)\n\t{\n\t\tthis.#isInputNodeValueUpdated = true;\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.#executeFeatureMethod('resetView');\n\t}\n\n\t/**\n\t * Render Widget\n\t * @param {AddressRenderProps} props\n\t */\n\trender(props: AddressRenderProps): void\n\t{\n\t\tif (!Type.isDomNode(props.controlWrapper))\n\t\t{\n\t\t\tBX.debug('props.controlWrapper must be instance of Element');\n\t\t}\n\n\t\tthis.#controlWrapper = props.controlWrapper;\n\n\t\tif (this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tif (!Type.isDomNode(props.inputNode))\n\t\t\t{\n\t\t\t\tBX.debug('props.inputNode must be instance of Element');\n\t\t\t}\n\n\t\t\tthis.#inputNode = props.inputNode;\n\t\t\tthis.#setInputValue(this.#address);\n\t\t}\n\n\t\tthis.#executeFeatureMethod('render', [props]);\n\n\t\t// We can prevent these events in features if need\n\t\tif (this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tEvent.bind(this.#inputNode, 'focus', this.#onInputFocus.bind(this));\n\t\t\tEvent.bind(this.#inputNode, 'focusout', this.#onInputFocusOut.bind(this));\n\t\t\tEvent.bind(this.#inputNode, 'keyup', this.onInputKeyup.bind(this));\n\t\t\tEvent.bind(this.#inputNode, 'input', this.onInputInput.bind(this));\n\t\t}\n\t}\n\n\tget controlWrapper()\n\t{\n\t\treturn this.#controlWrapper;\n\t}\n\n\tget inputNode()\n\t{\n\t\treturn this.#inputNode;\n\t}\n\n\tget address(): ?AddressEntity\n\t{\n\t\treturn this.#address;\n\t}\n\n\tset address(address: ?AddressEntity): void\n\t{\n\t\tif (address && !(address instanceof AddressEntity))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = address;\n\t\tthis.#storeAsLastAddress();\n\t\tthis.#executeFeatureMethod('setAddress', [address]);\n\t\tthis.#isInputNodeValueUpdated = false;\n\t\tthis.#isAddressChangedByFeature = false;\n\t\tthis.#setInputValue(address);\n\t}\n\n\tget mode()\n\t{\n\t\treturn this.#mode;\n\t}\n\n\tset mode(mode: string): void\n\t{\n\t\tif (!(ControlMode.isValid(mode)))\n\t\t{\n\t\t\tBX.debug('mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = mode;\n\n\t\tthis.#executeFeatureMethod('setMode', [mode]);\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\tget addressFormat(): Format\n\t{\n\t\treturn this.#addressFormat;\n\t}\n\n\tsetStateByFeature(state: string)\n\t{\n\t\tthis.#state = state;\n\n\t\tthis.emit(\n\t\t\tAddress.onStateChangedEvent,\n\t\t\t{state: state}\n\t\t);\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onStateChangedEvent, listener);\n\t}\n\n\tsubscribeOnAddressChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onAddressChangedEvent, listener);\n\t}\n\n\tsubscribeOnFeatureEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onFeatureEvent, listener);\n\t}\n\n\tsubscribeOnErrorEvent(listener: Function): void\n\t{\n\t\tErrorPublisher.getInstance().subscribe(listener);\n\t}\n\n\t#storeAsLastAddress()\n\t{\n\t\tif (\n\t\t\tthis.#address\n\t\t\t&& this.#address.fieldCollection\n\t\t\t&& this.#address.fieldCollection.isFieldExists(AddressType.LOCALITY)\n\t\t)\n\t\t{\n\t\t\tStorage.getInstance().lastAddress = this.#address;\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.#destroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.unbindAll(this);\n\t\tEvent.unbind(this.#inputNode, 'focus', this.#onInputFocus);\n\t\tEvent.unbind(this.#inputNode, 'focusout', this.#onInputFocusOut);\n\t\tEvent.unbind(this.#inputNode, 'keyup', this.onInputKeyup);\n\t\tEvent.unbind(this.#inputNode, 'input', this.onInputInput);\n\n\t\tthis.#executeFeatureMethod('destroy');\n\t\tthis.#destroyFeatures();\n\t\tthis.#destroyed = true;\n\t}\n\n\t#destroyFeatures()\n\t{\n\t\tthis.#features.splice(0, this.#features.length);\n\t}\n\n\tisDestroyed()\n\t{\n\t\treturn this.#destroyed;\n\t}\n}\n","import {EventEmitter} from 'main.core.events';\nimport {Tag} from 'main.core';\n\nexport default class MenuBottom extends EventEmitter\n{\n\t#node;\n\t#leftItemNodeContainer;\n\t#rightItemNodeContainer;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Location.Widget.Autocomplete.MenuBottom');\n\t}\n\n\trender()\n\t{\n\t\tthis.#leftItemNodeContainer = Tag.render`<div class=\"location-map-popup-item--info-left\"></div>`;\n\t\tthis.#rightItemNodeContainer = Tag.render`<div></div>`;\n\n\t\tthis.#node = Tag.render`\n\t\t\t<div>\n\t\t\t\t<span class=\"location-map-popup-item--info\"> \t\t\n\t\t\t\t\t${this.#leftItemNodeContainer}\n\t\t\t\t\t${this.#rightItemNodeContainer}\n\t\t\t\t</span>\t\t\t\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#node;\n\t}\n\n\tsetRightItemNode(node: Element): void\n\t{\n\t\twhile (this.#rightItemNodeContainer.firstChild)\n\t\t{\n\t\t\tthis.#rightItemNodeContainer.removeChild(this.#rightItemNodeContainer.firstChild);\n\t\t}\n\n\t\tthis.#rightItemNodeContainer.appendChild(node);\n\t}\n\n\tsetLeftItemNode(node: Element): void\n\t{\n\t\twhile (this.#leftItemNodeContainer.firstChild)\n\t\t{\n\t\t\tthis.#leftItemNodeContainer.removeChild(this.#leftItemNodeContainer.firstChild);\n\t\t}\n\n\t\tthis.#leftItemNodeContainer.appendChild(node);\n\t}\n}","import {Menu as MainMenu} from 'main.popup';\nimport './css/menu.css';\nimport MenuBottom from './menubottom';\n\nexport default class Menu extends MainMenu\n{\n\tchoseItemIdx = -1;\n\t#bottom;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tconst elRect = options.bindElement.getBoundingClientRect();\n\t\tthis.popupWindow.setMaxWidth(elRect.width);\n\t\tthis.#bottom = new MenuBottom();\n\t\tthis.layout.menuContainer.appendChild(\n\t\t\tthis.#bottom.render()\n\t\t);\n\t}\n\n\tisMenuEmpty(): boolean\n\t{\n\t\treturn this.menuItems.length <= 0;\n\t}\n\n\tisChoseLastItem(): boolean\n\t{\n\t\treturn this.choseItemIdx >= this.menuItems.length - 1;\n\t}\n\n\tisChoseFirstItem(): boolean\n\t{\n\t\treturn this.choseItemIdx === 0;\n\t}\n\n\tisItemChosen(): boolean\n\t{\n\t\treturn this.choseItemIdx >= 0;\n\t}\n\n\tisDestroyed(): boolean\n\t{\n\t\treturn this.getPopupWindow().isDestroyed();\n\t}\n\n\tisItemExist(index: number): boolean\n\t{\n\t\treturn typeof this.menuItems[index] !== 'undefined';\n\t}\n\n\tgetChosenItem()\n\t{\n\t\tlet result = null;\n\n\t\tif(this.isItemChosen() && this.isItemExist(this.choseItemIdx))\n\t\t{\n\t\t\tresult = this.menuItems[this.choseItemIdx];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tchooseNextItem(): void\n\t{\n\t\tif(!this.isMenuEmpty() && !this.isChoseLastItem())\n\t\t{\n\t\t\tthis.chooseItem(this.choseItemIdx + 1);\n\t\t}\n\n\t\treturn this.getChosenItem();\n\t}\n\n\tchoosePrevItem(): void\n\t{\n\t\tif(!this.isMenuEmpty() && !this.isChoseFirstItem())\n\t\t{\n\t\t\tthis.chooseItem(this.choseItemIdx - 1);\n\t\t}\n\n\t\treturn this.getChosenItem();\n\t}\n\n\thighlightItem(index: number): void\n\t{\n\t\tif(this.isItemExist(index))\n\t\t{\n\t\t\tconst item = this.getChosenItem();\n\n\t\t\tif(item && item.layout.item)\n\t\t\t{\n\t\t\t\titem.layout.item.classList.add('highlighted');\n\t\t\t}\n\t\t}\n\t}\n\n\tunHighlightItem(index: number): void\n\t{\n\t\tif(this.isItemExist(index))\n\t\t{\n\t\t\tconst item = this.getChosenItem();\n\n\t\t\tif(item && item.layout.item)\n\t\t\t{\n\t\t\t\titem.layout.item.classList.remove('highlighted');\n\t\t\t}\n\t\t}\n\t}\n\n\tchooseItem(index: number)\n\t{\n\t\tlet idx = index;\n\n\t\tif(idx < 0)\n\t\t{\n\t\t\tidx = this.menuItems.length - 1;\n\t\t}\n\t\telse if(idx > this.menuItems.length - 1)\n\t\t{\n\t\t\tidx = 0;\n\t\t}\n\n\t\tthis.unHighlightItem(this.choseItemIdx);\n\t\tthis.choseItemIdx = idx;\n\t\tthis.highlightItem(this.choseItemIdx);\n\t}\n\n\tclearItems()\n\t{\n\t\twhile(this.menuItems.length > 0)\n\t\t{\n\t\t\tthis.removeMenuItem(this.menuItems[0].id);\n\t\t}\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.getPopupWindow().isShown();\n\t}\n\n\tsetBottomRightItemNode(node: Element): void\n\t{\n\t\tthis.#bottom.setRightItemNode(node);\n\t}\n\n\tsetBottomLeftItemNode(node: Element): void\n\t{\n\t\tthis.#bottom.setLeftItemNode(node);\n\t}\n}\n","import {EventEmitter} from 'main.core.events';\nimport {Loc} from 'main.core';\nimport {Location, Address, AddressType, LocationType} from 'location.core';\nimport Menu from './menu';\n\nexport default class Prompt extends EventEmitter\n{\n\tstatic onItemSelectedEvent = 'onItemSelected';\n\n\t/** Element */\n\t#inputNode;\n\n\t/** Element */\n\t#menuNode;\n\n\t/** {Menu} */\n\t#menu;\n\n\t/** {Array<Location>} */\n\t#locationList;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.Prompt');\n\n\t\tthis.#inputNode = props.inputNode;\n\n\t\tif (props.menuNode)\n\t\t{\n\t\t\tthis.#menuNode = props.menuNode;\n\t\t}\n\t}\n\n\t#createMenu()\n\t{\n\t\treturn new Menu({\n\t\t\tbindElement: this.#menuNode ? this.#menuNode : this.#inputNode,\n\t\t\tautoHide: false,\n\t\t\tcloseByEsc: true,\n\t\t\tclassName: 'location-widget-prompt-menu',\n\t\t});\n\t}\n\n\tgetMenu(): Menu\n\t{\n\t\tif(!this.#menu || this.#menu.isDestroyed())\n\t\t{\n\t\t\tthis.#menu = this.#createMenu();\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t/**\n\t * Show menu with list of locations\n\t * @param {array} locationsList\n\t * @param {string} searchPhrase\n\t * @returns void\n\t */\n\tshow(locationsList: Array<Location>, searchPhrase: string): void\n\t{\n\t\tif(locationsList.length > 0)\n\t\t{\n\t\t\tthis.setMenuItems(locationsList, searchPhrase);\n\t\t\tthis.getMenu().show();\n\t\t}\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.getMenu().close();\n\t}\n\n\t/**\n\t * @param {array<Location>} locationsList\n\t * @param {string} searchPhrase\n\t * @param {Address} address\n\t * @returns {*}\n\t */\n\tsetMenuItems(locationsList: Array<Location>, searchPhrase: string, address: ?Address): Menu\n\t{\n\t\tthis.getMenu().clearItems();\n\n\t\tif(Array.isArray(locationsList))\n\t\t{\n\t\t\tthis.#locationList = locationsList.slice();\n\n\t\t\tconst showFlatList = (\n\t\t\t\t!address\n\t\t\t\t|| !address.getFieldValue(AddressType.LOCALITY)\n\t\t\t\t|| !Prompt.#hasLocationWithLocality(this.#locationList)\n\t\t\t);\n\n\t\t\tif (showFlatList)\n\t\t\t{\n\t\t\t\tlocationsList.forEach((location, index) => {\n\t\t\t\t\tthis.getMenu().addMenuItem(\n\t\t\t\t\t\tthis.#createMenuItem(index, location, searchPhrase)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlocationsList.forEach((location, index) => {\n\t\t\t\t\tif (this.#isAddressOfSameLocation(address, location)) {\n\t\t\t\t\t\tthis.getMenu().addMenuItem(\n\t\t\t\t\t\t\tthis.#createMenuItem(index, location, searchPhrase)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlet isSeparatorSet = false;\n\t\t\t\tlocationsList.forEach((location, index) => {\n\t\t\t\t\tif (!this.#isAddressOfSameLocation(address, location)) {\n\t\t\t\t\t\tif (!isSeparatorSet)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getMenu().addMenuItem({\n\t\t\t\t\t\t\t\thtml: Loc.getMessage('LOCATION_WIDGET_PROMPT_IN_OTHER_CITY'),\n\t\t\t\t\t\t\t\tdelimiter: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.getMenu().addMenuItem(\n\t\t\t\t\t\t\tthis.#createMenuItem(index, location, searchPhrase)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tisSeparatorSet = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t#isAddressOfSameLocation(address, location)\n\t{\n\t\treturn (\n\t\t\taddress\n\t\t\t&& address.getFieldValue(AddressType.LOCALITY)\n\t\t\t&& location\n\t\t\t&& location.address\n\t\t\t&& location.address.getFieldValue(AddressType.LOCALITY)\n\t\t\t&& Prompt.#getAddressPossibleLocalities(location.address).includes(\n\t\t\t\taddress.getFieldValue(AddressType.LOCALITY)\n\t\t\t)\n\t\t);\n\t}\n\n\tstatic #getAddressPossibleLocalities(address: Address)\n\t{\n\t\tconst result = [];\n\n\t\tif (address.getFieldValue(AddressType.LOCALITY))\n\t\t{\n\t\t\tresult.push(address.getFieldValue(AddressType.LOCALITY));\n\t\t}\n\n\t\t/**\n\t\t * Address break-down formed on frontend is very inaccurate so we can't rely only on the locality type field\n\t\t * @see #142094\n\t\t */\n\t\tif (address.getFieldValue(AddressType.ADM_LEVEL_1))\n\t\t{\n\t\t\tresult.push(address.getFieldValue(AddressType.ADM_LEVEL_1));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * @param {array<Location>} locationsList\n\t * @returns boolean\n\t */\n\tstatic #hasLocationWithLocality(locationsList: Array<Location>): boolean\n\t{\n\t\tfor (let location of locationsList)\n\t\t{\n\t\t\tif (location.address && location.address.getFieldValue(AddressType.LOCALITY))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * @param {number} index\n\t * @param {Location} location\n\t * @param {string} searchPhrase\n\t * @returns {{onclick: onclick, text: string}}\n\t */\n\t#createMenuItem(index, location: Location, searchPhrase): Object\n\t{\n\t\treturn {\n\t\t\tid: index,\n\t\t\ttitle: location.name,\n\t\t\thtml: Prompt.createMenuItemText(location.name, searchPhrase, location),\n\t\t\tonclick: (event, item) => {\n\t\t\t\tthis.#onItemSelect(index);\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t};\n\t}\n\n\t#onItemSelect(index: number): void\n\t{\n\t\tconst location = this.#getLocationFromList(index);\n\n\t\tif(location)\n\t\t{\n\t\t\tthis.emit(Prompt.onItemSelectedEvent, {location: location});\n\t\t}\n\t}\n\n\tstatic createMenuItemText(locationName: string, searchPhrase: string, location: Location): string\n\t{\n\t\tlet result = `\n\t\t<div>\n\t\t\t<strong>${locationName}</strong>\n\t\t</div>`;\n\n\t\tlet clarification;\n\n\t\tif(location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION))\n\t\t{\n\t\t\tclarification = location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION);\n\n\t\t\tif(clarification)\n\t\t\t{\n\t\t\t\tif(location.getFieldValue(LocationType.TMP_TYPE_HINT))\n\t\t\t\t{\n\t\t\t\t\tclarification += ` <i>(${location.getFieldValue(LocationType.TMP_TYPE_HINT)})</i>`;\n\t\t\t\t}\n\n\t\t\t\tresult += `<div>${clarification}</div>`;\n\t\t\t}\n\t\t}\n\n\t\treturn '<div data-role=\"location-widget-menu-item\" tabindex=\"-1\">' + result + '</div>';\n\t}\n\n\tstatic #extractClarification(location: Location): string\n\t{\n\t\tlet clarification = '';\n\n\t\tif(location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION))\n\t\t{\n\t\t\tclarification = location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION);\n\t\t}\n\n\t\treturn clarification;\n\t}\n\n\t#getLocationFromList(index: number): ?Location\n\t{\n\t\tlet result = null;\n\n\t\tif (this.#locationList[index] !== undefined)\n\t\t{\n\t\t\tresult = this.#locationList[index];\n\t\t}\n\n\t\tif(!result)\n\t\t{\n\t\t\tBX.debug(`Location with index ${index} was not found`);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tchoosePrevItem(isRecursive: boolean = false)\n\t{\n\t\tlet result = null;\n\t\tconst item = this.getMenu().choosePrevItem();\n\n\t\tif (item)\n\t\t{\n\t\t\tif (item.delimiter && item.delimiter === true)\n\t\t\t{\n\t\t\t\tresult = isRecursive ? this.getMenu().chooseNextItem() : this.choosePrevItem(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = this.#getLocationFromList(this.getMenu().choseItemIdx);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tchooseNextItem()\n\t{\n\t\tlet result = null;\n\t\tconst item = this.getMenu().chooseNextItem();\n\n\t\tif (item)\n\t\t{\n\t\t\tif (item.delimiter && item.delimiter === true)\n\t\t\t{\n\t\t\t\tresult = this.chooseNextItem();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = this.#getLocationFromList(this.getMenu().choseItemIdx);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisItemChosen()\n\t{\n\t\treturn this.getMenu().isItemChosen();\n\t}\n\n\tgetChosenItem()\n\t{\n\t\tlet result = null;\n\t\tconst menuItem = this.getMenu().getChosenItem();\n\n\t\tif(menuItem && menuItem.id)\n\t\t{\n\t\t\tresult = this.#getLocationFromList(this.getMenu().choseItemIdx);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.getMenu().isShown();\n\t}\n\n\tdestroy()\n\t{\n\t\tif(this.#menu)\n\t\t{\n\t\t\tthis.#menu.destroy();\n\t\t\tthis.#menu = null;\n\t\t}\n\n\t\tthis.#locationList = null;\n\t}\n}\n","import {Format, FormatTemplateType, AddressStringConverter, Address} from 'location.core';\n\nexport default class AddressString\n{\n\t// Input node element\n\t#input = null;\n\t// Address string value\n\t#value = '';\n\t// Address string as it was without custom inputs\n\t#pureAddressString = '';\n\t#addressFormat = null;\n\n\tconstructor(input: HTMLInputElement, addressFormat: Format, address: ?Address)\n\t{\n\t\tif (!(input instanceof HTMLInputElement))\n\t\t{\n\t\t\tthrow new TypeError('Wrong input type');\n\t\t}\n\n\t\tthis.#input = input;\n\n\t\tif (!(addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new TypeError('Wrong addressFormat type');\n\t\t}\n\n\t\tthis.#addressFormat = addressFormat;\n\n\t\tif (address && !(address instanceof Address))\n\t\t{\n\t\t\tthrow new TypeError('Wrong address type');\n\t\t}\n\t\tif (address)\n\t\t{\n\t\t\tthis.setValueFromAddress(address);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param {string} value Address string value\n\t * @param {boolean} isPureAddress Does it contain user input or not\n\t */\n\tsetValue(value: string, isPureAddress: boolean = false): void\n\t{\n\t\tthis.#value = value;\n\t\tthis.#input.value = value;\n\n\t\tif (isPureAddress)\n\t\t{\n\t\t\tthis.#pureAddressString = value;\n\t\t}\n\n\t\tthis.#actualizePureString();\n\t}\n\n\tactualize()\n\t{\n\t\tthis.#value = this.#input.value;\n\t\tthis.#actualizePureString();\n\t}\n\n\t#actualizePureString()\n\t{\n\t\tif (this.#isPureAddressStringModified())\n\t\t{\n\t\t\tthis.#pureAddressString = '';\n\t\t}\n\t}\n\n\tisChanged()\n\t{\n\t\treturn this.#value.trim() !== this.#input.value.trim();\n\t}\n\n\tget value(): string\n\t{\n\t\treturn this.#value;\n\t}\n\n\tget customTail()\n\t{\n\t\tif (this.#pureAddressString === '')\n\t\t{\n\t\t\treturn this.#value;\n\t\t}\n\n\t\tlet result;\n\n\t\tif (!this.#isPureAddressStringModified())\n\t\t{\n\t\t\tresult = this.#value.slice(this.#pureAddressString.length);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = this.#value;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\thasPureAddressString()\n\t{\n\t\treturn this.#pureAddressString !== '';\n\t}\n\n\t// We suggest that user will input data after the address data\n\t#isPureAddressStringModified(): boolean\n\t{\n\t\treturn this.#value === ''\n\t\t\t|| this.#pureAddressString === ''\n\t\t\t|| this.#value.indexOf(this.#pureAddressString) !== 0;\n\t}\n\n\tsetValueFromAddress(address: ?Address): void\n\t{\n\t\tlet value = '';\n\n\t\tif (address)\n\t\t{\n\t\t\tvalue = this.#convertAddressToString(address, FormatTemplateType.AUTOCOMPLETE);\n\n\t\t\tif (value.trim() === '')\n\t\t\t{\n\t\t\t\tvalue = this.#convertAddressToString(address, FormatTemplateType.DEFAULT);\n\t\t\t}\n\t\t}\n\n\t\tthis.setValue(value, true);\n\t}\n\n\t#convertAddressToString(address: Address, templateType: string): string\n\t{\n\t\tif (!this.#addressFormat.isTemplateExists(templateType))\n\t\t{\n\t\t\tconsole.error(`Address format \"${this.#addressFormat.code}\" does not have a template \"${templateType}\"`);\n\t\t\treturn '';\n\t\t}\n\n\t\treturn AddressStringConverter.convertAddressToStringTemplate(\n\t\t\taddress,\n\t\t\tthis.#addressFormat.getTemplate(templateType),\n\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT,\n\t\t\t', ',\n\t\t\tthis.#addressFormat\n\t\t);\n\t}\n}","import {Event, Loc, Tag} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {\n\tLocationRepository,\n\tAutocompleteServiceBase,\n\tFormat,\n\tAddress,\n\tLocation,\n\tErrorPublisher,\n\tAddressType,\n\tStorage,\n\tPoint\n} from 'location.core';\nimport type {AutocompleteServiceParams} from 'location.core';\nimport Prompt from './prompt';\nimport State from '../state';\nimport AddressString from './addressstring';\n\n/**\n * @mixes EventEmitter\n */\nexport default class Autocomplete extends EventEmitter\n{\n\tstatic #onAddressChangedEvent = 'onAddressChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\tstatic #onSearchStartedEvent = 'onSearchStarted';\n\tstatic #onSearchCompletedEvent = 'onSearchCompleted';\n\tstatic #onShowOnMapClickedEvent = 'onShowOnMapClicked';\n\n\t/** {Address} */\n\t#address;\n\t/** {AddressString|null} */\n\t#addressString = null;\n\t/** {String} */\n\t#languageId;\n\t/** {Format} */\n\t#addressFormat;\n\t/** {String} */\n\t#sourceCode;\n\t/** {LocationRepository} */\n\t#locationRepository;\n\t/** {Point} */\n\t#userLocationPoint;\n\t/** {Function} */\n\t#presetLocationsProvider;\n\t/** {Prompt} */\n\t#prompt;\n\t/** {AutocompleteServiceBase} */\n\t#autocompleteService;\n\t/** {number} */\n\t#timerId = null;\n\t/** {Element} */\n\t#inputNode;\n\n\t#searchPhrase = {\n\t\trequested: '',\n\t\tcurrent: '',\n\t\tdropped: ''\n\t};\n\n\t#state;\n\t#wasCleared = false;\n\t#isDestroyed = false;\n\n\t#isAutocompleteRequestStarted = false;\n\t#isNextAutocompleteRequestWaiting = false;\n\n\t#onLocationSelectTimerId = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Autocomplete');\n\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new Error('props.addressFormat must be type of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tif (!(props.autocompleteService instanceof AutocompleteServiceBase))\n\t\t{\n\t\t\tthrow new Error('props.autocompleteService must be type of AutocompleteServiceBase');\n\t\t}\n\n\t\tthis.#autocompleteService = props.autocompleteService;\n\n\t\tif (!props.languageId)\n\t\t{\n\t\t\tthrow new Error('props.languageId must be defined');\n\t\t}\n\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#sourceCode = props.sourceCode;\n\t\tthis.#address = props.address;\n\t\tthis.#presetLocationsProvider = props.presetLocationsProvider;\n\t\tthis.#locationRepository = props.locationRepository || new LocationRepository();\n\t\tthis.#userLocationPoint = props.userLocationPoint;\n\t\tthis.#setState(State.INITIAL);\n\t}\n\n\trender(props: {}): void\n\t{\n\t\tthis.#inputNode = props.inputNode;\n\t\tthis.#address = props.address;\n\t\tthis.#addressString = new AddressString(this.#inputNode, this.#addressFormat, this.#address);\n\t\tthis.#inputNode.addEventListener('keydown', this.#onInputKeyDown.bind(this));\n\t\tthis.#inputNode.addEventListener('keyup', this.#onInputKeyUp.bind(this));\n\t\tthis.#inputNode.addEventListener('focus', this.#onInputFocus.bind(this));\n\t\tthis.#inputNode.addEventListener('focusout', this.#onInputFocusOut.bind(this));\n\t\tthis.#inputNode.addEventListener('click', this.#onInputClick.bind(this));\n\t\tthis.#inputNode.addEventListener('paste', this.#onInputPaste.bind(this));\n\n\t\tthis.#prompt = new Prompt({\n\t\t\tinputNode: props.inputNode,\n\t\t\tmenuNode: props.menuNode,\n\t\t});\n\n\t\tthis.#prompt.subscribe(Prompt.onItemSelectedEvent, this.#onPromptItemSelected.bind(this));\n\t\tdocument.addEventListener('click', this.#onDocumentClick.bind(this));\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onInputClick(e: MouseEvent)\n\t{\n\t\tconst value = this.#addressString.value;\n\n\t\tif (value.length === 0)\n\t\t{\n\t\t\tthis.#showPresetLocations();\n\t\t}\n\t}\n\n\t#showPresetLocations()\n\t{\n\t\tconst presetLocationList = this.#presetLocationsProvider();\n\n\t\tthis.#prompt.setMenuItems(presetLocationList, '');\n\n\t\tlet leftBottomMenuMessage;\n\n\t\tif (presetLocationList.length > 0)\n\t\t{\n\t\t\tleftBottomMenuMessage = Loc.getMessage('LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tleftBottomMenuMessage = Loc.getMessage('LOCATION_WIDGET_START_PRINTING_OR_SHOW_ON_MAP');\n\t\t}\n\n\t\tthis.#showMenu(leftBottomMenuMessage, null);\n\t}\n\n\t#createRightBottomMenuNode(location: ?Location): Element\n\t{\n\t\tconst element = Tag.render`\n\t\t\t\t<span class=\"location-map-popup-item--show-on-map\">\n\t\t\t\t\t${Loc.getMessage('LOCATION_WIDGET_SHOW_ON_MAP')}\n\t\t\t\t</span>\n\t\t`;\n\n\t\telement.addEventListener('click', this.#getShowOnMapHandler(location));\n\n\t\treturn element;\n\t}\n\n\t#createLeftBottomMenuNode(text: string): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t\t<span>\n\t\t\t\t\t<span class=\"menu-popup-item-icon\"></span>\n\t\t\t\t\t<span class=\"menu-popup-item-text\">${text}</span>\n\t\t\t\t</span>\n\t\t`;\n\t}\n\n\t#showMenu(leftBottomText: string, location: ?Location): void\n\t{\n\t\t/* Menu destroys popup after the closing, so we need to refresh it every time, we show it */\n\t\tthis.#prompt.getMenu().setBottomRightItemNode(\n\t\t\tthis.#createRightBottomMenuNode(location)\n\t\t);\n\t\tthis.#prompt.getMenu().setBottomLeftItemNode(\n\t\t\tthis.#createLeftBottomMenuNode(leftBottomText)\n\t\t);\n\t\tthis.#prompt.getMenu().show();\n\t}\n\n\t#onInputFocusOut(e: Event)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tthis.#state === State.DATA_INPUTTING\n\t\t\t&& !(\n\t\t\t\te.relatedTarget\n\t\t\t\t&& (e.relatedTarget.getAttribute('data-role') === 'location-widget-menu-item')\n\t\t\t)\n\t\t) {\n\t\t\tthis.#setState(State.DATA_SUPPOSED);\n\n\t\t\tlet isChanged = false;\n\t\t\tif (this.#addressString) {\n\t\t\t\tif (\n\t\t\t\t\t!this.#address\n\t\t\t\t\t|| !this.#addressString.hasPureAddressString()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.#address = this.#convertStringToAddress(\n\t\t\t\t\t\tthis.#addressString.value\n\t\t\t\t\t);\n\t\t\t\t\tisChanged = true;\n\t\t\t\t}\n\t\t\t\t// this.#addressString === null until autocompete'll be rendered\n\t\t\t\telse if (this.#addressString.customTail !== '')\n\t\t\t\t{\n\t\t\t\t\tconst currentValue = this.#address.getFieldValue(this.#addressFormat.fieldForUnRecognized);\n\t\t\t\t\tconst newValue = currentValue\n\t\t\t\t\t\t? currentValue + this.#addressString.customTail\n\t\t\t\t\t\t: this.#addressString.customTail\n\t\t\t\t\t;\n\t\t\t\t\tthis.#address.setFieldValue(\n\t\t\t\t\t\tthis.#addressFormat.fieldForUnRecognized,\n\t\t\t\t\t\tnewValue\n\t\t\t\t\t);\n\t\t\t\t\tisChanged = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isChanged)\n\t\t\t{\n\t\t\t\tthis.#addressString.setValueFromAddress(this.#address);\n\t\t\t\tthis.#onAddressChangedEventEmit([], {storeAsLastAddress: false});\n\t\t\t}\n\t\t}\n\n\t\t// Let's prevent other onInputFocusOut handlers.\n\t\te.stopImmediatePropagation();\n\t}\n\n\t#onInputFocus()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#address)\n\t\t{\n\t\t\tconst lastAddress = Storage.getInstance().lastAddress;\n\n\t\t\tif (\n\t\t\t\tlastAddress\n\t\t\t\t&& lastAddress.fieldCollection.isFieldExists(AddressType.LOCALITY)\n\t\t\t\t&& !this.#wasCleared\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst fieldCollection = {};\n\n\t\t\t\tfieldCollection[AddressType.LOCALITY] = lastAddress.fieldCollection.getFieldValue(\n\t\t\t\t\tAddressType.LOCALITY\n\t\t\t\t);\n\t\t\t\tif (lastAddress.fieldCollection.isFieldExists(AddressType.COUNTRY))\n\t\t\t\t{\n\t\t\t\t\tfieldCollection[AddressType.COUNTRY] = lastAddress.fieldCollection.getFieldValue(AddressType.COUNTRY);\n\t\t\t\t}\n\t\t\t\tif (lastAddress.fieldCollection.isFieldExists(AddressType.ADM_LEVEL_1))\n\t\t\t\t{\n\t\t\t\t\tfieldCollection[AddressType.ADM_LEVEL_1] = lastAddress.fieldCollection.getFieldValue(AddressType.ADM_LEVEL_1);\n\t\t\t\t}\n\n\t\t\t\tif (['RU', 'RU_2'].includes(this.#addressFormat.code))\n\t\t\t\t{\n\t\t\t\t\tfieldCollection[AddressType.ADDRESS_LINE_2] = ', ';\n\t\t\t\t}\n\n\t\t\t\tthis.#address = new Address({\n\t\t\t\t\tlanguageId: lastAddress.languageId,\n\t\t\t\t\tfieldCollection: fieldCollection,\n\t\t\t\t});\n\t\t\t\tthis.#addressString.setValueFromAddress(this.#address);\n\t\t\t\tthis.#setState(State.DATA_SUPPOSED);\n\t\t\t\tthis.#onAddressChangedEventEmit(\n\t\t\t\t\t[],\n\t\t\t\t\t{storeAsLastAddress: false}\n\t\t\t\t);\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tBX.setCaretPosition(this.#inputNode, this.#inputNode.value.length);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.#address\n\t\t\t\t&& (!this.#address.location || !this.#address.location.hasExternalRelation())\n\t\t\t\t&& this.#addressString.value.length > 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.showPrompt(this.#addressString.value);\n\t\t\t}\n\t\t}\n\t}\n\n\t#makeAutocompleteServiceParams(): AutocompleteServiceParams\n\t{\n\t\tconst result: AutocompleteServiceParams = {};\n\n\t\t//result.biasPoint = this.#userLocationPoint;\n\t\tif (this.#address && this.#address.latitude && this.#address.longitude)\n\t\t{\n\t\t\tresult.biasPoint = new Point(\n\t\t\t\tthis.#address.latitude,\n\t\t\t\tthis.#address.longitude\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * @param address\n\t */\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\n\t\tif (this.#addressString) // already rendered\n\t\t{\n\t\t\tthis.#addressString.setValueFromAddress(this.#address);\n\t\t}\n\n\t\tif (!address)\n\t\t{\n\t\t\tthis.#wasCleared = true;\n\t\t}\n\t}\n\n\t/**\n\t * @returns {Address}\n\t */\n\tget address(): ?Address\n\t{\n\t\treturn this.#address;\n\t}\n\n\t/**\n\t * Close menu on mouse click outside\n\t * @param {MouseEvent} event\n\t */\n\t#onDocumentClick(event: MouseEvent)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.target === this.#inputNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#prompt.isShown())\n\t\t{\n\t\t\tthis.#prompt.close();\n\t\t}\n\t}\n\n\t/**\n\t * Subscribe on changed event\n\t * @param {Function} listener\n\t */\n\tonAddressChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onAddressChangedEvent, listener);\n\t}\n\n\t/**\n\t * Subscribe on loading event\n\t * @param {Function} listener\n\t */\n\tonStateChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onStateChangedEvent, listener);\n\t}\n\n\t/**\n\t * @param {Function} listener\n\t */\n\tonSearchStartedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onSearchStartedEvent, listener);\n\t}\n\n\t/**\n\t * @param {Function} listener\n\t */\n\tonSearchCompletedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onSearchCompletedEvent, listener);\n\t}\n\n\t/**\n\t * @param {Function} listener\n\t */\n\tonShowOnMapClickedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onShowOnMapClickedEvent, listener);\n\t}\n\n\t/**\n\t * Is called when autocompleteService returned location list\n\t * @param {array} locationsList\n\t * @param {object} params\n\t */\n\t#onPromptsReceived(locationsList: array<Location>, params: Object): void\n\t{\n\t\tif (Array.isArray(locationsList) && locationsList.length > 0)\n\t\t{\n\t\t\tif (\n\t\t\t\tlocationsList.length === 1\n\t\t\t\t&& this.#address\n\t\t\t\t&& this.#address.location\n\t\t\t\t&& this.#address.location.externalId\n\t\t\t\t&& this.#address.location.externalId === locationsList[0].externalId\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.closePrompt();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#prompt.setMenuItems(locationsList, this.#searchPhrase.requested, this.address);\n\t\t\tthis.#showMenu(Loc.getMessage('LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP'), locationsList[0]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#prompt.getMenu().clearItems();\n\n\t\t\tthis.#prompt.getMenu().addMenuItem(\n\t\t\t\t{\n\t\t\t\t\tid: 'notFound',\n\t\t\t\t\thtml: `<span>${Loc.getMessage('LOCATION_WIDGET_PROMPT_ADDRESS_NOT_FOUND')}</span>`,\n\t\t\t\t\t// eslint-disable-next-line no-unused-vars\n\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.#showMenu(Loc.getMessage('LOCATION_WIDGET_CHECK_ADDRESS_OR_SHOW_ON_MAP'), null);\n\t\t}\n\t}\n\n\t#getShowOnMapHandler(location: ?Location)\n\t{\n\t\treturn () => {\n\t\t\tif (location)\n\t\t\t{\n\t\t\t\tthis.#fulfillSelection(location);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Otherwise this click will close just opened map popup.\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.emit(Autocomplete.#onShowOnMapClickedEvent);\n\t\t\t}, 1);\n\t\t};\n\t}\n\n\tstatic #splitPhrase(phrase: string): Object\n\t{\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tphrase = phrase.trim();\n\n\t\tif (phrase.length <= 0)\n\t\t{\n\t\t\treturn ['', ''];\n\t\t}\n\n\t\tconst tailPosition = phrase.lastIndexOf(' ');\n\n\t\tif (tailPosition <= 0)\n\t\t{\n\t\t\treturn ['', ''];\n\t\t}\n\n\t\treturn [phrase.slice(0, tailPosition), phrase.slice(tailPosition + 1)];\n\t}\n\n\t/**\n\t * Is called when location from menu have chosen\n\t * @param event\n\t */\n\t#onPromptItemSelected(event: BaseEvent): void\n\t{\n\t\tif (event.data.location)\n\t\t{\n\t\t\tthis.#fulfillSelection(event.data.location);\n\t\t}\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Autocomplete.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\t/**\n\t * Fulfill selected location\n\t * @param {Location} location\n\t * @returns {Promise}\n\t */\n\t#fulfillSelection(location: ?Location): void\n\t{\n\t\tlet result;\n\t\tthis.#setState(State.DATA_SELECTED);\n\t\tif (location)\n\t\t{\n\t\t\tif (location.hasExternalRelation() && this.#sourceCode === location.sourceCode)\n\t\t\t{\n\t\t\t\tresult = this.#getLocationDetails(location)\n\t\t\t\t\t.then(\n\t\t\t\t\t\t(detailedLocation: ?Location) => {\n\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tlocation.address\n\t\t\t\t\t\t\t\t&& location.address.getFieldValue(AddressType.ADDRESS_LINE_2)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet addressLine2 = '';\n\t\t\t\t\t\t\t\tif (detailedLocation.address.getFieldValue(AddressType.ADDRESS_LINE_2))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\taddressLine2 = detailedLocation.address.getFieldValue(AddressType.ADDRESS_LINE_2);\n\t\t\t\t\t\t\t\t\taddressLine2 += ', ';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\taddressLine2 += location.address.getFieldValue(AddressType.ADDRESS_LINE_2);\n\n\t\t\t\t\t\t\t\tdetailedLocation.address.setFieldValue(AddressType.ADDRESS_LINE_2, addressLine2);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.#createOnLocationSelectTimer(detailedLocation, 0);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t(response) => ErrorPublisher.getInstance().notify(response.errors)\n\t\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = new Promise((resolve) => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.#createOnLocationSelectTimer(location, 0);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}, 0);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = new Promise((resolve) => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.#createOnLocationSelectTimer(null, 0);\n\t\t\t\t\tresolve();\n\t\t\t\t}, 0);\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#onAddressChangedEventEmit(excludeSetAddressFeatures: Array = [], options: Object = {})\n\t{\n\t\tthis.emit(\n\t\t\tAutocomplete.#onAddressChangedEvent,\n\t\t\t{\n\t\t\t\taddress: this.#address,\n\t\t\t\texcludeSetAddressFeatures,\n\t\t\t\toptions: options,\n\t\t\t}\n\t\t);\n\t}\n\n\t/**\n\t * obtain location details\n\t * @param {Location} location\n\t * @returns {*}\n\t */\n\t#getLocationDetails(location: Location): Promise\n\t{\n\t\tthis.#setState(State.DATA_LOADING);\n\n\t\treturn this.#locationRepository.findByExternalId(\n\t\t\tlocation.externalId,\n\t\t\tlocation.sourceCode,\n\t\t\tlocation.languageId\n\t\t)\n\t\t\t.then((detailedLocation: ?Location) => {\n\t\t\t\t\tthis.#setState(State.DATA_LOADED);\n\n\t\t\t\t\tlet result;\n\t\t\t\t\t/*\n\t\t\t\t\t * Nominatim could return a bit different location without the coordinates.\n\t\t\t\t\t * For example N752206814\n\t\t\t\t\t */\n\t\t\t\t\tif (\n\t\t\t\t\t\tdetailedLocation.latitude !== '0'\n\t\t\t\t\t\t&& detailedLocation.longitude !== '0'\n\t\t\t\t\t\t&& detailedLocation !== ''\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult = detailedLocation;\n\t\t\t\t\t\tresult.name = location.name;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult = location;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\t(response) => {\n\t\t\t\t\tErrorPublisher.getInstance().notify(response.errors);\n\t\t\t\t}\n\t\t\t);\n\t}\n\n\t#convertStringToAddress(addressString: string)\n\t{\n\t\tconst result = new Address({\n\t\t\tlanguageId: this.#languageId\n\t\t});\n\n\t\tresult.setFieldValue(this.#addressFormat.fieldForUnRecognized, addressString);\n\t\treturn result;\n\t}\n\n\t/**\n\t * Is called when location was selected and the location details were obtained\n\t * @param {Location} location\n\t */\n\t#onLocationSelect(location: ?Location): void\n\t{\n\t\tthis.#address = location ? location.toAddress() : null;\n\t\tthis.#addressString.setValueFromAddress(this.#address);\n\t\tthis.#onAddressChangedEventEmit();\n\t}\n\n\t#onInputKeyDown(e: KeyboardEvent): void\n\t{\n\t\tif (\n\t\t\t!(\n\t\t\t\tthis.#inputNode\n\t\t\t\t&& this.#inputNode.selectionStart === 0\n\t\t\t\t&& this.#inputNode.selectionEnd === this.#inputNode.value.length\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t(\n\t\t\t\te.code === 'Backspace'\n\t\t\t\t|| e.code === 'Delete'\n\t\t\t\t|| (e.code === 'KeyV' && ((e.ctrlKey || e.metaKey)))\n\t\t\t\t|| (e.code === 'KeyX' && ((e.ctrlKey || e.metaKey)))\n\t\t\t\t|| (e.code === 'Insert' && e.shiftKey)\n\t\t\t)\n\t\t\t|| (\n\t\t\t\t!(e.ctrlKey || e.metaKey)\n\t\t\t\t&& [...e.key].length === 1\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tthis.address = null;\n\t\t\tthis.#onAddressChangedEventEmit();\n\t\t}\n\t}\n\n\t#onInputKeyUp(e: KeyboardEvent): void\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tthis.#state !== State.DATA_INPUTTING\n\t\t\t&& this.#addressString.isChanged()\n\t\t)\n\t\t{\n\t\t\tthis.#setState(State.DATA_INPUTTING);\n\t\t}\n\n\t\tif (this.#prompt.isShown())\n\t\t{\n\t\t\tlet location;\n\t\t\tconst onLocationSelectTimeout = 700;\n\n\t\t\tswitch (e.code)\n\t\t\t{\n\t\t\t\tcase 'NumpadEnter':\n\t\t\t\tcase 'Enter':\n\t\t\t\t\tif (this.#prompt.isItemChosen())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#fulfillSelection(this.#prompt.getChosenItem())\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t(error) => BX.debug(error)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'Tab':\n\t\t\t\tcase 'Escape':\n\t\t\t\t\tthis.#setState(State.DATA_SUPPOSED);\n\t\t\t\t\tthis.#onAddressChangedEventEmit();\n\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'ArrowUp':\n\t\t\t\t\tlocation = this.#prompt.choosePrevItem();\n\n\t\t\t\t\tif (location && location.address)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#createOnLocationSelectTimer(location, onLocationSelectTimeout);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'ArrowDown':\n\t\t\t\t\tlocation = this.#prompt.chooseNextItem();\n\n\t\t\t\t\tif (location && location.address)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#createOnLocationSelectTimer(location, onLocationSelectTimeout);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#addressString.isChanged())\n\t\t{\n\t\t\tthis.#addressString.actualize();\n\t\t\tthis.showPrompt(this.#addressString.value);\n\t\t}\n\n\t\tif (this.#addressString.value.length === 0)\n\t\t{\n\t\t\tthis.#showPresetLocations();\n\t\t}\n\t}\n\n\t#onInputPaste(): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (\n\t\t\t\tthis.#state !== State.DATA_INPUTTING\n\t\t\t\t&& this.#addressString.isChanged()\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.#setState(State.DATA_INPUTTING);\n\t\t\t}\n\n\t\t\tif (this.#addressString.isChanged())\n\t\t\t{\n\t\t\t\tthis.#addressString.actualize();\n\t\t\t\tthis.showPrompt(this.#addressString.value);\n\t\t\t}\n\t\t}, 0);\n\t}\n\n\t#createOnLocationSelectTimer(location: Location, timeout: Number): void\n\t{\n\t\tif (this.#onLocationSelectTimerId !== null)\n\t\t{\n\t\t\tclearTimeout(this.#onLocationSelectTimerId);\n\t\t}\n\n\t\tthis.#onLocationSelectTimerId = setTimeout(() => {\n\t\t\t\tthis.#onLocationSelect(location);\n\t\t\t},\n\t\t\ttimeout\n\t\t);\n\t}\n\n\t/**\n\t * @param {string} searchPhrase\n\t */\n\tshowPrompt(searchPhrase: string): void\n\t{\n\t\tthis.#searchPhrase.requested = searchPhrase;\n\t\tthis.#searchPhrase.current = searchPhrase;\n\t\tthis.#searchPhrase.dropped = '';\n\t\tthis.#showPromptInner(searchPhrase);\n\t}\n\n\tclosePrompt(): void\n\t{\n\t\tif (this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.close();\n\t\t}\n\t}\n\n\tisPromptShown(): boolean\n\t{\n\t\tif (this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.isShown();\n\t\t}\n\t}\n\n\t#showPromptInner(searchPhrase: string): void\n\t{\n\t\tif (searchPhrase.length <= 3)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#timerId !== null)\n\t\t{\n\t\t\tclearTimeout(this.#timerId);\n\t\t}\n\n\t\tthis.#timerId = this.#createTimer(searchPhrase);\n\t}\n\n\t/**\n\t * Wait for further user input for some time\n\t * @param {string} searchPhrase\n\t * @returns {number}\n\t */\n\t#createTimer(searchPhrase: string): number\n\t{\n\t\treturn setTimeout(() => {\n\t\t\t\t// to avoid multiple parallel requests, server responses are too slow.\n\t\t\t\tif (this.#isAutocompleteRequestStarted)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.#timerId);\n\t\t\t\t\tthis.#timerId = this.#createTimer(searchPhrase);\n\t\t\t\t\tthis.#isNextAutocompleteRequestWaiting = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.#isNextAutocompleteRequestWaiting = false;\n\n\t\t\t\tthis.emit(Autocomplete.#onSearchStartedEvent);\n\t\t\t\tthis.#isAutocompleteRequestStarted = true;\n\t\t\t\tconst params = this.#makeAutocompleteServiceParams();\n\n\t\t\t\tthis.#autocompleteService.autocomplete(searchPhrase, params)\n\t\t\t\t\t.then(\n\t\t\t\t\t\t(locationsList: Array<Location>) => {\n\t\t\t\t\t\t\tthis.#timerId = null;\n\t\t\t\t\t\t\tif (!this.#isNextAutocompleteRequestWaiting)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#onPromptsReceived(locationsList, params);\n\t\t\t\t\t\t\t\tthis.emit(Autocomplete.#onSearchCompletedEvent);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.#isAutocompleteRequestStarted = false;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t(error) => {\n\t\t\t\t\t\t\tif (!this.#isNextAutocompleteRequestWaiting)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.emit(Autocomplete.#onSearchCompletedEvent);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.#isAutocompleteRequestStarted = false;\n\t\t\t\t\t\t\tBX.debug(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t},\n\t\t\t300\n\t\t);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.unbindAll(this);\n\n\t\tif (this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.destroy();\n\t\t\tthis.#prompt = null;\n\t\t}\n\n\t\tthis.#timerId = null;\n\n\t\tif (this.#inputNode)\n\t\t{\n\t\t\tthis.#inputNode.removeEventListener('keydown', this.#onInputKeyDown);\n\t\t\tthis.#inputNode.removeEventListener('keyup', this.#onInputKeyUp);\n\t\t\tthis.#inputNode.removeEventListener('focus', this.#onInputFocus);\n\t\t\tthis.#inputNode.removeEventListener('focusout', this.#onInputFocusOut);\n\t\t\tthis.#inputNode.removeEventListener('click', this.#onInputClick);\n\t\t\tthis.#inputNode.removeEventListener('paste', this.#onInputPaste);\n\t\t}\n\n\t\tdocument.removeEventListener('click', this.#onDocumentClick);\n\t\tthis.#isDestroyed = true;\n\t}\n}\n","import {Tag} from \"main.core\";\n\nexport default class Photo\n{\n\t#description;\n\t#url;\n\t#link;\n\t#location;\n\t#title;\n\n\tconstructor(props)\n\t{\n\t\tthis.#url = props.url;\n\t\tthis.#link = props.link || '';\n\t\tthis.#description = props.description || '';\n\t\tthis.#location = props.location;\n\t\tthis.#title = props.title || '';\n\t}\n\n\trender()\n\t{\n\t\tlet description = '';\n\n\t\tif(this.#description)\n\t\t{\n\t\t\t//todo: sanitize\n\t\t\tdescription = Tag.render`<span class=\"location-map-item-description\">${this.#description}</span>`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"location-map-photo-item-block\">\n\t\t\t\t<span class=\"location-map-photo-item-block-image-block-inner\">\n\t\t\t\t\t${description}\n\t\t\t\t\t<span \n\t\t\t\t\t\tdata-viewer data-viewer-type=\"image\" \n\t\t\t\t\t\tdata-src=\"${this.#link}\" \n\t\t\t\t\t\tdata-title=\"${this.#title}\"\n\t\t\t\t\t\tclass=\"location-map-item-photo-image\" \n\t\t\t\t\t\tdata-viewer-group-by=\"${this.#location.externalId}\"\n\t\t\t\t\t\tstyle=\"background-image: url(${this.#url});\">\t\t\t\t\t\t\t\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\t}\n}","import {Tag, Dom} from \"main.core\";\nimport Photo from \"./photo\";\n\nexport default class Gallery\n{\n\t#photos = [];\n\t#container = null;\n\t#photosContainer = null;\n\t#thumbnailHeight;\n\t#thumbnailWidth;\n\t#photoService;\n\t#maxPhotoCount;\n\t#location;\n\n\tconstructor(props)\n\t{\n\t\tthis.#thumbnailHeight = props.thumbnailHeight;\n\t\tthis.#thumbnailWidth = props.thumbnailWidth;\n\t\tthis.#maxPhotoCount = props.maxPhotoCount;\n\t\tthis.#photoService = props.photoService;\n\t}\n\n\trefresh()\n\t{\n\t\tif(this.#location)\n\t\t{\n\t\t\tthis.#photoService.requestPhotos({\t\t\t\t\n\t\t\t\tlocation: this.#location,\n\t\t\t\tthumbnailHeight: this.#thumbnailHeight,\n\t\t\t\tthumbnailWidth: this.#thumbnailWidth,\n\t\t\t\tmaxPhotoCount: this.#maxPhotoCount\n\t\t\t\t\n\t\t\t})\n\t\t\t.then((photosData) => {\n\t\t\t\tif(Array.isArray(photosData) && photosData.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#setPhotos(photosData);\n\t\t\t\t\tthis.show();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tset location(location: Location)\n\t{\n\t\tthis.#location = location;\n\t\tthis.refresh();\n\t}\n\n\t#setPhotos(photosData)\n\t{\n\t\tif(!this.#location)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet photos = [];\n\n\t\tfor(let photo of photosData)\n\t\t{\n\t\t\tphotos.push(\n\t\t\t\tnew Photo({\n\t\t\t\t\turl: photo.thumbnail.url,\n\t\t\t\t\tlink: photo.url,\n\t\t\t\t\tlocation: this.#location,\n\t\t\t\t\ttitle: this.#location.name + \" ( \" + BX.util.strip_tags(photo.description) + ' )'\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tif(!Array.isArray(photos))\n\t\t{\n\t\t\tBX.debug('Wrong type of photos. Must be array');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#photos = [];\n\n\t\tfor(let photo of photos)\n\t\t{\n\t\t\tthis.#photos.push(photo);\n\t\t}\n\n\t\tif(this.#photos.length > 0 && this.#photosContainer)\n\t\t{\n\t\t\tlet renderedPhotos = this.#photos ? this.#renderPhotos(this.#photos) : '';\n\n\t\t\tthis.#photosContainer.innerHTML = '';\n\n\t\t\tif(renderedPhotos.length > 0)\n\t\t\t{\n\t\t\t\tfor (let photo of renderedPhotos)\n\t\t\t\t{\n\t\t\t\t\tthis.#photosContainer.appendChild(photo);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif(this.#container)\n\t\t{\n\t\t\tthis.#container.style.display = 'none';\n\t\t}\n\t}\n\n\tisHidden()\n\t{\n\t\treturn !this.#container || this.#container.clientWidth <= 0;\n\t}\n\n\tshow()\n\t{\n\t\tif(this.#container)\n\t\t{\n\t\t\tthis.#container.style.display = 'block';\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tthis.#photosContainer = Tag.render`\t\t\t\t\t\n\t\t\t\t<div class=\"location-map-photo-inner\">\t\t\t\t\t\n\t\t\t\t</div>`;\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"location-map-photo-container\">\n\t\t\t\t${this.#photosContainer}\n\t\t\t</div>`;\n\n\t\treturn this.#container;\n\t}\n\n\t#renderPhotos(photos)\n\t{\n\t\tlet result = [];\n\n\t\tfor (let photo of photos)\n\t\t{\n\t\t\tresult.push(photo.render());\n\t\t}\n\n\t\treturn result;\n\t}\n}","import {Tag, Event, Dom, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'ui.forms';\nimport {ControlMode} from 'location.core';\nimport State from '../state';\n\nexport default class Field extends EventEmitter\n{\n\tstatic #onValueChangedEvent = 'onValueChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\n\t#title;\n\t#value;\n\t#type;\n\t#sort;\n\t#mode;\n\t#input;\n\t#viewContainer;\n\t#container = null;\n\t#state = State.INITIAL;\n\n\tconstructor(props: FieldConstructorProps)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.Field');\n\n\t\tthis.#title = props.title;\n\t\tthis.#type = props.type;\n\t\tthis.#sort = props.sort;\n\t}\n\n\tget container()\n\t{\n\t\treturn this.#container;\n\t}\n\n\tget state()\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Field.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\trender(props: FieldRenderProps): void\n\t{\n\t\tthis.#value = typeof props.value === 'string' ? props.value : '';\n\n\t\tif(!ControlMode.isValid(props.mode))\n\t\t{\n\t\t\tBX.debug('props.mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block ui-entity-editor-field-text\">\n\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t<label class=\"ui-entity-editor-block-title-text\">${this.#title}:</label>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>`;\n\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#renderEditMode(this.#container)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#renderViewMode(this.#container)\n\t\t}\n\n\t\treturn this.#container;\n\t}\n\n\t#renderEditMode(container: Element)\n\t{\n\t\tthis.#input = Tag.render`<input type=\"text\" class=\"ui-ctl-element\" value=\"${Text.encode(this.#value)}\">`;\n\t\tthis.#viewContainer = null;\n\n\t\tEvent.bind(this.#input, 'focus', (e) => {\n\t\t\tthis.#setState(State.DATA_INPUTTING);\n\t\t});\n\n\t\tEvent.bind(this.#input, 'focusout', (e) => {\n\t\t\tthis.#setState(State.DATA_SELECTED);\n\t\t});\n\n\t\tEvent.bind(this.#input, 'change', (e) => {\n\t\t\tthis.#setState(State.DATA_SELECTED);\n\t\t\tthis.#value = this.#input.value;\n\t\t\tthis.emit(Field.#onValueChangedEvent, {value: this});\n\t\t});\n\n\t\tcontainer.appendChild(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t${this.#input}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t);\n\t}\n\n\t#renderViewMode(container: Element)\n\t{\n\t\tthis.#input = null;\n\n\t\tthis.#viewContainer = Tag.render`\n\t\t\t<div class=\"ui-title-6\">\n\t\t\t\t${Text.encode(this.#value)}\n\t\t\t</div>`;\n\n\t\tcontainer.appendChild(this.#viewContainer);\n\t}\n\n\t#refreshLayout()\n\t{\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#input.value = this.#value;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#viewContainer.innerHTML = Text.encode(this.#value);\n\t\t}\n\t}\n\n\tset type(type: number)\n\t{\n\t\tthis.#type = type;\n\t}\n\n\tget type(): number\n\t{\n\t\treturn this.#type;\n\t}\n\n\tset sort(sort: number)\n\t{\n\t\tthis.#sort = sort;\n\t}\n\n\tget sort(): number\n\t{\n\t\treturn this.#sort;\n\t}\n\n\tset value(value: string)\n\t{\n\t\tthis.#value = typeof value === 'string' ? value : '';\n\t\tthis.#refreshLayout();\n\t}\n\n\tget value(): string\n\t{\n\t\treturn this.#value;\n\t}\n\n\tsubscribeOnValueChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Field.#onValueChangedEvent, listener);\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Field.#onStateChangedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tDom.remove(this.#container);\n\t\tEvent.unbindAll(this);\n\t\tthis.#container = null;\n\t}\n}\n\ntype FieldConstructorProps = {\n\ttitle: string\n}\n\ntype FieldRenderProps = {\n\tvalue: string,\n\tmode: string //ControlMode\n}","import {Event, Dom, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Format, Address, ControlMode} from 'location.core';\nimport Field from './field';\n\nexport type FieldsConstructorType = {\n\taddressFormat: Format\n}\n\nexport type FieldsRenderType = {\n\taddress: Address,\n\tmode: string, // ControlMode\n\tcontainer: Element\n}\n\nexport default class Fields extends EventEmitter\n{\n\tstatic #onAddressChangedEvent = 'onAddressChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\n\t#address;\n\t#addressFormat;\n\t#mode;\n\t#fields = [];\n\t#languageId;\n\t#container;\n\t#state;\n\n\tconstructor(props: FieldsConstructorType)\n\t{\n\t\tsuper(props);\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Fields');\n\n\t\tif(!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#initFields();\n\t}\n\n\t#initFields()\n\t{\n\t\tfor (let type in this.#addressFormat.fieldCollection.fields)\n\t\t{\n\t\t\tif(!this.#addressFormat.fieldCollection.fields.hasOwnProperty(type))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet formatField = this.#addressFormat.fieldCollection.fields[type];\n\n\t\t\tlet field = new Field({\n\t\t\t\ttitle: formatField.name,\n\t\t\t\ttype: formatField.type,\n\t\t\t\tsort: formatField.sort\n\t\t\t});\n\n\t\t\tfield.subscribeOnValueChangedEvent((event) => {\n\t\t\t\tthis.#onFieldChanged(field);\n\t\t\t});\n\n\t\t\tfield.subscribeOnStateChangedEvent((event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#setState(data.state);\n\t\t\t});\n\n\t\t\tthis.#fields.push(field)\n\t\t}\n\n\t\tthis.#fields.sort((a, b) => {\n\t\t\treturn a.sort - b.sort;\n\t\t});\n\t}\n\n\trender(props: FieldsRenderType): void\n\t{\n\t\tif(props.address && !(props.address instanceof Address))\n\t\t{\n\t\t\tBX.debug('props.address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = props.address;\n\n\t\tif(!ControlMode.isValid(props.mode))\n\t\t{\n\t\t\tBX.debug('props.mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tif(!Type.isDomNode(props.container))\n\t\t{\n\t\t\tBX.debug('props.container must be dom node');\n\t\t}\n\n\t\tthis.#container = props.container;\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tlet value = this.#address ? this.#address.getFieldValue(field.type) : '';\n\n\t\t\tif(this.#mode === ControlMode.view && !value)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet item = field.render({\n\t\t\t\tvalue: value,\n\t\t\t\tmode: this.#mode\n\t\t\t});\n\n\t\t\tthis.#container.appendChild(item);\n\t\t}\n\t}\n\n\t#onFieldChanged(field: Field)\n\t{\n\t\tif(!this.#address)\n\t\t{\n\t\t\tthis.#address = new Address({\n\t\t\t\tlanguageId: this.#languageId\n\t\t\t});\n\t\t}\n\n\t\tthis.#address.setFieldValue(field.type, field.value);\n\n\t\tthis.emit(Fields.#onAddressChangedEvent, {\n\t\t\taddress: this.#address,\n\t\t\tchangedField: field\n\t\t});\n\t}\n\n\tset address(address: ?Address)\n\t{\n\t\tif(address && !(address instanceof Address))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = address;\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tfield.value = this.#address ? this.#address.getFieldValue(field.type) : '';\n\t\t}\n\t}\n\n\tsubscribeOnAddressChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Fields.#onAddressChangedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tEvent.unbindAll(this);\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tfield.destroy();\n\t\t}\n\n\t\tDom.clean(this.#container);\n\t}\n\n\tget state()\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Fields.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Fields.#onStateChangedEvent, listener);\n\t}\n}","import {Type} from 'main.core';\nimport {Address} from 'location.core';\nimport MapPopup from '../../mappopup/mappopup';\nimport BaseFeature from './basefeature';\nimport State from '../../state';\n\n/**\n * Complex address widget\n */\nexport default class MapFeature extends BaseFeature\n{\n\t#map = null;\n\n\t#mapBindElement = null;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tif(!(props.map instanceof MapPopup))\n\t\t{\n\t\t\tBX.debug('props.map must be instance of MapPopup');\n\t\t}\n\n\t\tthis.#map = props.map;\n\n\t\tthis.#map.onChangedEventSubscribe(\n\t\t\t(event) => {\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.setAddressByFeature(data.address, this);\n\t\t\t});\n\t}\n\n\tshowMap(useUserLocation: boolean = false): void\n\t{\n\t\tif(!this.#map.isShown())\n\t\t{\n\t\t\tthis.#map.show(useUserLocation);\n\t\t}\n\t}\n\n\tcloseMap(): void\n\t{\n\t\tif(this.#map.isShown())\n\t\t{\n\t\t\tthis.#map.close();\n\t\t}\n\n\t\tthis.#map.bindelement = this.#mapBindElement;\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.closeMap();\n\t}\n\n\t/**\n\t * Render Widget\n\t * @param {Object} props\n\t */\n\trender(props: {}): void\n\t{\n\t\tif(!Type.isDomNode(props.mapBindElement))\n\t\t{\n\t\t\tBX.debug('props.mapBindElement  must be instance of Element');\n\t\t}\n\n\t\tthis.#mapBindElement = props.mapBindElement;\n\n\t\tthis.#map.render({\n\t\t\tbindElement: props.mapBindElement,\n\t\t\taddress: this.#addressWidget.address,\n\t\t\tmode: this.#addressWidget.mode,\n\t\t});\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tif(this.addressWidget.state === State.DATA_INPUTTING)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#map.address = address;\n\t}\n\n\tsetAddressWidget(addressWidget): void\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\t\tthis.#map.mode = mode;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#map.destroy();\n\t\tthis.#map = null;\n\t}\n\n\tget map(): MapPopup\n\t{\n\t\treturn this.#map;\n\t}\n\n\tget addressWidget(): Address\n\t{\n\t\treturn this.#addressWidget;\n\t}\n\n\tget mapBindElement(): Element\n\t{\n\t\treturn this.#mapBindElement;\n\t}\n}","import {Address, ControlMode} from 'location.core';\nimport BaseFeature from './basefeature';\nimport Autocomplete from '../../autocomplete/autocomplete';\n\n/**\n * Complex address widget\n */\nexport default class AutocompleteFeature extends BaseFeature\n{\n\tstatic searchStartedEvent = 'searchStarted';\n\tstatic searchCompletedEvent = 'searchCompleted';\n\tstatic showOnMapClickedEvent = 'showOnMapClicked';\n\n\t#autocomplete;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tif(!(props.autocomplete instanceof Autocomplete))\n\t\t{\n\t\t\tBX.debug('props.autocomplete  must be instance of Autocomplete');\n\t\t}\n\n\t\tthis.#autocomplete = props.autocomplete;\n\n\t\tthis.#autocomplete.onAddressChangedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\n\t\t\t\tthis.#addressWidget.setAddressByFeature(\n\t\t\t\t\tdata.address,\n\t\t\t\t\tthis,\n\t\t\t\t\tdata.excludeSetAddressFeatures,\n\t\t\t\t\tdata.options\n\t\t\t\t);\n\t\t\t});\n\n\t\tthis.#autocomplete.onStateChangedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.setStateByFeature(data.state);\n\t\t\t});\n\n\t\tthis.#autocomplete.onSearchStartedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.emitFeatureEvent(\n\t\t\t\t\t{\n\t\t\t\t\t\tfeature: this,\n\t\t\t\t\t\teventCode: AutocompleteFeature.searchStartedEvent,\n\t\t\t\t\t\tpayload: data\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\n\t\tthis.#autocomplete.onSearchCompletedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.emitFeatureEvent(\n\t\t\t\t\t{\n\t\t\t\t\t\tfeature: this,\n\t\t\t\t\t\teventCode: AutocompleteFeature.searchCompletedEvent,\n\t\t\t\t\t\tpayload: data\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\n\t\tthis.#autocomplete.onShowOnMapClickedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.emitFeatureEvent(\n\t\t\t\t\t{\n\t\t\t\t\t\tfeature: this,\n\t\t\t\t\t\teventCode: AutocompleteFeature.showOnMapClickedEvent,\n\t\t\t\t\t\tpayload: data\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.#autocomplete.closePrompt();\n\t}\n\n\trender(props): void\n\t{\n\t\tif(this.#addressWidget.mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#autocomplete.render({\n\t\t\t\tinputNode: this.#addressWidget.inputNode,\n\t\t\t\tmenuNode: props.autocompleteMenuElement,\n\t\t\t\taddress: this.#addressWidget.address,\n\t\t\t\tmode: this.#addressWidget.mode,\n\t\t\t});\n\t\t}\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tthis.#autocomplete.address = address;\n\t}\n\n\tsetAddressWidget(addressWidget)\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#autocomplete.destroy();\n\t\tthis.#autocomplete = null;\n\t}\n}","import {Type} from 'main.core';\nimport {Address, ControlMode} from 'location.core';\nimport BaseFeature from './basefeature';\nimport Fields from '../../fields/fields';\n\n/**\n * Fields widget feature\n */\nexport default class FieldsFeature extends BaseFeature\n{\n\t#fields;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tif(!(props.fields instanceof Fields))\n\t\t{\n\t\t\tBX.debug('props.Fields must be instance of Fields');\n\t\t}\n\n\t\tthis.#fields = props.fields;\n\n\t\tthis.#fields.subscribeOnAddressChangedEvent(\n\t\t\t(event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#addressWidget.setAddressByFeature(data.address, this);\n\t\t\t});\n\n\t\tthis.#fields.subscribeOnStateChangedEvent(\n\t\t\t(event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#addressWidget.setStateByFeature(data.state);\n\t\t\t});\n\t}\n\n\trender(props): void\n\t{\n\t\tif(this.#addressWidget.mode === ControlMode.edit)\n\t\t{\n\t\t\tif (!Type.isDomNode(props.fieldsContainer))\n\t\t\t{\n\t\t\t\tBX.debug('props.fieldsContainer  must be instance of Element');\n\t\t\t}\n\n\t\t\tthis.#fields.render({\n\t\t\t\taddress: this.#addressWidget.address,\n\t\t\t\tmode: this.#addressWidget.mode,\n\t\t\t\tcontainer: props.fieldsContainer\n\t\t\t});\n\t\t}\n\t}\n\n\tsetAddressWidget(addressWidget)\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tsetAddress(address: Address): void\n\t{\n\t\tthis.#fields.address = address;\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\t\tthis.#fields.mode = mode;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#fields.destroy();\n\t\tthis.#fields = null;\n\t}\n}","import {Address, ControlMode} from 'location.core';\nimport State from '../../state';\nimport MapFeature from './mapfeature';\n\n/**\n * Map feature for the address widget with auto map opening / closing behavior\n */\nexport default class MapFeatureAuto extends MapFeature\n{\n\t#showMapTimerId = null;\n\t#showMapDelay = 700;\n\t#closeMapTimerId = null;\n\t#closeMapDelay = 800;\n\n\t#isDestroyed = false;\n\n\t/**\n\t * Render Widget\n\t * @param {AddressRenderProps} props\n\t */\n\trender(props: AddressRenderProps): void\n\t{\n\t\tsuper.render(props);\n\n\t\tthis.addressWidget.controlWrapper.addEventListener('click', this.#onControlWrapperClick.bind(this));\n\t\tthis.addressWidget.controlWrapper.addEventListener('mouseover', this.#processOnMouseOver.bind(this));\n\t\tthis.addressWidget.controlWrapper.addEventListener('mouseout', this.#processOnMouseOut.bind(this));\n\n\t\tdocument.addEventListener('click', this.#onDocumentClick.bind(this));\n\n\t\tthis.map.onMouseOverSubscribe(this.#processOnMouseOver.bind(this));\n\t\tthis.map.onMouseOutSubscribe(this.#processOnMouseOut.bind(this));\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onControlWrapperClick(event)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.mode === ControlMode.view)\n\t\t{\n\t\t\tif (this.map.isShown())\n\t\t\t{\n\t\t\t\tthis.closeMap();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclearTimeout(this.#showMapTimerId);\n\t\t\t}\n\t\t}\n\t\telse if (this.addressWidget.mode === ControlMode.edit && this._saveResourceStrategy === false)\n\t\t{\n\t\t\tif (this.addressWidget.address && !this.map.isShown() && event.target === this.addressWidget.inputNode)\n\t\t\t{\n\t\t\t\tthis.showMap();\n\t\t\t}\n\t\t}\n\t}\n\n\t#onDocumentClick(event)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.inputNode !== event.target)\n\t\t{\n\t\t\tthis.closeMap();\n\t\t}\n\t}\n\n\t#processOnMouseOver()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.#showMapTimerId);\n\t\tclearTimeout(this.#closeMapTimerId);\n\n\t\tif (this.addressWidget.mode !== ControlMode.view)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.address && !this.map.isShown())\n\t\t{\n\t\t\tthis.#showMapTimerId = setTimeout(() => {\n\t\t\t\t\tthis.showMap();\n\t\t\t\t},\n\t\t\t\tthis.#showMapDelay\n\t\t\t);\n\t\t}\n\t}\n\n\t#processOnMouseOut()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.#showMapTimerId);\n\t\tclearTimeout(this.#closeMapTimerId);\n\n\t\tif (this.addressWidget.mode !== ControlMode.view)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.mode === ControlMode.view && this.map.isShown())\n\t\t{\n\t\t\tthis.#closeMapTimerId = setTimeout(() => {\n\t\t\t\t\tthis.closeMap();\n\t\t\t\t},\n\t\t\t\tthis.#closeMapDelay\n\t\t\t);\n\t\t}\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tif (!address)\n\t\t{\n\t\t\tthis.closeMap();\n\t\t}\n\n\t\tthis.map.address = address;\n\n\t\tif (address && this.addressWidget.state !== State.DATA_SUPPOSED)\n\t\t{\n\t\t\tthis.showMap();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdocument.removeEventListener('click', this.#onDocumentClick);\n\n\t\tif (this.addressWidget.controlWrapper)\n\t\t{\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('click', this.#onControlWrapperClick);\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('mouseover', this.#processOnMouseOver);\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('mouseout', this.#processOnMouseOut);\n\t\t}\n\n\t\tthis.#showMapTimerId = null;\n\t\tthis.#closeMapTimerId = null;\n\n\t\tsuper.destroy();\n\t\tthis.#isDestroyed = true;\n\t}\n}\n","import {\n\tLocationRepository,\n\tSourceCreationError,\n\tFormat,\n\tLocation,\n} from 'location.core';\nimport { Google } from 'location.google';\nimport Address from './address/address';\nimport Autocomplete from './autocomplete/autocomplete';\nimport { Factory as SourceFactory } from 'location.source';\nimport MapPopup from './mappopup/mappopup';\nimport Gallery from './mappopup/gallery';\nimport Popup from './mappopup/popup';\nimport Fields from './fields/fields';\nimport MapFeature from './address/features/mapfeature';\nimport AutocompleteFeature from './address/features/autocompletefeature';\nimport FieldsFeature from './address/features/fieldsfeature';\nimport MapFeatureAuto from './address/features/mapfeatureauto';\n\n/**\n * Props type for the main fabric method\n */\nexport type FactoryCreateAddressWidgetProps = {\n\t// Initial Address\n\taddress?: Address,\n\t// Initial widget mode\n\tmode: 'edit' | 'view',\n\n\t// optional\n\tlanguageId?: string,\n\taddressFormat?: Format,\n\tsourceCode?: string,\n\tsourceParams?: {},\n\n\t// Witch features will be used?\n\tuseFeatures?: {\n\t\tfields?: boolean, \t\t// default true\n\t\tmap?: boolean, \t\t\t// default true\n\t\tautocomplete?: boolean\t// default true\n\t},\n\n\t// Useful for the using with map feature only\n\t// Address photo height if photo exists\n\tthumbnailHeight: number,\n\t// Address photo width if photo exists\n\tthumbnailWidth: number,\n\t// Max photo thumbnails count\n\tmaxPhotoCount: number,\n\t/*\n\t * auto - open / close map feature depends on user's input\n\t * manual - allow to control open / close map\n\t */\n\tmapBehavior: 'auto' | 'manual',\n\tpopupOptions?: {},\n\tpopupBindOptions: {\n\t\tforceBindPosition?: boolean,\n\t\tforceLeft?: boolean,\n\t\tforceTop?: boolean,\n\t\tposition?: 'right' | 'top' | 'bootom'\n\t},\n\tpresetLocationsProvider?: Function,\n\tpresetLocationList?: []\n};\n\n/**\n * Factory class with a set of tools for the address widget creation\n */\nexport default class Factory\n{\n\t/**\n\t * Main factory method\n\t * @param {FactoryCreateAddressWidgetProps} props\n\t * @returns {Address}\n\t */\n\tcreateAddressWidget(props: FactoryCreateAddressWidgetProps): Address\n\t{\n\t\tconst sourceCode = props.sourceCode || BX.message('LOCATION_WIDGET_SOURCE_CODE');\n\t\tconst sourceParams = props.sourceParams || BX.message('LOCATION_WIDGET_SOURCE_PARAMS');\n\t\tconst languageId = props.languageId || BX.message('LOCATION_WIDGET_LANGUAGE_ID');\n\t\tconst sourceLanguageId = props.sourceLanguageId || BX.message('LOCATION_WIDGET_SOURCE_LANGUAGE_ID');\n\t\tconst userLocationPoint = new Location(JSON.parse(BX.message('LOCATION_WIDGET_USER_LOCATION_POINT')));\n\n\t\tconst addressFormat = props.addressFormat || new Format(\n\t\t\tJSON.parse(\n\t\t\t\tBX.message('LOCATION_WIDGET_DEFAULT_FORMAT')\n\t\t\t));\n\n\t\tconst presetLocationsProvider = props.presetLocationsProvider\n\t\t\t? props.presetLocationsProvider\n\t\t\t: () => {\n\t\t\t\treturn props.presetLocationList ? props.presetLocationList : [];\n\t\t\t};\n\n\t\tconst features = [];\n\n\t\tif(!props.useFeatures || props.useFeatures.fields !== false)\n\t\t{\n\t\t\tfeatures.push(\n\t\t\t\tthis.createFieldsFeature({addressFormat, languageId})\n\t\t\t);\n\t\t}\n\n\t\tlet source = null;\n\n\t\tif(sourceCode && sourceParams)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tsource = SourceFactory.create(sourceCode, languageId, sourceLanguageId, sourceParams)\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif(e instanceof SourceCreationError)\n\t\t\t\t{\n\t\t\t\t\tsource = null;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet mapFeature = null;\n\t\tif(source)\n\t\t{\n\t\t\tif(!props.useFeatures || props.useFeatures.autocomplete !== false)\n\t\t\t{\n\t\t\t\tfeatures.push(\n\t\t\t\t\tthis.createAutocompleteFeature({\n\t\t\t\t\t\tlanguageId,\n\t\t\t\t\t\taddressFormat,\n\t\t\t\t\t\tsource,\n\t\t\t\t\t\tuserLocationPoint: userLocationPoint,\n\t\t\t\t\t\tpresetLocationsProvider\n\t\t\t\t\t}));\n\t\t\t}\n\n\t\t\tif(!props.useFeatures || props.useFeatures.map !== false)\n\t\t\t{\n\t\t\t\tconst showPhotos = !!sourceParams.showPhotos;\n\t\t\t\tconst useGeocodingService = !!sourceParams.useGeocodingService;\n\t\t\t\tconst DEFAULT_THUMBNAIL_HEIGHT = 80;\n\t\t\t\tconst DEFAULT_THUMBNAIL_WIDTH = 150;\n\t\t\t\tconst DEFAULT_MAX_PHOTO_COUNT = showPhotos ? 5 : 0;\n\t\t\t\tconst DEFAULT_MAP_BEHAVIOR = 'auto';\n\n\t\t\t\tmapFeature = this.createMapFeature({\n\t\t\t\t\taddressFormat,\n\t\t\t\t\tsource,\n\t\t\t\t\tuseGeocodingService,\n\t\t\t\t\tpopupOptions: props.popupOptions,\n\t\t\t\t\tpopupBindOptions: props.popupBindOptions,\n\t\t\t\t\tthumbnailHeight: props.thumbnailHeight || DEFAULT_THUMBNAIL_HEIGHT,\n\t\t\t\t\tthumbnailWidth: props.thumbnailWidth || DEFAULT_THUMBNAIL_WIDTH,\n\t\t\t\t\tmaxPhotoCount: props.maxPhotoCount || DEFAULT_MAX_PHOTO_COUNT,\n\t\t\t\t\tmapBehavior: props.mapBehavior || DEFAULT_MAP_BEHAVIOR,\n\t\t\t\t\tuserLocationPoint: userLocationPoint\n\t\t\t\t});\n\n\t\t\t\tfeatures.push(mapFeature);\n\t\t\t}\n\t\t}\n\n\t\tconst widget = new Address({\n\t\t\tfeatures,\n\t\t\taddress: props.address,\n\t\t\tmode: props.mode,\n\t\t\taddressFormat,\n\t\t\tlanguageId,\n\t\t});\n\n\t\tif(mapFeature)\n\t\t{\n\t\t\twidget.subscribeOnFeatureEvent((event) => {\n\t\t\t\tconst data = event.getData();\n\n\t\t\t\tif(data.feature instanceof AutocompleteFeature\n\t\t\t\t\t&& data.eventCode === AutocompleteFeature.showOnMapClickedEvent\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tmapFeature.showMap(true);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn widget;\n\t}\n\n\tcreateFieldsFeature(props: {}): FieldsFeature\n\t{\n\t\tconst fields = new Fields({\n\t\t\taddressFormat: props.addressFormat,\n\t\t\tlanguageId: props.languageId,\n\t\t});\n\n\t\treturn new FieldsFeature({\n\t\t\tfields\n\t\t});\n\t}\n\n\tcreateAutocompleteFeature(props: {}): AutocompleteFeature\n\t{\n\t\tconst autocomplete = new Autocomplete({\n\t\t\tsourceCode: props.source.sourceCode,\n\t\t\tlanguageId: props.languageId,\n\t\t\taddressFormat: props.addressFormat,\n\t\t\tautocompleteService: props.source.autocompleteService,\n\t\t\tuserLocationPoint: props.userLocationPoint,\n\t\t\tpresetLocationsProvider: props.presetLocationsProvider,\n\t\t});\n\n\t\treturn new AutocompleteFeature({\n\t\t\tautocomplete\n\t\t});\n\t}\n\n\tcreateMapFeature(props: {}): MapFeature\n\t{\n\t\tlet popupOptions = {\n\t\t\tcacheable: true,\n\t\t\tcloseByEsc: true,\n\t\t\tclassName: `location-popup-window location-source-${props.source.sourceCode}`,\n\t\t\tanimation: 'fading',\n\t\t\tangle: true,\n\t\t\tbindOptions: props.popupBindOptions\n\t\t};\n\t\tif(props.popupOptions)\n\t\t{\n\t\t\tpopupOptions = Object.assign(popupOptions, props.popupOptions);\n\t\t}\n\t\tconst popup = new Popup(popupOptions);\n\n\t\tlet gallery = null;\n\n\t\tif(props.maxPhotoCount > 0)\n\t\t{\n\t\t\tgallery = new Gallery({\n\t\t\t\tphotoService: props.source.photoService,\n\t\t\t\tthumbnailHeight: props.thumbnailHeight,\n\t\t\t\tthumbnailWidth: props.thumbnailWidth,\n\t\t\t\tmaxPhotoCount: props.maxPhotoCount\n\t\t\t});\n\t\t}\n\n\t\tconst mapFeatureProps = {\n\t\t\tsaveResourceStrategy: props.source.sourceCode === Google.code,\n\t\t\tmap: new MapPopup({\n\t\t\t\taddressFormat: props.addressFormat,\n\t\t\t\tmap: props.source.map,\n\t\t\t\tpopup: popup,\n\t\t\t\tgallery: gallery,\n\t\t\t\tlocationRepository: new LocationRepository(),\n\t\t\t\tgeocodingService: props.useGeocodingService ? props.source.geocodingService : null,\n\t\t\t\tuserLocationPoint: props.userLocationPoint\n\t\t\t})\n\t\t};\n\n\t\tlet result;\n\n\t\tif(props.mapBehavior === 'manual')\n\t\t{\n\t\t\tresult = new MapFeature(mapFeatureProps);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = new MapFeatureAuto(mapFeatureProps);\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","import {EventEmitter} from \"main.core.events\";\nimport {Tag} from \"main.core\";\n\nexport default class Switch extends EventEmitter\n{\n\tstatic STATE_OFF = 0;\n\tstatic STATE_ON = 1;\n\n\tstatic #onToggleEvent = \"onToggleEvent\";\n\n\t#state;\n\t#titleContainer;\n\t#titles = ['on', 'off'];\n\n\tconstructor(props = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Location.Widget.Switch');\n\t\tthis.#state = props.state;\n\t\tthis.#titles = props.titles;\n\t}\n\n\tset state(state: string)\n\t{\n\t\tthis.#state = state;\n\n\t\tif(this.#titleContainer)\n\t\t{\n\t\t\tthis.#titleContainer.innerHTML = this.#getTitle();\n\t\t}\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#getTitle()\n\t{\n\t\treturn this.#titles[this.#state];\n\t}\n\n\trender(mode: number)\n\t{\n\t\tthis.#titleContainer = Tag.render`\t\t\t\n\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\">\n\t\t\t\t${this.#getTitle()}\n\t\t\t</span>`;\n\n\t\tthis.#titleContainer.addEventListener(\n\t\t\t'click',\n\t\t\t(event) => {\n\t\t\t\tthis.state = this.#state === Switch.STATE_OFF ? Switch.STATE_ON : Switch.STATE_OFF;\n\t\t\t\tthis.emit(Switch.#onToggleEvent, {state: this.#state});\n\t\t\t\tevent.stopPropagation();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t);\n\n\t\tthis.#titleContainer.addEventListener(\n\t\t\t'mouseover',\n\t\t\t(event) => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t);\n\n\t\treturn this.#titleContainer;\n\t}\n\n\tsubscribeOnToggleEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Switch.#onToggleEvent, listener);\n\t}\n}\n","import {EventEmitter} from \"main.core.events\";\nimport {Tag} from \"main.core\";\n\nexport default class Icon extends EventEmitter\n{\n\tstatic #onClickEvent = 'onClick';\n\n\tstatic TYPE_CLEAR = 'clear';\n\tstatic TYPE_SEARCH = 'search';\n\tstatic TYPE_LOADER = 'loader';\n\n\t#type = Icon.TYPE_SEARCH;\n\t#domNode;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Location.Widget.Icon');\n\t}\n\n\tset type(type: string): void\n\t{\n\t\tthis.#type = type;\n\n\t\tif(this.#domNode)\n\t\t{\n\t\t\tthis.#domNode.className = this.#getClassByType(this.#type);\n\t\t}\n\t}\n\n\t#getClassByType(iconType: string): void\n\t{\n\t\tlet iconClass = '';\n\n\t\tif(iconType === Icon.TYPE_CLEAR)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear\";\n\t\t}\n\t\telse if(iconType === Icon.TYPE_SEARCH)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-search\";\n\t\t}\n\t\telse if(iconType === Icon.TYPE_LOADER)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-loader\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.debug('Wrong icon type');\n\t\t}\n\n\t\treturn iconClass;\n\t}\n\n\trender(props)\n\t{\n\t\tthis.#type = props.type;\n\t\tthis.#domNode = Tag.render`<div class=\"${this.#getClassByType(this.#type)}\"></div>`;\n\n\t\tthis.#domNode.addEventListener(\n\t\t\t'click',\n\t\t\t(e) => {\n\t\t\t\tthis.emit(Icon.#onClickEvent);\n\t\t\t}\n\t\t);\n\n\t\treturn this.#domNode;\n\t}\n\n\tsubscribeOnClickEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Icon.#onClickEvent, listener);\n\t}\n}","import {Type, Tag, Dom} from 'main.core';\nimport {Address, ControlMode, ErrorPublisher} from 'location.core';\nimport {BaseEvent} from 'main.core.events';\nimport './css/ui-address.css';\nimport {State as WidgetState} from 'location.widget';\nimport Factory from '../factory';\nimport Switch from './switch';\nimport Icon from './icon';\n\n/**\n * Address field widget for the ui.entity-editor\n */\nexport default class UIAddress extends BX.UI.EntityEditorField\n{\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tthis._input = null;\n\t\tthis._inputIcon = null;\n\t\tthis._hiddenInput = null;\n\t\tthis._innerWrapper = null;\n\t\tthis._addressWidget = null;\n\t\tthis._addressFieldsContainer = null;\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new UIAddress();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tsuper.initialize(id, settings);\n\n\t\tconst value = this.getValue();\n\t\tlet address = null;\n\n\t\tif(Type.isStringFilled(value))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\taddress = new Address(JSON.parse(value));\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tBX.debug('Cant parse address value');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\n\t\tconst widgetFactory = new Factory();\n\n\t\tthis._addressWidget = widgetFactory.createAddressWidget({\n\t\t\taddress: address,\n\t\t\tmode: this._mode === BX.UI.EntityEditorMode.edit ? ControlMode.edit : ControlMode.view,\n\t\t\tpopupBindOptions: {\n\t\t\t\tposition: 'right'\n\t\t\t}\n\t\t});\n\n\t\tthis._addressWidget.subscribeOnStateChangedEvent(this.#onAddressWidgetChangedState.bind(this));\n\t\tthis._addressWidget.subscribeOnAddressChangedEvent(this.#onAddressChanged.bind(this));\n\n\t\tthis._fieldsSwitch = new Switch({\n\t\t\tstate: Switch.STATE_OFF,\n\t\t\ttitles: [\n\t\t\t\tBX.message('LOCATION_WIDGET_AUI_MORE'),\n\t\t\t\tBX.message('LOCATION_WIDGET_AUI_BRIEFLY')\n\t\t\t]\n\t\t});\n\t\tthis._fieldsSwitch.subscribeOnToggleEventSubscribe(this.#onFieldsSwitchToggle.bind(this));\n\t}\n\n\t#onIconClick()\n\t{\n\t\tif(this._input.value !== '')\n\t\t{\n\t\t\tthis._input.value = '';\n\t\t\tthis._addressWidget.address = null;\n\t\t\tthis._inputIcon.type = Icon.TYPE_SEARCH;\n\t\t}\n\n\t\tif(this.hasError())\n\t\t{\n\t\t\tthis.clearError();\n\t\t}\n\t}\n\n\t#onFieldsSwitchToggle(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst state = data.state;\n\n\t\tif(state === Switch.STATE_OFF)\n\t\t{\n\t\t\tthis.#hideFields();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#showFields();\n\t\t}\n\n\t\tthis._addressWidget.resetView();\n\t}\n\n\tfocus()\n\t{\n\t\tif(!this._input)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.focus(this._input);\n\t\tBX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input);\n\t}\n\n\t#hideFields()\n\t{\n\t\tif(this._addressFieldsContainer)\n\t\t{\n\t\t\tthis._addressFieldsContainer.classList.remove('visible');\n\t\t}\n\t}\n\n\t#showFields()\n\t{\n\t\tif(this._addressFieldsContainer)\n\t\t{\n\t\t\tthis._addressFieldsContainer.classList.add('visible');\n\t\t}\n\t}\n\n\t#onAddressWidgetChangedState(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst state = data.state;\n\t\tlet iconType;\n\n\t\tif(data.state === WidgetState.DATA_LOADING)\n\t\t{\n\t\t\ticonType = Icon.TYPE_LOADER;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(data.state === WidgetState.DATA_INPUTTING)\n\t\t\t{\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\n\t\t\ticonType = UIAddress.#chooseInputIconTypeByAddress(this.#getAddress());\n\t\t}\n\n\n\t\tthis._inputIcon.type = iconType;\n\t}\n\n\tgetModeSwitchType(mode)\n\t{\n\t\tlet result = BX.UI.EntityEditorModeSwitchType.common;\n\n\t\tif(mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\t// eslint-disable-next-line no-bitwise\n\t\t\tresult |= BX.UI.EntityEditorModeSwitchType.button | BX.UI.EntityEditorModeSwitchType.content;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tdoSetMode(mode)\n\t{\n\t\tthis._addressWidget.mode = mode === BX.UI.EntityEditorMode.edit ? ControlMode.edit : ControlMode.view;\n\t\tthis._fieldsSwitch.state = Switch.STATE_OFF;\n\t}\n\n\tgetContentWrapper()\n\t{\n\t\treturn this._innerWrapper;\n\t}\n\n\t#onAddressChanged(event: BaseEvent): void\n\t{\n\t\tconst data = event.getData();\n\t\tconst address = data.address;\n\n\t\tif(this._hiddenInput)\n\t\t{\n\t\t\tthis._hiddenInput.value = address ? address.toJson() : '';\n\t\t\tthis.markAsChanged();\n\t\t}\n\n\t\tif(this._inputIcon)\n\t\t{\n\t\t\tthis._inputIcon.type = UIAddress.#chooseInputIconTypeByAddress(address);\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tif(!this.isEditable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst address = this.#getAddress();\n\n\t\tthis._model.setField(\n\t\t\tthis.getName(),\n\t\t\taddress ? address.toJson() : ''\n\t\t);\n\n\t\tthis._addressWidget.resetView();\n\t}\n\n\tshowError(error, anchor)\n\t{\n\t\tsuper.showError.apply(this, [error, anchor]);\n\n\t\tif(this._input)\n\t\t{\n\t\t\tBX.addClass(this._inputContainer, 'ui-ctl-danger');\n\t\t}\n\t}\n\n\tclearError()\n\t{\n\t\tsuper.clearError.apply(this);\n\n\t\tif(this._input)\n\t\t{\n\t\t\tBX.removeClass(this._inputContainer, 'ui-ctl-danger');\n\t\t}\n\t}\n\n\tdoClearLayout(options)\n\t{\n\t\tthis._input = null;\n\t\tthis._innerWrapper = null;\n\t\tthis._inputContainer = null;\n\t\tthis._addressFieldsContainer = null;\n\t\tthis._inputIcon = null;\n\t\tthis._hiddenInput = null;\n\t\tDom.clean(this._innerWrapper);\n\t}\n\n\tvalidate(result)\n\t{\n\t\tif(!(this._mode === BX.UI.EntityEditorMode.edit && this._input))\n\t\t{\n\t\t\tthrow Error('BX.Location.UIAddress. Invalid validation context');\n\t\t}\n\n\t\tthis.clearError();\n\n\t\tif(this.hasValidators())\n\t\t{\n\t\t\treturn this.executeValidators(result);\n\t\t}\n\n\t\tconst isValid = !this.isRequired() || BX.util.trim(this._input.value) !== '';\n\n\t\tif(!isValid)\n\t\t{\n\t\t\tresult.addError(BX.UI.EntityValidationError.create({field: this}));\n\t\t\tthis.showRequiredFieldError(this._input);\n\t\t}\n\t\treturn isValid;\n\t}\n\n\tgetRuntimeValue()\n\t{\n\t\treturn (this._mode === BX.UI.EntityEditorMode.edit\n\t\t\t? this.#getAddress() : null\n\t\t);\n\t}\n\n\tstatic #chooseInputIconTypeByAddress(address: ?Address): string\n\t{\n\t\treturn address ? Icon.TYPE_CLEAR : Icon.TYPE_SEARCH;\n\t};\n\n\t#convertAddressToString(address: ?Address): string\n\t{\n\t\tif(!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(this._addressWidget.addressFormat);\n\t}\n\n\t#getAddress(): Address\n\t{\n\t\treturn this._addressWidget.address;\n\t}\n\n\tlayout(options): void\n\t{\n\t\tif(this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ensureWrapperCreated({classNames: ['ui-entity-card-content-block-field-phone']});\n\t\tthis.adjustWrapper();\n\n\t\tconst title = this.getTitle();\n\n\t\tif(this.isDragEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createDragButton());\n\t\t}\n\n\t\tconst addressWidgetParams = {};\n\n\t\tif(this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\n\t\t\tthis._input = Tag.render`<input class=\"ui-ctl-element ui-ctl-textbox\" value=\"\" type=\"text\" autocomplete=\"off\" name=\"${`${this.getName()}_STRING`}\">`;\n\t\t\tthis._hiddenInput = Tag.render`<input value='${this.getValue()}' type=\"hidden\" name=\"${this.getName()}\">`;\n\t\t\tthis._inputIcon = new Icon();\n\t\t\tthis._inputIcon.subscribeOnClickEvent(this.#onIconClick.bind(this));\n\t\t\tconst inputIconNode = this._inputIcon.render({\n\t\t\t\ttype: UIAddress.#chooseInputIconTypeByAddress(this.#getAddress())\n\t\t\t});\n\n\t\t\tthis._inputContainer = Tag.render`<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">${inputIconNode}${this._input}${this._hiddenInput}</div>`;\n\t\t\tthis._titleWrapper.appendChild(Tag.render`${this._fieldsSwitch.render(this._mode)}`);\n\n\t\t\tthis._innerWrapper = Tag.render`\t\t\t\t\t\t    \n\t\t\t\t<div class=\"location-search-control-block\">\t\t\t\t\t\n\t\t\t\t\t${this._inputContainer}\n\t\t\t\t</div>`;\n\n\t\t\taddressWidgetParams.inputNode = this._input;\n\t\t\taddressWidgetParams.mapBindElement = inputIconNode;\n\n\t\t\tthis._addressFieldsContainer = Tag.render`<div class=\"location-fields-control-block\"></div>`;\n\n\t\t\tif(this._fieldsSwitch.state === Switch.STATE_ON)\n\t\t\t{\n\t\t\t\tthis._addressFieldsContainer.classList.add('visible');\n\t\t\t}\n\n\t\t\taddressWidgetParams.fieldsContainer = this._addressFieldsContainer;\n\t\t\tthis._innerWrapper.appendChild(this._addressFieldsContainer);\n\t\t}\n\t\telse// if(this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\n\t\t\tlet addressStringNode;\n\n\t\t\tif(this.hasContentToDisplay())\n\t\t\t{\n\t\t\t\tconst addressString = this.#convertAddressToString(this.#getAddress());\n\t\t\t\taddressStringNode = Tag.render`<span class=\"ui-link ui-link-dark ui-link-dotted\">${addressString}</span>`;\n\n\t\t\t\tthis._innerWrapper = Tag.render`\n\t\t\t\t\t<div class=\"location-search-control-block\">\n\t\t\t\t\t\t<div class=\"ui-entity-editor-content-block-text\">\n\t\t\t\t\t\t\t${addressStringNode}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\n\t\t\t\taddressWidgetParams.mapBindElement = addressStringNode;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._innerWrapper = Tag.render`<div class=\"location-search-control-block\">\n\t\t\t\t\t${BX.message('UI_ENTITY_EDITOR_FIELD_EMPTY')}\n\t\t\t\t</div>`;\n\n\t\t\t\taddressWidgetParams.mapBindElement = this._innerWrapper;\n\t\t\t}\n\t\t}\n\n\t\taddressWidgetParams.controlWrapper = this._innerWrapper;\n\t\tthis._addressWidget.render(addressWidgetParams);\n\t\tthis._wrapper.appendChild(this._innerWrapper);\n\n\t\tthis._addressWidget.subscribeOnErrorEvent(this.errorListener.bind(this));\n\n\t\tif(this.isContextMenuEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t}\n\n\t\tif(this.isDragEnabled())\n\t\t{\n\t\t\tthis.initializeDragDropAbilities();\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\terrorListener(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst errors = data.errors;\n\n\t\tif(this._inputIcon)\n\t\t{\n\t\t\tthis._inputIcon.type = Icon.TYPE_CLEAR;\n\t\t}\n\n\t\tif(!Type.isArray(errors))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// todo: this.showError supports only one error\n\t\terrors.forEach((error) => {\n\t\t\tlet message;\n\n\t\t\tif(error.message)\n\t\t\t{\n\t\t\t\tmessage = error.message;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmessage = BX.message('LOCATION_WIDGET_AUI_UNKNOWN_ERROR');\n\t\t\t}\n\n\t\t\tif(error.code)\n\t\t\t{\n\t\t\t\tmessage += ` [${error.code}]`;\n\t\t\t}\n\n\t\t\tthis.showError(message);\n\t\t});\n\t}\n\n\tprocessModelChange(params)\n\t{\n\t\tif(BX.prop.get(params, 'originator', null) === this)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(!BX.prop.getBoolean(params, 'forAll', false)\n\t\t\t&& BX.prop.getString(params, 'name', '') !== this.getName()\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.refreshLayout();\n\t}\n\n\tstatic registerField(): void\n\t{\n\t\tif(typeof BX.UI.EntityEditorControlFactory !== 'undefined')\n\t\t{\n\t\t\tBX.UI.EntityEditorControlFactory.registerFactoryMethod('address', UIAddress.registerFieldMethod);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.addCustomEvent('BX.UI.EntityEditorControlFactory:onInitialize', (params, eventArgs) =>\n\t\t\t{\n\t\t\t\teventArgs.methods.address = UIAddress.registerFieldMethod;\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic registerFieldMethod(type, controlId, settings): ?UIAddress\n\t{\n\t\tlet result = null;\n\n\t\tif(type === 'address')\n\t\t{\n\t\t\tresult = UIAddress.create(controlId, settings);\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","import Address from './address/address';\nimport Factory from './factory';\nimport UIAddress from './ui-address/ui-address';\nimport State from './state';\nimport BaseFeature from './address/features/basefeature';\nimport MapFeature from './address/features/mapfeature';\nimport AutocompleteFeature from './address/features/autocompletefeature';\nimport FieldsFeature from './address/features/fieldsfeature';\n\n/* A set of widgets for using to deal with addresses */\nexport {\n\n\t// Main Widget\n\tAddress,\n\n\t// Widget features\n\tBaseFeature,\n\n\tMapFeature,\n\tAutocompleteFeature,\n\tFieldsFeature,\n\n\t// Widget factory\n\tFactory,\n\n\t// Possible widget states\n\tState,\n\n\t/* Address field for the ui.forms.\n\t * This can be used as an example of the widget implementation\n\t */\n\tUIAddress,\n};\n\n// Register fields for ui.entity-editor\nUIAddress.registerField();\n"],"names":["State","AddressString","props","addressFormat","Format","Error","address","addresStr","Tag","render","hide","style","display","innerHTML","isHidden","show","result","AddressStringConverter","convertAddressToStringTemplate","getTemplate","FormatTemplateType","DEFAULT","CONTENT_TYPE_HTML","Popup","_classPrivateMethodInitSpec","bindElement","bindOptions","isCustomPosition","isCustomPositionSuccess","position","MainPopup","bindElRect","getBoundingClientRect","popupHeight","getPopupContainer","offsetHeight","popupWidth","offsetWidth","left","width","document","documentElement","clientWidth","angleOffsetY","top","window","pageYOffset","height","body","clientHeight","setAngle","offset","Dom","adjust","popupContainer","zIndex","getZindex","MapPopup","_classPrivateFieldInitSpec","setEventNamespace","map","MapBase","BX","debug","onLocationChangedEventSubscribe","_classPrivateMethodGet","bind","popup","gallery","userLocationPoint","mode","useUserLocation","then","location","emit","onMapShow","isShown","close","listener","subscribe","destroy","remove","Event","unbindAll","getBindElement","Type","isDomNode","setBindElement","EventEmitter","event","data","getData","toAddress","fieldCollection","isEqual","LocationType","ADDRESS_LINE_1","latitude","longitude","text","mapInnerContainer","thirdPartyWarningNode","Loc","getMessage","ControlMode","edit","e","stopPropagation","setContent","lat","lon","Promise","resolve","view","Location","latLon","type","getType","mapContainer","toString","STRATEGY_TYPE_TEMPLATE_COMMA","CONTENT_TYPE_TEXT","BaseFeature","_saveResourceStrategy","saveResourceStrategy","MethodNotImplemented","addressWidget","Address","AddressEntity","isValid","isString","languageId","TypeError","features","isArray","forEach","feature","isBoolean","needWarmBackendAfterAddressChanged","locationRepository","LocationRepository","INITIAL","sourceFeature","excludeFeatures","options","addressId","id","getFieldValue","AddressType","isTemplateExists","setFieldValue","storeAsLastAddress","hasOwnProperty","DATA_INPUTTING","featureEvent","onFeatureEvent","code","resetView","controlWrapper","inputNode","onInputKeyup","onInputInput","state","onStateChangedEvent","onAddressChangedEvent","ErrorPublisher","getInstance","unbind","setAddressWidget","push","method","params","isExcluded","excludeFeature","apply","findParents","value","length","setCaretPosition","templateType","console","error","shortAddressString","AUTOCOMPLETE","fullAddressString","trim","title","selectionStart","selectionEnd","setSelectionRange","fieldForUnRecognized","isFieldExists","LOCALITY","Storage","lastAddress","splice","MenuBottom","node","firstChild","removeChild","appendChild","Menu","elRect","popupWindow","setMaxWidth","layout","menuContainer","menuItems","choseItemIdx","getPopupWindow","isDestroyed","index","isItemChosen","isItemExist","isMenuEmpty","isChoseLastItem","chooseItem","getChosenItem","isChoseFirstItem","item","classList","add","idx","unHighlightItem","highlightItem","removeMenuItem","setRightItemNode","setLeftItemNode","MainMenu","Prompt","menuNode","locationsList","searchPhrase","setMenuItems","getMenu","clearItems","Array","slice","showFlatList","addMenuItem","isSeparatorSet","html","delimiter","isRecursive","choosePrevItem","chooseNextItem","menuItem","locationName","clarification","TMP_TYPE_CLARIFICATION","TMP_TYPE_HINT","autoHide","closeByEsc","className","includes","ADM_LEVEL_1","name","createMenuItemText","onclick","onItemSelectedEvent","undefined","input","HTMLInputElement","setValueFromAddress","isPureAddress","setValue","indexOf","Autocomplete","requested","current","dropped","autocompleteService","AutocompleteServiceBase","sourceCode","presetLocationsProvider","addEventListener","removeEventListener","presetLocationList","leftBottomMenuMessage","element","leftBottomText","setBottomRightItemNode","setBottomLeftItemNode","relatedTarget","getAttribute","DATA_SUPPOSED","isChanged","hasPureAddressString","customTail","currentValue","newValue","stopImmediatePropagation","COUNTRY","ADDRESS_LINE_2","setTimeout","hasExternalRelation","showPrompt","biasPoint","Point","target","externalId","closePrompt","DATA_SELECTED","detailedLocation","addressLine2","response","notify","errors","excludeSetAddressFeatures","DATA_LOADING","findByExternalId","DATA_LOADED","addressString","ctrlKey","metaKey","shiftKey","key","onLocationSelectTimeout","actualize","timeout","clearTimeout","autocomplete","Photo","url","link","description","Gallery","thumbnailHeight","thumbnailWidth","maxPhotoCount","photoService","requestPhotos","photosData","refresh","photos","photo","thumbnail","util","strip_tags","renderedPhotos","Field","sort","container","Text","encode","Fields","field","clean","fields","formatField","subscribeOnValueChangedEvent","subscribeOnStateChangedEvent","a","b","changedField","MapFeature","onChangedEventSubscribe","setAddressByFeature","bindelement","closeMap","mapBindElement","AutocompleteFeature","onAddressChangedEventSubscribe","onStateChangedEventSubscribe","setStateByFeature","onSearchStartedEventSubscribe","emitFeatureEvent","eventCode","searchStartedEvent","payload","onSearchCompletedEventSubscribe","searchCompletedEvent","onShowOnMapClickedEventSubscribe","showOnMapClickedEvent","autocompleteMenuElement","FieldsFeature","subscribeOnAddressChangedEvent","fieldsContainer","MapFeatureAuto","onMouseOverSubscribe","onMouseOutSubscribe","showMap","Factory","message","sourceParams","sourceLanguageId","JSON","parse","useFeatures","createFieldsFeature","source","SourceFactory","create","SourceCreationError","mapFeature","createAutocompleteFeature","showPhotos","useGeocodingService","DEFAULT_THUMBNAIL_HEIGHT","DEFAULT_THUMBNAIL_WIDTH","DEFAULT_MAX_PHOTO_COUNT","DEFAULT_MAP_BEHAVIOR","createMapFeature","popupOptions","popupBindOptions","mapBehavior","widget","subscribeOnFeatureEvent","cacheable","animation","angle","Object","assign","mapFeatureProps","Google","geocodingService","Switch","titles","STATE_OFF","STATE_ON","Icon","TYPE_SEARCH","iconType","iconClass","TYPE_CLEAR","TYPE_LOADER","UIAddress","_input","_inputIcon","_hiddenInput","_innerWrapper","_addressWidget","_addressFieldsContainer","settings","getValue","isStringFilled","widgetFactory","createAddressWidget","_mode","UI","EntityEditorMode","_fieldsSwitch","subscribeOnToggleEventSubscribe","focus","EditorTextHelper","getCurrent","setPositionAtEnd","EntityEditorModeSwitchType","common","button","content","isEditable","_model","setField","getName","toJson","anchor","addClass","_inputContainer","removeClass","clearError","hasValidators","executeValidators","isRequired","addError","EntityValidationError","showRequiredFieldError","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","getTitle","isDragEnabled","_wrapper","createDragButton","addressWidgetParams","createTitleNode","subscribeOnClickEvent","inputIconNode","_titleWrapper","addressStringNode","hasContentToDisplay","subscribeOnErrorEvent","errorListener","isContextMenuEnabled","createContextMenuButton","initializeDragDropAbilities","registerLayout","showError","prop","get","getBoolean","getString","refreshLayout","self","initialize","EntityEditorControlFactory","registerFactoryMethod","registerFieldMethod","addCustomEvent","eventArgs","methods","controlId","EntityEditorField","hasError","WidgetState","markAsChanged","registerField"],"mappings":"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"}