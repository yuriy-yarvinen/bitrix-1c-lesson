this.BX=this.BX||{};this.BX.Location=this.BX.Location||{};(function(e,t,i,s,a,l,r,n,d,o){"use strict";var b=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(b,"INITIAL","INITIAL");babelHelpers.defineProperty(b,"DATA_INPUTTING","DATA_INPUTTING");babelHelpers.defineProperty(b,"DATA_SELECTED","DATA_SELECTED");babelHelpers.defineProperty(b,"DATA_SUPPOSED","DATA_SUPPOSED");babelHelpers.defineProperty(b,"DATA_LOADING","DATA_LOADING");babelHelpers.defineProperty(b,"DATA_LOADED","DATA_LOADED");var c,u;function p(e,t){v(e,t);t.add(e)}function h(e,t,i){v(e,t);t.set(e,i)}function v(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function f(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var H=new WeakMap;var P=new WeakMap;var F=new WeakMap;var m=new WeakMap;var g=new WeakSet;var T=function(){function e(t){babelHelpers.classCallCheck(this,e);p(this,g);h(this,H,{writable:true,value:void 0});h(this,P,{writable:true,value:void 0});h(this,F,{writable:true,value:void 0});h(this,m,{writable:true,value:void 0});if(!(t.addressFormat instanceof r.Format)){throw new Error("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(this,m,t.addressFormat)}babelHelpers.createClass(e,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,H,t.address);var i=f(this,g,w).call(this,babelHelpers.classPrivateFieldGet(this,H));babelHelpers.classPrivateFieldSet(this,F,o.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['<div class="location-map-address-text">',"</div>"])),i));babelHelpers.classPrivateFieldSet(this,P,o.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-container">\n\t\t\t\t<div class="location-map-address-icon"></div>\n\t\t\t\t',"\n\t\t\t</div>"])),babelHelpers.classPrivateFieldGet(this,F)));if(i===""){this.hide()}return babelHelpers.classPrivateFieldGet(this,P)}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,P)){babelHelpers.classPrivateFieldGet(this,P).style.display="block"}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,P)){babelHelpers.classPrivateFieldGet(this,P).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,P)||babelHelpers.classPrivateFieldGet(this,P).style.display==="none"}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,H,t);if(!babelHelpers.classPrivateFieldGet(this,F)){return}babelHelpers.classPrivateFieldGet(this,F).innerHTML=f(this,g,w).call(this,t);if(!t&&!this.isHidden()){this.hide()}else if(t&&this.isHidden()){this.show()}}}]);return e}();function w(e){var t="";if(e){t=r.AddressStringConverter.convertAddressToStringTemplate(e,babelHelpers.classPrivateFieldGet(this,m).getTemplate(r.FormatTemplateType.DEFAULT),r.AddressStringConverter.CONTENT_TYPE_HTML,", ",babelHelpers.classPrivateFieldGet(this,m))}return t}function y(e,t){I(e,t);t.add(e)}function I(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function G(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var S=new WeakSet;var E=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var s=arguments.length,a=new Array(s),l=0;l<s;l++){a[l]=arguments[l]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));y(babelHelpers.assertThisInitialized(i),S);return i}babelHelpers.createClass(t,[{key:"getBindElement",value:function e(){return this.bindElement}},{key:"adjustPosition",value:function e(i){var s,a;if(this.bindOptions.position&&this.bindOptions.position==="right"){s=true;a=G(this,S,k).call(this)}if(!(s&&a)){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"adjustPosition",this).call(this,i)}}}]);return t}(s.Popup);function k(){var e=this.bindElement.getBoundingClientRect();var t=this.getPopupContainer().offsetHeight;var i=this.getPopupContainer().offsetWidth;if(e.left+e.width+i>document.documentElement.clientWidth){return false}var s=t/2;var a=e.left+e.width+10;var l=window.pageYOffset+e.top+e.height/2-t/2;if(l<window.pageYOffset){s-=window.pageYOffset-l;l=window.pageYOffset}else if(l>window.pageYOffset+document.body.clientHeight-t){s+=l-(window.pageYOffset+document.body.clientHeight-t);l=window.pageYOffset+document.body.clientHeight-t}this.setAngle({position:"left",offset:s});o.Dom.adjust(this.popupContainer,{style:{top:"".concat(l,"px"),left:"".concat(a,"px"),zIndex:this.getZindex()}});return true}var C,A,W,_,M,z;function L(e,t){N(e,t);t.add(e)}function O(e,t,i){N(e,t);t.set(e,i)}function N(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function D(e,t,i){R(e,t);B(i,"get");return X(e,i)}function B(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function R(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function X(e,t){if(t.get){return t.get.call(e)}return t.value}function x(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var U=new WeakMap;var V=new WeakMap;var Y=new WeakMap;var j=new WeakMap;var K=new WeakMap;var q=new WeakMap;var J=new WeakMap;var $=new WeakMap;var Z=new WeakMap;var Q=new WeakMap;var ee=new WeakMap;var te=new WeakMap;var ie=new WeakMap;var se=new WeakMap;var ae=new WeakMap;var le=new WeakSet;var re=new WeakSet;var ne=new WeakSet;var de=new WeakSet;var oe=new WeakSet;var be=new WeakSet;var ce=new WeakSet;var ue=new WeakSet;var pe=new WeakSet;var he=new WeakSet;var ve=new WeakSet;var fe=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));L(babelHelpers.assertThisInitialized(i),ve);L(babelHelpers.assertThisInitialized(i),he);L(babelHelpers.assertThisInitialized(i),pe);L(babelHelpers.assertThisInitialized(i),ue);L(babelHelpers.assertThisInitialized(i),ce);L(babelHelpers.assertThisInitialized(i),be);L(babelHelpers.assertThisInitialized(i),oe);L(babelHelpers.assertThisInitialized(i),de);L(babelHelpers.assertThisInitialized(i),ne);L(babelHelpers.assertThisInitialized(i),re);L(babelHelpers.assertThisInitialized(i),le);O(babelHelpers.assertThisInitialized(i),U,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),V,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),Y,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),j,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),K,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),q,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),J,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),$,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),Z,{writable:true,value:false});O(babelHelpers.assertThisInitialized(i),Q,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),ee,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),te,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),ie,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),se,{writable:true,value:void 0});O(babelHelpers.assertThisInitialized(i),ae,{writable:true,value:void 0});i.setEventNamespace("BX.Location.Widget.MapPopup");if(!(e.map instanceof r.MapBase)){BX.debug("map must be instance of Map")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),U,e.map);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),U).onLocationChangedEventSubscribe(x(babelHelpers.assertThisInitialized(i),le,He).bind(babelHelpers.assertThisInitialized(i)));if(!(e.popup instanceof E)){BX.debug("popup must be instance of Popup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),K,e.popup);if(!(e.addressFormat instanceof r.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),J,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),q,new T({addressFormat:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),J)}));if(e.gallery){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),$,e.gallery)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),ae,e.userLocationPoint);return i}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Y,t.address);babelHelpers.classPrivateFieldSet(this,V,t.mode);babelHelpers.classPrivateFieldSet(this,Z,false);babelHelpers.classPrivateFieldSet(this,Q,o.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['<div class="location-map-inner"></div>']))));x(this,ne,Fe).call(this);x(this,re,Pe).call(this,t.bindElement,babelHelpers.classPrivateFieldGet(this,Q))}},{key:"show",value:function e(){var i=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;x(this,be,Te).call(this,babelHelpers.classPrivateFieldGet(this,Y),s).then((function(e){if(!e){return}babelHelpers.classPrivateFieldGet(i,K).show();if(babelHelpers.classPrivateFieldGet(i,Z)){babelHelpers.classPrivateFieldGet(i,U).location=e;if(babelHelpers.classPrivateFieldGet(i,$)){babelHelpers.classPrivateFieldGet(i,$).location=e}i.emit(D(t,t,Ae));babelHelpers.classPrivateFieldGet(i,U).onMapShow()}else{x(i,ue,ye).call(i,{location:e}).then((function(){if(babelHelpers.classPrivateFieldGet(i,$)){babelHelpers.classPrivateFieldGet(i,$).location=e}i.emit(D(t,t,Ae));babelHelpers.classPrivateFieldGet(i,U).onMapShow()}));babelHelpers.classPrivateFieldSet(i,Z,true)}}))}},{key:"isShown",value:function e(){return babelHelpers.classPrivateFieldGet(this,K).isShown()}},{key:"close",value:function e(){babelHelpers.classPrivateFieldGet(this,K).close();x(this,pe,Ie).call(this);this.emit(D(t,t,We))}},{key:"onChangedEventSubscribe",value:function e(i){this.subscribe(D(t,t,Ee),i)}},{key:"onMouseOverSubscribe",value:function e(i){this.subscribe(D(t,t,ke),i)}},{key:"onMouseOutSubscribe",value:function e(i){this.subscribe(D(t,t,Ce),i)}},{key:"subscribeOnShowedEvent",value:function e(i){this.subscribe(D(t,t,Ae),i)}},{key:"subscribeOnClosedEvent",value:function e(i){this.subscribe(D(t,t,We),i)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldSet(this,U,null);babelHelpers.classPrivateFieldSet(this,$,null);babelHelpers.classPrivateFieldSet(this,q,null);babelHelpers.classPrivateFieldGet(this,K).destroy();babelHelpers.classPrivateFieldSet(this,K,null);o.Dom.remove(babelHelpers.classPrivateFieldGet(this,ee));babelHelpers.classPrivateFieldSet(this,ee,null);o.Event.unbindAll(this)}},{key:"bindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,K).getBindElement()},set:function e(t){if(o.Type.isDomNode(t)){babelHelpers.classPrivateFieldGet(this,K).setBindElement(t)}else{BX.debug("bindElement must be type of dom node")}}},{key:"address",set:function e(t){var i=this;babelHelpers.classPrivateFieldSet(this,Y,t);babelHelpers.classPrivateFieldGet(this,q).address=t;x(this,be,Te).call(this,t).then((function(e){x(i,ce,we).call(i,e)}))}},{key:"mode",set:function e(t){babelHelpers.classPrivateFieldSet(this,V,t);babelHelpers.classPrivateFieldGet(this,U).mode=t}}]);return t}(d.EventEmitter);function He(e){var t=e.getData();var i=t.location;var s=i.toAddress();if(!babelHelpers.classPrivateFieldGet(this,Y)){babelHelpers.classPrivateFieldSet(this,Y,s);babelHelpers.classPrivateFieldGet(this,q).address=s;this.emit(D(fe,fe,Ee),{address:s})}else if(s.fieldCollection.isEqual(babelHelpers.classPrivateFieldGet(this,Y).fieldCollection,r.LocationType.ADDRESS_LINE_1)){babelHelpers.classPrivateFieldGet(this,Y).latitude=s.latitude;babelHelpers.classPrivateFieldGet(this,Y).longitude=s.longitude;if(babelHelpers.classPrivateFieldGet(this,Y).location){babelHelpers.classPrivateFieldGet(this,Y).location.latitude=s.latitude;babelHelpers.classPrivateFieldGet(this,Y).location.longitude=s.longitude}this.emit(D(fe,fe,Ee),{address:babelHelpers.classPrivateFieldGet(this,Y)});x(this,pe,Ie).call(this)}else{babelHelpers.classPrivateFieldGet(this,q).address=s;babelHelpers.classPrivateFieldSet(this,j,s);o.Dom.adjust(babelHelpers.classPrivateFieldGet(this,se),{text:x(this,ve,Se).call(this,babelHelpers.classPrivateFieldGet(this,j))});x(this,he,Ge).call(this)}if(babelHelpers.classPrivateFieldGet(this,$)){babelHelpers.classPrivateFieldGet(this,$).location=i}}function Pe(e,t){var i=this;var s="";if(babelHelpers.classPrivateFieldGet(this,$)){s=babelHelpers.classPrivateFieldGet(this,$).render()}var a=o.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-third-party-warning">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),o.Loc.getMessage("LOCATION_WIDGET_THIRD_PARTY_WARNING"));babelHelpers.classPrivateFieldSet(this,ee,o.Tag.render(W||(W=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-wrapper">\n\t\t\t\t<div class="location-map-container">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),t,s,babelHelpers.classPrivateFieldGet(this,V)===r.ControlMode.edit?babelHelpers.classPrivateFieldGet(this,q).render({address:babelHelpers.classPrivateFieldGet(this,Y)}):"",a,babelHelpers.classPrivateFieldGet(this,V)===r.ControlMode.edit?babelHelpers.classPrivateFieldGet(this,te):""));o.Event.bind(babelHelpers.classPrivateFieldGet(this,ee),"click",(function(e){return e.stopPropagation()}));o.Event.bind(babelHelpers.classPrivateFieldGet(this,ee),"mouseover",(function(e){return i.emit(D(fe,fe,ke),e)}));o.Event.bind(babelHelpers.classPrivateFieldGet(this,ee),"mouseout",(function(e){return i.emit(D(fe,fe,Ce),e)}));this.bindElement=e;babelHelpers.classPrivateFieldGet(this,K).setContent(babelHelpers.classPrivateFieldGet(this,ee));x(this,pe,Ie).call(this)}function Fe(){babelHelpers.classPrivateFieldSet(this,ie,o.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button @click="handleApplyClick" type="button" class="location-map-address-apply-btn">\n\t\t\t\t',"\n\t\t\t</button>\n\t\t"])),o.Loc.getMessage("LOCATION_WIDGET_AUI_ADDRESS_APPLY")));o.Event.bind(babelHelpers.classPrivateFieldGet(this,ie),"click",x(this,de,me).bind(this));babelHelpers.classPrivateFieldSet(this,se,o.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-changed-text">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),x(this,ve,Se).call(this,babelHelpers.classPrivateFieldGet(this,Y))));babelHelpers.classPrivateFieldSet(this,te,o.Tag.render(z||(z=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-changed">\n\t\t\t\t<div class="location-map-address-changed-inner">\n\t\t\t\t<div class="location-map-address-changed-title">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\t\n\t\t"])),o.Loc.getMessage("LOCATION_WIDGET_AUI_ADDRESS_CHANGED_NEW_ADDRESS"),babelHelpers.classPrivateFieldGet(this,se),babelHelpers.classPrivateFieldGet(this,ie)))}function me(){babelHelpers.classPrivateFieldSet(this,Y,babelHelpers.classPrivateFieldGet(this,j));babelHelpers.classPrivateFieldGet(this,q).address=babelHelpers.classPrivateFieldGet(this,j);x(this,pe,Ie).call(this);this.emit(D(fe,fe,Ee),{address:babelHelpers.classPrivateFieldGet(this,j)})}function ge(e){var t=null;var i;var s;if(e.latitude&&e.longitude){i=e.latitude;s=e.longitude}else if(e.location&&e.location.latitude&&e.location.longitude){i=e.location.latitude;s=e.location.longitude}if(i&&i!=="0"&&s&&s!=="0"){t=[i,s]}return t}function Te(e){var t=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return new Promise((function(s){if(i){s(babelHelpers.classPrivateFieldGet(t,ae)&&babelHelpers.classPrivateFieldGet(t,V)!==r.ControlMode.view?new r.Location({latitude:babelHelpers.classPrivateFieldGet(t,ae).latitude,longitude:babelHelpers.classPrivateFieldGet(t,ae).longitude}):null);return}if(e){var a=x(t,oe,ge).call(t,e);if(a){s(new r.Location({latitude:a[0],longitude:a[1],type:e.getType()}));return}}s(null)}))}function we(e){if(babelHelpers.classPrivateFieldGet(this,U)){babelHelpers.classPrivateFieldGet(this,U).location=e}if(babelHelpers.classPrivateFieldGet(this,$)){babelHelpers.classPrivateFieldGet(this,$).location=e}}function ye(e){var t=e.location;return babelHelpers.classPrivateFieldGet(this,U).render({mapContainer:babelHelpers.classPrivateFieldGet(this,Q),location:t,mode:babelHelpers.classPrivateFieldGet(this,V)})}function Ie(){o.Dom.style(babelHelpers.classPrivateFieldGet(this,te),{display:"none"})}function Ge(){o.Dom.style(babelHelpers.classPrivateFieldGet(this,te),{display:"flex"})}function Se(e){if(!e){return""}return e.toString(babelHelpers.classPrivateFieldGet(this,J),r.AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA,r.AddressStringConverter.CONTENT_TYPE_TEXT)}var Ee={writable:true,value:"onChanged"};var ke={writable:true,value:"onMouseOver"};var Ce={writable:true,value:"onMouseOut"};var Ae={writable:true,value:"onShow"};var We={writable:true,value:"onClose"};var _e=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"_saveResourceStrategy",false);this._saveResourceStrategy=t.saveResourceStrategy}babelHelpers.createClass(e,[{key:"render",value:function e(t){throw new r.MethodNotImplemented("Method render must be implemented")}},{key:"setAddressWidget",value:function e(t){throw new r.MethodNotImplemented("Method render must be implemented")}},{key:"setAddress",value:function e(t){throw new r.MethodNotImplemented("Method set address must be implemented")}},{key:"setMode",value:function e(t){}},{key:"destroy",value:function e(){}},{key:"resetView",value:function e(){}}]);return e}();function Me(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=ze(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var s=0;var a=function e(){};return{s:a,n:function t(){if(s>=e.length)return{done:true};return{done:false,value:e[s++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&i["return"]!=null)i["return"]()}finally{if(r)throw n}}}}function ze(e,t){if(!e)return;if(typeof e==="string")return Le(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Le(e,t)}function Le(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function Oe(e,t){De(e,t);t.add(e)}function Ne(e,t,i){De(e,t);t.set(e,i)}function De(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Be(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Re=new WeakMap;var Xe=new WeakMap;var xe=new WeakMap;var Ue=new WeakMap;var Ve=new WeakMap;var Ye=new WeakMap;var je=new WeakMap;var Ke=new WeakMap;var qe=new WeakMap;var Je=new WeakMap;var $e=new WeakMap;var Ze=new WeakMap;var Qe=new WeakMap;var et=new WeakSet;var tt=new WeakSet;var it=new WeakSet;var st=new WeakSet;var at=new WeakSet;var lt=new WeakSet;var rt=new WeakSet;var nt=new WeakSet;var dt=new WeakSet;var ot=new WeakSet;var bt=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Oe(babelHelpers.assertThisInitialized(i),ot);Oe(babelHelpers.assertThisInitialized(i),dt);Oe(babelHelpers.assertThisInitialized(i),nt);Oe(babelHelpers.assertThisInitialized(i),rt);Oe(babelHelpers.assertThisInitialized(i),lt);Oe(babelHelpers.assertThisInitialized(i),at);Oe(babelHelpers.assertThisInitialized(i),st);Oe(babelHelpers.assertThisInitialized(i),it);Oe(babelHelpers.assertThisInitialized(i),tt);Oe(babelHelpers.assertThisInitialized(i),et);Ne(babelHelpers.assertThisInitialized(i),Re,{writable:true,value:void 0});Ne(babelHelpers.assertThisInitialized(i),Xe,{writable:true,value:void 0});Ne(babelHelpers.assertThisInitialized(i),xe,{writable:true,value:void 0});Ne(babelHelpers.assertThisInitialized(i),Ue,{writable:true,value:void 0});Ne(babelHelpers.assertThisInitialized(i),Ve,{writable:true,value:void 0});Ne(babelHelpers.assertThisInitialized(i),Ye,{writable:true,value:[]});Ne(babelHelpers.assertThisInitialized(i),je,{writable:true,value:void 0});Ne(babelHelpers.assertThisInitialized(i),Ke,{writable:true,value:void 0});Ne(babelHelpers.assertThisInitialized(i),qe,{writable:true,value:false});Ne(babelHelpers.assertThisInitialized(i),Je,{writable:true,value:false});Ne(babelHelpers.assertThisInitialized(i),$e,{writable:true,value:false});Ne(babelHelpers.assertThisInitialized(i),Ze,{writable:true,value:true});Ne(babelHelpers.assertThisInitialized(i),Qe,{writable:true,value:void 0});i.setEventNamespace("BX.Location.Widget.Address");if(!(e.addressFormat instanceof r.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Ue,e.addressFormat);if(e.address&&!(e.address instanceof r.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),xe,e.address||null);if(!r.ControlMode.isValid(e.mode)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Re,e.mode);if(!o.Type.isString(e.languageId)){throw new TypeError("props.languageId must be type of string")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Ve,e.languageId);if(e.features){if(!o.Type.isArray(e.features)){throw new TypeError("features must be an array")}e.features.forEach((function(e){Be(babelHelpers.assertThisInitialized(i),et,ct).call(babelHelpers.assertThisInitialized(i),e)}))}if(o.Type.isBoolean(e.needWarmBackendAfterAddressChanged)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Ze,e.needWarmBackendAfterAddressChanged)}if(e.locationRepository instanceof r.LocationRepository){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Qe,e.locationRepository)}else if(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Ze)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Qe,new r.LocationRepository)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Xe,b.INITIAL);return i}babelHelpers.createClass(t,[{key:"setAddressByFeature",value:function e(t,i){var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var l=babelHelpers.classPrivateFieldGet(this,xe)?babelHelpers.classPrivateFieldGet(this,xe).id:0;if(t&&!t.getFieldValue(r.AddressType.ADDRESS_LINE_1)&&babelHelpers.classPrivateFieldGet(this,Ue).isTemplateExists(r.FormatTemplateType.ADDRESS_LINE_1)){t.setFieldValue(r.AddressType.ADDRESS_LINE_1,r.AddressStringConverter.convertAddressToStringTemplate(t,babelHelpers.classPrivateFieldGet(this,Ue).getTemplate(r.FormatTemplateType.ADDRESS_LINE_1),r.AddressStringConverter.CONTENT_TYPE_TEXT,null,babelHelpers.classPrivateFieldGet(this,Ue)))}babelHelpers.classPrivateFieldSet(this,xe,t);var n=a.hasOwnProperty("storeAsLastAddress")?a.storeAsLastAddress:true;if(n){Be(this,dt,Ft).call(this)}if(babelHelpers.classPrivateFieldGet(this,xe)&&l>0){babelHelpers.classPrivateFieldGet(this,xe).id=l}babelHelpers.classPrivateFieldSet(this,Je,true);Be(this,rt,Ht).call(this,t);Be(this,tt,ut).call(this,"setAddress",[t],i,s);if(babelHelpers.classPrivateFieldGet(this,Xe)!==b.DATA_INPUTTING){Be(this,it,pt).call(this)}}},{key:"emitFeatureEvent",value:function e(i){this.emit(t.onFeatureEvent,i)}},{key:"onInputKeyup",value:function e(t){switch(t.code){case"Tab":case"Esc":case"Enter":case"NumpadEnter":this.resetView();break}}},{key:"onInputInput",value:function e(t){babelHelpers.classPrivateFieldSet(this,$e,true)}},{key:"resetView",value:function e(){Be(this,tt,ut).call(this,"resetView")}},{key:"render",value:function e(t){if(!o.Type.isDomNode(t.controlWrapper)){BX.debug("props.controlWrapper must be instance of Element")}babelHelpers.classPrivateFieldSet(this,Ke,t.controlWrapper);if(babelHelpers.classPrivateFieldGet(this,Re)===r.ControlMode.edit){if(!o.Type.isDomNode(t.inputNode)){BX.debug("props.inputNode must be instance of Element")}babelHelpers.classPrivateFieldSet(this,je,t.inputNode);Be(this,rt,Ht).call(this,babelHelpers.classPrivateFieldGet(this,xe))}Be(this,tt,ut).call(this,"render",[t]);if(babelHelpers.classPrivateFieldGet(this,Re)===r.ControlMode.edit){o.Event.bind(babelHelpers.classPrivateFieldGet(this,je),"focus",Be(this,at,vt).bind(this));o.Event.bind(babelHelpers.classPrivateFieldGet(this,je),"focusout",Be(this,nt,Pt).bind(this));o.Event.bind(babelHelpers.classPrivateFieldGet(this,je),"keyup",this.onInputKeyup.bind(this));o.Event.bind(babelHelpers.classPrivateFieldGet(this,je),"input",this.onInputInput.bind(this))}}},{key:"setStateByFeature",value:function e(i){babelHelpers.classPrivateFieldSet(this,Xe,i);this.emit(t.onStateChangedEvent,{state:i})}},{key:"subscribeOnStateChangedEvent",value:function e(i){this.subscribe(t.onStateChangedEvent,i)}},{key:"subscribeOnAddressChangedEvent",value:function e(i){this.subscribe(t.onAddressChangedEvent,i)}},{key:"subscribeOnFeatureEvent",value:function e(i){this.subscribe(t.onFeatureEvent,i)}},{key:"subscribeOnErrorEvent",value:function e(t){r.ErrorPublisher.getInstance().subscribe(t)}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,qe)){return}o.Event.unbindAll(this);o.Event.unbind(babelHelpers.classPrivateFieldGet(this,je),"focus",Be(this,at,vt));o.Event.unbind(babelHelpers.classPrivateFieldGet(this,je),"focusout",Be(this,nt,Pt));o.Event.unbind(babelHelpers.classPrivateFieldGet(this,je),"keyup",this.onInputKeyup);o.Event.unbind(babelHelpers.classPrivateFieldGet(this,je),"input",this.onInputInput);Be(this,tt,ut).call(this,"destroy");Be(this,ot,mt).call(this);babelHelpers.classPrivateFieldSet(this,qe,true)}},{key:"isDestroyed",value:function e(){return babelHelpers.classPrivateFieldGet(this,qe)}},{key:"features",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ye)}},{key:"controlWrapper",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ke)}},{key:"inputNode",get:function e(){return babelHelpers.classPrivateFieldGet(this,je)}},{key:"address",get:function e(){return babelHelpers.classPrivateFieldGet(this,xe)},set:function e(t){if(t&&!(t instanceof r.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,xe,t);Be(this,dt,Ft).call(this);Be(this,tt,ut).call(this,"setAddress",[t]);babelHelpers.classPrivateFieldSet(this,$e,false);babelHelpers.classPrivateFieldSet(this,Je,false);Be(this,rt,Ht).call(this,t)}},{key:"mode",get:function e(){return babelHelpers.classPrivateFieldGet(this,Re)},set:function e(t){if(!r.ControlMode.isValid(t)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,Re,t);Be(this,tt,ut).call(this,"setMode",[t])}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Xe)}},{key:"addressFormat",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ue)}}]);return t}(d.EventEmitter);function ct(e){if(!(e instanceof _e)){BX.debug("feature must be instance of BaseFeature")}e.setAddressWidget(this);babelHelpers.classPrivateFieldGet(this,Ye).push(e)}function ut(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var a;var l=Me(babelHelpers.classPrivateFieldGet(this,Ye)),r;try{for(l.s();!(r=l.n()).done;){var n=r.value;var d=false;var o=Me(s),b;try{for(o.s();!(b=o.n()).done;){var c=b.value;if(n instanceof c){d=true;break}}}catch(e){o.e(e)}finally{o.f()}if(!d&&n!==i){a=n[e].apply(n,t)}}}catch(e){l.e(e)}finally{l.f()}return a}function pt(){this.emit(bt.onAddressChangedEvent,{address:babelHelpers.classPrivateFieldGet(this,xe)});if(babelHelpers.classPrivateFieldGet(this,xe)&&babelHelpers.classPrivateFieldGet(this,Ze)){Be(this,st,ht).call(this,babelHelpers.classPrivateFieldGet(this,xe))}}function ht(e){if(e.location!==null&&e.location.id<=0){babelHelpers.classPrivateFieldGet(this,Qe).findParents(e.location)}}function vt(e){var t=babelHelpers.classPrivateFieldGet(this,je).value;if(t.length>0){BX.setCaretPosition(babelHelpers.classPrivateFieldGet(this,je),t.length)}}function ft(e,t){var i="";if(e){if(!babelHelpers.classPrivateFieldGet(this,Ue).isTemplateExists(t)){console.error('Address format "'.concat(babelHelpers.classPrivateFieldGet(this,Ue).code,'" does not have a template "').concat(t,'"'));return""}i=r.AddressStringConverter.convertAddressToStringTemplate(e,babelHelpers.classPrivateFieldGet(this,Ue).getTemplate(t),r.AddressStringConverter.CONTENT_TYPE_TEXT,", ",babelHelpers.classPrivateFieldGet(this,Ue))}return i}function Ht(e){if(babelHelpers.classPrivateFieldGet(this,je)){var t=Be(this,lt,ft).call(this,e,r.FormatTemplateType.AUTOCOMPLETE);var i=Be(this,lt,ft).call(this,e,r.FormatTemplateType.DEFAULT);babelHelpers.classPrivateFieldGet(this,je).value=t.trim()!==""?t:i;babelHelpers.classPrivateFieldGet(this,je).title=i;var s=babelHelpers.classPrivateFieldGet(this,je).selectionStart;var a=t.length;babelHelpers.classPrivateFieldGet(this,je).setSelectionRange(s,a)}}function Pt(e){if(babelHelpers.classPrivateFieldGet(this,$e)&&!babelHelpers.classPrivateFieldGet(this,Je)){var t=babelHelpers.classPrivateFieldGet(this,je).value.trim();var i=new r.Address({languageId:babelHelpers.classPrivateFieldGet(this,Ve)});i.setFieldValue(babelHelpers.classPrivateFieldGet(this,Ue).fieldForUnRecognized,t);this.address=i;Be(this,it,pt).call(this)}babelHelpers.classPrivateFieldSet(this,$e,false);babelHelpers.classPrivateFieldSet(this,Je,false)}function Ft(){if(babelHelpers.classPrivateFieldGet(this,xe)&&babelHelpers.classPrivateFieldGet(this,xe).fieldCollection&&babelHelpers.classPrivateFieldGet(this,xe).fieldCollection.isFieldExists(r.AddressType.LOCALITY)){r.Storage.getInstance().lastAddress=babelHelpers.classPrivateFieldGet(this,xe)}}function mt(){babelHelpers.classPrivateFieldGet(this,Ye).splice(0,babelHelpers.classPrivateFieldGet(this,Ye).length)}babelHelpers.defineProperty(bt,"onAddressChangedEvent","onAddressChanged");babelHelpers.defineProperty(bt,"onStateChangedEvent","onStateChanged");babelHelpers.defineProperty(bt,"onFeatureEvent","onFeatureEvent");var gt,Tt,wt;function yt(e,t,i){It(e,t);t.set(e,i)}function It(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Gt=new WeakMap;var St=new WeakMap;var Et=new WeakMap;var kt=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));yt(babelHelpers.assertThisInitialized(e),Gt,{writable:true,value:void 0});yt(babelHelpers.assertThisInitialized(e),St,{writable:true,value:void 0});yt(babelHelpers.assertThisInitialized(e),Et,{writable:true,value:void 0});e.setEventNamespace("BX.Location.Widget.Autocomplete.MenuBottom");return e}babelHelpers.createClass(t,[{key:"render",value:function e(){babelHelpers.classPrivateFieldSet(this,St,o.Tag.render(gt||(gt=babelHelpers.taggedTemplateLiteral(['<div class="location-map-popup-item--info-left"></div>']))));babelHelpers.classPrivateFieldSet(this,Et,o.Tag.render(Tt||(Tt=babelHelpers.taggedTemplateLiteral(["<div></div>"]))));babelHelpers.classPrivateFieldSet(this,Gt,o.Tag.render(wt||(wt=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<span class="location-map-popup-item--info"> \t\t\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</span>\t\t\t\n\t\t\t</div>\n\t\t"])),babelHelpers.classPrivateFieldGet(this,St),babelHelpers.classPrivateFieldGet(this,Et)));return babelHelpers.classPrivateFieldGet(this,Gt)}},{key:"setRightItemNode",value:function e(t){while(babelHelpers.classPrivateFieldGet(this,Et).firstChild){babelHelpers.classPrivateFieldGet(this,Et).removeChild(babelHelpers.classPrivateFieldGet(this,Et).firstChild)}babelHelpers.classPrivateFieldGet(this,Et).appendChild(t)}},{key:"setLeftItemNode",value:function e(t){while(babelHelpers.classPrivateFieldGet(this,St).firstChild){babelHelpers.classPrivateFieldGet(this,St).removeChild(babelHelpers.classPrivateFieldGet(this,St).firstChild)}babelHelpers.classPrivateFieldGet(this,St).appendChild(t)}}]);return t}(d.EventEmitter);function Ct(e,t,i){At(e,t);t.set(e,i)}function At(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Wt=new WeakMap;var _t=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"choseItemIdx",-1);Ct(babelHelpers.assertThisInitialized(i),Wt,{writable:true,value:void 0});var s=e.bindElement.getBoundingClientRect();i.popupWindow.setMaxWidth(s.width);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Wt,new kt);i.layout.menuContainer.appendChild(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Wt).render());return i}babelHelpers.createClass(t,[{key:"isMenuEmpty",value:function e(){return this.menuItems.length<=0}},{key:"isChoseLastItem",value:function e(){return this.choseItemIdx>=this.menuItems.length-1}},{key:"isChoseFirstItem",value:function e(){return this.choseItemIdx===0}},{key:"isItemChosen",value:function e(){return this.choseItemIdx>=0}},{key:"isDestroyed",value:function e(){return this.getPopupWindow().isDestroyed()}},{key:"isItemExist",value:function e(t){return typeof this.menuItems[t]!=="undefined"}},{key:"getChosenItem",value:function e(){var t=null;if(this.isItemChosen()&&this.isItemExist(this.choseItemIdx)){t=this.menuItems[this.choseItemIdx]}return t}},{key:"chooseNextItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseLastItem()){this.chooseItem(this.choseItemIdx+1)}return this.getChosenItem()}},{key:"choosePrevItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseFirstItem()){this.chooseItem(this.choseItemIdx-1)}return this.getChosenItem()}},{key:"highlightItem",value:function e(t){if(this.isItemExist(t)){var i=this.getChosenItem();if(i&&i.layout.item){i.layout.item.classList.add("highlighted")}}}},{key:"unHighlightItem",value:function e(t){if(this.isItemExist(t)){var i=this.getChosenItem();if(i&&i.layout.item){i.layout.item.classList.remove("highlighted")}}}},{key:"chooseItem",value:function e(t){var i=t;if(i<0){i=this.menuItems.length-1}else if(i>this.menuItems.length-1){i=0}this.unHighlightItem(this.choseItemIdx);this.choseItemIdx=i;this.highlightItem(this.choseItemIdx)}},{key:"clearItems",value:function e(){while(this.menuItems.length>0){this.removeMenuItem(this.menuItems[0].id)}}},{key:"isShown",value:function e(){return this.getPopupWindow().isShown()}},{key:"setBottomRightItemNode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Wt).setRightItemNode(t)}},{key:"setBottomLeftItemNode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Wt).setLeftItemNode(t)}}]);return t}(s.Menu);function Mt(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=zt(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var s=0;var a=function e(){};return{s:a,n:function t(){if(s>=e.length)return{done:true};return{done:false,value:e[s++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&i["return"]!=null)i["return"]()}finally{if(r)throw n}}}}function zt(e,t){if(!e)return;if(typeof e==="string")return Lt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Lt(e,t)}function Lt(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function Ot(e,t){Dt(e,t);t.add(e)}function Nt(e,t,i){Dt(e,t);t.set(e,i)}function Dt(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Bt(e,t,i){Rt(e,t);return i}function Rt(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function Xt(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var xt=new WeakMap;var Ut=new WeakMap;var Vt=new WeakMap;var Yt=new WeakMap;var jt=new WeakSet;var Kt=new WeakSet;var qt=new WeakSet;var Jt=new WeakSet;var $t=new WeakSet;var Zt=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Ot(babelHelpers.assertThisInitialized(i),$t);Ot(babelHelpers.assertThisInitialized(i),Jt);Ot(babelHelpers.assertThisInitialized(i),qt);Ot(babelHelpers.assertThisInitialized(i),Kt);Ot(babelHelpers.assertThisInitialized(i),jt);Nt(babelHelpers.assertThisInitialized(i),xt,{writable:true,value:void 0});Nt(babelHelpers.assertThisInitialized(i),Ut,{writable:true,value:void 0});Nt(babelHelpers.assertThisInitialized(i),Vt,{writable:true,value:void 0});Nt(babelHelpers.assertThisInitialized(i),Yt,{writable:true,value:void 0});i.setEventNamespace("BX.Location.Widget.Prompt");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),xt,e.inputNode);if(e.menuNode){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Ut,e.menuNode)}return i}babelHelpers.createClass(t,[{key:"getMenu",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,Vt)||babelHelpers.classPrivateFieldGet(this,Vt).isDestroyed()){babelHelpers.classPrivateFieldSet(this,Vt,Xt(this,jt,Qt).call(this))}return babelHelpers.classPrivateFieldGet(this,Vt)}},{key:"show",value:function e(t,i){if(t.length>0){this.setMenuItems(t,i);this.getMenu().show()}}},{key:"close",value:function e(){this.getMenu().close()}},{key:"setMenuItems",value:function e(i,s,a){var l=this;this.getMenu().clearItems();if(Array.isArray(i)){babelHelpers.classPrivateFieldSet(this,Yt,i.slice());var n=!a||!a.getFieldValue(r.AddressType.LOCALITY)||!Bt(t,t,ii).call(t,babelHelpers.classPrivateFieldGet(this,Yt));if(n){i.forEach((function(e,t){l.getMenu().addMenuItem(Xt(l,qt,si).call(l,t,e,s))}))}else{i.forEach((function(e,t){if(Xt(l,Kt,ei).call(l,a,e)){l.getMenu().addMenuItem(Xt(l,qt,si).call(l,t,e,s))}}));var d=false;i.forEach((function(e,t){if(!Xt(l,Kt,ei).call(l,a,e)){if(!d){l.getMenu().addMenuItem({html:o.Loc.getMessage("LOCATION_WIDGET_PROMPT_IN_OTHER_CITY"),delimiter:true})}l.getMenu().addMenuItem(Xt(l,qt,si).call(l,t,e,s));d=true}}))}}}},{key:"choosePrevItem",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var i=null;var s=this.getMenu().choosePrevItem();if(s){if(s.delimiter&&s.delimiter===true){i=t?this.getMenu().chooseNextItem():this.choosePrevItem(true)}else{i=Xt(this,$t,li).call(this,this.getMenu().choseItemIdx)}}return i}},{key:"chooseNextItem",value:function e(){var t=null;var i=this.getMenu().chooseNextItem();if(i){if(i.delimiter&&i.delimiter===true){t=this.chooseNextItem()}else{t=Xt(this,$t,li).call(this,this.getMenu().choseItemIdx)}}return t}},{key:"isItemChosen",value:function e(){return this.getMenu().isItemChosen()}},{key:"getChosenItem",value:function e(){var t=null;var i=this.getMenu().getChosenItem();if(i&&i.id){t=Xt(this,$t,li).call(this,this.getMenu().choseItemIdx)}return t}},{key:"isShown",value:function e(){return this.getMenu().isShown()}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Vt)){babelHelpers.classPrivateFieldGet(this,Vt).destroy();babelHelpers.classPrivateFieldSet(this,Vt,null)}babelHelpers.classPrivateFieldSet(this,Yt,null)}}],[{key:"createMenuItemText",value:function e(t,i,s){var a="\n\t\t<div>\n\t\t\t<strong>".concat(t,"</strong>\n\t\t</div>");var l;if(s.getFieldValue(r.LocationType.TMP_TYPE_CLARIFICATION)){l=s.getFieldValue(r.LocationType.TMP_TYPE_CLARIFICATION);if(l){if(s.getFieldValue(r.LocationType.TMP_TYPE_HINT)){l+=" <i>(".concat(s.getFieldValue(r.LocationType.TMP_TYPE_HINT),")</i>")}a+="<div>".concat(l,"</div>")}}return'<div data-role="location-widget-menu-item" tabindex="-1">'+a+"</div>"}}]);return t}(d.EventEmitter);function Qt(){return new _t({bindElement:babelHelpers.classPrivateFieldGet(this,Ut)?babelHelpers.classPrivateFieldGet(this,Ut):babelHelpers.classPrivateFieldGet(this,xt),autoHide:false,closeByEsc:true,className:"location-widget-prompt-menu"})}function ei(e,t){return e&&e.getFieldValue(r.AddressType.LOCALITY)&&t&&t.address&&t.address.getFieldValue(r.AddressType.LOCALITY)&&Bt(Zt,Zt,ti).call(Zt,t.address).includes(e.getFieldValue(r.AddressType.LOCALITY))}function ti(e){var t=[];if(e.getFieldValue(r.AddressType.LOCALITY)){t.push(e.getFieldValue(r.AddressType.LOCALITY))}if(e.getFieldValue(r.AddressType.ADM_LEVEL_1)){t.push(e.getFieldValue(r.AddressType.ADM_LEVEL_1))}return t}function ii(e){var t=Mt(e),i;try{for(t.s();!(i=t.n()).done;){var s=i.value;if(s.address&&s.address.getFieldValue(r.AddressType.LOCALITY)){return true}}}catch(e){t.e(e)}finally{t.f()}return false}function si(e,t,i){var s=this;return{id:e,title:t.name,html:Zt.createMenuItemText(t.name,i,t),onclick:function t(i,a){Xt(s,Jt,ai).call(s,e);s.close()}}}function ai(e){var t=Xt(this,$t,li).call(this,e);if(t){this.emit(Zt.onItemSelectedEvent,{location:t})}}function li(e){var t=null;if(babelHelpers.classPrivateFieldGet(this,Yt)[e]!==undefined){t=babelHelpers.classPrivateFieldGet(this,Yt)[e]}if(!t){BX.debug("Location with index ".concat(e," was not found"))}return t}babelHelpers.defineProperty(Zt,"onItemSelectedEvent","onItemSelected");function ri(e,t){di(e,t);t.add(e)}function ni(e,t,i){di(e,t);t.set(e,i)}function di(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function oi(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var bi=new WeakMap;var ci=new WeakMap;var ui=new WeakMap;var pi=new WeakMap;var hi=new WeakSet;var vi=new WeakSet;var fi=new WeakSet;var Hi=function(){function e(t,i,s){babelHelpers.classCallCheck(this,e);ri(this,fi);ri(this,vi);ri(this,hi);ni(this,bi,{writable:true,value:null});ni(this,ci,{writable:true,value:""});ni(this,ui,{writable:true,value:""});ni(this,pi,{writable:true,value:null});if(!(t instanceof HTMLInputElement)){throw new TypeError("Wrong input type")}babelHelpers.classPrivateFieldSet(this,bi,t);if(!(i instanceof r.Format)){throw new TypeError("Wrong addressFormat type")}babelHelpers.classPrivateFieldSet(this,pi,i);if(s&&!(s instanceof r.Address)){throw new TypeError("Wrong address type")}if(s){this.setValueFromAddress(s)}}babelHelpers.createClass(e,[{key:"setValue",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;babelHelpers.classPrivateFieldSet(this,ci,t);babelHelpers.classPrivateFieldGet(this,bi).value=t;if(i){babelHelpers.classPrivateFieldSet(this,ui,t)}oi(this,hi,Pi).call(this)}},{key:"actualize",value:function e(){babelHelpers.classPrivateFieldSet(this,ci,babelHelpers.classPrivateFieldGet(this,bi).value);oi(this,hi,Pi).call(this)}},{key:"isChanged",value:function e(){return babelHelpers.classPrivateFieldGet(this,ci).trim()!==babelHelpers.classPrivateFieldGet(this,bi).value.trim()}},{key:"hasPureAddressString",value:function e(){return babelHelpers.classPrivateFieldGet(this,ui)!==""}},{key:"setValueFromAddress",value:function e(t){var i="";if(t){i=oi(this,fi,mi).call(this,t,r.FormatTemplateType.AUTOCOMPLETE);if(i.trim()===""){i=oi(this,fi,mi).call(this,t,r.FormatTemplateType.DEFAULT)}}this.setValue(i,true)}},{key:"value",get:function e(){return babelHelpers.classPrivateFieldGet(this,ci)}},{key:"customTail",get:function e(){if(babelHelpers.classPrivateFieldGet(this,ui)===""){return babelHelpers.classPrivateFieldGet(this,ci)}var t;if(!oi(this,vi,Fi).call(this)){t=babelHelpers.classPrivateFieldGet(this,ci).slice(babelHelpers.classPrivateFieldGet(this,ui).length)}else{t=babelHelpers.classPrivateFieldGet(this,ci)}return t}}]);return e}();function Pi(){if(oi(this,vi,Fi).call(this)){babelHelpers.classPrivateFieldSet(this,ui,"")}}function Fi(){return babelHelpers.classPrivateFieldGet(this,ci)===""||babelHelpers.classPrivateFieldGet(this,ui)===""||babelHelpers.classPrivateFieldGet(this,ci).indexOf(babelHelpers.classPrivateFieldGet(this,ui))!==0}function mi(e,t){if(!babelHelpers.classPrivateFieldGet(this,pi).isTemplateExists(t)){console.error('Address format "'.concat(babelHelpers.classPrivateFieldGet(this,pi).code,'" does not have a template "').concat(t,'"'));return""}return r.AddressStringConverter.convertAddressToStringTemplate(e,babelHelpers.classPrivateFieldGet(this,pi).getTemplate(t),r.AddressStringConverter.CONTENT_TYPE_TEXT,", ",babelHelpers.classPrivateFieldGet(this,pi))}var gi,Ti;function wi(e,t){Ii(e,t);t.add(e)}function yi(e,t,i){Ii(e,t);t.set(e,i)}function Ii(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Gi(e,t,i){Ei(e,t);Si(i,"get");return ki(e,i)}function Si(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function Ei(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function ki(e,t){if(t.get){return t.get.call(e)}return t.value}function Ci(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Ai=new WeakMap;var Wi=new WeakMap;var _i=new WeakMap;var Mi=new WeakMap;var zi=new WeakMap;var Li=new WeakMap;var Oi=new WeakMap;var Ni=new WeakMap;var Di=new WeakMap;var Bi=new WeakMap;var Ri=new WeakMap;var Xi=new WeakMap;var xi=new WeakMap;var Ui=new WeakMap;var Vi=new WeakMap;var Yi=new WeakMap;var ji=new WeakMap;var Ki=new WeakMap;var qi=new WeakMap;var Ji=new WeakSet;var $i=new WeakSet;var Zi=new WeakSet;var Qi=new WeakSet;var es=new WeakSet;var ts=new WeakSet;var is=new WeakSet;var ss=new WeakSet;var as=new WeakSet;var ls=new WeakSet;var rs=new WeakSet;var ns=new WeakSet;var ds=new WeakSet;var os=new WeakSet;var bs=new WeakSet;var cs=new WeakSet;var us=new WeakSet;var ps=new WeakSet;var hs=new WeakSet;var vs=new WeakSet;var fs=new WeakSet;var Hs=new WeakSet;var Ps=new WeakSet;var Fs=new WeakSet;var ms=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));wi(babelHelpers.assertThisInitialized(i),Fs);wi(babelHelpers.assertThisInitialized(i),Ps);wi(babelHelpers.assertThisInitialized(i),Hs);wi(babelHelpers.assertThisInitialized(i),fs);wi(babelHelpers.assertThisInitialized(i),vs);wi(babelHelpers.assertThisInitialized(i),hs);wi(babelHelpers.assertThisInitialized(i),ps);wi(babelHelpers.assertThisInitialized(i),us);wi(babelHelpers.assertThisInitialized(i),cs);wi(babelHelpers.assertThisInitialized(i),bs);wi(babelHelpers.assertThisInitialized(i),os);wi(babelHelpers.assertThisInitialized(i),ds);wi(babelHelpers.assertThisInitialized(i),ns);wi(babelHelpers.assertThisInitialized(i),rs);wi(babelHelpers.assertThisInitialized(i),ls);wi(babelHelpers.assertThisInitialized(i),as);wi(babelHelpers.assertThisInitialized(i),ss);wi(babelHelpers.assertThisInitialized(i),is);wi(babelHelpers.assertThisInitialized(i),ts);wi(babelHelpers.assertThisInitialized(i),es);wi(babelHelpers.assertThisInitialized(i),Qi);wi(babelHelpers.assertThisInitialized(i),Zi);wi(babelHelpers.assertThisInitialized(i),$i);wi(babelHelpers.assertThisInitialized(i),Ji);yi(babelHelpers.assertThisInitialized(i),Ai,{writable:true,value:void 0});yi(babelHelpers.assertThisInitialized(i),Wi,{writable:true,value:null});yi(babelHelpers.assertThisInitialized(i),_i,{writable:true,value:void 0});yi(babelHelpers.assertThisInitialized(i),Mi,{writable:true,value:void 0});yi(babelHelpers.assertThisInitialized(i),zi,{writable:true,value:void 0});yi(babelHelpers.assertThisInitialized(i),Li,{writable:true,value:void 0});yi(babelHelpers.assertThisInitialized(i),Oi,{writable:true,value:void 0});yi(babelHelpers.assertThisInitialized(i),Ni,{writable:true,value:void 0});yi(babelHelpers.assertThisInitialized(i),Di,{writable:true,value:void 0});yi(babelHelpers.assertThisInitialized(i),Bi,{writable:true,value:void 0});yi(babelHelpers.assertThisInitialized(i),Ri,{writable:true,value:null});yi(babelHelpers.assertThisInitialized(i),Xi,{writable:true,value:void 0});yi(babelHelpers.assertThisInitialized(i),xi,{writable:true,value:{requested:"",current:"",dropped:""}});yi(babelHelpers.assertThisInitialized(i),Ui,{writable:true,value:void 0});yi(babelHelpers.assertThisInitialized(i),Vi,{writable:true,value:false});yi(babelHelpers.assertThisInitialized(i),Yi,{writable:true,value:false});yi(babelHelpers.assertThisInitialized(i),ji,{writable:true,value:false});yi(babelHelpers.assertThisInitialized(i),Ki,{writable:true,value:false});yi(babelHelpers.assertThisInitialized(i),qi,{writable:true,value:null});i.setEventNamespace("BX.Location.Widget.Autocomplete");if(!(e.addressFormat instanceof r.Format)){throw new Error("props.addressFormat must be type of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Mi,e.addressFormat);if(!(e.autocompleteService instanceof r.AutocompleteServiceBase)){throw new Error("props.autocompleteService must be type of AutocompleteServiceBase")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Bi,e.autocompleteService);if(!e.languageId){throw new Error("props.languageId must be defined")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),_i,e.languageId);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),zi,e.sourceCode);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Ai,e.address);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Ni,e.presetLocationsProvider);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Li,e.locationRepository||new r.LocationRepository);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Oi,e.userLocationPoint);Ci(babelHelpers.assertThisInitialized(i),ds,_s).call(babelHelpers.assertThisInitialized(i),b.INITIAL);return i}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Xi,t.inputNode);babelHelpers.classPrivateFieldSet(this,Ai,t.address);babelHelpers.classPrivateFieldSet(this,Wi,new Hi(babelHelpers.classPrivateFieldGet(this,Xi),babelHelpers.classPrivateFieldGet(this,Mi),babelHelpers.classPrivateFieldGet(this,Ai)));babelHelpers.classPrivateFieldGet(this,Xi).addEventListener("keydown",Ci(this,hs,Ds).bind(this));babelHelpers.classPrivateFieldGet(this,Xi).addEventListener("keyup",Ci(this,vs,Bs).bind(this));babelHelpers.classPrivateFieldGet(this,Xi).addEventListener("focus",Ci(this,is,Ss).bind(this));babelHelpers.classPrivateFieldGet(this,Xi).addEventListener("focusout",Ci(this,ts,Gs).bind(this));babelHelpers.classPrivateFieldGet(this,Xi).addEventListener("click",Ci(this,Ji,gs).bind(this));babelHelpers.classPrivateFieldGet(this,Xi).addEventListener("paste",Ci(this,fs,Rs).bind(this));babelHelpers.classPrivateFieldSet(this,Di,new Zt({inputNode:t.inputNode,menuNode:t.menuNode}));babelHelpers.classPrivateFieldGet(this,Di).subscribe(Zt.onItemSelectedEvent,Ci(this,ns,Ws).bind(this));document.addEventListener("click",Ci(this,as,ks).bind(this))}},{key:"onAddressChangedEventSubscribe",value:function e(i){this.subscribe(Gi(t,t,Vs),i)}},{key:"onStateChangedEventSubscribe",value:function e(i){this.subscribe(Gi(t,t,Ys),i)}},{key:"onSearchStartedEventSubscribe",value:function e(i){this.subscribe(Gi(t,t,js),i)}},{key:"onSearchCompletedEventSubscribe",value:function e(i){this.subscribe(Gi(t,t,Ks),i)}},{key:"onShowOnMapClickedEventSubscribe",value:function e(i){this.subscribe(Gi(t,t,qs),i)}},{key:"showPrompt",value:function e(t){babelHelpers.classPrivateFieldGet(this,xi).requested=t;babelHelpers.classPrivateFieldGet(this,xi).current=t;babelHelpers.classPrivateFieldGet(this,xi).dropped="";Ci(this,Ps,xs).call(this,t)}},{key:"closePrompt",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Di)){babelHelpers.classPrivateFieldGet(this,Di).close()}}},{key:"isPromptShown",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Di)){babelHelpers.classPrivateFieldGet(this,Di).isShown()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Yi)){return}o.Event.unbindAll(this);if(babelHelpers.classPrivateFieldGet(this,Di)){babelHelpers.classPrivateFieldGet(this,Di).destroy();babelHelpers.classPrivateFieldSet(this,Di,null)}babelHelpers.classPrivateFieldSet(this,Ri,null);if(babelHelpers.classPrivateFieldGet(this,Xi)){babelHelpers.classPrivateFieldGet(this,Xi).removeEventListener("keydown",Ci(this,hs,Ds));babelHelpers.classPrivateFieldGet(this,Xi).removeEventListener("keyup",Ci(this,vs,Bs));babelHelpers.classPrivateFieldGet(this,Xi).removeEventListener("focus",Ci(this,is,Ss));babelHelpers.classPrivateFieldGet(this,Xi).removeEventListener("focusout",Ci(this,ts,Gs));babelHelpers.classPrivateFieldGet(this,Xi).removeEventListener("click",Ci(this,Ji,gs));babelHelpers.classPrivateFieldGet(this,Xi).removeEventListener("paste",Ci(this,fs,Rs))}document.removeEventListener("click",Ci(this,as,ks));babelHelpers.classPrivateFieldSet(this,Yi,true)}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ai,t);if(babelHelpers.classPrivateFieldGet(this,Wi)){babelHelpers.classPrivateFieldGet(this,Wi).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,Ai))}if(!t){babelHelpers.classPrivateFieldSet(this,Vi,true)}},get:function e(){return babelHelpers.classPrivateFieldGet(this,Ai)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ui)}}]);return t}(d.EventEmitter);function gs(e){var t=babelHelpers.classPrivateFieldGet(this,Wi).value;if(t.length===0){Ci(this,$i,Ts).call(this)}}function Ts(){var e=babelHelpers.classPrivateFieldGet(this,Ni).call(this);babelHelpers.classPrivateFieldGet(this,Di).setMenuItems(e,"");var t;if(e.length>0){t=o.Loc.getMessage("LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP")}else{t=o.Loc.getMessage("LOCATION_WIDGET_START_PRINTING_OR_SHOW_ON_MAP")}Ci(this,es,Is).call(this,t,null)}function ws(e){var t=o.Tag.render(gi||(gi=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="location-map-popup-item--show-on-map">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t"])),o.Loc.getMessage("LOCATION_WIDGET_SHOW_ON_MAP"));t.addEventListener("click",Ci(this,rs,As).call(this,e));return t}function ys(e){return o.Tag.render(Ti||(Ti=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span>\n\t\t\t\t\t<span class="menu-popup-item-icon"></span>\n\t\t\t\t\t<span class="menu-popup-item-text">',"</span>\n\t\t\t\t</span>\n\t\t"])),e)}function Is(e,t){babelHelpers.classPrivateFieldGet(this,Di).getMenu().setBottomRightItemNode(Ci(this,Zi,ws).call(this,t));babelHelpers.classPrivateFieldGet(this,Di).getMenu().setBottomLeftItemNode(Ci(this,Qi,ys).call(this,e));babelHelpers.classPrivateFieldGet(this,Di).getMenu().show()}function Gs(e){if(babelHelpers.classPrivateFieldGet(this,Yi)){return}if(babelHelpers.classPrivateFieldGet(this,Ui)===b.DATA_INPUTTING&&!(e.relatedTarget&&e.relatedTarget.getAttribute("data-role")==="location-widget-menu-item")){Ci(this,ds,_s).call(this,b.DATA_SUPPOSED);var t=false;if(babelHelpers.classPrivateFieldGet(this,Wi)){if(!babelHelpers.classPrivateFieldGet(this,Ai)||!babelHelpers.classPrivateFieldGet(this,Wi).hasPureAddressString()){babelHelpers.classPrivateFieldSet(this,Ai,Ci(this,us,Os).call(this,babelHelpers.classPrivateFieldGet(this,Wi).value));t=true}else if(babelHelpers.classPrivateFieldGet(this,Wi).customTail!==""){var i=babelHelpers.classPrivateFieldGet(this,Ai).getFieldValue(babelHelpers.classPrivateFieldGet(this,Mi).fieldForUnRecognized);var s=i?i+babelHelpers.classPrivateFieldGet(this,Wi).customTail:babelHelpers.classPrivateFieldGet(this,Wi).customTail;babelHelpers.classPrivateFieldGet(this,Ai).setFieldValue(babelHelpers.classPrivateFieldGet(this,Mi).fieldForUnRecognized,s);t=true}}if(t){babelHelpers.classPrivateFieldGet(this,Wi).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,Ai));Ci(this,bs,zs).call(this,[],{storeAsLastAddress:false})}}e.stopImmediatePropagation()}function Ss(){var e=this;if(babelHelpers.classPrivateFieldGet(this,Yi)){return}if(!babelHelpers.classPrivateFieldGet(this,Ai)){var t=r.Storage.getInstance().lastAddress;if(t&&t.fieldCollection.isFieldExists(r.AddressType.LOCALITY)&&!babelHelpers.classPrivateFieldGet(this,Vi)){var i={};i[r.AddressType.LOCALITY]=t.fieldCollection.getFieldValue(r.AddressType.LOCALITY);if(t.fieldCollection.isFieldExists(r.AddressType.COUNTRY)){i[r.AddressType.COUNTRY]=t.fieldCollection.getFieldValue(r.AddressType.COUNTRY)}if(t.fieldCollection.isFieldExists(r.AddressType.ADM_LEVEL_1)){i[r.AddressType.ADM_LEVEL_1]=t.fieldCollection.getFieldValue(r.AddressType.ADM_LEVEL_1)}if(["RU","RU_2"].includes(babelHelpers.classPrivateFieldGet(this,Mi).code)){i[r.AddressType.ADDRESS_LINE_2]=", "}babelHelpers.classPrivateFieldSet(this,Ai,new r.Address({languageId:t.languageId,fieldCollection:i}));babelHelpers.classPrivateFieldGet(this,Wi).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,Ai));Ci(this,ds,_s).call(this,b.DATA_SUPPOSED);Ci(this,bs,zs).call(this,[],{storeAsLastAddress:false});setTimeout((function(){BX.setCaretPosition(babelHelpers.classPrivateFieldGet(e,Xi),babelHelpers.classPrivateFieldGet(e,Xi).value.length)}),0)}}else{if(babelHelpers.classPrivateFieldGet(this,Ai)&&(!babelHelpers.classPrivateFieldGet(this,Ai).location||!babelHelpers.classPrivateFieldGet(this,Ai).location.hasExternalRelation())&&babelHelpers.classPrivateFieldGet(this,Wi).value.length>0){this.showPrompt(babelHelpers.classPrivateFieldGet(this,Wi).value)}}}function Es(){var e={};if(babelHelpers.classPrivateFieldGet(this,Ai)&&babelHelpers.classPrivateFieldGet(this,Ai).latitude&&babelHelpers.classPrivateFieldGet(this,Ai).longitude){e.biasPoint=new r.Point(babelHelpers.classPrivateFieldGet(this,Ai).latitude,babelHelpers.classPrivateFieldGet(this,Ai).longitude)}return e}function ks(e){if(babelHelpers.classPrivateFieldGet(this,Yi)){return}if(e.target===babelHelpers.classPrivateFieldGet(this,Xi)){return}if(babelHelpers.classPrivateFieldGet(this,Di).isShown()){babelHelpers.classPrivateFieldGet(this,Di).close()}}function Cs(e,t){var i=this;if(Array.isArray(e)&&e.length>0){if(e.length===1&&babelHelpers.classPrivateFieldGet(this,Ai)&&babelHelpers.classPrivateFieldGet(this,Ai).location&&babelHelpers.classPrivateFieldGet(this,Ai).location.externalId&&babelHelpers.classPrivateFieldGet(this,Ai).location.externalId===e[0].externalId){this.closePrompt();return}babelHelpers.classPrivateFieldGet(this,Di).setMenuItems(e,babelHelpers.classPrivateFieldGet(this,xi).requested,this.address);Ci(this,es,Is).call(this,o.Loc.getMessage("LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP"),e[0])}else{babelHelpers.classPrivateFieldGet(this,Di).getMenu().clearItems();babelHelpers.classPrivateFieldGet(this,Di).getMenu().addMenuItem({id:"notFound",html:"<span>".concat(o.Loc.getMessage("LOCATION_WIDGET_PROMPT_ADDRESS_NOT_FOUND"),"</span>"),onclick:function e(t,s){babelHelpers.classPrivateFieldGet(i,Di).close()}});Ci(this,es,Is).call(this,o.Loc.getMessage("LOCATION_WIDGET_CHECK_ADDRESS_OR_SHOW_ON_MAP"),null)}}function As(e){var t=this;return function(){if(e){Ci(t,os,Ms).call(t,e);return}setTimeout((function(){t.emit(Gi(ms,ms,qs))}),1)}}function Ws(e){if(e.data.location){Ci(this,os,Ms).call(this,e.data.location)}}function _s(e){babelHelpers.classPrivateFieldSet(this,Ui,e);this.emit(Gi(ms,ms,Ys),{state:babelHelpers.classPrivateFieldGet(this,Ui)})}function Ms(e){var t=this;var i;Ci(this,ds,_s).call(this,b.DATA_SELECTED);if(e){if(e.hasExternalRelation()&&babelHelpers.classPrivateFieldGet(this,zi)===e.sourceCode){i=Ci(this,cs,Ls).call(this,e).then((function(i){if(e.address&&e.address.getFieldValue(r.AddressType.ADDRESS_LINE_2)){var s="";if(i.address.getFieldValue(r.AddressType.ADDRESS_LINE_2)){s=i.address.getFieldValue(r.AddressType.ADDRESS_LINE_2);s+=", "}s+=e.address.getFieldValue(r.AddressType.ADDRESS_LINE_2);i.address.setFieldValue(r.AddressType.ADDRESS_LINE_2,s)}Ci(t,Hs,Xs).call(t,i,0);return true}),(function(e){return r.ErrorPublisher.getInstance().notify(e.errors)}))}else{i=new Promise((function(i){setTimeout((function(){Ci(t,Hs,Xs).call(t,e,0);i()}),0)}))}}else{i=new Promise((function(e){setTimeout((function(){Ci(t,Hs,Xs).call(t,null,0);e()}),0)}))}return i}function zs(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.emit(Gi(ms,ms,Vs),{address:babelHelpers.classPrivateFieldGet(this,Ai),excludeSetAddressFeatures:e,options:t})}function Ls(e){var t=this;Ci(this,ds,_s).call(this,b.DATA_LOADING);return babelHelpers.classPrivateFieldGet(this,Li).findByExternalId(e.externalId,e.sourceCode,e.languageId).then((function(i){Ci(t,ds,_s).call(t,b.DATA_LOADED);var s;if(i.latitude!=="0"&&i.longitude!=="0"&&i!==""){s=i;s.name=e.name}else{s=e}return s}),(function(e){r.ErrorPublisher.getInstance().notify(e.errors)}))}function Os(e){var t=new r.Address({languageId:babelHelpers.classPrivateFieldGet(this,_i)});t.setFieldValue(babelHelpers.classPrivateFieldGet(this,Mi).fieldForUnRecognized,e);return t}function Ns(e){babelHelpers.classPrivateFieldSet(this,Ai,e?e.toAddress():null);babelHelpers.classPrivateFieldGet(this,Wi).setValueFromAddress(babelHelpers.classPrivateFieldGet(this,Ai));Ci(this,bs,zs).call(this)}function Ds(e){if(!(babelHelpers.classPrivateFieldGet(this,Xi)&&babelHelpers.classPrivateFieldGet(this,Xi).selectionStart===0&&babelHelpers.classPrivateFieldGet(this,Xi).selectionEnd===babelHelpers.classPrivateFieldGet(this,Xi).value.length)){return}if(e.code==="Backspace"||e.code==="Delete"||e.code==="KeyV"&&(e.ctrlKey||e.metaKey)||e.code==="KeyX"&&(e.ctrlKey||e.metaKey)||e.code==="Insert"&&e.shiftKey||!(e.ctrlKey||e.metaKey)&&babelHelpers.toConsumableArray(e.key).length===1){this.address=null;Ci(this,bs,zs).call(this)}}function Bs(e){var t=this;if(babelHelpers.classPrivateFieldGet(this,Yi)){return}if(babelHelpers.classPrivateFieldGet(this,Ui)!==b.DATA_INPUTTING&&babelHelpers.classPrivateFieldGet(this,Wi).isChanged()){Ci(this,ds,_s).call(this,b.DATA_INPUTTING)}if(babelHelpers.classPrivateFieldGet(this,Di).isShown()){var i;var s=700;switch(e.code){case"NumpadEnter":case"Enter":if(babelHelpers.classPrivateFieldGet(this,Di).isItemChosen()){Ci(this,os,Ms).call(this,babelHelpers.classPrivateFieldGet(this,Di).getChosenItem()).then((function(){babelHelpers.classPrivateFieldGet(t,Di).close()}),(function(e){return BX.debug(e)}))}return;case"Tab":case"Escape":Ci(this,ds,_s).call(this,b.DATA_SUPPOSED);Ci(this,bs,zs).call(this);babelHelpers.classPrivateFieldGet(this,Di).close();return;case"ArrowUp":i=babelHelpers.classPrivateFieldGet(this,Di).choosePrevItem();if(i&&i.address){Ci(this,Hs,Xs).call(this,i,s)}return;case"ArrowDown":i=babelHelpers.classPrivateFieldGet(this,Di).chooseNextItem();if(i&&i.address){Ci(this,Hs,Xs).call(this,i,s)}return}}if(babelHelpers.classPrivateFieldGet(this,Wi).isChanged()){babelHelpers.classPrivateFieldGet(this,Wi).actualize();this.showPrompt(babelHelpers.classPrivateFieldGet(this,Wi).value)}if(babelHelpers.classPrivateFieldGet(this,Wi).value.length===0){Ci(this,$i,Ts).call(this)}}function Rs(){var e=this;setTimeout((function(){if(babelHelpers.classPrivateFieldGet(e,Ui)!==b.DATA_INPUTTING&&babelHelpers.classPrivateFieldGet(e,Wi).isChanged()){Ci(e,ds,_s).call(e,b.DATA_INPUTTING)}if(babelHelpers.classPrivateFieldGet(e,Wi).isChanged()){babelHelpers.classPrivateFieldGet(e,Wi).actualize();e.showPrompt(babelHelpers.classPrivateFieldGet(e,Wi).value)}}),0)}function Xs(e,t){var i=this;if(babelHelpers.classPrivateFieldGet(this,qi)!==null){clearTimeout(babelHelpers.classPrivateFieldGet(this,qi))}babelHelpers.classPrivateFieldSet(this,qi,setTimeout((function(){Ci(i,ps,Ns).call(i,e)}),t))}function xs(e){if(e.length<=3){return}if(babelHelpers.classPrivateFieldGet(this,Ri)!==null){clearTimeout(babelHelpers.classPrivateFieldGet(this,Ri))}babelHelpers.classPrivateFieldSet(this,Ri,Ci(this,Fs,Us).call(this,e))}function Us(e){var t=this;return setTimeout((function(){if(babelHelpers.classPrivateFieldGet(t,ji)){clearTimeout(babelHelpers.classPrivateFieldGet(t,Ri));babelHelpers.classPrivateFieldSet(t,Ri,Ci(t,Fs,Us).call(t,e));babelHelpers.classPrivateFieldSet(t,Ki,true);return}babelHelpers.classPrivateFieldSet(t,Ki,false);t.emit(Gi(ms,ms,js));babelHelpers.classPrivateFieldSet(t,ji,true);var i=Ci(t,ss,Es).call(t);babelHelpers.classPrivateFieldGet(t,Bi).autocomplete(e,i).then((function(e){babelHelpers.classPrivateFieldSet(t,Ri,null);if(!babelHelpers.classPrivateFieldGet(t,Ki)){Ci(t,ls,Cs).call(t,e,i);t.emit(Gi(ms,ms,Ks))}babelHelpers.classPrivateFieldSet(t,ji,false)}),(function(e){if(!babelHelpers.classPrivateFieldGet(t,Ki)){t.emit(Gi(ms,ms,Ks))}babelHelpers.classPrivateFieldSet(t,ji,false);BX.debug(e)}))}),300)}var Vs={writable:true,value:"onAddressChanged"};var Ys={writable:true,value:"onStateChanged"};var js={writable:true,value:"onSearchStarted"};var Ks={writable:true,value:"onSearchCompleted"};var qs={writable:true,value:"onShowOnMapClicked"};var Js,$s;function Zs(e,t,i){Qs(e,t);t.set(e,i)}function Qs(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var ea=new WeakMap;var ta=new WeakMap;var ia=new WeakMap;var sa=new WeakMap;var aa=new WeakMap;var la=function(){function e(t){babelHelpers.classCallCheck(this,e);Zs(this,ea,{writable:true,value:void 0});Zs(this,ta,{writable:true,value:void 0});Zs(this,ia,{writable:true,value:void 0});Zs(this,sa,{writable:true,value:void 0});Zs(this,aa,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ta,t.url);babelHelpers.classPrivateFieldSet(this,ia,t.link||"");babelHelpers.classPrivateFieldSet(this,ea,t.description||"");babelHelpers.classPrivateFieldSet(this,sa,t.location);babelHelpers.classPrivateFieldSet(this,aa,t.title||"")}babelHelpers.createClass(e,[{key:"render",value:function e(){var t="";if(babelHelpers.classPrivateFieldGet(this,ea)){t=o.Tag.render(Js||(Js=babelHelpers.taggedTemplateLiteral(['<span class="location-map-item-description">',"</span>"])),babelHelpers.classPrivateFieldGet(this,ea))}return o.Tag.render($s||($s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-item-block">\n\t\t\t\t<span class="location-map-photo-item-block-image-block-inner">\n\t\t\t\t\t','\n\t\t\t\t\t<span \n\t\t\t\t\t\tdata-viewer data-viewer-type="image" \n\t\t\t\t\t\tdata-src="','" \n\t\t\t\t\t\tdata-title="','"\n\t\t\t\t\t\tclass="location-map-item-photo-image" \n\t\t\t\t\t\tdata-viewer-group-by="','"\n\t\t\t\t\t\tstyle="background-image: url(',');">\t\t\t\t\t\t\t\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>'])),t,babelHelpers.classPrivateFieldGet(this,ia),babelHelpers.classPrivateFieldGet(this,aa),babelHelpers.classPrivateFieldGet(this,sa).externalId,babelHelpers.classPrivateFieldGet(this,ta))}}]);return e}();var ra,na;function da(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=oa(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var s=0;var a=function e(){};return{s:a,n:function t(){if(s>=e.length)return{done:true};return{done:false,value:e[s++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&i["return"]!=null)i["return"]()}finally{if(r)throw n}}}}function oa(e,t){if(!e)return;if(typeof e==="string")return ba(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ba(e,t)}function ba(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function ca(e,t){pa(e,t);t.add(e)}function ua(e,t,i){pa(e,t);t.set(e,i)}function pa(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function ha(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var va=new WeakMap;var fa=new WeakMap;var Ha=new WeakMap;var Pa=new WeakMap;var Fa=new WeakMap;var ma=new WeakMap;var ga=new WeakMap;var Ta=new WeakMap;var wa=new WeakSet;var ya=new WeakSet;var Ia=function(){function e(t){babelHelpers.classCallCheck(this,e);ca(this,ya);ca(this,wa);ua(this,va,{writable:true,value:[]});ua(this,fa,{writable:true,value:null});ua(this,Ha,{writable:true,value:null});ua(this,Pa,{writable:true,value:void 0});ua(this,Fa,{writable:true,value:void 0});ua(this,ma,{writable:true,value:void 0});ua(this,ga,{writable:true,value:void 0});ua(this,Ta,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Pa,t.thumbnailHeight);babelHelpers.classPrivateFieldSet(this,Fa,t.thumbnailWidth);babelHelpers.classPrivateFieldSet(this,ga,t.maxPhotoCount);babelHelpers.classPrivateFieldSet(this,ma,t.photoService)}babelHelpers.createClass(e,[{key:"refresh",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Ta)){babelHelpers.classPrivateFieldGet(this,ma).requestPhotos({location:babelHelpers.classPrivateFieldGet(this,Ta),thumbnailHeight:babelHelpers.classPrivateFieldGet(this,Pa),thumbnailWidth:babelHelpers.classPrivateFieldGet(this,Fa),maxPhotoCount:babelHelpers.classPrivateFieldGet(this,ga)}).then((function(e){if(Array.isArray(e)&&e.length>0){ha(t,wa,Ga).call(t,e);t.show()}else{t.hide()}}))}else{this.hide()}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,fa)){babelHelpers.classPrivateFieldGet(this,fa).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,fa)||babelHelpers.classPrivateFieldGet(this,fa).clientWidth<=0}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,fa)){babelHelpers.classPrivateFieldGet(this,fa).style.display="block"}}},{key:"render",value:function e(){babelHelpers.classPrivateFieldSet(this,Ha,o.Tag.render(ra||(ra=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\n\t\t\t\t<div class="location-map-photo-inner">\t\t\t\t\t\n\t\t\t\t</div>']))));babelHelpers.classPrivateFieldSet(this,fa,o.Tag.render(na||(na=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-container">\n\t\t\t\t',"\n\t\t\t</div>"])),babelHelpers.classPrivateFieldGet(this,Ha)));return babelHelpers.classPrivateFieldGet(this,fa)}},{key:"location",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ta,t);this.refresh()}}]);return e}();function Ga(e){if(!babelHelpers.classPrivateFieldGet(this,Ta)){return}var t=[];var i=da(e),s;try{for(i.s();!(s=i.n()).done;){var a=s.value;t.push(new la({url:a.thumbnail.url,link:a.url,location:babelHelpers.classPrivateFieldGet(this,Ta),title:babelHelpers.classPrivateFieldGet(this,Ta).name+" ( "+BX.util.strip_tags(a.description)+" )"}))}}catch(e){i.e(e)}finally{i.f()}if(!Array.isArray(t)){BX.debug("Wrong type of photos. Must be array");return}babelHelpers.classPrivateFieldSet(this,va,[]);for(var l=0,r=t;l<r.length;l++){var n=r[l];babelHelpers.classPrivateFieldGet(this,va).push(n)}if(babelHelpers.classPrivateFieldGet(this,va).length>0&&babelHelpers.classPrivateFieldGet(this,Ha)){var d=babelHelpers.classPrivateFieldGet(this,va)?ha(this,ya,Sa).call(this,babelHelpers.classPrivateFieldGet(this,va)):"";babelHelpers.classPrivateFieldGet(this,Ha).innerHTML="";if(d.length>0){var o=da(d),b;try{for(o.s();!(b=o.n()).done;){var c=b.value;babelHelpers.classPrivateFieldGet(this,Ha).appendChild(c)}}catch(e){o.e(e)}finally{o.f()}}}}function Sa(e){var t=[];var i=da(e),s;try{for(i.s();!(s=i.n()).done;){var a=s.value;t.push(a.render())}}catch(e){i.e(e)}finally{i.f()}return t}var Ea,ka,Ca,Aa;function Wa(e,t){Ma(e,t);t.add(e)}function _a(e,t,i){Ma(e,t);t.set(e,i)}function Ma(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function za(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}function La(e,t,i){Na(e,t);Oa(i,"get");return Da(e,i)}function Oa(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function Na(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function Da(e,t){if(t.get){return t.get.call(e)}return t.value}var Ba=new WeakMap;var Ra=new WeakMap;var Xa=new WeakMap;var xa=new WeakMap;var Ua=new WeakMap;var Va=new WeakMap;var Ya=new WeakMap;var ja=new WeakMap;var Ka=new WeakMap;var qa=new WeakSet;var Ja=new WeakSet;var $a=new WeakSet;var Za=new WeakSet;var Qa=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Wa(babelHelpers.assertThisInitialized(i),Za);Wa(babelHelpers.assertThisInitialized(i),$a);Wa(babelHelpers.assertThisInitialized(i),Ja);Wa(babelHelpers.assertThisInitialized(i),qa);_a(babelHelpers.assertThisInitialized(i),Ba,{writable:true,value:void 0});_a(babelHelpers.assertThisInitialized(i),Ra,{writable:true,value:void 0});_a(babelHelpers.assertThisInitialized(i),Xa,{writable:true,value:void 0});_a(babelHelpers.assertThisInitialized(i),xa,{writable:true,value:void 0});_a(babelHelpers.assertThisInitialized(i),Ua,{writable:true,value:void 0});_a(babelHelpers.assertThisInitialized(i),Va,{writable:true,value:void 0});_a(babelHelpers.assertThisInitialized(i),Ya,{writable:true,value:void 0});_a(babelHelpers.assertThisInitialized(i),ja,{writable:true,value:null});_a(babelHelpers.assertThisInitialized(i),Ka,{writable:true,value:b.INITIAL});i.setEventNamespace("BX.Location.Widget.Field");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Ba,e.title);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Xa,e.type);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),xa,e.sort);return i}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ra,typeof t.value==="string"?t.value:"");if(!r.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,Ua,t.mode);babelHelpers.classPrivateFieldSet(this,ja,o.Tag.render(Ea||(Ea=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block ui-entity-editor-field-text">\n\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t<label class="ui-entity-editor-block-title-text">',":</label>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>"])),babelHelpers.classPrivateFieldGet(this,Ba)));if(babelHelpers.classPrivateFieldGet(this,Ua)===r.ControlMode.edit){za(this,Ja,tl).call(this,babelHelpers.classPrivateFieldGet(this,ja))}else{za(this,$a,il).call(this,babelHelpers.classPrivateFieldGet(this,ja))}return babelHelpers.classPrivateFieldGet(this,ja)}},{key:"subscribeOnValueChangedEvent",value:function e(i){this.subscribe(La(t,t,al),i)}},{key:"subscribeOnStateChangedEvent",value:function e(i){this.subscribe(La(t,t,ll),i)}},{key:"destroy",value:function e(){o.Dom.remove(babelHelpers.classPrivateFieldGet(this,ja));o.Event.unbindAll(this);babelHelpers.classPrivateFieldSet(this,ja,null)}},{key:"container",get:function e(){return babelHelpers.classPrivateFieldGet(this,ja)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ka)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,Xa,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,Xa)}},{key:"sort",set:function e(t){babelHelpers.classPrivateFieldSet(this,xa,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,xa)}},{key:"value",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ra,typeof t==="string"?t:"");za(this,Za,sl).call(this)},get:function e(){return babelHelpers.classPrivateFieldGet(this,Ra)}}]);return t}(d.EventEmitter);function el(e){babelHelpers.classPrivateFieldSet(this,Ka,e);this.emit(La(Qa,Qa,ll),{state:babelHelpers.classPrivateFieldGet(this,Ka)})}function tl(e){var t=this;babelHelpers.classPrivateFieldSet(this,Va,o.Tag.render(ka||(ka=babelHelpers.taggedTemplateLiteral(['<input type="text" class="ui-ctl-element" value="','">'])),o.Text.encode(babelHelpers.classPrivateFieldGet(this,Ra))));babelHelpers.classPrivateFieldSet(this,Ya,null);o.Event.bind(babelHelpers.classPrivateFieldGet(this,Va),"focus",(function(e){za(t,qa,el).call(t,b.DATA_INPUTTING)}));o.Event.bind(babelHelpers.classPrivateFieldGet(this,Va),"focusout",(function(e){za(t,qa,el).call(t,b.DATA_SELECTED)}));o.Event.bind(babelHelpers.classPrivateFieldGet(this,Va),"change",(function(e){za(t,qa,el).call(t,b.DATA_SELECTED);babelHelpers.classPrivateFieldSet(t,Ra,babelHelpers.classPrivateFieldGet(t,Va).value);t.emit(La(Qa,Qa,al),{value:t})}));e.appendChild(o.Tag.render(Ca||(Ca=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>"])),babelHelpers.classPrivateFieldGet(this,Va)))}function il(e){babelHelpers.classPrivateFieldSet(this,Va,null);babelHelpers.classPrivateFieldSet(this,Ya,o.Tag.render(Aa||(Aa=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-title-6">\n\t\t\t\t',"\n\t\t\t</div>"])),o.Text.encode(babelHelpers.classPrivateFieldGet(this,Ra))));e.appendChild(babelHelpers.classPrivateFieldGet(this,Ya))}function sl(){if(babelHelpers.classPrivateFieldGet(this,Ua)===r.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,Va).value=babelHelpers.classPrivateFieldGet(this,Ra)}else{babelHelpers.classPrivateFieldGet(this,Ya).innerHTML=o.Text.encode(babelHelpers.classPrivateFieldGet(this,Ra))}}var al={writable:true,value:"onValueChanged"};var ll={writable:true,value:"onStateChanged"};function rl(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=nl(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var s=0;var a=function e(){};return{s:a,n:function t(){if(s>=e.length)return{done:true};return{done:false,value:e[s++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,r=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();l=t.done;return t},e:function e(t){r=true;n=t},f:function e(){try{if(!l&&i["return"]!=null)i["return"]()}finally{if(r)throw n}}}}function nl(e,t){if(!e)return;if(typeof e==="string")return dl(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return dl(e,t)}function dl(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function ol(e,t){cl(e,t);t.add(e)}function bl(e,t,i){cl(e,t);t.set(e,i)}function cl(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function ul(e,t,i){hl(e,t);pl(i,"get");return vl(e,i)}function pl(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function hl(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function vl(e,t){if(t.get){return t.get.call(e)}return t.value}function fl(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Hl=new WeakMap;var Pl=new WeakMap;var Fl=new WeakMap;var ml=new WeakMap;var gl=new WeakMap;var Tl=new WeakMap;var wl=new WeakMap;var yl=new WeakSet;var Il=new WeakSet;var Gl=new WeakSet;var Sl=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));ol(babelHelpers.assertThisInitialized(i),Gl);ol(babelHelpers.assertThisInitialized(i),Il);ol(babelHelpers.assertThisInitialized(i),yl);bl(babelHelpers.assertThisInitialized(i),Hl,{writable:true,value:void 0});bl(babelHelpers.assertThisInitialized(i),Pl,{writable:true,value:void 0});bl(babelHelpers.assertThisInitialized(i),Fl,{writable:true,value:void 0});bl(babelHelpers.assertThisInitialized(i),ml,{writable:true,value:[]});bl(babelHelpers.assertThisInitialized(i),gl,{writable:true,value:void 0});bl(babelHelpers.assertThisInitialized(i),Tl,{writable:true,value:void 0});bl(babelHelpers.assertThisInitialized(i),wl,{writable:true,value:void 0});i.setEventNamespace("BX.Location.Widget.Fields");if(!(e.addressFormat instanceof r.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Pl,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),gl,e.languageId);fl(babelHelpers.assertThisInitialized(i),yl,El).call(babelHelpers.assertThisInitialized(i));return i}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(t.address&&!(t.address instanceof r.Address)){BX.debug("props.address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,Hl,t.address);if(!r.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,Fl,t.mode);if(!o.Type.isDomNode(t.container)){BX.debug("props.container must be dom node")}babelHelpers.classPrivateFieldSet(this,Tl,t.container);var i=rl(babelHelpers.classPrivateFieldGet(this,ml)),s;try{for(i.s();!(s=i.n()).done;){var a=s.value;var l=babelHelpers.classPrivateFieldGet(this,Hl)?babelHelpers.classPrivateFieldGet(this,Hl).getFieldValue(a.type):"";if(babelHelpers.classPrivateFieldGet(this,Fl)===r.ControlMode.view&&!l){continue}var n=a.render({value:l,mode:babelHelpers.classPrivateFieldGet(this,Fl)});babelHelpers.classPrivateFieldGet(this,Tl).appendChild(n)}}catch(e){i.e(e)}finally{i.f()}}},{key:"subscribeOnAddressChangedEvent",value:function e(i){this.subscribe(ul(t,t,Al),i)}},{key:"destroy",value:function e(){o.Event.unbindAll(this);var t=rl(babelHelpers.classPrivateFieldGet(this,ml)),i;try{for(t.s();!(i=t.n()).done;){var s=i.value;s.destroy()}}catch(e){t.e(e)}finally{t.f()}o.Dom.clean(babelHelpers.classPrivateFieldGet(this,Tl))}},{key:"subscribeOnStateChangedEvent",value:function e(i){this.subscribe(ul(t,t,Wl),i)}},{key:"address",set:function e(t){if(t&&!(t instanceof r.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,Hl,t);var i=rl(babelHelpers.classPrivateFieldGet(this,ml)),s;try{for(i.s();!(s=i.n()).done;){var a=s.value;a.value=babelHelpers.classPrivateFieldGet(this,Hl)?babelHelpers.classPrivateFieldGet(this,Hl).getFieldValue(a.type):""}}catch(e){i.e(e)}finally{i.f()}}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,wl)}}]);return t}(d.EventEmitter);function El(){var e=this;var t=function t(){if(!babelHelpers.classPrivateFieldGet(e,Pl).fieldCollection.fields.hasOwnProperty(i)){return"continue"}var s=babelHelpers.classPrivateFieldGet(e,Pl).fieldCollection.fields[i];var a=new Qa({title:s.name,type:s.type,sort:s.sort});a.subscribeOnValueChangedEvent((function(t){fl(e,Il,kl).call(e,a)}));a.subscribeOnStateChangedEvent((function(t){var i=t.getData();fl(e,Gl,Cl).call(e,i.state)}));babelHelpers.classPrivateFieldGet(e,ml).push(a)};for(var i in babelHelpers.classPrivateFieldGet(this,Pl).fieldCollection.fields){var s=t();if(s==="continue")continue}babelHelpers.classPrivateFieldGet(this,ml).sort((function(e,t){return e.sort-t.sort}))}function kl(e){if(!babelHelpers.classPrivateFieldGet(this,Hl)){babelHelpers.classPrivateFieldSet(this,Hl,new r.Address({languageId:babelHelpers.classPrivateFieldGet(this,gl)}))}babelHelpers.classPrivateFieldGet(this,Hl).setFieldValue(e.type,e.value);this.emit(ul(Sl,Sl,Al),{address:babelHelpers.classPrivateFieldGet(this,Hl),changedField:e})}function Cl(e){babelHelpers.classPrivateFieldSet(this,wl,e);this.emit(ul(Sl,Sl,Wl),{state:babelHelpers.classPrivateFieldGet(this,wl)})}var Al={writable:true,value:"onAddressChanged"};var Wl={writable:true,value:"onStateChanged"};function _l(e,t,i){Ml(e,t);t.set(e,i)}function Ml(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var zl=new WeakMap;var Ll=new WeakMap;var Ol=new WeakMap;var Nl=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));_l(babelHelpers.assertThisInitialized(i),zl,{writable:true,value:null});_l(babelHelpers.assertThisInitialized(i),Ll,{writable:true,value:null});_l(babelHelpers.assertThisInitialized(i),Ol,{writable:true,value:null});if(!(e.map instanceof fe)){BX.debug("props.map must be instance of MapPopup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),zl,e.map);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),zl).onChangedEventSubscribe((function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Ol).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(i))}));return i}babelHelpers.createClass(t,[{key:"showMap",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!babelHelpers.classPrivateFieldGet(this,zl).isShown()){babelHelpers.classPrivateFieldGet(this,zl).show(t)}}},{key:"closeMap",value:function e(){if(babelHelpers.classPrivateFieldGet(this,zl).isShown()){babelHelpers.classPrivateFieldGet(this,zl).close()}babelHelpers.classPrivateFieldGet(this,zl).bindelement=babelHelpers.classPrivateFieldGet(this,Ll)}},{key:"resetView",value:function e(){this.closeMap()}},{key:"render",value:function e(t){if(!o.Type.isDomNode(t.mapBindElement)){BX.debug("props.mapBindElement  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,Ll,t.mapBindElement);babelHelpers.classPrivateFieldGet(this,zl).render({bindElement:t.mapBindElement,address:babelHelpers.classPrivateFieldGet(this,Ol).address,mode:babelHelpers.classPrivateFieldGet(this,Ol).mode})}},{key:"setAddress",value:function e(t){if(this.addressWidget.state===b.DATA_INPUTTING){return}babelHelpers.classPrivateFieldGet(this,zl).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ol,t)}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,zl).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,zl).destroy();babelHelpers.classPrivateFieldSet(this,zl,null)}},{key:"map",get:function e(){return babelHelpers.classPrivateFieldGet(this,zl)}},{key:"addressWidget",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ol)}},{key:"mapBindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ll)}}]);return t}(_e);function Dl(e,t,i){Bl(e,t);t.set(e,i)}function Bl(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Rl=new WeakMap;var Xl=new WeakMap;var xl=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Dl(babelHelpers.assertThisInitialized(i),Rl,{writable:true,value:void 0});Dl(babelHelpers.assertThisInitialized(i),Xl,{writable:true,value:null});if(!(e.autocomplete instanceof ms)){BX.debug("props.autocomplete  must be instance of Autocomplete")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Rl,e.autocomplete);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Rl).onAddressChangedEventSubscribe((function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Xl).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(i),t.excludeSetAddressFeatures,t.options)}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Rl).onStateChangedEventSubscribe((function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Xl).setStateByFeature(t.state)}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Rl).onSearchStartedEventSubscribe((function(e){var s=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Xl).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(i),eventCode:t.searchStartedEvent,payload:s})}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Rl).onSearchCompletedEventSubscribe((function(e){var s=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Xl).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(i),eventCode:t.searchCompletedEvent,payload:s})}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Rl).onShowOnMapClickedEventSubscribe((function(e){var s=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Xl).emitFeatureEvent({feature:babelHelpers.assertThisInitialized(i),eventCode:t.showOnMapClickedEvent,payload:s})}));return i}babelHelpers.createClass(t,[{key:"resetView",value:function e(){babelHelpers.classPrivateFieldGet(this,Rl).closePrompt()}},{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,Xl).mode===r.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,Rl).render({inputNode:babelHelpers.classPrivateFieldGet(this,Xl).inputNode,menuNode:t.autocompleteMenuElement,address:babelHelpers.classPrivateFieldGet(this,Xl).address,mode:babelHelpers.classPrivateFieldGet(this,Xl).mode})}}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,Rl).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Xl,t)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Rl).destroy();babelHelpers.classPrivateFieldSet(this,Rl,null)}}]);return t}(_e);babelHelpers.defineProperty(xl,"searchStartedEvent","searchStarted");babelHelpers.defineProperty(xl,"searchCompletedEvent","searchCompleted");babelHelpers.defineProperty(xl,"showOnMapClickedEvent","showOnMapClicked");function Ul(e,t,i){Vl(e,t);t.set(e,i)}function Vl(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Yl=new WeakMap;var jl=new WeakMap;var Kl=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Ul(babelHelpers.assertThisInitialized(i),Yl,{writable:true,value:void 0});Ul(babelHelpers.assertThisInitialized(i),jl,{writable:true,value:null});if(!(e.fields instanceof Sl)){BX.debug("props.Fields must be instance of Fields")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Yl,e.fields);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Yl).subscribeOnAddressChangedEvent((function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),jl).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(i))}));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),Yl).subscribeOnStateChangedEvent((function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),jl).setStateByFeature(t.state)}));return i}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,jl).mode===r.ControlMode.edit){if(!o.Type.isDomNode(t.fieldsContainer)){BX.debug("props.fieldsContainer  must be instance of Element")}babelHelpers.classPrivateFieldGet(this,Yl).render({address:babelHelpers.classPrivateFieldGet(this,jl).address,mode:babelHelpers.classPrivateFieldGet(this,jl).mode,container:t.fieldsContainer})}}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,jl,t)}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,Yl).address=t}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Yl).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Yl).destroy();babelHelpers.classPrivateFieldSet(this,Yl,null)}}]);return t}(_e);function ql(e,t){$l(e,t);t.add(e)}function Jl(e,t,i){$l(e,t);t.set(e,i)}function $l(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Zl(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Ql=new WeakMap;var er=new WeakMap;var tr=new WeakMap;var ir=new WeakMap;var sr=new WeakMap;var ar=new WeakSet;var lr=new WeakSet;var rr=new WeakSet;var nr=new WeakSet;var dr=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var s=arguments.length,a=new Array(s),l=0;l<s;l++){a[l]=arguments[l]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));ql(babelHelpers.assertThisInitialized(i),nr);ql(babelHelpers.assertThisInitialized(i),rr);ql(babelHelpers.assertThisInitialized(i),lr);ql(babelHelpers.assertThisInitialized(i),ar);Jl(babelHelpers.assertThisInitialized(i),Ql,{writable:true,value:null});Jl(babelHelpers.assertThisInitialized(i),er,{writable:true,value:700});Jl(babelHelpers.assertThisInitialized(i),tr,{writable:true,value:null});Jl(babelHelpers.assertThisInitialized(i),ir,{writable:true,value:800});Jl(babelHelpers.assertThisInitialized(i),sr,{writable:true,value:false});return i}babelHelpers.createClass(t,[{key:"render",value:function e(i){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"render",this).call(this,i);this.addressWidget.controlWrapper.addEventListener("click",Zl(this,ar,or).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseover",Zl(this,rr,cr).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseout",Zl(this,nr,ur).bind(this));document.addEventListener("click",Zl(this,lr,br).bind(this));this.map.onMouseOverSubscribe(Zl(this,rr,cr).bind(this));this.map.onMouseOutSubscribe(Zl(this,nr,ur).bind(this))}},{key:"setAddress",value:function e(t){if(!t){this.closeMap()}this.map.address=t;if(t&&this.addressWidget.state!==b.DATA_SUPPOSED){this.showMap()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,sr)){return}document.removeEventListener("click",Zl(this,lr,br));if(this.addressWidget.controlWrapper){this.addressWidget.controlWrapper.removeEventListener("click",Zl(this,ar,or));this.addressWidget.controlWrapper.removeEventListener("mouseover",Zl(this,rr,cr));this.addressWidget.controlWrapper.removeEventListener("mouseout",Zl(this,nr,ur))}babelHelpers.classPrivateFieldSet(this,Ql,null);babelHelpers.classPrivateFieldSet(this,tr,null);babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);babelHelpers.classPrivateFieldSet(this,sr,true)}}]);return t}(Nl);function or(e){if(babelHelpers.classPrivateFieldGet(this,sr)){return}if(this.addressWidget.mode===r.ControlMode.view){if(this.map.isShown()){this.closeMap()}else{clearTimeout(babelHelpers.classPrivateFieldGet(this,Ql))}}else if(this.addressWidget.mode===r.ControlMode.edit&&this._saveResourceStrategy===false){if(this.addressWidget.address&&!this.map.isShown()&&e.target===this.addressWidget.inputNode){this.showMap()}}}function br(e){if(babelHelpers.classPrivateFieldGet(this,sr)){return}if(this.addressWidget.inputNode!==e.target){this.closeMap()}}function cr(){var e=this;if(babelHelpers.classPrivateFieldGet(this,sr)){return}clearTimeout(babelHelpers.classPrivateFieldGet(this,Ql));clearTimeout(babelHelpers.classPrivateFieldGet(this,tr));if(this.addressWidget.mode!==r.ControlMode.view){return}if(this.addressWidget.address&&!this.map.isShown()){babelHelpers.classPrivateFieldSet(this,Ql,setTimeout((function(){e.showMap()}),babelHelpers.classPrivateFieldGet(this,er)))}}function ur(){var e=this;if(babelHelpers.classPrivateFieldGet(this,sr)){return}clearTimeout(babelHelpers.classPrivateFieldGet(this,Ql));clearTimeout(babelHelpers.classPrivateFieldGet(this,tr));if(this.addressWidget.mode!==r.ControlMode.view){return}if(this.addressWidget.mode===r.ControlMode.view&&this.map.isShown()){babelHelpers.classPrivateFieldSet(this,tr,setTimeout((function(){e.closeMap()}),babelHelpers.classPrivateFieldGet(this,ir)))}}var pr=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"createAddressWidget",value:function e(t){var i=t.sourceCode||BX.message("LOCATION_WIDGET_SOURCE_CODE");var s=t.sourceParams||BX.message("LOCATION_WIDGET_SOURCE_PARAMS");var l=t.languageId||BX.message("LOCATION_WIDGET_LANGUAGE_ID");var n=t.sourceLanguageId||BX.message("LOCATION_WIDGET_SOURCE_LANGUAGE_ID");var d=new r.Location(JSON.parse(BX.message("LOCATION_WIDGET_USER_LOCATION_POINT")));var o=t.addressFormat||new r.Format(JSON.parse(BX.message("LOCATION_WIDGET_DEFAULT_FORMAT")));var b=t.presetLocationsProvider?t.presetLocationsProvider:function(){return t.presetLocationList?t.presetLocationList:[]};var c=[];if(!t.useFeatures||t.useFeatures.fields!==false){c.push(this.createFieldsFeature({addressFormat:o,languageId:l}))}var u=null;if(i&&s){try{u=a.Factory.create(i,l,n,s)}catch(e){if(e instanceof r.SourceCreationError){u=null}else{throw e}}}var p=null;if(u){if(!t.useFeatures||t.useFeatures.autocomplete!==false){c.push(this.createAutocompleteFeature({languageId:l,addressFormat:o,source:u,userLocationPoint:d,presetLocationsProvider:b}))}if(!t.useFeatures||t.useFeatures.map!==false){var h=!!s.showPhotos;var v=!!s.useGeocodingService;var f=80;var H=150;var P=h?5:0;var F="auto";p=this.createMapFeature({addressFormat:o,source:u,useGeocodingService:v,popupOptions:t.popupOptions,popupBindOptions:t.popupBindOptions,thumbnailHeight:t.thumbnailHeight||f,thumbnailWidth:t.thumbnailWidth||H,maxPhotoCount:t.maxPhotoCount||P,mapBehavior:t.mapBehavior||F,userLocationPoint:d});c.push(p)}}var m=new bt({features:c,address:t.address,mode:t.mode,addressFormat:o,languageId:l});if(p){m.subscribeOnFeatureEvent((function(e){var t=e.getData();if(t.feature instanceof xl&&t.eventCode===xl.showOnMapClickedEvent){p.showMap(true)}}))}return m}},{key:"createFieldsFeature",value:function e(t){var i=new Sl({addressFormat:t.addressFormat,languageId:t.languageId});return new Kl({fields:i})}},{key:"createAutocompleteFeature",value:function e(t){var i=new ms({sourceCode:t.source.sourceCode,languageId:t.languageId,addressFormat:t.addressFormat,autocompleteService:t.source.autocompleteService,userLocationPoint:t.userLocationPoint,presetLocationsProvider:t.presetLocationsProvider});return new xl({autocomplete:i})}},{key:"createMapFeature",value:function e(t){var s={cacheable:true,closeByEsc:true,className:"location-popup-window location-source-".concat(t.source.sourceCode),animation:"fading",angle:true,bindOptions:t.popupBindOptions};if(t.popupOptions){s=Object.assign(s,t.popupOptions)}var a=new E(s);var l=null;if(t.maxPhotoCount>0){l=new Ia({photoService:t.source.photoService,thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth,maxPhotoCount:t.maxPhotoCount})}var n={saveResourceStrategy:t.source.sourceCode===i.Google.code,map:new fe({addressFormat:t.addressFormat,map:t.source.map,popup:a,gallery:l,locationRepository:new r.LocationRepository,geocodingService:t.useGeocodingService?t.source.geocodingService:null,userLocationPoint:t.userLocationPoint})};var d;if(t.mapBehavior==="manual"){d=new Nl(n)}else{d=new dr(n)}return d}}]);return e}();var hr;function vr(e,t){Hr(e,t);t.add(e)}function fr(e,t,i){Hr(e,t);t.set(e,i)}function Hr(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Pr(e,t,i){mr(e,t);Fr(i,"get");return gr(e,i)}function Fr(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function mr(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function gr(e,t){if(t.get){return t.get.call(e)}return t.value}function Tr(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var wr=new WeakMap;var yr=new WeakMap;var Ir=new WeakMap;var Gr=new WeakSet;var Sr=function(e){babelHelpers.inherits(t,e);function t(){var e;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));vr(babelHelpers.assertThisInitialized(e),Gr);fr(babelHelpers.assertThisInitialized(e),wr,{writable:true,value:void 0});fr(babelHelpers.assertThisInitialized(e),yr,{writable:true,value:void 0});fr(babelHelpers.assertThisInitialized(e),Ir,{writable:true,value:["on","off"]});e.setEventNamespace("BX.Location.Widget.Switch");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),wr,i.state);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),Ir,i.titles);return e}babelHelpers.createClass(t,[{key:"render",value:function e(i){var s=this;babelHelpers.classPrivateFieldSet(this,yr,o.Tag.render(hr||(hr=babelHelpers.taggedTemplateLiteral(['\t\t\t\n\t\t\t<span class="ui-link ui-link-secondary ui-entity-editor-block-title-link">\n\t\t\t\t',"\n\t\t\t</span>"])),Tr(this,Gr,Er).call(this)));babelHelpers.classPrivateFieldGet(this,yr).addEventListener("click",(function(e){s.state=babelHelpers.classPrivateFieldGet(s,wr)===t.STATE_OFF?t.STATE_ON:t.STATE_OFF;s.emit(Pr(t,t,kr),{state:babelHelpers.classPrivateFieldGet(s,wr)});e.stopPropagation();return false}));babelHelpers.classPrivateFieldGet(this,yr).addEventListener("mouseover",(function(e){e.stopPropagation()}));return babelHelpers.classPrivateFieldGet(this,yr)}},{key:"subscribeOnToggleEventSubscribe",value:function e(i){this.subscribe(Pr(t,t,kr),i)}},{key:"state",set:function e(t){babelHelpers.classPrivateFieldSet(this,wr,t);if(babelHelpers.classPrivateFieldGet(this,yr)){babelHelpers.classPrivateFieldGet(this,yr).innerHTML=Tr(this,Gr,Er).call(this)}},get:function e(){return babelHelpers.classPrivateFieldGet(this,wr)}}]);return t}(d.EventEmitter);function Er(){return babelHelpers.classPrivateFieldGet(this,Ir)[babelHelpers.classPrivateFieldGet(this,wr)]}babelHelpers.defineProperty(Sr,"STATE_OFF",0);babelHelpers.defineProperty(Sr,"STATE_ON",1);var kr={writable:true,value:"onToggleEvent"};var Cr;function Ar(e,t){_r(e,t);t.add(e)}function Wr(e,t,i){_r(e,t);t.set(e,i)}function _r(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Mr(e,t,i){Lr(e,t);zr(i,"get");return Or(e,i)}function zr(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function Lr(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function Or(e,t){if(t.get){return t.get.call(e)}return t.value}function Nr(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Dr=new WeakMap;var Br=new WeakMap;var Rr=new WeakSet;var Xr=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ar(babelHelpers.assertThisInitialized(e),Rr);Wr(babelHelpers.assertThisInitialized(e),Dr,{writable:true,value:t.TYPE_SEARCH});Wr(babelHelpers.assertThisInitialized(e),Br,{writable:true,value:void 0});e.setEventNamespace("BX.Location.Widget.Icon");return e}babelHelpers.createClass(t,[{key:"render",value:function e(i){var s=this;babelHelpers.classPrivateFieldSet(this,Dr,i.type);babelHelpers.classPrivateFieldSet(this,Br,o.Tag.render(Cr||(Cr=babelHelpers.taggedTemplateLiteral(['<div class="','"></div>'])),Nr(this,Rr,xr).call(this,babelHelpers.classPrivateFieldGet(this,Dr))));babelHelpers.classPrivateFieldGet(this,Br).addEventListener("click",(function(e){s.emit(Mr(t,t,Ur))}));return babelHelpers.classPrivateFieldGet(this,Br)}},{key:"subscribeOnClickEvent",value:function e(i){this.subscribe(Mr(t,t,Ur),i)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,Dr,t);if(babelHelpers.classPrivateFieldGet(this,Br)){babelHelpers.classPrivateFieldGet(this,Br).className=Nr(this,Rr,xr).call(this,babelHelpers.classPrivateFieldGet(this,Dr))}}}]);return t}(d.EventEmitter);function xr(e){var t="";if(e===Xr.TYPE_CLEAR){t="ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear"}else if(e===Xr.TYPE_SEARCH){t="ui-ctl-after ui-ctl-icon-search"}else if(e===Xr.TYPE_LOADER){t="ui-ctl-after ui-ctl-icon-loader"}else{BX.debug("Wrong icon type")}return t}var Ur={writable:true,value:"onClick"};babelHelpers.defineProperty(Xr,"TYPE_CLEAR","clear");babelHelpers.defineProperty(Xr,"TYPE_SEARCH","search");babelHelpers.defineProperty(Xr,"TYPE_LOADER","loader");var Vr,Yr,jr,Kr,qr,Jr,$r,Zr,Qr;function en(e,t){tn(e,t);t.add(e)}function tn(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function sn(e,t,i){an(e,t);return i}function an(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function ln(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var rn=new WeakSet;var nn=new WeakSet;var dn=new WeakSet;var on=new WeakSet;var bn=new WeakSet;var cn=new WeakSet;var un=new WeakSet;var pn=new WeakSet;var hn=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));en(babelHelpers.assertThisInitialized(i),pn);en(babelHelpers.assertThisInitialized(i),un);en(babelHelpers.assertThisInitialized(i),cn);en(babelHelpers.assertThisInitialized(i),bn);en(babelHelpers.assertThisInitialized(i),on);en(babelHelpers.assertThisInitialized(i),dn);en(babelHelpers.assertThisInitialized(i),nn);en(babelHelpers.assertThisInitialized(i),rn);i._input=null;i._inputIcon=null;i._hiddenInput=null;i._innerWrapper=null;i._addressWidget=null;i._addressFieldsContainer=null;return i}babelHelpers.createClass(t,[{key:"initialize",value:function e(i,s){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"initialize",this).call(this,i,s);var a=this.getValue();var l=null;if(o.Type.isStringFilled(a)){try{l=new r.Address(JSON.parse(a))}catch(e){BX.debug("Cant parse address value");return}}var n=new pr;this._addressWidget=n.createAddressWidget({address:l,mode:this._mode===BX.UI.EntityEditorMode.edit?r.ControlMode.edit:r.ControlMode.view,popupBindOptions:{position:"right"}});this._addressWidget.subscribeOnStateChangedEvent(ln(this,bn,Fn).bind(this));this._addressWidget.subscribeOnAddressChangedEvent(ln(this,cn,mn).bind(this));this._fieldsSwitch=new Sr({state:Sr.STATE_OFF,titles:[BX.message("LOCATION_WIDGET_AUI_MORE"),BX.message("LOCATION_WIDGET_AUI_BRIEFLY")]});this._fieldsSwitch.subscribeOnToggleEventSubscribe(ln(this,nn,fn).bind(this))}},{key:"focus",value:function e(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)}},{key:"getModeSwitchType",value:function e(t){var i=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){i|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return i}},{key:"doSetMode",value:function e(t){this._addressWidget.mode=t===BX.UI.EntityEditorMode.edit?r.ControlMode.edit:r.ControlMode.view;this._fieldsSwitch.state=Sr.STATE_OFF}},{key:"getContentWrapper",value:function e(){return this._innerWrapper}},{key:"save",value:function e(){if(!this.isEditable()){return}var t=ln(this,pn,wn).call(this);this._model.setField(this.getName(),t?t.toJson():"");this._addressWidget.resetView()}},{key:"showError",value:function e(i,s){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"showError",this).apply(this,[i,s]);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}}},{key:"clearError",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"clearError",this).apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}}},{key:"doClearLayout",value:function e(t){this._input=null;this._innerWrapper=null;this._inputContainer=null;this._addressFieldsContainer=null;this._inputIcon=null;this._hiddenInput=null;o.Dom.clean(this._innerWrapper)}},{key:"validate",value:function e(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw Error("BX.Location.UIAddress. Invalid validation context")}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var i=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!i){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return i}},{key:"getRuntimeValue",value:function e(){return this._mode===BX.UI.EntityEditorMode.edit?ln(this,pn,wn).call(this):null}},{key:"layout",value:function e(i){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-card-content-block-field-phone"]});this.adjustWrapper();var s=this.getTitle();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}var a={};if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(s));this._input=o.Tag.render(Vr||(Vr=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element ui-ctl-textbox" value="" type="text" autocomplete="off" name="','">'])),"".concat(this.getName(),"_STRING"));this._hiddenInput=o.Tag.render(Yr||(Yr=babelHelpers.taggedTemplateLiteral(["<input value='",'\' type="hidden" name="','">'])),this.getValue(),this.getName());this._inputIcon=new Xr;this._inputIcon.subscribeOnClickEvent(ln(this,rn,vn).bind(this));var l=this._inputIcon.render({type:sn(t,t,gn).call(t,ln(this,pn,wn).call(this))});this._inputContainer=o.Tag.render(jr||(jr=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon">',"","","</div>"])),l,this._input,this._hiddenInput);this._titleWrapper.appendChild(o.Tag.render(Kr||(Kr=babelHelpers.taggedTemplateLiteral(["",""])),this._fieldsSwitch.render(this._mode)));this._innerWrapper=o.Tag.render(qr||(qr=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\t    \n\t\t\t\t<div class="location-search-control-block">\t\t\t\t\t\n\t\t\t\t\t',"\n\t\t\t\t</div>"])),this._inputContainer);a.inputNode=this._input;a.mapBindElement=l;this._addressFieldsContainer=o.Tag.render(Jr||(Jr=babelHelpers.taggedTemplateLiteral(['<div class="location-fields-control-block"></div>'])));if(this._fieldsSwitch.state===Sr.STATE_ON){this._addressFieldsContainer.classList.add("visible")}a.fieldsContainer=this._addressFieldsContainer;this._innerWrapper.appendChild(this._addressFieldsContainer)}else{this._wrapper.appendChild(this.createTitleNode(s));var r;if(this.hasContentToDisplay()){var n=ln(this,un,Tn).call(this,ln(this,pn,wn).call(this));r=o.Tag.render($r||($r=babelHelpers.taggedTemplateLiteral(['<span class="ui-link ui-link-dark ui-link-dotted">',"</span>"])),n);this._innerWrapper=o.Tag.render(Zr||(Zr=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="location-search-control-block">\n\t\t\t\t\t\t<div class="ui-entity-editor-content-block-text">\n\t\t\t\t\t\t\t',"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"])),r);a.mapBindElement=r}else{this._innerWrapper=o.Tag.render(Qr||(Qr=babelHelpers.taggedTemplateLiteral(['<div class="location-search-control-block">\n\t\t\t\t\t',"\n\t\t\t\t</div>"])),BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY"));a.mapBindElement=this._innerWrapper}}a.controlWrapper=this._innerWrapper;this._addressWidget.render(a);this._wrapper.appendChild(this._innerWrapper);this._addressWidget.subscribeOnErrorEvent(this.errorListener.bind(this));if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(i);this._hasLayout=true}},{key:"errorListener",value:function e(t){var i=this;var s=t.getData();var a=s.errors;if(this._inputIcon){this._inputIcon.type=Xr.TYPE_CLEAR}if(!o.Type.isArray(a)){return}a.forEach((function(e){var t;if(e.message){t=e.message}else{t=BX.message("LOCATION_WIDGET_AUI_UNKNOWN_ERROR")}if(e.code){t+=" [".concat(e.code,"]")}i.showError(t)}))}},{key:"processModelChange",value:function e(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()}}],[{key:"create",value:function e(i,s){var a=new t;a.initialize(i,s);return a}},{key:"registerField",value:function e(){if(typeof BX.UI.EntityEditorControlFactory!=="undefined"){BX.UI.EntityEditorControlFactory.registerFactoryMethod("address",t.registerFieldMethod)}else{BX.addCustomEvent("BX.UI.EntityEditorControlFactory:onInitialize",(function(e,i){i.methods.address=t.registerFieldMethod}))}}},{key:"registerFieldMethod",value:function e(i,s,a){var l=null;if(i==="address"){l=t.create(s,a)}return l}}]);return t}(BX.UI.EntityEditorField);function vn(){if(this._input.value!==""){this._input.value="";this._addressWidget.address=null;this._inputIcon.type=Xr.TYPE_SEARCH}if(this.hasError()){this.clearError()}}function fn(e){var t=e.getData();var i=t.state;if(i===Sr.STATE_OFF){ln(this,dn,Hn).call(this)}else{ln(this,on,Pn).call(this)}this._addressWidget.resetView()}function Hn(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.remove("visible")}}function Pn(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.add("visible")}}function Fn(e){var t=e.getData();var i=t.state;var s;if(t.state===n.State.DATA_LOADING){s=Xr.TYPE_LOADER}else{if(t.state===n.State.DATA_INPUTTING){this.markAsChanged()}s=sn(hn,hn,gn).call(hn,ln(this,pn,wn).call(this))}this._inputIcon.type=s}function mn(e){var t=e.getData();var i=t.address;if(this._hiddenInput){this._hiddenInput.value=i?i.toJson():"";this.markAsChanged()}if(this._inputIcon){this._inputIcon.type=sn(hn,hn,gn).call(hn,i)}}function gn(e){return e?Xr.TYPE_CLEAR:Xr.TYPE_SEARCH}function Tn(e){if(!e){return""}return e.toString(this._addressWidget.addressFormat)}function wn(){return this._addressWidget.address}hn.registerField();e.Address=bt;e.BaseFeature=_e;e.MapFeature=Nl;e.AutocompleteFeature=xl;e.FieldsFeature=Kl;e.Factory=pr;e.State=b;e.UIAddress=hn})(this.BX.Location.Widget=this.BX.Location.Widget||{},BX,BX.Location.Google,BX.Main,BX.Location.Source,BX,BX.Location.Core,BX.Location.Widget,BX.Event,BX);
//# sourceMappingURL=widget.bundle.map.js