{"version":3,"file":"task-list.bundle.js","sources":["../src/components/empty-state.js","../src/classes/task-service.js","../src/classes/context-menu-manager.js","../src/task-list.js"],"sourcesContent":["import { RecentEmptyState } from 'im.v2.component.list.items.elements.empty-state';\n\n// @vue/component\nexport const EmptyState = {\n\tname: 'EmptyState',\n\tcomponents: { RecentEmptyState },\n\tmethods: {\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<RecentEmptyState :title=\"loc('IM_LIST_TASK_EMPTY_STATE_TITLE')\" />\n\t`,\n};\n","import { RestMethod, ChatType } from 'im.v2.const';\nimport { BaseRecentService, type BaseRecentQueryParams } from 'im.v2.provider.service.recent';\n\nexport class TaskService extends BaseRecentService\n{\n\tgetRestMethodName(): string\n\t{\n\t\treturn RestMethod.imV2RecentExternalChatTail;\n\t}\n\n\tgetQueryParams(firstPage: boolean = false): BaseRecentQueryParams & { type: string }\n\t{\n\t\treturn {\n\t\t\t...super.getQueryParams(firstPage),\n\t\t\ttype: ChatType.taskComments,\n\t\t};\n\t}\n\n\tgetRecentSaveActionName(): string\n\t{\n\t\treturn 'recent/setTask';\n\t}\n}\n","import { RecentMenu } from 'im.v2.lib.menu';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\n\nexport class TaskRecentMenu extends RecentMenu\n{\n\tgetMenuItems(): MenuItemOptions[]\n\t{\n\t\treturn [\n\t\t\tthis.getUnreadMessageItem(),\n\t\t\tthis.getPinMessageItem(),\n\t\t\tthis.getHideItem(),\n\t\t];\n\t}\n}\n","import { DraftManager } from 'im.v2.lib.draft';\nimport { Utils } from 'im.v2.lib.utils';\nimport { ListLoadingState as LoadingState } from 'im.v2.component.elements.list-loading-state';\nimport { RecentItem } from 'im.v2.component.list.items.recent';\n\nimport { EmptyState } from './components/empty-state';\nimport { TaskService } from './classes/task-service';\nimport { TaskRecentMenu } from './classes/context-menu-manager';\n\nimport './css/task-list.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem } from 'im.v2.model';\n\n// @vue/component\nexport const TaskList = {\n\tname: 'TaskList',\n\tcomponents: { EmptyState, LoadingState, RecentItem },\n\temits: ['chatClick'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tisLoadingNextPage: false,\n\t\t\tfirstPageLoaded: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tcollection(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.$store.getters['recent/getTaskCollection'];\n\t\t},\n\t\tpreparedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn [...this.collection].sort((a, b) => {\n\t\t\t\tconst firstDate: Date = this.$store.getters['recent/getSortDate'](a.dialogId);\n\t\t\t\tconst secondDate: Date = this.$store.getters['recent/getSortDate'](b.dialogId);\n\n\t\t\t\treturn secondDate - firstDate;\n\t\t\t});\n\t\t},\n\t\tpinnedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.preparedItems.filter((item) => {\n\t\t\t\treturn item.pinned === true;\n\t\t\t});\n\t\t},\n\t\tgeneralItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.preparedItems.filter((item) => {\n\t\t\t\treturn item.pinned === false;\n\t\t\t});\n\t\t},\n\t\tisEmptyCollection(): boolean\n\t\t{\n\t\t\treturn this.collection.length === 0;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new TaskRecentMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tasync activated()\n\t{\n\t\tthis.isLoading = true;\n\t\tawait this.getRecentService().loadFirstPage();\n\t\tif (!this.firstPageLoaded)\n\t\t{\n\t\t\tvoid DraftManager.getInstance().initDraftHistory();\n\t\t}\n\t\tthis.firstPageLoaded = true;\n\t\tthis.isLoading = false;\n\t},\n\tmethods: {\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenuManager.close();\n\t\t\tif (!Utils.dom.isOneScreenRemaining(event.target) || !this.getRecentService().hasMoreItemsToLoad())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoadingNextPage = true;\n\t\t\tawait this.getRecentService().loadNextPage();\n\t\t\tthis.isLoadingNextPage = false;\n\t\t},\n\t\tonClick(item: ImModelRecentItem)\n\t\t{\n\t\t\tthis.$emit('chatClick', item.dialogId);\n\t\t},\n\t\tonRightClick(item: ImModelRecentItem, event: PointerEvent)\n\t\t{\n\t\t\tevent.preventDefault();\n\n\t\t\tconst context = {\n\t\t\t\tdialogId: item.dialogId,\n\t\t\t\trecentItem: item,\n\t\t\t};\n\t\t\tthis.contextMenuManager.openMenu(context, event.currentTarget);\n\t\t},\n\t\tgetRecentService(): TaskService\n\t\t{\n\t\t\tif (!this.service)\n\t\t\t{\n\t\t\t\tthis.service = new TaskService();\n\t\t\t}\n\n\t\t\treturn this.service;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-task__container\">\n\t\t\t<LoadingState v-if=\"isLoading && !firstPageLoaded\" />\n\t\t\t<div v-else @scroll=\"onScroll\" class=\"bx-im-list-task__scroll-container\">\n\t\t\t\t<EmptyState v-if=\"isEmptyCollection\" />\n\t\t\t\t<div v-if=\"pinnedItems.length > 0\" class=\"bx-im-list-task__pinned_container\">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for=\"item in pinnedItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t@click=\"onClick(item)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-task__general_container\">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for=\"item in generalItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t@click=\"onClick(item)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<LoadingState v-if=\"isLoadingNextPage\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["EmptyState","name","components","RecentEmptyState","methods","loc","phraseCode","$Bitrix","Loc","getMessage","template","TaskService","BaseRecentService","getRestMethodName","RestMethod","imV2RecentExternalChatTail","getQueryParams","firstPage","type","ChatType","taskComments","getRecentSaveActionName","TaskRecentMenu","RecentMenu","getMenuItems","getUnreadMessageItem","getPinMessageItem","getHideItem","TaskList","LoadingState","RecentItem","emits","data","isLoading","isLoadingNextPage","firstPageLoaded","computed","collection","$store","getters","preparedItems","sort","a","b","firstDate","dialogId","secondDate","pinnedItems","filter","item","pinned","generalItems","isEmptyCollection","length","created","contextMenuManager","beforeUnmount","destroy","activated","getRecentService","loadFirstPage","DraftManager","getInstance","initDraftHistory","onScroll","event","close","Utils","dom","isOneScreenRemaining","target","hasMoreItemsToLoad","loadNextPage","onClick","$emit","onRightClick","preventDefault","context","recentItem","openMenu","currentTarget","service"],"mappings":"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"}