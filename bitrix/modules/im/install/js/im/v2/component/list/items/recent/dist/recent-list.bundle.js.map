{"version":3,"file":"recent-list.bundle.js","sources":["../src/components/recent-item/components/message-text.js","../src/components/recent-item/components/item-counter.js","../src/components/recent-item/components/message-status.js","../src/components/recent-item/recent-item.js","../src/components/active-call.js","../src/components/create-chat.js","../src/components/empty-state.js","../src/classes/broadcast-manager.js","../src/classes/like-manager.js","../src/recent-list.js"],"sourcesContent":["import { Text, Loc } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\n\nimport { Core } from 'im.v2.application.core';\nimport { ChatType, Settings } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Parser } from 'im.v2.lib.parser';\nimport { MessageAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport type { ImModelUser, ImModelChat, ImModelRecentItem, ImModelMessage } from 'im.v2.model';\n\nconst HiddenTitleByChatType = {\n\t[ChatType.openChannel]: Loc.getMessage('IM_LIST_RECENT_CHAT_TYPE_OPEN_CHANNEL'),\n\t[ChatType.channel]: Loc.getMessage('IM_LIST_RECENT_CHAT_TYPE_PRIVATE_CHANNEL'),\n\t[ChatType.generalChannel]: Loc.getMessage('IM_LIST_RECENT_CHAT_TYPE_OPEN_CHANNEL'),\n\tdefault: Loc.getMessage('IM_LIST_RECENT_CHAT_TYPE_GROUP_V2'),\n};\n\n// @vue/component\nexport const MessageText = {\n\tname: 'MessageText',\n\tcomponents: { MessageAvatar },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['recent/getMessage'](this.recentItem.dialogId);\n\t\t},\n\t\tneedsBirthdayPlaceholder(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['recent/needsBirthdayPlaceholder'](this.recentItem.dialogId);\n\t\t},\n\t\tneedsVacationPlaceholder(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['recent/needsVacationPlaceholder'](this.recentItem.dialogId);\n\t\t},\n\t\tshowLastMessage(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showLastMessage);\n\t\t},\n\t\tnotesText(): string\n\t\t{\n\t\t\treturn this.loc('IM_LIST_RECENT_CHAT_SELF_SUBTITLE');\n\t\t},\n\t\thiddenMessageText(): string\n\t\t{\n\t\t\tif (this.isNotes)\n\t\t\t{\n\t\t\t\treturn this.notesText;\n\t\t\t}\n\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['users/getPosition'](this.recentItem.dialogId);\n\t\t\t}\n\n\t\t\treturn HiddenTitleByChatType[this.dialog.type] ?? HiddenTitleByChatType.default;\n\t\t},\n\t\tisLastMessageAuthor(): boolean\n\t\t{\n\t\t\treturn this.showLastMessage && this.message.authorId === Core.getUserId();\n\t\t},\n\t\tmessageText(): string\n\t\t{\n\t\t\tif (this.message.isDeleted)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_LIST_RECENT_DELETED_MESSAGE');\n\t\t\t}\n\n\t\t\tconst formattedText = Parser.purifyRecent(this.recentItem);\n\t\t\tif (!this.showLastMessage || !formattedText)\n\t\t\t{\n\t\t\t\treturn this.hiddenMessageText;\n\t\t\t}\n\n\t\t\treturn formattedText;\n\t\t},\n\t\tformattedMessageText(): string\n\t\t{\n\t\t\tconst SPLIT_INDEX = 27;\n\n\t\t\treturn Utils.text.insertUnseenWhitespace(this.messageText, SPLIT_INDEX);\n\t\t},\n\t\tpreparedDraftContent(): string\n\t\t{\n\t\t\tconst phrase = this.loc('IM_LIST_RECENT_MESSAGE_DRAFT_2');\n\t\t\tconst PLACEHOLDER_LENGTH = '#TEXT#'.length;\n\t\t\tconst prefix = phrase.slice(0, -PLACEHOLDER_LENGTH);\n\t\t\tconst text = Text.encode(this.formattedDraftText);\n\n\t\t\treturn `\n\t\t\t\t<span class=\"bx-im-list-recent-item__message_draft-prefix\">${prefix}</span>\n\t\t\t\t<span class=\"bx-im-list-recent-item__message_text_content\">${text}</span>\n\t\t\t`;\n\t\t},\n\t\tformattedDraftText(): string\n\t\t{\n\t\t\treturn Parser.purify({ text: this.recentItem.draft.text, showIconIfEmptyText: false });\n\t\t},\n\t\tformattedVacationEndDate(): string\n\t\t{\n\t\t\treturn DateTimeFormat.format('d.m.Y', this.user.absent);\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisNotes(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['chats/isNotes'](this.recentItem.dialogId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-recent-item__message_container\">\n\t\t\t<span class=\"bx-im-list-recent-item__message_text\">\n\t\t\t\t<span v-if=\"recentItem.draft.text\" v-html=\"preparedDraftContent\"></span>\n\t\t\t\t<span v-else-if=\"recentItem.invitation.isActive\" class=\"bx-im-list-recent-item__balloon_container --invitation\">\n\t\t\t\t\t<span class=\"bx-im-list-recent-item__balloon\">{{ loc('IM_LIST_RECENT_INVITATION_NOT_ACCEPTED_MSGVER_1') }}</span>\n\t\t\t\t</span>\n\t\t\t\t<span v-else-if=\"needsBirthdayPlaceholder\" class=\"bx-im-list-recent-item__balloon_container --birthday\" :title=\"loc('IM_LIST_RECENT_BIRTHDAY')\">\n\t\t\t\t\t<span class=\"bx-im-list-recent-item__balloon\">{{ loc('IM_LIST_RECENT_BIRTHDAY') }}</span>\n\t\t\t\t</span>\n\t\t\t\t<span v-else-if=\"needsVacationPlaceholder\" class=\"bx-im-list-recent-item__balloon_container --vacation\">\n\t\t\t\t\t<span class=\"bx-im-list-recent-item__balloon\">\n\t\t\t\t\t\t{{ loc('IM_LIST_RECENT_VACATION', {'#VACATION_END_DATE#': formattedVacationEndDate}) }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<span v-if=\"isLastMessageAuthor\" class=\"bx-im-list-recent-item__self_author-icon\"></span>\n\t\t\t\t\t<MessageAvatar\n\t\t\t\t\t\tv-else-if=\"isChat && message.authorId\"\n\t\t\t\t\t\t:messageId=\"message.id\"\n\t\t\t\t\t\t:authorId=\"message.authorId\"\n\t\t\t\t\t\t:size=\"AvatarSize.XXS\"\n\t\t\t\t\t\tclass=\"bx-im-list-recent-item__author-avatar\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span>{{ formattedMessageText }}</span>\n\t\t\t\t</template>\n\t\t\t</span>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\nimport { ChatType, AnchorType } from 'im.v2.const';\n\nimport type { ImModelChat, ImModelRecentItem, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const ItemCounters = {\n\tname: 'ItemCounters',\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisChatMuted: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tisSelfChat(): boolean\n\t\t{\n\t\t\treturn this.isUser && this.user.id === Core.getUserId();\n\t\t},\n\t\tinvitation(): { isActive: boolean, originator: number, canResend: boolean }\n\t\t{\n\t\t\treturn this.recentItem.invitation;\n\t\t},\n\t\ttotalCounter(): number\n\t\t{\n\t\t\treturn this.dialog.counter + this.channelCommentsCounter;\n\t\t},\n\t\tchannelCommentsCounter(): number\n\t\t{\n\t\t\treturn this.$store.getters['counters/getChannelCommentsCounter'](this.dialog.chatId);\n\t\t},\n\t\tformattedCounter(): string\n\t\t{\n\t\t\treturn this.formatCounter(this.totalCounter);\n\t\t},\n\t\tshowCounterContainer(): boolean\n\t\t{\n\t\t\treturn !this.invitation.isActive;\n\t\t},\n\t\tshowPinnedIcon(): boolean\n\t\t{\n\t\t\tconst noCounters = this.totalCounter === 0;\n\n\t\t\treturn this.recentItem.pinned && noCounters && !this.recentItem.unread;\n\t\t},\n\t\tshowUnreadWithoutCounter(): boolean\n\t\t{\n\t\t\treturn this.recentItem.unread && this.totalCounter === 0;\n\t\t},\n\t\tshowUnreadWithCounter(): boolean\n\t\t{\n\t\t\treturn this.recentItem.unread && this.totalCounter > 0;\n\t\t},\n\t\tshowMention(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/anchors/isChatHasAnchorsWithType'](this.dialog.chatId, AnchorType.mention) && !this.isSelfChat;\n\t\t},\n\t\tshowCounter(): boolean\n\t\t{\n\t\t\tconst isSingleMessageWithMention = this.showMention && this.totalCounter === 1;\n\n\t\t\treturn !isSingleMessageWithMention && !this.recentItem.unread && this.totalCounter > 0 && !this.isSelfChat;\n\t\t},\n\t\tcontainerClasses(): { [className: string]: boolean }\n\t\t{\n\t\t\tconst commentsOnly = this.dialog.counter === 0 && this.channelCommentsCounter > 0;\n\t\t\tconst withComments = this.dialog.counter > 0 && this.channelCommentsCounter > 0;\n\t\t\tconst withMentionAndCounter = this.dialog.counter > 0 && this.showMention;\n\n\t\t\treturn {\n\t\t\t\t'--muted': this.isChatMuted,\n\t\t\t\t'--comments-only': commentsOnly,\n\t\t\t\t'--with-comments': withComments,\n\t\t\t\t'--with-mention-and-counter': withMentionAndCounter,\n\t\t\t};\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tformatCounter(counter: number): string\n\t\t{\n\t\t\treturn counter > 99 ? '99+' : counter.toString();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"showCounterContainer\" :class=\"containerClasses\" class=\"bx-im-list-recent-item__counters_wrap\">\n\t\t\t<div class=\"bx-im-list-recent-item__counters_container\">\n\t\t\t\t<div v-if=\"showPinnedIcon\" class=\"bx-im-list-recent-item__pinned-icon\"></div>\n\t\t\t\t<div v-else class=\"bx-im-list-recent-item__counters\">\n\t\t\t\t\t<div v-if=\"showMention\" class=\"bx-im-list-recent-item__mention\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-item__mention-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"showUnreadWithoutCounter\" class=\"bx-im-list-recent-item__counter_number --no-counter\"></div>\n\t\t\t\t\t<div v-else-if=\"showUnreadWithCounter\" class=\"bx-im-list-recent-item__counter_number --with-unread\">\n\t\t\t\t\t\t{{ formattedCounter }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else-if=\"showCounter\" class=\"bx-im-list-recent-item__counter_number\">\n\t\t\t\t\t\t{{ formattedCounter }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\nimport { ChatType, OwnMessageStatus, UserType, AnchorType } from 'im.v2.const';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelRecentItem, ImModelUser, ImModelMessage } from 'im.v2.model';\n\nconst StatusIcon = {\n\tnone: '',\n\tlike: 'like',\n\tsending: 'sending',\n\tsent: 'sent',\n\tviewed: 'viewed',\n};\n\n// @vue/component\nexport const MessageStatus = {\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['recent/getMessage'](this.recentItem.dialogId);\n\t\t},\n\t\tisChatWithReactions(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/anchors/isChatHasAnchorsWithType'](this.dialog.chatId, AnchorType.reaction);\n\t\t},\n\t\tshowLike(): boolean\n\t\t{\n\t\t\t/*\n\t\t\t* 'this.recent Item.liked' is left to allow work without anchors\n\t\t\t* */\n\t\t\treturn this.isChatWithReactions || this.recentItem.liked;\n\t\t},\n\t\tmessageStatus(): $Values<typeof OwnMessageStatus>\n\t\t{\n\t\t\tif (this.message.sending)\n\t\t\t{\n\t\t\t\treturn OwnMessageStatus.sending;\n\t\t\t}\n\n\t\t\tif (this.message.viewedByOthers)\n\t\t\t{\n\t\t\t\treturn OwnMessageStatus.viewed;\n\t\t\t}\n\n\t\t\treturn OwnMessageStatus.sent;\n\t\t},\n\t\tstatusIcon(): $Values<typeof StatusIcon>\n\t\t{\n\t\t\tif (this.isSelfChat || this.isBot)\n\t\t\t{\n\t\t\t\treturn StatusIcon.none;\n\t\t\t}\n\n\t\t\tif (this.showLike)\n\t\t\t{\n\t\t\t\treturn StatusIcon.like;\n\t\t\t}\n\n\t\t\tif (!this.isLastMessageAuthor || this.needsBirthdayPlaceholder || this.hasDraft)\n\t\t\t{\n\t\t\t\treturn StatusIcon.none;\n\t\t\t}\n\n\t\t\treturn this.messageStatus;\n\t\t},\n\t\tisLastMessageAuthor(): boolean\n\t\t{\n\t\t\treturn this.message?.authorId === Core.getUserId();\n\t\t},\n\t\tisSelfChat(): boolean\n\t\t{\n\t\t\treturn this.isUser && this.user.id === Core.getUserId();\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tisBot(): boolean\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn this.user.type === UserType.bot;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\thasDraft(): boolean\n\t\t{\n\t\t\treturn Boolean(this.recentItem.draft.text);\n\t\t},\n\t\tneedsBirthdayPlaceholder(): boolean\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.$store.getters['recent/needsBirthdayPlaceholder'](this.recentItem.dialogId);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-recent-item__status-icon\" :class=\"'--' + statusIcon\"></div>\n\t`,\n};\n","import 'main.date';\n\nimport { Core } from 'im.v2.application.core';\nimport { ChatType, Settings, Layout } from 'im.v2.const';\nimport { InputActionIndicator } from 'im.v2.component.list.items.elements.input-action-indicator';\nimport { ChatTitle, ChatTitleType } from 'im.v2.component.elements.chat-title';\nimport { ChatAvatar, AvatarSize, ChatAvatarType } from 'im.v2.component.elements.avatar';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\nimport { ChannelManager } from 'im.v2.lib.channel';\n\nimport { MessageText } from './components/message-text';\nimport { ItemCounters } from './components/item-counter';\nimport { MessageStatus } from './components/message-status';\n\nimport './css/recent-item.css';\n\nimport type { ImModelRecentItem, ImModelChat, ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const RecentItem = {\n\tname: 'RecentItem',\n\tcomponents: { ChatAvatar, ChatTitle, MessageText, MessageStatus, ItemCounters, InputActionIndicator },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\tif (this.needsBirthdayPlaceholder)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_LIST_RECENT_BIRTHDAY_DATE');\n\t\t\t}\n\n\t\t\treturn this.formatDate(this.itemDate);\n\t\t},\n\t\tformattedCounter(): string\n\t\t{\n\t\t\treturn this.dialog.counter > 99 ? '99+' : this.dialog.counter.toString();\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tlayout(): { name: string, entityId: string }\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['recent/getMessage'](this.recentItem.dialogId);\n\t\t},\n\t\titemDate(): Date\n\t\t{\n\t\t\treturn this.$store.getters['recent/getSortDate'](this.recentItem.dialogId);\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisChannel(): boolean\n\t\t{\n\t\t\treturn ChannelManager.isChannel(this.recentItem.dialogId);\n\t\t},\n\t\tisNotes(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['chats/isNotes'](this.recentItem.dialogId);\n\t\t},\n\t\tavatarType(): string\n\t\t{\n\t\t\treturn this.isNotes ? ChatAvatarType.notes : '';\n\t\t},\n\t\tchatType(): string\n\t\t{\n\t\t\treturn this.isNotes ? ChatTitleType.notes : '';\n\t\t},\n\t\tisChatSelected(): boolean\n\t\t{\n\t\t\tconst canBeSelected = [Layout.chat, Layout.updateChat, Layout.collab, Layout.copilot, Layout.taskComments];\n\t\t\tif (!canBeSelected.includes(this.layout.name))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.layout.entityId === this.recentItem.dialogId;\n\t\t},\n\t\tisChatMuted(): boolean\n\t\t{\n\t\t\tconst isMuted = this.dialog.muteList.find((element) => {\n\t\t\t\treturn element === Core.getUserId();\n\t\t\t});\n\n\t\t\treturn Boolean(isMuted);\n\t\t},\n\t\thasActiveInputAction(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['chats/inputActions/isChatActive'](this.recentItem.dialogId);\n\t\t},\n\t\tneedsBirthdayPlaceholder(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['recent/needsBirthdayPlaceholder'](this.recentItem.dialogId);\n\t\t},\n\t\tshowLastMessage(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showLastMessage);\n\t\t},\n\t\tinvitation(): { isActive: boolean, originator: number, canResend: boolean }\n\t\t{\n\t\t\treturn this.recentItem.invitation;\n\t\t},\n\t\twrapClasses(): { [string]: boolean }\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--pinned': this.recentItem.pinned,\n\t\t\t\t'--selected': this.isChatSelected,\n\t\t\t};\n\t\t},\n\t\titemClasses(): { [string]: boolean }\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--no-text': !this.showLastMessage,\n\t\t\t};\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tformatDate(date): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :data-id=\"recentItem.dialogId\" :class=\"wrapClasses\" class=\"bx-im-list-recent-item__wrap\">\n\t\t\t<div :class=\"itemClasses\" class=\"bx-im-list-recent-item__container\">\n\t\t\t\t<div class=\"bx-im-list-recent-item__avatar_container\">\n\t\t\t\t\t<div v-if=\"invitation.isActive\" class=\"bx-im-list-recent-item__avatar_invitation\"></div>\n\t\t\t\t\t<div v-else class=\"bx-im-list-recent-item__avatar_content\">\n\t\t\t\t\t\t<ChatAvatar \n\t\t\t\t\t\t\t:avatarDialogId=\"recentItem.dialogId\" \n\t\t\t\t\t\t\t:contextDialogId=\"recentItem.dialogId\" \n\t\t\t\t\t\t\t:size=\"AvatarSize.XL\" \n\t\t\t\t\t\t\t:withSpecialTypeIcon=\"!hasActiveInputAction\"\n\t\t\t\t\t\t\t:customType=\"avatarType\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<InputActionIndicator v-if=\"hasActiveInputAction\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-recent-item__content_container\">\n\t\t\t\t\t<div class=\"bx-im-list-recent-item__content_header\">\n\t\t\t\t\t\t<ChatTitle \n\t\t\t\t\t\t\t:dialogId=\"recentItem.dialogId\" \n\t\t\t\t\t\t\t:withMute=\"true\" \n\t\t\t\t\t\t\t:withAutoDelete=\"true\"\n\t\t\t\t\t\t\t:customType=\"chatType\"\n\t\t\t\t\t\t\t:showItsYou=\"false\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-item__date\">\n\t\t\t\t\t\t\t<MessageStatus :item=\"item\" />\n\t\t\t\t\t\t\t<span>{{ formattedDate }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-list-recent-item__content_bottom\">\n\t\t\t\t\t\t<MessageText :item=\"recentItem\" />\n\t\t\t\t\t\t<ItemCounters :item=\"recentItem\" :isChatMuted=\"isChatMuted\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ConferenceChannel } from 'call.application.conference';\nimport { Messenger } from 'im.public';\nimport { Text } from 'main.core';\n\nimport { EventEmitter } from 'main.core.events';\n\nimport { ChatType, RecentCallStatus, EventType } from 'im.v2.const';\nimport { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { ChatButton, ButtonSize, ButtonColor, ButtonIcon, type CustomColorScheme } from 'im.v2.component.elements.button';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { CallManager } from 'im.v2.lib.call';\nimport { Analytics as CallAnalytics } from 'call.lib.analytics';\n\nimport '../css/active-call.css';\n\nimport type { ImModelCallItem, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const ActiveCall = {\n\tname: 'ActiveCall',\n\tcomponents: { ChatAvatar, ChatTitle, ChatButton },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['click'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tButtonIcon: () => ButtonIcon,\n\t\tactiveCall(): ImModelCallItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.activeCall.dialogId, true);\n\t\t},\n\t\tisConference(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.videoconf;\n\t\t},\n\t\tpreparedName(): string\n\t\t{\n\t\t\treturn Text.decode(this.activeCall.name);\n\t\t},\n\t\tanotherDeviceColorScheme(): CustomColorScheme\n\t\t{\n\t\t\treturn {\n\t\t\t\tbackgroundColor: 'transparent',\n\t\t\t\tborderColor: '#bbde4d',\n\t\t\t\ticonColor: '#525c69',\n\t\t\t\ttextColor: '#525c69',\n\t\t\t\thoverColor: 'transparent',\n\t\t\t};\n\t\t},\n\t\tisTabWithActiveCall(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.$store.getters['recent/calls/hasActiveCall']()\n\t\t\t\t&& Boolean(this.getCallManager().hasCurrentCall())\n\t\t\t);\n\t\t},\n\t\thasJoined(): boolean\n\t\t{\n\t\t\treturn this.activeCall.state === RecentCallStatus.joined;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tasync onJoinClick()\n\t\t{\n\t\t\tEventEmitter.emit(EventType.call.onJoinFromRecentItem);\n\n\t\t\tif (this.isConference)\n\t\t\t{\n\t\t\t\tCallAnalytics.getInstance().onJoinConferenceClick({\n\t\t\t\t\tcallId: this.activeCall.call.id,\n\t\t\t\t});\n\n\t\t\t\tconst hasThisActiveConference = await ConferenceChannel.getInstance().sendRequest(this.dialog.public.code);\n\t\t\t\tif (hasThisActiveConference.some(call => call))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tMessenger.openConference({ code: this.dialog.public.code });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst hasThisActiveCall = await this.getCallManager().sendBroadcastRequest(this.activeCall.call.uuid);\n\t\t\tif (hasThisActiveCall.some(call => call))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getCallManager().joinCall(this.activeCall.call.id, this.activeCall.call.uuid, this.activeCall.dialogId);\n\t\t},\n\t\tonBackToCallClick() {\n\t\t\tif (this.isConference)\n\t\t\t{\n\t\t\t\tConferenceChannel.getInstance().sendRequest(this.dialog.public.code);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.getCallManager().sendBroadcastRequest(this.activeCall.call.uuid);\n\t\t},\n\t\tonLeaveCallClick()\n\t\t{\n\t\t\tthis.getCallManager().leaveCurrentCall();\n\t\t},\n\t\tonClick(event)\n\t\t{\n\t\t\tconst recentItem = this.$store.getters['recent/get'](this.activeCall.dialogId);\n\t\t\tif (!recentItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.$emit('click', { item: recentItem, $event: event });\n\t\t},\n\t\treturnToCall()\n\t\t{\n\t\t\tif (this.activeCall.state !== RecentCallStatus.joined)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getCallManager().unfoldCurrentCall();\n\t\t},\n\t\tgetCallManager(): CallManager\n\t\t{\n\t\t\treturn CallManager.getInstance();\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :data-id=\"activeCall.dialogId\" class=\"bx-im-list-recent-item__wrap bx-im-list-recent-active-call-item__wrap\">\n\t\t\t<div @click=\"onClick\" class=\"bx-im-list-recent-item__container bx-im-list-recent-active-call__container\">\n\t\t\t\t<div class=\"bx-im-list-recent-item__avatar_container\">\n\t\t\t\t\t<ChatAvatar \n\t\t\t\t\t\t:avatarDialogId=\"activeCall.dialogId\" \n\t\t\t\t\t\t:contextDialogId=\"activeCall.dialogId\" \n\t\t\t\t\t\t:size=\"AvatarSize.XL\" \n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-recent-item__content_container\">\n\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__title_container\">\n\t\t\t\t\t\t<ChatTitle :text=\"preparedName\" />\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__title_icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"!hasJoined\" class=\"bx-im-list-recent-active-call__actions_container\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__actions_item --join\">\n\t\t\t\t\t\t\t<ChatButton @click.stop=\"onJoinClick\" :size=\"ButtonSize.M\" :color=\"ButtonColor.Success\" :isRounded=\"true\" :text=\"loc('IM_LIST_RECENT_ACTIVE_CALL_JOIN')\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else-if=\"hasJoined && isTabWithActiveCall\" class=\"bx-im-list-recent-active-call__actions_container\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__actions_item --return\">\n\t\t\t\t\t\t\t<ChatButton @click.stop=\"returnToCall\" :size=\"ButtonSize.M\" :color=\"ButtonColor.Success\" :isRounded=\"true\" :text=\"loc('IM_LIST_RECENT_ACTIVE_CALL_RETURN')\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else-if=\"hasJoined && !isTabWithActiveCall\" class=\"bx-im-list-recent-active-call__actions_container\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__actions_item --another-device\">\n\t\t\t\t\t\t\t<ChatButton :size=\"ButtonSize.M\" @click.stop=\"onBackToCallClick\" :customColorScheme=\"anotherDeviceColorScheme\" :isRounded=\"true\" :text=\"loc('IM_LIST_RECENT_ACTIVE_CALL_ANOTHER_DEVICE')\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};","import { Loc, type JsonObject } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { BIcon, Outline as OutlineIcons } from 'ui.icon-set.api.vue';\n\nimport { Messenger } from 'im.public';\nimport { CreateChatManager } from 'im.v2.lib.create-chat';\nimport { EmptyAvatar, EmptyAvatarType, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { Layout, ChatType, Color } from 'im.v2.const';\n\nimport '../css/create-chat.css';\n\nconst DefaultTitleByChatType = {\n\t[ChatType.chat]: Loc.getMessage('IM_LIST_RECENT_CREATE_CHAT_DEFAULT_TITLE'),\n\t[ChatType.videoconf]: Loc.getMessage('IM_LIST_RECENT_CREATE_CONFERENCE_DEFAULT_TITLE'),\n\t[ChatType.channel]: Loc.getMessage('IM_LIST_RECENT_CREATE_CHANNEL_DEFAULT_TITLE'),\n\t[ChatType.collab]: Loc.getMessage('IM_LIST_RECENT_CREATE_COLLAB_DEFAULT_TITLE'),\n};\n\nconst SubtitleByChatType = {\n\t[ChatType.chat]: Loc.getMessage('IM_LIST_RECENT_CREATE_CHAT_SUBTITLE'),\n\t[ChatType.videoconf]: Loc.getMessage('IM_LIST_RECENT_CREATE_CONFERENCE_SUBTITLE'),\n\t[ChatType.channel]: Loc.getMessage('IM_LIST_RECENT_CREATE_CHANNEL_SUBTITLE'),\n\t[ChatType.collab]: Loc.getMessage('IM_LIST_RECENT_CREATE_COLLAB_SUBTITLE'),\n};\n\nconst CLOSE_ICON_SIZE = 20;\n\n// @vue/component\nexport const CreateChat = {\n\tname: 'CreateChat',\n\tcomponents: { EmptyAvatar, BIcon },\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tchatTitle: '',\n\t\t\tchatAvatarFile: '',\n\t\t\tchatType: '',\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tOutlineIcons: () => OutlineIcons,\n\t\tColor: () => Color,\n\t\tCLOSE_ICON_SIZE: () => CLOSE_ICON_SIZE,\n\t\tchatCreationIsOpened(): boolean\n\t\t{\n\t\t\tconst { name: currentLayoutName } = this.$store.getters['application/getLayout'];\n\n\t\t\treturn currentLayoutName === Layout.createChat;\n\t\t},\n\t\tpreparedTitle(): string\n\t\t{\n\t\t\tif (this.chatTitle === '')\n\t\t\t{\n\t\t\t\treturn DefaultTitleByChatType[this.chatType];\n\t\t\t}\n\n\t\t\treturn this.chatTitle;\n\t\t},\n\t\tpreparedSubtitle(): string\n\t\t{\n\t\t\treturn SubtitleByChatType[this.chatType];\n\t\t},\n\t\tpreparedAvatar(): string | null\n\t\t{\n\t\t\tif (!this.chatAvatarFile)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn URL.createObjectURL(this.chatAvatarFile);\n\t\t},\n\t\tavatarType(): $Values<typeof EmptyAvatarType>\n\t\t{\n\t\t\tif (this.chatType === ChatType.collab)\n\t\t\t{\n\t\t\t\treturn EmptyAvatarType.collab;\n\t\t\t}\n\n\t\t\tif (this.chatType === ChatType.chat)\n\t\t\t{\n\t\t\t\treturn EmptyAvatarType.default;\n\t\t\t}\n\n\t\t\treturn EmptyAvatarType.squared;\n\t\t},\n\t\tcloseIconColor(): string\n\t\t{\n\t\t\treturn this.chatCreationIsOpened ? Color.white : Color.black;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tconst existingTitle = CreateChatManager.getInstance().getChatTitle();\n\t\tif (existingTitle)\n\t\t{\n\t\t\tthis.chatTitle = existingTitle;\n\t\t}\n\n\t\tconst existingAvatar = CreateChatManager.getInstance().getChatAvatar();\n\t\tif (existingAvatar)\n\t\t{\n\t\t\tthis.chatAvatarFile = existingAvatar;\n\t\t}\n\n\t\tthis.chatType = CreateChatManager.getInstance().getChatType();\n\n\t\tCreateChatManager.getInstance().subscribe(CreateChatManager.events.titleChange, this.onTitleChange);\n\t\tCreateChatManager.getInstance().subscribe(CreateChatManager.events.avatarChange, this.onAvatarChange);\n\t\tCreateChatManager.getInstance().subscribe(CreateChatManager.events.chatTypeChange, this.onChatTypeChange);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tCreateChatManager.getInstance().unsubscribe(CreateChatManager.events.titleChange, this.onTitleChange);\n\t\tCreateChatManager.getInstance().unsubscribe(CreateChatManager.events.avatarChange, this.onAvatarChange);\n\t\tCreateChatManager.getInstance().unsubscribe(CreateChatManager.events.chatTypeChange, this.onChatTypeChange);\n\t},\n\tmethods:\n\t{\n\t\tonTitleChange(event: BaseEvent<string>)\n\t\t{\n\t\t\tthis.chatTitle = event.getData();\n\t\t},\n\t\tonAvatarChange(event: BaseEvent<string>)\n\t\t{\n\t\t\tthis.chatAvatarFile = event.getData();\n\t\t},\n\t\tonChatTypeChange(event: BaseEvent<string>)\n\t\t{\n\t\t\tthis.chatType = event.getData();\n\t\t},\n\t\tonClick()\n\t\t{\n\t\t\tCreateChatManager.getInstance().startChatCreation(this.chatType, {\n\t\t\t\tclearCurrentCreation: false,\n\t\t\t});\n\t\t},\n\t\tonCancel()\n\t\t{\n\t\t\tCreateChatManager.getInstance().clearExternalFields();\n\t\t\tCreateChatManager.getInstance().setCreationStatus(false);\n\n\t\t\tif (!this.chatCreationIsOpened)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid Messenger.openChat();\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-recent-create-chat__container\">\n\t\t\t<div class=\"bx-im-list-recent-item__wrap\" :class=\"{'--selected': chatCreationIsOpened}\" @click=\"onClick\">\n\t\t\t\t<div class=\"bx-im-list-recent-item__container\">\n\t\t\t\t\t<div class=\"bx-im-list-recent-create-chat__avatar-container\">\n\t\t\t\t\t\t<EmptyAvatar \n\t\t\t\t\t\t\t:url=\"preparedAvatar\" \n\t\t\t\t\t\t\t:size=\"AvatarSize.XL\"\n\t\t\t\t\t\t\t:title=\"chatTitle\"\n\t\t\t\t\t\t\t:type=\"avatarType\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-list-recent-item__content_container\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-item__content_header\">\n\t\t\t\t\t\t\t<div class=\"bx-im-list-recent-create-chat__header --ellipsis\">\n\t\t\t\t\t\t\t\t{{ preparedTitle }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-item__content_bottom\">\n\t\t\t\t\t\t\t<div class=\"bx-im-list-recent-item__message_container\">\n\t\t\t\t\t\t\t\t{{ preparedSubtitle }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name=\"OutlineIcons.CROSS_M\"\n\t\t\t\t\t\t:size=\"CLOSE_ICON_SIZE\"\n\t\t\t\t\t\t:color=\"closeIconColor\"\n\t\t\t\t\t\tclass=\"bx-im-list-recent-create-chat__icon-close\"\n\t\t\t\t\t\t@click.stop=\"onCancel\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ChatButton, ButtonSize, ButtonColor } from 'im.v2.component.elements.button';\nimport { Feature, FeatureManager } from 'im.v2.lib.feature';\nimport { InviteManager } from 'im.v2.lib.invite';\nimport { RecentEmptyState } from 'im.v2.component.list.items.elements.empty-state';\n\n// @vue/component\nexport const EmptyState = {\n\tname: 'EmptyState',\n\tcomponents: { ChatButton, RecentEmptyState },\n\tcomputed: {\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tcanInviteUsers(): boolean\n\t\t{\n\t\t\treturn FeatureManager.isFeatureAvailable(Feature.intranetInviteAvailable);\n\t\t},\n\t},\n\tmethods: {\n\t\tonInviteUsersClick(): void\n\t\t{\n\t\t\tInviteManager.openInviteSlider();\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<RecentEmptyState\n\t\t\t:title=\"loc('IM_LIST_RECENT_EMPTY_STATE_TITLE')\"\n\t\t\t:subtitle=\"loc('IM_LIST_RECENT_EMPTY_STATE_SUBTITLE')\"\n\t\t>\n\t\t\t<ChatButton\n\t\t\t\tv-if=\"canInviteUsers\"\n\t\t\t\t:size=\"ButtonSize.L\"\n\t\t\t\t:isRounded=\"true\"\n\t\t\t\t:text=\"loc('IM_LIST_RECENT_EMPTY_STATE_INVITE_USERS')\"\n\t\t\t\t@click=\"onInviteUsersClick\"\n\t\t\t/>\n\t\t</RecentEmptyState>\n\t`,\n};\n","import {EventEmitter} from 'main.core.events';\nimport {Type} from 'main.core';\nimport {Utils} from 'im.v2.lib.utils';\n\nexport class BroadcastManager extends EventEmitter\n{\n\tstatic instance = null;\n\tstatic channelName = 'im-recent';\n\tstatic eventNamespace = 'BX.Messenger.v2.Recent.BroadcastManager';\n\tstatic events = {\n\t\trecentListUpdate: 'recentListUpdate'\n\t};\n\n\tstatic getInstance()\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(BroadcastManager.eventNamespace);\n\t\tthis.init();\n\t}\n\n\tisSupported()\n\t{\n\t\treturn !Type.isUndefined(window.BroadcastChannel) && !Utils.platform.isBitrixDesktop();\n\t}\n\n\tinit()\n\t{\n\t\tif (!this.isSupported())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.channel = new BroadcastChannel(BroadcastManager.channelName);\n\t\tthis.channel.addEventListener('message', ({data: {type, data}}) => {\n\t\t\tthis.emit(type, data);\n\t\t});\n\t}\n\n\tsendRecentList(recentData: Object)\n\t{\n\t\tif (!this.isSupported())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.channel.postMessage({\n\t\t\ttype: BroadcastManager.events.recentListUpdate,\n\t\t\tdata: recentData\n\t\t});\n\t}\n}","import {EventEmitter, BaseEvent} from 'main.core.events';\n\nimport {Core} from 'im.v2.application.core';\nimport {EventType} from 'im.v2.const';\n\nimport type {OnDialogInitedEvent} from 'im.v2.const';\n\nexport class LikeManager\n{\n\tstore: Object;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t}\n\n\tinit()\n\t{\n\t\tthis.onDialogInitedHandler = this.onDialogInited.bind(this);\n\t\tEventEmitter.subscribe(EventType.dialog.onDialogInited, this.onDialogInitedHandler);\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.onDialogInited, this.onDialogInitedHandler);\n\t}\n\n\tonDialogInited(event: BaseEvent<OnDialogInitedEvent>)\n\t{\n\t\tconst { dialogId } = event.getData();\n\t\tconst recentItem = this.store.getters['recent/get'](dialogId);\n\t\tif (!recentItem || !recentItem.liked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.dispatch('recent/like', {\n\t\t\tid: dialogId,\n\t\t\tliked: false,\n\t\t});\n\t}\n}\n","import { BaseEvent } from 'main.core.events';\n\nimport { ChatType, Settings } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { LegacyRecentService } from 'im.v2.provider.service.recent';\nimport { RecentMenu } from 'im.v2.lib.menu';\nimport { DraftManager } from 'im.v2.lib.draft';\nimport { CreateChatManager } from 'im.v2.lib.create-chat';\nimport { ListLoadingState as LoadingState } from 'im.v2.component.elements.list-loading-state';\n\nimport { RecentItem } from './components/recent-item/recent-item';\nimport { ActiveCall } from './components/active-call';\nimport { CreateChat } from './components/create-chat';\nimport { EmptyState } from './components/empty-state';\n\nimport { BroadcastManager } from './classes/broadcast-manager';\nimport { LikeManager } from './classes/like-manager';\n\nimport './css/recent-list.css';\n\nexport { RecentItem } from './components/recent-item/recent-item';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem, ImModelCallItem } from 'im.v2.model';\n\n// @vue/component\nexport const RecentList = {\n\tname: 'RecentList',\n\tcomponents: { LoadingState, RecentItem, ActiveCall, CreateChat, EmptyState },\n\temits: ['chatClick'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tisLoadingNextPage: false,\n\t\t\tlistIsScrolled: false,\n\t\t\tisCreatingChat: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tcollection(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.getRecentService().getCollection();\n\t\t},\n\t\tisEmptyCollection(): boolean\n\t\t{\n\t\t\treturn this.collection.length === 0;\n\t\t},\n\t\tpreparedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\tconst filteredCollection = this.collection.filter((item) => {\n\t\t\t\tlet result = true;\n\t\t\t\tif (!this.showBirthdays && item.isBirthdayPlaceholder)\n\t\t\t\t{\n\t\t\t\t\tresult = false;\n\t\t\t\t}\n\n\t\t\t\tif (item.isFakeElement && !this.isFakeItemNeeded(item))\n\t\t\t\t{\n\t\t\t\t\tresult = false;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t});\n\n\t\t\treturn [...filteredCollection].sort((a, b) => {\n\t\t\t\tconst firstDate = this.$store.getters['recent/getSortDate'](a.dialogId);\n\t\t\t\tconst secondDate = this.$store.getters['recent/getSortDate'](b.dialogId);\n\n\t\t\t\treturn secondDate - firstDate;\n\t\t\t});\n\t\t},\n\t\tactiveCalls(): ImModelCallItem[]\n\t\t{\n\t\t\treturn this.$store.getters['recent/calls/get'];\n\t\t},\n\t\tpinnedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.preparedItems.filter((item) => {\n\t\t\t\treturn item.pinned === true;\n\t\t\t});\n\t\t},\n\t\tgeneralItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.preparedItems.filter((item) => {\n\t\t\t\treturn item.pinned === false;\n\t\t\t});\n\t\t},\n\t\tshowBirthdays(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showBirthday);\n\t\t},\n\t\tshowInvited(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showInvited);\n\t\t},\n\t\tfirstPageLoaded(): boolean\n\t\t{\n\t\t\treturn this.getRecentService().firstPageIsLoaded;\n\t\t},\n\t},\n\tasync created()\n\t{\n\t\tthis.contextMenuManager = new RecentMenu();\n\n\t\tthis.initBroadcastManager();\n\t\tthis.initLikeManager();\n\t\tthis.initCreateChatManager();\n\n\t\tthis.isLoading = true;\n\t\tawait this.getRecentService().loadFirstPage({ ignorePreloadedItems: true });\n\t\tthis.isLoading = false;\n\n\t\tvoid DraftManager.getInstance().initDraftHistory();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t\tthis.destroyBroadcastManager();\n\t\tthis.destroyLikeManager();\n\t\tthis.destroyCreateChatManager();\n\t},\n\tmethods:\n\t{\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.listIsScrolled = event.target.scrollTop > 0;\n\n\t\t\tthis.contextMenuManager.close();\n\t\t\tif (!Utils.dom.isOneScreenRemaining(event.target) || !this.getRecentService().hasMoreItemsToLoad)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoadingNextPage = true;\n\t\t\tawait this.getRecentService().loadNextPage();\n\t\t\tthis.isLoadingNextPage = false;\n\t\t},\n\t\tonClick(item)\n\t\t{\n\t\t\tthis.$emit('chatClick', item.dialogId);\n\t\t},\n\t\tonRightClick(item, event)\n\t\t{\n\t\t\tif (Utils.key.isCombination(event, 'Alt+Shift'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst context = {\n\t\t\t\tdialogId: item.dialogId,\n\t\t\t\trecentItem: item,\n\t\t\t\tcompactMode: false,\n\t\t\t};\n\n\t\t\tconst positionTarget = {\n\t\t\t\tleft: event.clientX,\n\t\t\t\ttop: event.clientY,\n\t\t\t};\n\n\t\t\tthis.contextMenuManager.openMenu(context, positionTarget);\n\n\t\t\tevent.preventDefault();\n\t\t},\n\t\tonCallClick({ item, $event })\n\t\t{\n\t\t\tthis.onClick(item, $event);\n\t\t},\n\t\tinitBroadcastManager()\n\t\t{\n\t\t\tthis.onRecentListUpdate = (event) => {\n\t\t\t\tthis.getRecentService().setPreloadedData(event.data);\n\t\t\t};\n\t\t\tthis.broadcastManager = BroadcastManager.getInstance();\n\t\t\tthis.broadcastManager.subscribe(BroadcastManager.events.recentListUpdate, this.onRecentListUpdate);\n\t\t},\n\t\tdestroyBroadcastManager()\n\t\t{\n\t\t\tthis.broadcastManager = BroadcastManager.getInstance();\n\t\t\tthis.broadcastManager.unsubscribe(BroadcastManager.events.recentListUpdate, this.onRecentListUpdate);\n\t\t},\n\t\tinitLikeManager()\n\t\t{\n\t\t\tthis.likeManager = new LikeManager();\n\t\t\tthis.likeManager.init();\n\t\t},\n\t\tdestroyLikeManager()\n\t\t{\n\t\t\tthis.likeManager.destroy();\n\t\t},\n\t\tinitCreateChatManager()\n\t\t{\n\t\t\tif (CreateChatManager.getInstance().isCreating())\n\t\t\t{\n\t\t\t\tthis.isCreatingChat = true;\n\t\t\t}\n\n\t\t\tthis.onCreationStatusChange = (event: BaseEvent<boolean>) => {\n\t\t\t\tthis.isCreatingChat = event.getData();\n\t\t\t};\n\t\t\tCreateChatManager.getInstance().subscribe(\n\t\t\t\tCreateChatManager.events.creationStatusChange,\n\t\t\t\tthis.onCreationStatusChange,\n\t\t\t);\n\t\t},\n\t\tdestroyCreateChatManager()\n\t\t{\n\t\t\tCreateChatManager.getInstance().unsubscribe(\n\t\t\t\tCreateChatManager.events.creationStatusChange,\n\t\t\t\tthis.onCreationStatusChange,\n\t\t\t);\n\t\t},\n\t\tisFakeItemNeeded(item: ImModelRecentItem): boolean\n\t\t{\n\t\t\tconst dialog = this.$store.getters['chats/get'](item.dialogId, true);\n\t\t\tconst isUser = dialog.type === ChatType.user;\n\t\t\tconst hasBirthday = isUser && this.showBirthdays && this.$store.getters['users/hasBirthday'](item.dialogId);\n\n\t\t\treturn this.showInvited || hasBirthday;\n\t\t},\n\t\tgetRecentService(): LegacyRecentService\n\t\t{\n\t\t\tif (!this.service)\n\t\t\t{\n\t\t\t\tthis.service = LegacyRecentService.getInstance();\n\t\t\t}\n\n\t\t\treturn this.service;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-recent__container\">\n\t\t\t<div v-if=\"activeCalls.length > 0\" class=\"bx-im-list-recent__calls_container\" :class=\"{'--with-shadow': listIsScrolled}\">\n\t\t\t\t<ActiveCall\n\t\t\t\t\tv-for=\"activeCall in activeCalls\"\n\t\t\t\t\t:key=\"activeCall.dialogId\"\n\t\t\t\t\t:item=\"activeCall\"\n\t\t\t\t\t@click=\"onCallClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<CreateChat v-if=\"isCreatingChat\" />\n\t\t\t<LoadingState v-if=\"isLoading && !firstPageLoaded\" />\n\t\t\t<div v-else @scroll=\"onScroll\" class=\"bx-im-list-recent__scroll-container\">\n\t\t\t\t<EmptyState v-if=\"isEmptyCollection\" />\n\t\t\t\t<div v-if=\"pinnedItems.length > 0\" class=\"bx-im-list-recent__pinned_container\">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for=\"item in pinnedItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t@click=\"onClick(item, $event)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-recent__general_container\">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for=\"item in generalItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t@click=\"onClick(item, $event)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\t\n\t\t\t\t<LoadingState v-if=\"isLoadingNextPage\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["HiddenTitleByChatType","ChatType","openChannel","Loc","getMessage","channel","generalChannel","default","MessageText","name","components","MessageAvatar","props","item","type","Object","required","computed","AvatarSize","recentItem","dialog","$store","getters","dialogId","user","message","needsBirthdayPlaceholder","needsVacationPlaceholder","showLastMessage","Settings","recent","notesText","loc","hiddenMessageText","isNotes","isUser","isLastMessageAuthor","authorId","Core","getUserId","messageText","isDeleted","formattedText","Parser","purifyRecent","formattedMessageText","SPLIT_INDEX","Utils","text","insertUnseenWhitespace","preparedDraftContent","phrase","PLACEHOLDER_LENGTH","length","prefix","slice","Text","encode","formattedDraftText","purify","draft","showIconIfEmptyText","formattedVacationEndDate","DateTimeFormat","format","absent","isChat","methods","phraseCode","replacements","$Bitrix","template","ItemCounters","isChatMuted","Boolean","isSelfChat","id","invitation","totalCounter","counter","channelCommentsCounter","chatId","formattedCounter","formatCounter","showCounterContainer","isActive","showPinnedIcon","noCounters","pinned","unread","showUnreadWithoutCounter","showUnreadWithCounter","showMention","AnchorType","mention","showCounter","isSingleMessageWithMention","containerClasses","commentsOnly","withComments","withMentionAndCounter","toString","StatusIcon","none","like","sending","sent","viewed","MessageStatus","data","isChatWithReactions","reaction","showLike","liked","messageStatus","OwnMessageStatus","viewedByOthers","statusIcon","isBot","hasDraft","UserType","bot","RecentItem","ChatAvatar","ChatTitle","InputActionIndicator","formattedDate","formatDate","itemDate","layout","isChannel","ChannelManager","avatarType","ChatAvatarType","notes","chatType","ChatTitleType","isChatSelected","canBeSelected","Layout","chat","updateChat","collab","copilot","taskComments","includes","entityId","isMuted","muteList","find","element","hasActiveInputAction","wrapClasses","itemClasses","date","DateFormatter","formatByTemplate","DateTemplate","ActiveCall","ChatButton","emits","ButtonSize","ButtonColor","ButtonIcon","activeCall","isConference","videoconf","preparedName","decode","anotherDeviceColorScheme","backgroundColor","borderColor","iconColor","textColor","hoverColor","isTabWithActiveCall","getCallManager","hasCurrentCall","hasJoined","state","RecentCallStatus","joined","onJoinClick","EventEmitter","emit","EventType","call","onJoinFromRecentItem","CallAnalytics","getInstance","onJoinConferenceClick","callId","hasThisActiveConference","ConferenceChannel","sendRequest","public","code","some","Messenger","openConference","hasThisActiveCall","sendBroadcastRequest","uuid","joinCall","onBackToCallClick","onLeaveCallClick","leaveCurrentCall","onClick","event","$emit","$event","returnToCall","unfoldCurrentCall","CallManager","DefaultTitleByChatType","SubtitleByChatType","CLOSE_ICON_SIZE","CreateChat","EmptyAvatar","BIcon","chatTitle","chatAvatarFile","OutlineIcons","Color","chatCreationIsOpened","currentLayoutName","createChat","preparedTitle","preparedSubtitle","preparedAvatar","URL","createObjectURL","EmptyAvatarType","squared","closeIconColor","white","black","created","existingTitle","CreateChatManager","getChatTitle","existingAvatar","getChatAvatar","getChatType","subscribe","events","titleChange","onTitleChange","avatarChange","onAvatarChange","chatTypeChange","onChatTypeChange","beforeUnmount","unsubscribe","getData","startChatCreation","clearCurrentCreation","onCancel","clearExternalFields","setCreationStatus","openChat","EmptyState","RecentEmptyState","canInviteUsers","FeatureManager","isFeatureAvailable","Feature","intranetInviteAvailable","onInviteUsersClick","InviteManager","openInviteSlider","BroadcastManager","instance","constructor","setEventNamespace","eventNamespace","init","isSupported","Type","isUndefined","window","BroadcastChannel","platform","isBitrixDesktop","channelName","addEventListener","sendRecentList","recentData","postMessage","recentListUpdate","LikeManager","store","getStore","onDialogInitedHandler","onDialogInited","bind","destroy","dispatch","RecentList","LoadingState","isLoading","isLoadingNextPage","listIsScrolled","isCreatingChat","collection","getRecentService","getCollection","isEmptyCollection","preparedItems","filteredCollection","filter","result","showBirthdays","isBirthdayPlaceholder","isFakeElement","isFakeItemNeeded","sort","a","b","firstDate","secondDate","activeCalls","pinnedItems","generalItems","showBirthday","showInvited","firstPageLoaded","firstPageIsLoaded","contextMenuManager","RecentMenu","initBroadcastManager","initLikeManager","initCreateChatManager","loadFirstPage","ignorePreloadedItems","DraftManager","initDraftHistory","destroyBroadcastManager","destroyLikeManager","destroyCreateChatManager","onScroll","target","scrollTop","close","dom","isOneScreenRemaining","hasMoreItemsToLoad","loadNextPage","onRightClick","key","isCombination","context","compactMode","positionTarget","left","clientX","top","clientY","openMenu","preventDefault","onCallClick","onRecentListUpdate","setPreloadedData","broadcastManager","likeManager","isCreating","onCreationStatusChange","creationStatusChange","hasBirthday","service","LegacyRecentService"],"mappings":"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"}