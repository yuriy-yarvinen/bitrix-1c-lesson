this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,n,i,s,o,a,r,l,d,c,u,g,h,p,m,I,_,b,v,T,C,L,S,E,y,f){"use strict";const B="user";const A=600;const M={name:"AddToChatContent",components:{AddToChat:y.AddToChat,ChatButton:u.ChatButton},props:{dialogId:{type:String,required:true},isLoading:{type:Boolean,required:false},height:{type:Number,default:A}},emits:["inviteMembers","close"],data(){return{searchQuery:"",showHistory:true,selectedItems:new Set}},computed:{ButtonSize:()=>u.ButtonSize,ButtonColor:()=>u.ButtonColor,dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},isChat(){return this.dialog.type!==S.ChatType.user},isCollab(){return this.dialog.type===S.ChatType.collab},isOpenLines(){return this.dialog.type===S.ChatType.lines},isChannel(){return i.ChannelManager.isChannel(this.dialogId)},showHistoryOption(){return!this.isCollab&&this.isChat&&!this.isChannel&&!this.isOpenLines},containerStyles(){return{height:`${this.height}px`}}},created(){this.membersSelector=this.getTagSelector()},mounted(){this.membersSelector.renderTo(this.$refs["tag-selector"]);this.membersSelector.focusTextBox()},beforeUnmount(){E.Analytics.getInstance().userAdd.onClosePopup()},activated(){this.membersSelector.hideAddButton();this.membersSelector.showTextBox();this.membersSelector.focusTextBox()},methods:{getTagSelector(){let t=null;return new n.TagSelector({maxHeight:111,showAddButton:false,showTextBox:true,addButtonCaption:this.loc("IM_ENTITY_SELECTOR_ADD_TO_CHAT_ADD_MSGVER_1"),addButtonCaptionMore:this.loc("IM_ENTITY_SELECTOR_ADD_TO_CHAT_ADD_MORE"),showCreateButton:false,events:{onBeforeTagAdd:()=>{clearTimeout(t)},onAfterTagAdd:t=>{const{tag:e}=t.getData();this.selectedItems.add(e.id);this.focusSelector()},onKeyUp:t=>{const{event:e}=t.getData();v.EventEmitter.emit(S.EventType.search.keyPressed,{keyboardEvent:e})},onBeforeTagRemove:()=>{clearTimeout(t)},onAfterTagRemove:t=>{const{tag:e}=t.getData();this.selectedItems.delete(e.id);this.focusSelector()},onInput:()=>{E.Analytics.getInstance().userAdd.onStartSearch({dialogId:this.dialogId});this.searchQuery=this.membersSelector.getTextBoxValue().trim().toLowerCase()},onBlur:()=>{const e=this.membersSelector.getTextBoxValue();if(e.length>0){return}t=setTimeout((()=>{this.membersSelector.hideTextBox();this.membersSelector.showAddButton()}),200)},onContainerClick:()=>{this.focusSelector()}}})},focusSelector(){this.membersSelector.hideAddButton();this.membersSelector.showTextBox();this.membersSelector.focusTextBox()},onSelectItem(t){const{dialogId:e,nativeEvent:n}=t;if(this.selectedItems.has(e)){const t={id:e,entityId:B};this.membersSelector.removeTag(t)}else{const t=this.getTagByDialogId(e);this.membersSelector.addTag(t)}this.membersSelector.clearTextBox();if(!n.altKey){this.searchQuery=""}},getTagByDialogId(t){const e=this.$store.getters["users/get"](t,true);const n=e.type===S.UserType.extranet;const i=n?"extranet":"employee";return{id:t,entityId:B,entityType:i,title:e.name,avatar:e.avatar.length>0?e.avatar:null}},onInviteClick(){const t=[...this.selectedItems];this.$emit("inviteMembers",{members:t,showHistory:this.showHistory})},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-entity-selector-add-to-chat__container" :style="containerStyles">\n\t\t\t<div class="bx-im-entity-selector-add-to-chat__input" ref="tag-selector"></div>\n\t\t\t<div v-if="showHistoryOption" class="bx-im-entity-selector-add-to-chat__show-history">\n\t\t\t\t<input type="checkbox" id="bx-im-entity-selector-add-to-chat-show-history" v-model="showHistory">\n\t\t\t\t<label for="bx-im-entity-selector-add-to-chat-show-history">\n\t\t\t\t\t{{ loc('IM_ENTITY_SELECTOR_ADD_TO_CHAT_SHOW_HISTORY')}}\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div class="bx-im-entity-selector-add-to-chat__search-result-container">\n\t\t\t\t<AddToChat\n\t\t\t\t\t:query="searchQuery"\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t:selectedItems="[...selectedItems]"\n\t\t\t\t\t@clickItem="onSelectItem"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="bx-im-entity-selector-add-to-chat__buttons">\n\t\t\t\t<ChatButton\n\t\t\t\t\t:size="ButtonSize.L"\n\t\t\t\t\t:color="ButtonColor.Primary"\n\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t:isLoading="isLoading"\n\t\t\t\t\t:text="loc('IM_ENTITY_SELECTOR_ADD_TO_CHAT_INVITE_BUTTON')"\n\t\t\t\t\t:isDisabled="selectedItems.size === 0"\n\t\t\t\t\t@click="onInviteClick"\n\t\t\t\t/>\n\t\t\t\t<ChatButton\n\t\t\t\t\t:size="ButtonSize.L"\n\t\t\t\t\t:color="ButtonColor.LightBorder"\n\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t:text="loc('IM_ENTITY_SELECTOR_ADD_TO_CHAT_CANCEL_BUTTON')"\n\t\t\t\t\t@click="$emit('close')"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const O="im-add-to-chat-popup";const x={name:"AddToChat",components:{MessengerPopup:b.MessengerPopup,AddToChatContent:M},props:{bindElement:{type:Object,required:true},dialogId:{type:String,required:true},popupConfig:{type:Object,required:true}},emits:["close"],data(){return{isLoading:false}},computed:{POPUP_ID:()=>O,config(){return{titleBar:this.$Bitrix.Loc.getMessage("IM_ENTITY_SELECTOR_ADD_TO_CHAT_ADD_MEMBERS_TITLE"),closeIcon:true,bindElement:this.bindElement,offsetTop:this.popupConfig.offsetTop,offsetLeft:this.popupConfig.offsetLeft,padding:0,contentPadding:0,contentBackground:"#fff",className:"bx-im-entity-selector-add-to-chat__scope"}},dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},isChat(){return this.dialog.type!==S.ChatType.user},chatId(){return this.dialog.chatId}},created(){this.chatService=new e.ChatService},methods:{inviteMembers(t){const{members:e,showHistory:n}=t;if(this.isChat){this.extendChat(e,n)}else{e.push(this.dialogId,o.Core.getUserId());void this.createChat(e)}},extendChat(t,e){this.isLoading=true;this.chatService.addToChat({chatId:this.chatId,members:t,showHistory:e}).then((()=>{this.isLoading=false;this.$emit("close")})).catch((()=>{this.isLoading=false;this.$emit("close")}))},async createChat(t){this.isLoading=true;const{newDialogId:e}=await this.chatService.createChat({title:null,description:null,members:t,ownerId:o.Core.getUserId(),isPrivate:true}).catch((()=>{this.isLoading=false}));this.isLoading=false;this.$emit("close");void L.Messenger.openChat(e)}},template:`\n\t\t<MessengerPopup\n\t\t\t:config="config"\n\t\t\t:id="POPUP_ID"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<AddToChatContent \n\t\t\t\t:dialogId="dialogId" \n\t\t\t\t:isLoading="isLoading"\n\t\t\t\t@close="$emit('close')"\n\t\t\t\t@inviteMembers="inviteMembers"\n\t\t\t/>\n\t\t</MessengerPopup>\n\t`};class w{addEmployees({dialogId:t,members:e}){const n={data:{dialogId:t,members:h.Utils.user.prepareSelectorIds(e)}};g.runAction(S.RestMethod.socialnetworkMemberAdd,n).catch((([t])=>{console.error("CollabInvitationService: add employee error",t)}))}copyLink(t,e){const n={data:{collabId:t,userLang:e}};return g.runAction(S.RestMethod.intranetInviteGetLinkByCollabId,n).catch((([t])=>{console.error("CollabInvitationService: getting invite link error",t);throw t}))}updateLink(t){const e={data:{collabId:t}};return g.runAction(S.RestMethod.intranetInviteRegenerateLinkByCollabId,e).catch((([t])=>{console.error("CollabInvitationService: updating invite link error",t);throw t}))}}const D={name:"CopyInviteLink",components:{ChatButton:u.ChatButton},directives:{hint:I.hint},props:{dialogId:{type:String,required:true},collabId:{type:Number,required:true},langCode:{type:String,required:true}},data(){return{isCopyingInviteLink:false,isUpdatingLink:false}},computed:{ButtonSize:()=>u.ButtonSize,ButtonColor:()=>u.ButtonColor,isInviteLinkAvailable(){return c.FeatureManager.isFeatureAvailable(c.Feature.inviteByLinkAvailable)},isEnabledCollabersInvitation(){return c.FeatureManager.isFeatureAvailable(c.Feature.enabledCollabersInvitation)},updateLinkHint(){return{text:this.loc("IM_ENTITY_SELECTOR_ADD_TO_COLLAB_LINK_UPDATE_HINT"),popupOptions:{width:278,bindOptions:{position:"top"},angle:{offset:36,position:"top"},targetContainer:document.body,offsetTop:-8}}},canUpdateLink(){return d.PermissionManager.getInstance().canPerformActionByRole(S.ActionByRole.updateInviteLink,this.dialogId)}},methods:{async copyInviteLink(){if(!this.isEnabledCollabersInvitation){this.showHelper();return}try{this.isCopyingInviteLink=true;const t=await(new w).copyLink(this.collabId,this.langCode);await h.Utils.text.copyToClipboard(t);f.Notifier.onCopyLinkComplete()}catch{f.Notifier.collab.onCopyLinkError()}finally{this.isCopyingInviteLink=false}},async updateLink(){if(!this.isEnabledCollabersInvitation){this.showHelper();return}try{this.isUpdatingLink=true;await(new w).updateLink(this.collabId);f.Notifier.collab.onUpdateLinkComplete()}catch{f.Notifier.onDefaultError()}finally{this.isUpdatingLink=false}},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},showHelper(){new l.FeaturePromoter({code:S.SliderCode.collabInviteOff}).show()}},template:`\n\t\t<div v-if="isInviteLinkAvailable" class="bx-im-add-to-collab__invite-block --link">\n\t\t\t<span class="bx-im-add-to-collab__invite-block-title --ellipsis">\n\t\t\t\t{{ loc('IM_ENTITY_SELECTOR_ADD_TO_COLLAB_INVITE_BY_LINK') }}\n\t\t\t</span>\n\t\t\t<ChatButton\n\t\t\t\t:size="ButtonSize.M"\n\t\t\t\t:color="ButtonColor.Primary"\n\t\t\t\t:isRounded="true"\n\t\t\t\t:isUppercase="false"\n\t\t\t\t:isLoading="isCopyingInviteLink"\n\t\t\t\t:isDisabled="isUpdatingLink"\n\t\t\t\t:text="loc('IM_ENTITY_SELECTOR_ADD_TO_COLLAB_COPY_LINK')"\n\t\t\t\t@click="copyInviteLink"\n\t\t\t/>\n\t\t\t<button\n\t\t\t\tv-if="canUpdateLink"\n\t\t\t\tv-hint="updateLinkHint"\n\t\t\t\t:class="{'--loading': isUpdatingLink}"\n\t\t\t\tclass="bx-im-add-to-collab__update-link_button"\n\t\t\t\t@click="updateLink"\n\t\t\t>\n\t\t\t\t<span class="bx-im-add-to-collab__update-link_icon"></span>\n\t\t\t</button>\n\t\t</div>\n\t`};const k="bx-im-add-to-collab__language-selector_item";const N="menu-popup-item-accept";const P={name:"InviteLanguageSelector",directives:{hint:I.hint},props:{defaultLanguageCode:{type:String,required:true}},emits:["selectLanguage","openLanguageSelector","closeLanguageSelector"],data(){return{selectedLanguageCode:this.defaultLanguageCode,isSelectorShown:false}},computed:{selectedLanguageName(){const t=this.availableLanguages[this.selectedLanguageCode];return t?t.NAME:""}},created(){this.availableLanguages=(new p.Languages).getLanguages()},methods:{languageSelectorHint(){return{text:this.loc("IM_ENTITY_SELECTOR_ADD_TO_COLLAB_LANGUAGE_SELECTOR_HINT"),popupOptions:{className:"im-add-to-collab__invite-language-section_hint",width:270,bindOptions:{position:"top",forceBindPosition:true},angle:{offset:37,position:"bottom"},offsetTop:-8}}},onLanguageSelected(t){this.toggleSelector();this.selectedLanguageCode=t;this.$emit("selectLanguage",this.selectedLanguageCode)},toggleSelector(){if(this.isSelectorShown){this.closeSelector()}else{this.showSelector()}},showSelector(){this.selector=this.createSelector();this.selector.show();this.isSelectorShown=true;this.$emit("openLanguageSelector")},closeSelector(){this.selector.close();this.isSelectorShown=false;this.$emit("closeLanguageSelector")},createSelector(){return _.PopupMenu.create({id:m.Text.getRandom().toLowerCase(),bindElement:this.$refs.inviteLanguageSection,className:"bx-im-messenger__scope bx-im-add-to-collab__invite-language-section_language-selector",items:this.getMenuItems(),angle:false,autoHide:true,closeByEsc:true,maxHeight:207,contentPadding:10,padding:10,bindOptions:{forceBindPosition:true},events:{onPopupClose:()=>{this.isSelectorShown=false;this.$emit("closeLanguageSelector")}}})},getMenuItems(){return Object.keys(this.availableLanguages).map((t=>new _.MenuItem({langCode:t,className:this.getMenuItemClass(t),text:this.getMenuItemText(t),onclick:()=>this.onLanguageSelected(t)})))},getMenuItemClass(t){return t===this.selectedLanguageCode?`${k} ${N}`:k},getMenuItemText(t){const e=this.availableLanguages[t];const n=e?e.NAME:"";if(t===this.defaultLanguageCode){return this.loc("IM_ENTITY_SELECTOR_ADD_TO_COLLAB_DEFAULT_LANGUAGE_TITLE",{"#LANG_NAME#":n})}return n},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<section\n\t\t\tclass="bx-im-add-to-collab__invite-language-section"\n\t\t\tv-hint="languageSelectorHint"\n\t\t\tref="inviteLanguageSection"\n\t\t>\n\t\t\t<span class="bx-im-add-to-collab__invite-language-section_title">\n\t\t\t\t{{ loc('IM_ENTITY_SELECTOR_ADD_TO_COLLAB_INVITE_LANGUAGE_TITLE') }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\tclass="bx-im-add-to-collab__invite-language-section_selected-language-block"\n\t\t\t\t@click="toggleSelector"\n\t\t\t>\n\t\t\t\t<span class="bx-im-add-to-collab__selected-language-block_title">\n\t\t\t\t\t{{ selectedLanguageName }}\n\t\t\t\t</span>\n\t\t\t\t<span\n\t\t\t\t\tclass="bx-im-add-to-collab__selected-language-block_arrow"\n\t\t\t\t\t:class="{ '--open': isSelectorShown }"\n\t\t\t\t></span>\n\t\t\t</div>\n\t\t</section>\n\t`};const H="SidePanel.Slider:onClose";const R="main:helper";const U={name:"AddGuestsTab",components:{ChatButton:u.ChatButton,ScrollWithGradient:r.ScrollWithGradient,CopyInviteLink:D,InviteLanguageSelector:P},props:{dialogId:{type:String,required:true},height:{type:Number,default:0}},emits:["close","closeHelpdeskSlider","openHelpdeskSlider","closeLanguageSelector","openLanguageSelector"],data(){return{isAddButtonDisabled:true,isInvitingGuests:false,invitationLangCode:""}},computed:{ButtonSize:()=>u.ButtonSize,ButtonColor:()=>u.ButtonColor,isCurrentUserCollaber(){const t=this.$store.getters["users/get"](o.Core.getUserId(),true);return t.type===S.UserType.collaber},preparedDescription(){if(this.isCurrentUserCollaber){return this.loc("IM_ENTITY_SELECTOR_ADD_TO_COLLAB_DESCRIPTION_TEXT_GUEST")}return this.loc("IM_ENTITY_SELECTOR_ADD_TO_COLLAB_DESCRIPTION_TEXT_EMPLOYEE")},preparedDescriptionTitle(){if(this.isCurrentUserCollaber){return this.loc("IM_ENTITY_SELECTOR_ADD_TO_COLLAB_DESCRIPTION_TITLE_GUEST")}return this.loc("IM_ENTITY_SELECTOR_ADD_TO_COLLAB_DESCRIPTION_TITLE_EMPLOYEE")},chatId(){const t=this.$store.getters["chats/get"](this.dialogId,true);return t.chatId},collabId(){const t=this.$store.getters["chats/collabs/getByChatId"](this.chatId);return t.collabId},containerStyles(){return{height:`${this.height}px`}},isPhoneInviteAvailable(){return c.FeatureManager.isFeatureAvailable(c.Feature.inviteByPhoneAvailable)},preparedInvitationTitle(){if(this.isPhoneInviteAvailable){return this.loc("IM_ENTITY_SELECTOR_ADD_TO_COLLAB_INVITE_BY_PHONE_OR_EMAIL")}return this.loc("IM_ENTITY_SELECTOR_ADD_TO_COLLAB_INVITE_BY_EMAIL")},isCollaber(){const t=this.$store.getters["users/get"](o.Core.getUserId());return t.type===S.UserType.collaber},isEnabledCollabersInvitation(){return c.FeatureManager.isFeatureAvailable(c.Feature.enabledCollabersInvitation)},isChangeInviteLanguageAvailable(){return c.FeatureManager.isFeatureAvailable(c.Feature.changeInviteLanguageAvailable)},defaultLanguageCode(){return o.Core.getLanguageId()}},created(){this.initInvitationInput();v.EventEmitter.subscribe(H,this.onCloseOpenHelpdeskSlider)},mounted(){this.invitationLangCode=this.defaultLanguageCode;this.invitationGuests.renderTo(this.$refs["im-collab-invitation-guests-input"])},beforeUnmount(){this.invitationGuests.unsubscribe("readyState",this.onReadySaveInputHandler);this.invitationGuests.unsubscribe("onUnreadySave",this.onUnreadySaveInputHandler);v.EventEmitter.unsubscribe(H,this.onCloseOpenHelpdeskSlider)},methods:{openHelpdesk(){this.$emit("openHelpdeskSlider");const t="22706836";a.openHelpdeskArticle(t)},initInvitationInput(){this.invitationGuests=new s.InvitationInput;this.invitationGuests.subscribe("onReadySave",this.onReadySaveInputHandler);this.invitationGuests.subscribe("onUnreadySave",this.onUnreadySaveInputHandler)},onReadySaveInputHandler(){this.isAddButtonDisabled=false},onUnreadySaveInputHandler(){this.isAddButtonDisabled=true;this.isInvitingGuests=false},async addGuestToCollab(){this.isInvitingGuests=true;await this.invitationGuests.inviteToGroup(this.collabId);this.isInvitingGuests=false;this.$emit("close")},onInvitationGuests(){if(!this.isEnabledCollabersInvitation){this.showHelper()}},showHelper(){new l.FeaturePromoter({code:S.SliderCode.collabInviteOff}).show()},onCloseOpenHelpdeskSlider({data:t}){const[e]=t;const n=e.getSlider().getUrl().toString();if(n===R){this.$emit("closeHelpdeskSlider")}},onInviteLanguageSelected(t){this.invitationLangCode=t;this.invitationGuests.changeLanguage(t)},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="bx-im-add-to-collab__container" :style="containerStyles">\n\t\t\t<div class="bx-im-add-to-collab__invite-section">\n\t\t\t\t<ScrollWithGradient :gradientHeight="28" :withShadow="true">\n\t\t\t\t\t<div class="bx-im-add-to-collab__content">\n\t\t\t\t\t\t<div class="bx-im-add-to-collab__description">\n\t\t\t\t\t\t\t<div class="bx-im-add-to-collab__description_content">\n\t\t\t\t\t\t\t\t<div class="bx-im-add-to-collab__description_title">{{ preparedDescriptionTitle }}</div>\n\t\t\t\t\t\t\t\t<div class="bx-im-add-to-collab__description_text">{{ preparedDescription }}</div>\n\t\t\t\t\t\t\t\t<a class="bx-im-add-to-collab__helpdesk-link" @click.prevent="openHelpdesk">\n\t\t\t\t\t\t\t\t\t{{ loc('IM_ENTITY_SELECTOR_ADD_TO_COLLAB_HELPDESK_LINK') }}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="bx-im-add-to-collab__description_icon"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<InviteLanguageSelector\n\t\t\t\t\t\t\tv-if="isChangeInviteLanguageAvailable"\n\t\t\t\t\t\t\t:defaultLanguageCode="defaultLanguageCode"\n\t\t\t\t\t\t\t@selectLanguage="onInviteLanguageSelected"\n\t\t\t\t\t\t\t@openLanguageSelector="$emit('openLanguageSelector')"\n\t\t\t\t\t\t\t@closeLanguageSelector="$emit('closeLanguageSelector')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<CopyInviteLink \n\t\t\t\t\t\t\t:collabId="collabId"\n\t\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t\t:langCode="invitationLangCode"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="bx-im-add-to-collab__invite-block">\n\t\t\t\t\t\t\t<span class="bx-im-add-to-collab__invite-block-title --ellipsis">\n\t\t\t\t\t\t\t\t{{ preparedInvitationTitle }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tref="im-collab-invitation-guests-input" \n\t\t\t\t\t\t\t\tclass="bx-im-add-to-collab__invite-block-input"\n\t\t\t\t\t\t\t\t@click="onInvitationGuests"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</ScrollWithGradient>\n\t\t\t</div>\n\t\t\t<div class="bx-im-add-to-collab__buttons">\n\t\t\t\t<ChatButton\n\t\t\t\t\t:size="ButtonSize.L"\n\t\t\t\t\t:color="ButtonColor.Collab"\n\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t:text="loc('IM_ENTITY_SELECTOR_ADD_TO_CHAT_INVITE_BUTTON')"\n\t\t\t\t\t:isDisabled="isAddButtonDisabled || isInvitingGuests"\n\t\t\t\t\t:isLoading="isInvitingGuests"\n\t\t\t\t\t@click="addGuestToCollab"\n\t\t\t\t/>\n\t\t\t\t<ChatButton\n\t\t\t\t\t:size="ButtonSize.L"\n\t\t\t\t\t:color="ButtonColor.LightBorder"\n\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t:text="loc('IM_ENTITY_SELECTOR_ADD_TO_CHAT_CANCEL_BUTTON')"\n\t\t\t\t\t@click="$emit('close')"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const $={name:"AddEmployeesTab",components:{AddToChatContent:M},props:{dialogId:{type:String,required:true},height:{type:Number,required:true}},emits:["close"],methods:{inviteMembers({members:t}){(new w).addEmployees({dialogId:this.dialogId,members:t});this.$emit("close")}},template:`\n\t\t<div class="bx-im-add-to-collab__employees-tab-container">\n\t\t\t<AddToChatContent\n\t\t\t\t:dialogId="dialogId"\n\t\t\t\t:height="height"\n\t\t\t\t@inviteMembers="inviteMembers"\n\t\t\t\t@close="$emit('close')"\n\t\t\t/>\n\t\t</div>\n\t`};const F=Object.freeze({guests:"guests",employees:"employees"});const G=[{id:F.guests,title:m.Loc.getMessage("IM_ENTITY_SELECTOR_GUESTS_TAB")},{id:F.employees,title:m.Loc.getMessage("IM_ENTITY_SELECTOR_EMPLOYEES_TAB")}];const X="im-add-to-collab-popup";const Y=498;const q={name:"AddToCollab",components:{MessengerPopup:b.MessengerPopup,SegmentButton:u.SegmentButton,AddGuestsTab:U,AddEmployeesTab:$},props:{bindElement:{type:Object,required:true},dialogId:{type:String,required:true},popupConfig:{type:Object,required:true}},emits:["close"],data(){return{activeTabId:F.guests}},computed:{POPUP_ID:()=>X,Tabs:()=>G,config(){return{titleBar:this.$Bitrix.Loc.getMessage("IM_ENTITY_SELECTOR_ADD_TO_COLLAB_TITLE"),closeIcon:true,bindElement:this.bindElement,offsetTop:this.popupConfig.offsetTop,offsetLeft:this.popupConfig.offsetLeft,padding:0,contentPadding:0,contentBackground:"#fff",className:"bx-im-add-to-collab__scope"}},isEnabledCollabersInvitation(){return c.FeatureManager.isFeatureAvailable(c.Feature.enabledCollabersInvitation)},tabComponent(){return this.activeTabId===F.guests?U:$},isCollaber(){const t=this.$store.getters["users/get"](o.Core.getUserId());return t.type===S.UserType.collaber},isInviteLinkAvailable(){return c.FeatureManager.isFeatureAvailable(c.Feature.inviteByLinkAvailable)},finalHeight(){const t=58+12;const e=38;let n=Y;if(this.isCollaber){n-=e}if(!this.isInviteLinkAvailable){n-=t}return n}},created(){this.activeTabId=this.isEnabledCollabersInvitation?F.guests:F.employees},methods:{onTabSwitch(t){this.activeTabId=t}},template:`\n\t\t<MessengerPopup\n\t\t\t:config="config"\n\t\t\t:id="POPUP_ID"\n\t\t\tv-slot="{ enableAutoHide, disableAutoHide }"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<div class="bx-im-add-to-collab__tabs">\n\t\t\t\t<SegmentButton \n\t\t\t\t\t:tabs="Tabs" \n\t\t\t\t\t:activeTabId="activeTabId" \n\t\t\t\t\t@segmentSelected="onTabSwitch"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<KeepAlive>\n\t\t\t\t<component\n\t\t\t\t\t:is="tabComponent"\n\t\t\t\t\t:dialogId="dialogId" \n\t\t\t\t\t:height="finalHeight"\n\t\t\t\t\t@close="$emit('close')"\n\t\t\t\t\t@openHelpdeskSlider="disableAutoHide"\n\t\t\t\t\t@closeHelpdeskSlider="enableAutoHide"\n\t\t\t\t\t@openLanguageSelector="disableAutoHide"\n\t\t\t\t\t@closeLanguageSelector="enableAutoHide"\n\t\t\t\t/>\n\t\t\t</KeepAlive>\n\t\t</MessengerPopup>\n\t`};const z={name:"ForwardContent",components:{ForwardSearch:y.ForwardSearch,ChatSearchInput:y.ChatSearchInput},props:{messagesIds:{type:Array,required:true},dialogId:{type:String,required:true}},emits:["close"],data(){return{searchQuery:"",isLoading:false}},beforeUnmount(){E.Analytics.getInstance().messageForward.onClosePopup()},methods:{onLoading(t){this.isLoading=t},onUpdateSearch(t){E.Analytics.getInstance().messageForward.onStartSearch({dialogId:this.dialogId});this.searchQuery=t.trim().toLowerCase()},isNotes(t){return this.$store.getters["chats/isNotes"](t)},async forwardToNotes(t){await C.SendingService.getInstance().forwardMessages({forwardIds:this.messagesIds,dialogId:t});f.Notifier.message.onForwardNotesComplete(this.messagesIds);T.SoundNotificationManager.getInstance().playOnce(S.SoundType.send)},async onSelectItem(t){const{dialogId:e}=t;v.EventEmitter.emit(S.EventType.dialog.closeBulkActionsMode,{dialogId:this.dialogId});const n=this.isNotes(e);const i=this.isNotes(this.dialogId);if(n&&!i){void this.forwardToNotes(e)}else{await L.Messenger.openChat(e);v.EventEmitter.emit(S.EventType.textarea.insertForward,{messagesIds:this.messagesIds,dialogId:e})}this.$emit("close")}},template:`\n\t\t<div class="bx-im-entity-selector-forward__container">\n\t\t\t<div class="bx-im-entity-selector-forward__input">\n\t\t\t\t<ChatSearchInput \n\t\t\t\t\t:searchMode="true" \n\t\t\t\t\t:isLoading="isLoading" \n\t\t\t\t\t:withIcon="false" \n\t\t\t\t\t:delayForFocusOnStart="1"\n\t\t\t\t\t@updateSearch="onUpdateSearch"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="bx-im-entity-selector-forward__search-result-container">\n\t\t\t\t<ForwardSearch\n\t\t\t\t\t:query="searchQuery"\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t@clickItem="onSelectItem"\n\t\t\t\t\t@loading="onLoading"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const V="im-forward-popup";const K={name:"ForwardPopup",components:{MessengerPopup:b.MessengerPopup,ForwardContent:z},props:{messagesIds:{type:Array,required:true},dialogId:{type:String,required:true}},emits:["close"],computed:{POPUP_ID:()=>V,config(){return{titleBar:this.popupTitle,closeIcon:true,targetContainer:document.body,fixed:true,draggable:true,padding:0,autoHide:false,contentPadding:0,contentBackground:"#fff",overlay:true,className:"bx-im-entity-selector-forward__scope"}},popupTitle(){return this.messagesIds.length>1?this.loc("IM_ENTITY_SELECTOR_ADD_TO_CHAT_FORWARD_TITLE_SEVERAL_MESSAGES"):this.loc("IM_ENTITY_SELECTOR_ADD_TO_CHAT_FORWARD_TITLE")}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<MessengerPopup\n\t\t\t:id="POPUP_ID"\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<ForwardContent\n\t\t\t\t:dialogId="dialogId"\n\t\t\t\t:messagesIds="messagesIds" \n\t\t\t\t@close="$emit('close')"\n\t\t\t/>\n\t\t</MessengerPopup>\n\t`};t.AddToChat=x;t.AddToCollab=q;t.ForwardPopup=K})(this.BX.Messenger.v2.Component.EntitySelector=this.BX.Messenger.v2.Component.EntitySelector||{},BX.Messenger.v2.Service,BX.UI.EntitySelector,BX.Messenger.v2.Lib,BX.Intranet,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Elements,BX.UI,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Intranet,BX,BX.Vue3.Directives,BX.Main,BX.Messenger.v2.Component.Elements,BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Component,BX.Messenger.v2.Lib);
//# sourceMappingURL=registry.bundle.map.js