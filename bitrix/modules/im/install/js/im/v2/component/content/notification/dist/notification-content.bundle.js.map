{"version":3,"file":"notification-content.bundle.js","sources":["../src/components/item/notification-item-avatar.js","../src/components/notification-quick-answer.js","../src/components/item/notification-item-confirm-buttons.js","../src/components/item/notification-item-content.js","../src/components/item/notification-item-header.js","../src/components/notification-item.js","../src/components/notification-placeholder.js","../src/components/notification-search-panel.js","../src/components/notification-scroll-button.js","../src/classes/notification-search-service.js","../src/classes/notification-read-service.js","../src/notification-content.js"],"sourcesContent":["import { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport '../../css/notification-item-avatar.css';\n\nimport type { ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const NotificationItemAvatar = {\n\tname: 'NotificationItemAvatar',\n\tcomponents: { ChatAvatar },\n\tprops: {\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tisSystem(): boolean\n\t\t{\n\t\t\treturn this.userId === 0;\n\t\t},\n\t\tuserDialogId(): string\n\t\t{\n\t\t\treturn this.userId.toString();\n\t\t},\n\t\tuser(): ?ImModelUser\n\t\t{\n\t\t\t// For now, we don't have a user if it is an OL user.\n\t\t\treturn this.$store.getters['users/get'](this.userId);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-notification-item-avatar__container\">\n\t\t\t<div \n\t\t\t\tv-if=\"isSystem || !user\"\n\t\t\t\tclass=\"bx-im-content-notification-item-avatar__system-icon\"\n\t\t\t></div>\n\t\t\t<ChatAvatar \n\t\t\t\tv-else \n\t\t\t\t:avatarDialogId=\"userDialogId\" \n\t\t\t\t:contextDialogId=\"userDialogId\" \n\t\t\t\t:size=\"AvatarSize.L\" \n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { ChatButton, ButtonSize, ButtonColor } from 'im.v2.component.elements.button';\n\nimport '../css/notification-quick-answer.css';\n\n// @vue/component\nexport const NotificationQuickAnswer = {\n\tname: 'NotificationQuickAnswer',\n\tcomponents: { ChatButton },\n\tprops: {\n\t\tnotification: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['sendQuickAnswer'],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tquickAnswerText: '',\n\t\t\tquickAnswerResultMessage: '',\n\t\t\tshowQuickAnswer: false,\n\t\t\tisSending: false,\n\t\t\tsuccessSentQuickAnswer: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t},\n\tmethods:\n\t{\n\t\ttoggleQuickAnswer()\n\t\t{\n\t\t\tif (this.successSentQuickAnswer)\n\t\t\t{\n\t\t\t\tthis.showQuickAnswer = true;\n\t\t\t\tthis.successSentQuickAnswer = false;\n\t\t\t\tthis.quickAnswerResultMessage = '';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showQuickAnswer = !this.showQuickAnswer;\n\t\t\t}\n\n\t\t\tif (this.showQuickAnswer)\n\t\t\t{\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.$refs['textarea'].focus();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tsendQuickAnswer()\n\t\t{\n\t\t\tif (this.isSending || this.quickAnswerText.trim() === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isSending = true;\n\n\t\t\tthis.$emit('sendQuickAnswer', {\n\t\t\t\tid: this.notification.id,\n\t\t\t\ttext: this.quickAnswerText.trim(),\n\t\t\t\tcallbackSuccess: (response) => {\n\t\t\t\t\tconst {result_message: resultMessage} = response.data();\n\t\t\t\t\tconst [message] = resultMessage;\n\t\t\t\t\tthis.quickAnswerResultMessage = message;\n\t\t\t\t\tthis.successSentQuickAnswer = true;\n\t\t\t\t\tthis.quickAnswerText = '';\n\t\t\t\t\tthis.isSending = false;\n\t\t\t\t},\n\t\t\t\tcallbackError: () => {\n\t\t\t\t\tthis.isSending = false;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-notification-quick-answer__container\">\n\t\t\t<button \n\t\t\t\tv-if=\"!showQuickAnswer\"\n\t\t\t\tclass=\"bx-im-content-notification-quick-answer__reply-link\" \n\t\t\t\t@click=\"toggleQuickAnswer\" \n\t\t\t\t@dblclick.stop\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_QUICK_ANSWER_BUTTON') }}\n\t\t\t</button>\n\t\t\t<transition name=\"quick-answer-slide\">\n\t\t\t\t<div \n\t\t\t\t\tv-if=\"showQuickAnswer && !successSentQuickAnswer\" \n\t\t\t\t\tclass=\"bx-im-content-notification-quick-answer__textarea-container\"\n\t\t\t\t>\n\t\t\t\t\t<textarea\n\t\t\t\t\t\tref=\"textarea\"\n\t\t\t\t\t\tautofocus\n\t\t\t\t\t\tclass=\"bx-im-content-notification-quick-answer__textarea\"\n\t\t\t\t\t\tv-model=\"quickAnswerText\"\n\t\t\t\t\t\t:disabled=\"isSending\"\n\t\t\t\t\t\t@keydown.enter.prevent\n\t\t\t\t\t\t@keyup.enter.prevent=\"sendQuickAnswer\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-if=\"!successSentQuickAnswer\" \n\t\t\t\t\t\tclass=\"bx-im-content-notification-quick-answer__buttons-container\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChatButton\n\t\t\t\t\t\t\t:color=\"ButtonColor.Primary\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.M\"\n\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_QUICK_ANSWER_SEND')\"\n\t\t\t\t\t\t\t:isLoading=\"isSending\"\n\t\t\t\t\t\t\t@click=\"sendQuickAnswer\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ChatButton\n\t\t\t\t\t\t\t:color=\"ButtonColor.LightBorder\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.M\"\n\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_QUICK_ANSWER_CANCEL')\"\n\t\t\t\t\t\t\t:isDisabled=\"isSending\"\n\t\t\t\t\t\t\t@click=\"toggleQuickAnswer\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t\t<div v-if=\"successSentQuickAnswer\" class=\"bx-im-content-notification-quick-answer__result\">\n\t\t\t\t<div class=\"bx-im-content-notification-quick-answer__success-icon\"></div>\n\t\t\t\t<div class=\"bx-im-content-notification-quick-answer__success-text\">{{ quickAnswerResultMessage }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\n\nimport { ChatButton, ButtonSize, ButtonColor } from 'im.v2.component.elements.button';\n\nimport '../../css/notification-item-confirm-buttons.css';\n\n// @vue/component\nexport const NotificationItemConfirmButtons = {\n\tname: 'NotificationItemConfirmButtons',\n\tcomponents: { ChatButton },\n\tprops: {\n\t\tbuttons: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['confirmButtonsClick'],\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tpreparedButtons(): Array\n\t\t{\n\t\t\treturn this.buttons.map((button) => {\n\t\t\t\tconst [id, value] = button.COMMAND_PARAMS.split('|');\n\n\t\t\t\t// we need to decode it, because legacy chat does htmlspecialcharsbx on the server side\n\t\t\t\t// @see \\CIMMessenger::Add\n\t\t\t\tconst text = Text.decode(button.TEXT);\n\n\t\t\t\treturn { id, value, text };\n\t\t\t});\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tclick(button)\n\t\t{\n\t\t\tthis.$emit('confirmButtonsClick', button);\n\t\t},\n\t\tgetButtonColor(button): string\n\t\t{\n\t\t\treturn button.value === 'Y' ? ButtonColor.Primary : ButtonColor.LightBorder;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-notification-item-confirm-buttons__container\">\n\t\t\t<ChatButton\n\t\t\t\tv-for=\"(button, index) in preparedButtons\" :key=\"index\"\n\t\t\t\t:text=\"button.text\"\n\t\t\t\t:color=\"getButtonColor(button)\"\n\t\t\t\t:size=\"ButtonSize.M\"\n\t\t\t\t:isRounded=\"true\"\n\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t@click=\"click(button)\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Attach } from 'im.v2.component.elements.attach';\nimport { Parser } from 'im.v2.lib.parser';\nimport { NotificationQuickAnswer } from '../notification-quick-answer';\nimport { NotificationItemConfirmButtons } from './notification-item-confirm-buttons';\n\nimport '../../css/notification-item-content.css';\n\n// @vue/component\nexport const NotificationItemContent = {\n\tname: 'NotificationItemContent',\n\tcomponents: { NotificationQuickAnswer, Attach, NotificationItemConfirmButtons },\n\tprops: {\n\t\tnotification: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['confirmButtonsClick', 'sendQuickAnswer'],\n\tcomputed:\n\t{\n\t\tnotificationItem(): Object\n\t\t{\n\t\t\treturn this.notification;\n\t\t},\n\t\thasQuickAnswer(): boolean\n\t\t{\n\t\t\treturn Boolean(this.notification.params?.canAnswer === 'Y');\n\t\t},\n\t\tcontent(): string\n\t\t{\n\t\t\treturn Parser.decodeNotification(this.notification);\n\t\t},\n\t\tattachList(): ?Array\n\t\t{\n\t\t\treturn this.notification.params?.attach;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonContentClick(event)\n\t\t{\n\t\t\tParser.executeClickEvent(event);\n\t\t},\n\t\tonConfirmButtonsClick(event)\n\t\t{\n\t\t\tthis.$emit('confirmButtonsClick', event);\n\t\t},\n\t\tonSendQuickAnswer(event)\n\t\t{\n\t\t\tthis.$emit('sendQuickAnswer', event);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-notification-item-content__container\" @click=\"onContentClick\">\n\t\t\t<div \n\t\t\t\tv-if=\"content.length > 0\" \n\t\t\t\tclass=\"bx-im-content-notification-item-content__content-text\"\n\t\t\t\tv-html=\"content\"\n\t\t\t></div>\n\t\t\t<NotificationQuickAnswer \n\t\t\t\tv-if=\"hasQuickAnswer\" \n\t\t\t\t:notification=\"notificationItem\" \n\t\t\t\t@sendQuickAnswer=\"onSendQuickAnswer\"\n\t\t\t/>\n\t\t\t<template v-if=\"attachList\">\n\t\t\t\t<template v-for=\"attachItem in attachList\">\n\t\t\t\t\t<Attach :config=\"attachItem\"/>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t\t<NotificationItemConfirmButtons \n\t\t\t\tv-if=\"notificationItem.notifyButtons.length > 0\" \n\t\t\t\t@confirmButtonsClick=\"onConfirmButtonsClick\" \n\t\t\t\t:buttons=\"notificationItem.notifyButtons\"\n\t\t\t/>\n\t\t</div>\n\t`\n};","import { Messenger } from 'im.public';\nimport { NotificationTypesCodes, UserType } from 'im.v2.const';\nimport { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\n\nimport '../../css/notification-item-header.css';\n\nimport type { ImModelUser, ImModelNotification } from 'im.v2.model';\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const NotificationItemHeader = {\n\tname: 'NotificationItemHeader',\n\tcomponents: { ChatTitle },\n\tprops: {\n\t\tnotification: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tnotificationItem(): ImModelNotification\n\t\t{\n\t\t\treturn this.notification;\n\t\t},\n\t\tdate(): Date\n\t\t{\n\t\t\treturn this.notificationItem.date;\n\t\t},\n\t\ttype(): NotificationTypesCodes\n\t\t{\n\t\t\treturn this.notificationItem.sectionCode;\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.notificationItem.authorId, true);\n\t\t},\n\t\thasName(): boolean\n\t\t{\n\t\t\treturn this.notificationItem.authorId > 0 && this.user.name.length > 0;\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\tif (this.notificationItem.title.length > 0)\n\t\t\t{\n\t\t\t\treturn this.notificationItem.title;\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_ITEM_SYSTEM');\n\t\t},\n\t\tisSystem(): boolean\n\t\t{\n\t\t\treturn this.notification.authorId === 0;\n\t\t},\n\t\tuserDialogId(): string\n\t\t{\n\t\t\treturn this.notification.authorId.toString();\n\t\t},\n\t\ttitleClasses(): JsonObject\n\t\t{\n\t\t\treturn {\n\t\t\t\t'bx-im-content-notification-item-header__title-text': true,\n\t\t\t\t'bx-im-content-notification-item-header__title-user-text': !this.isSystem,\n\t\t\t\t'--extranet': this.user.type === UserType.extranet,\n\t\t\t\t'--short': !this.hasMoreUsers,\n\t\t\t};\n\t\t},\n\t\thasMoreUsers(): boolean\n\t\t{\n\t\t\tif (this.isSystem)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn Boolean(this.notificationItem.params?.users) && this.notificationItem.params.users.length > 0;\n\t\t},\n\t\tmoreUsers(): string\n\t\t{\n\t\t\tconst phrase = this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_MORE_USERS').split('#COUNT#');\n\n\t\t\treturn {\n\t\t\t\tstart: phrase[0],\n\t\t\t\tend: this.notificationItem.params.users.length + phrase[1],\n\t\t\t};\n\t\t},\n\t\tcanDelete(): boolean\n\t\t{\n\t\t\treturn this.type === NotificationTypesCodes.simple;\n\t\t},\n\t\titemDate(): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(this.date, DateTemplate.notification);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonUserTitleClick()\n\t\t{\n\t\t\tif (this.isSystem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tMessenger.openChat(this.userDialogId);\n\t\t},\n\t\tonMoreUsersClick(event)\n\t\t{\n\t\t\tif (event.users)\n\t\t\t{\n\t\t\t\tthis.$emit('moreUsersClick', {\n\t\t\t\t\tevent: event.event,\n\t\t\t\t\tusers: event.users,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonDeleteClick()\n\t\t{\n\t\t\tthis.$emit('deleteClick', this.notificationItem.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-notification-item-header__container\">\n\t\t\t<div class=\"bx-im-content-notification-item-header__title-container\">\n\t\t\t\t<ChatTitle\n\t\t\t\t\tv-if=\"hasName\"\n\t\t\t\t\t:dialogId=\"userDialogId\"\n\t\t\t\t\t:showItsYou=\"false\"\n\t\t\t\t\t:class=\"titleClasses\"\n\t\t\t\t\t@click.prevent=\"onUserTitleClick\"\n\t\t\t\t/>\n\t\t\t\t<span v-else @click.prevent=\"onUserTitleClick\" :class=\"titleClasses\">{{ title }}</span>\n\t\t\t\t<span v-if=\"hasMoreUsers\" class=\"bx-im-content-notification-item-header__more-users\">\n\t\t\t\t\t<span class=\"bx-im-content-notification-item-header__more-users-start\">{{ moreUsers.start }}</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"bx-im-content-notification-item-header__more-users-dropdown\"\n\t\t\t\t\t\t@click=\"onMoreUsersClick({users: notificationItem.params.users, event: $event})\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ moreUsers.end }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-content-notification-item-header__date-container\">\n\t\t\t\t<div class=\"bx-im-content-notification-item-header__date\">{{ itemDate }}</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"canDelete\"\n\t\t\t\t\tclass=\"bx-im-content-notification-item-header__delete-button\"\n\t\t\t\t\t@click=\"onDeleteClick()\"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import {NotificationTypesCodes} from 'im.v2.const';\nimport {NotificationItemAvatar} from './item/notification-item-avatar';\nimport {NotificationItemContent} from './item/notification-item-content';\nimport {NotificationItemHeader} from './item/notification-item-header';\nimport '../css/notification-item.css';\nimport type {ImModelNotification, ImModelUser} from 'im.v2.model';\n\n// @vue/component\nexport const NotificationItem = {\n\tcomponents: {NotificationItemAvatar, NotificationItemContent, NotificationItemHeader},\n\tprops: {\n\t\tnotification: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['dblclick', 'buttonsClick', 'confirmButtonsClick', 'deleteClick', 'sendQuickAnswer', 'moreUsersClick'],\n\tcomputed:\n\t{\n\t\tNotificationTypesCodes: () => NotificationTypesCodes,\n\t\tnotificationItem(): ImModelNotification\n\t\t{\n\t\t\treturn this.notification;\n\t\t},\n\t\ttype(): number\n\t\t{\n\t\t\treturn this.notification.sectionCode;\n\t\t},\n\t\tisUnread(): boolean\n\t\t{\n\t\t\treturn !this.notificationItem.read && !this.searchMode;\n\t\t},\n\t\tuserData(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.notificationItem.authorId, true);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonDoubleClick()\n\t\t{\n\t\t\tthis.$emit('dblclick', this.notificationItem.id);\n\t\t},\n\t\tonConfirmButtonsClick(event)\n\t\t{\n\t\t\tthis.$emit('confirmButtonsClick', event);\n\t\t},\n\t\tonMoreUsersClick(event)\n\t\t{\n\t\t\tthis.$emit('moreUsersClick', event);\n\t\t},\n\t\tonSendQuickAnswer(event)\n\t\t{\n\t\t\tthis.$emit('sendQuickAnswer', event);\n\t\t},\n\t\tonDeleteClick(event)\n\t\t{\n\t\t\tthis.$emit('deleteClick', event);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"bx-im-content-notification-item__container\"\n\t\t\t:class=\"{'--unread': isUnread}\"\n\t\t\t@dblclick=\"onDoubleClick\"\n\t\t>\n\t\t\t<NotificationItemAvatar :userId=\"notificationItem.authorId\" />\n\t\t\t<div class=\"bx-im-content-notification-item__content-container\">\n\t\t\t\t<NotificationItemHeader \n\t\t\t\t\t:notification=\"notificationItem\"\n\t\t\t\t\t@deleteClick=\"onDeleteClick\"\n\t\t\t\t\t@moreUsersClick=\"onMoreUsersClick\"\n\t\t\t\t/>\n\t\t\t\t<NotificationItemContent \n\t\t\t\t\t:notification=\"notificationItem\" \n\t\t\t\t\t@confirmButtonsClick=\"onConfirmButtonsClick\"\n\t\t\t\t\t@sendQuickAnswer=\"onSendQuickAnswer\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`\n};\n","import '../css/notification-placeholder.css';\n\nexport const NotificationPlaceholder = {\n\tname: 'NotificationPlaceholder',\n\tprops: {\n\t\titemsToShow: {\n\t\t\ttype: Number,\n\t\t\tdefault: 50\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-notification-placeholder__container\" v-for=\"index in itemsToShow\">\n\t\t\t<div class=\"bx-im-content-notification-placeholder__element\">\n\t\t\t\t<div class=\"bx-im-content-notification-placeholder__avatar-container\">\n\t\t\t\t\t<div class=\"bx-im-content-notification-placeholder__avatar\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-content-notification-placeholder__content-container\">\n\t\t\t\t\t<div class=\"bx-im-content-notification-placeholder__content-inner\">\n\t\t\t\t\t\t<div class=\"bx-im-content-notification-placeholder__content --top\"></div>\n\t\t\t\t\t\t<div class=\"bx-im-content-notification-placeholder__content --short\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-content-notification-placeholder__content --full\"></div>\n\t\t\t\t\t<div class=\"bx-im-content-notification-placeholder__content --middle\"></div>\n\t\t\t\t\t<div class=\"bx-im-content-notification-placeholder__content --bottom\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import 'ui.forms';\nimport { EventEmitter } from 'main.core.events';\n\nimport { EscEventAction } from 'im.v2.lib.esc-manager';\nimport { EventType } from 'im.v2.const';\n\nimport '../css/notification-search-panel.css';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const NotificationSearchPanel = {\n\tname: 'NotificationSearchPanel',\n\tprops: {\n\t\tschema: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['search', 'close'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tsearchQuery: '',\n\t\t\tsearchType: '',\n\t\t\tsearchDate: '',\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tfilterTypes(): JsonObject[]\n\t\t{\n\t\t\tconst originalSchema = { ...this.schema };\n\n\t\t\t// get rid of some subcategories\n\t\t\tconst modulesToRemove = [\n\t\t\t\t'timeman', 'mail', 'disk', 'bizproc', 'voximplant', 'sender', 'blog', 'vote', 'socialnetwork',\n\t\t\t\t'imopenlines', 'photogallery', 'intranet', 'forum',\n\t\t\t];\n\t\t\tmodulesToRemove.forEach((moduleId) => {\n\t\t\t\tif (originalSchema[moduleId])\n\t\t\t\t{\n\t\t\t\t\tdelete originalSchema[moduleId].LIST;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// rename some groups\n\t\t\tif (originalSchema.calendar)\n\t\t\t{\n\t\t\t\toriginalSchema.calendar.NAME = this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_CALENDAR');\n\t\t\t}\n\n\t\t\tif (originalSchema.sender)\n\t\t\t{\n\t\t\t\toriginalSchema.sender.NAME = this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_SENDER');\n\t\t\t}\n\n\t\t\tif (originalSchema.blog)\n\t\t\t{\n\t\t\t\toriginalSchema.blog.NAME = this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_BLOG');\n\t\t\t}\n\n\t\t\tif (originalSchema.socialnetwork)\n\t\t\t{\n\t\t\t\toriginalSchema.socialnetwork.NAME = this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_SOCIALNETWORK');\n\t\t\t}\n\n\t\t\tif (originalSchema.intranet)\n\t\t\t{\n\t\t\t\toriginalSchema.intranet.NAME = this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_INTRANET');\n\t\t\t}\n\n\t\t\t// we need only these modules in this order!\n\t\t\tconst modulesToShowInFilter = [\n\t\t\t\t'tasks', 'calendar', 'crm', 'timeman', 'mail', 'disk', 'bizproc', 'voximplant', 'sender',\n\t\t\t\t'blog', 'vote', 'socialnetwork', 'imopenlines', 'photogallery', 'intranet', 'forum',\n\t\t\t];\n\t\t\tconst notificationFilterTypes = [];\n\t\t\tmodulesToShowInFilter.forEach((moduleId) => {\n\t\t\t\tif (originalSchema[moduleId])\n\t\t\t\t{\n\t\t\t\t\tnotificationFilterTypes.push(originalSchema[moduleId]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn notificationFilterTypes;\n\t\t},\n\t\tisEmptyQuery(): boolean\n\t\t{\n\t\t\treturn this.searchQuery.trim() === '';\n\t\t},\n\t\thasFocus(): boolean\n\t\t{\n\t\t\treturn document.activeElement === this.$refs.searchInput;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tsearchQuery()\n\t\t{\n\t\t\tthis.search();\n\t\t},\n\t\tsearchType()\n\t\t{\n\t\t\tthis.search();\n\t\t},\n\t\tsearchDate()\n\t\t{\n\t\t\tthis.search();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tEventEmitter.subscribe(EventType.key.onBeforeEscape, this.onBeforeEscape);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.key.onBeforeEscape, this.onBeforeEscape);\n\t},\n\tmethods:\n\t{\n\t\tsearch()\n\t\t{\n\t\t\tthis.$emit('search', {\n\t\t\t\tsearchQuery: this.searchQuery,\n\t\t\t\tsearchType: this.searchType,\n\t\t\t\tsearchDate: this.searchDate,\n\t\t\t});\n\t\t},\n\t\tonDateFilterClick(event)\n\t\t{\n\t\t\tif (BX && BX.calendar && BX.calendar.get().popup)\n\t\t\t{\n\t\t\t\tBX.calendar.get().popup.close();\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-bx\n\t\t\tBX.calendar({\n\t\t\t\tnode: event.target,\n\t\t\t\tfield: event.target,\n\t\t\t\tbTime: false,\n\t\t\t\tcallback_after: () => {\n\t\t\t\t\tthis.searchDate = event.target.value;\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tonBeforeEscape(): $Values<typeof EscEventAction>\n\t\t{\n\t\t\tif (!this.hasFocus)\n\t\t\t{\n\t\t\t\treturn EscEventAction.ignored;\n\t\t\t}\n\n\t\t\tif (this.isEmptyQuery)\n\t\t\t{\n\t\t\t\tthis.$emit('close');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.searchQuery = '';\n\t\t\t}\n\n\t\t\treturn EscEventAction.handled;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-notifications-header-filter-box\">\n\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-sm ui-ctl-w25\">\n\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t<select class=\"ui-ctl-element\" v-model=\"searchType\">\n\t\t\t\t\t<option value=\"\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_PLACEHOLDER') }}\n\t\t\t\t\t</option>\n\t\t\t\t\t<template v-for=\"group in filterTypes\">\n\t\t\t\t\t\t<template v-if=\"group.LIST\">\n\t\t\t\t\t\t\t<optgroup :label=\"group.NAME\">\n\t\t\t\t\t\t\t\t<option v-for=\"option in group.LIST\" :value=\"option.ID\">\n\t\t\t\t\t\t\t\t\t{{ option.NAME }}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<option :value=\"group.MODULE_ID\">\n\t\t\t\t\t\t\t\t{{ group.NAME }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</template>\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-after-icon ui-ctl-sm ui-ctl-w50\">\n\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\" @click.prevent=\"searchQuery=''\"></button>\n\t\t\t\t<input\n\t\t\t\t\tautofocus\n\t\t\t\t\tref=\"searchInput\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\tv-model=\"searchQuery\"\n\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_TEXT_PLACEHOLDER')\"\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-before-icon ui-ctl-sm ui-ctl-w25\">\n\t\t\t\t<div class=\"ui-ctl-before ui-ctl-icon-calendar\"></div>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox\"\n\t\t\t\t\tv-model=\"searchDate\"\n\t\t\t\t\t@focus.prevent.stop=\"onDateFilterClick\"\n\t\t\t\t\t@click.prevent.stop=\"onDateFilterClick\"\n\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_DATE_PLACEHOLDER')\"\n\t\t\t\t\treadonly\n\t\t\t\t>\n\t\t\t\t<button class=\"ui-ctl-after ui-ctl-icon-clear\" @click.prevent=\"searchDate=''\"></button>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import {NotificationTypesCodes} from 'im.v2.const';\nimport {mapState} from 'ui.vue3.vuex';\n\nimport '../css/notification-scroll-button.css';\n\nexport const NotificationScrollButton = {\n\tname: 'NotificationScrollButton',\n\tprops: {\n\t\tunreadCounter: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tnotificationsOnScreen: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t},\n\temits: ['scrollButtonClick'],\n\tcomputed:\n\t{\n\t\tnotificationCollection(): Array\n\t\t{\n\t\t\treturn this.$store.getters['notifications/getSortedCollection'];\n\t\t},\n\t\thasUnreadOnScreen(): boolean\n\t\t{\n\t\t\treturn [...this.notificationsOnScreen].some(id => !this.notificationMapCollection.get(id)?.read);\n\t\t},\n\t\tfirstUnreadId(): ?number\n\t\t{\n\t\t\tconst item = this.notificationCollection.find(notification => !notification.read);\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn item.id;\n\t\t},\n\t\tfirstUnreadBelowVisible(): ?number\n\t\t{\n\t\t\tconst minIdOnScreen = Math.min(...this.notificationsOnScreen);\n\n\t\t\tconst item = this.notificationCollection.find(notification => {\n\t\t\t\treturn !notification.read\n\t\t\t\t\t&& notification.sectionCode === NotificationTypesCodes.simple\n\t\t\t\t\t&& minIdOnScreen > notification.id\n\t\t\t\t;\n\t\t\t});\n\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn item.id;\n\t\t},\n\t\thasUnreadBelowVisible(): boolean\n\t\t{\n\t\t\tlet unreadCounterBeforeVisible = 0;\n\n\t\t\tfor (let i = 0; i <= this.notificationCollection.length - 1; i++)\n\t\t\t{\n\t\t\t\tif (!this.notificationCollection[i].read)\n\t\t\t\t{\n\t\t\t\t\t++unreadCounterBeforeVisible;\n\t\t\t\t}\n\n\t\t\t\t// In this case we decide that there is no more unread notifications below visible notifications,\n\t\t\t\t// so we show arrow up on scroll button.\n\t\t\t\tif (\n\t\t\t\t\tthis.notificationsOnScreen.has(this.notificationCollection[i].id)\n\t\t\t\t\t&& this.unreadCounter === unreadCounterBeforeVisible\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tshowScrollButton()\n\t\t{\n\t\t\t// todo: check BXIM.settings.notifyAutoRead\n\t\t\tif (this.unreadCounter === 0 || this.hasUnreadOnScreen)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tarrowButtonClass()\n\t\t{\n\t\t\tconst arrowDown = this.hasUnreadBelowVisible;\n\n\t\t\treturn {\n\t\t\t\t'bx-im-notifications-scroll-button-arrow-down': arrowDown,\n\t\t\t\t'bx-im-notifications-scroll-button-arrow-up': !arrowDown,\n\t\t\t};\n\t\t},\n\t\tformattedCounter(): string\n\t\t{\n\t\t\tif (this.unreadCounter > 99)\n\t\t\t{\n\t\t\t\treturn '99+';\n\t\t\t}\n\n\t\t\treturn `${this.unreadCounter}`;\n\t\t},\n\t\t...mapState({\n\t\t\tnotificationMapCollection: state => state.notifications.collection,\n\t\t})\n\t},\n\tmethods:\n\t{\n\t\tonScrollButtonClick()\n\t\t{\n\t\t\tlet idToScroll = null;\n\t\t\tif (this.firstUnreadBelowVisible)\n\t\t\t{\n\t\t\t\tidToScroll = this.firstUnreadBelowVisible;\n\t\t\t}\n\t\t\telse if (!this.hasUnreadBelowVisible)\n\t\t\t{\n\t\t\t\tidToScroll = this.firstUnreadId;\n\t\t\t}\n\n\t\t\tlet firstUnreadNode = null;\n\t\t\tif (idToScroll !== null)\n\t\t\t{\n\t\t\t\tconst selector = `.bx-im-content-notification-item__container[data-id=\"${idToScroll}\"]`;\n\t\t\t\tfirstUnreadNode = document.querySelector(selector);\n\t\t\t}\n\n\t\t\tif (firstUnreadNode)\n\t\t\t{\n\t\t\t\tthis.$emit('scrollButtonClick', firstUnreadNode.offsetTop);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst latestNotification = this.notificationCollection[this.notificationCollection.length - 1];\n\t\t\t\tconst selector = `.bx-im-content-notification-item__container[data-id=\"${latestNotification.id}\"]`;\n\t\t\t\tconst latestNotificationNode = document.querySelector(selector);\n\n\t\t\t\tthis.$emit('scrollButtonClick', latestNotificationNode.offsetTop);\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<transition name=\"bx-im-notifications-scroll-button\">\n\t\t\t<div \n\t\t\t\tv-show=\"showScrollButton\" \n\t\t\t\tclass=\"bx-im-content-notification-scroll-button__container\" \n\t\t\t\t@click=\"onScrollButtonClick\"\n\t\t\t>\n\t\t\t\t<div class=\"bx-im-content-notification-scroll-button__button\">\n\t\t\t\t\t<div class=\"bx-im-notifications-scroll-button-counter\">\n\t\t\t\t\t\t{{ formattedCounter }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div :class=\"arrowButtonClass\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t`\n};","import { Type } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Logger } from 'im.v2.lib.logger';\nimport { RestMethod } from 'im.v2.const';\n\nconst LIMIT_PER_PAGE = 50;\n\nexport class NotificationSearchService\n{\n\tsearchQuery: string = '';\n\tsearchType: string = '';\n\tsearchDate: Date = null;\n\n\tstore: Object = null;\n\trestClient: Object = null;\n\tuserManager: Object = null;\n\tisLoading: boolean = false;\n\n\tlastId: number = 0;\n\thasMoreItemsToLoad: boolean = true;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tloadFirstPage({ searchQuery, searchType, searchDate }): Promise\n\t{\n\t\tthis.isLoading = true;\n\n\t\tthis.searchQuery = searchQuery;\n\t\tthis.searchType = searchType;\n\t\tthis.searchDate = searchDate;\n\n\t\treturn this.requestItems({ firstPage: true });\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tif (this.isLoading || !this.hasMoreItemsToLoad)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tthis.isLoading = true;\n\n\t\treturn this.requestItems();\n\t}\n\n\tsearchInModel({ searchQuery, searchType, searchDate }): Array\n\t{\n\t\tthis.searchQuery = searchQuery;\n\t\tthis.searchType = searchType;\n\t\tthis.searchDate = searchDate;\n\n\t\treturn this.store.getters['notifications/getSortedCollection'].filter((item) => {\n\t\t\tlet result = false;\n\t\t\tif (this.searchQuery.length >= 3)\n\t\t\t{\n\t\t\t\tresult = item.text.toLowerCase().includes(this.searchQuery.toLowerCase());\n\t\t\t\tif (!result)\n\t\t\t\t{\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.searchType !== '')\n\t\t\t{\n\t\t\t\tresult = item.settingName === this.searchType; // todo: ???\n\t\t\t\tif (!result)\n\t\t\t\t{\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.searchDate !== '')\n\t\t\t{\n\t\t\t\tconst date = BX.parseDate(this.searchDate);\n\t\t\t\tif (date instanceof Date)\n\t\t\t\t{\n\t\t\t\t\t// compare dates excluding time.\n\t\t\t\t\tconst itemDateForCompare = (new Date(item.date.getTime())).setHours(0, 0, 0, 0);\n\t\t\t\t\tconst dateFromInput = date.setHours(0, 0, 0, 0);\n\n\t\t\t\t\tresult = itemDateForCompare === dateFromInput;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t});\n\t}\n\n\trequestItems({ firstPage = false } = {}): Promise\n\t{\n\t\tconst queryParams = this.getSearchRequestParams(firstPage);\n\n\t\treturn this.restClient.callMethod(RestMethod.imNotifyHistorySearch, queryParams)\n\t\t\t.then((response) => {\n\t\t\t\tconst responseData = response.data();\n\t\t\t\tLogger.warn('im.notify.history.search: first page results', responseData);\n\t\t\t\tthis.hasMoreItemsToLoad = !this.isLastPage(responseData.notifications);\n\t\t\t\tif (!responseData || responseData.notifications.length === 0)\n\t\t\t\t{\n\t\t\t\t\tLogger.warn('im.notify.get: no notifications', responseData);\n\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\tthis.lastId = this.getLastItemId(responseData.notifications);\n\n\t\t\t\tthis.userManager.setUsersToModel(responseData.users);\n\t\t\t\tthis.isLoading = false;\n\n\t\t\t\treturn responseData.notifications;\n\t\t\t}).catch((result: RestResult) => {\n\t\t\t\tconsole.error('NotificationService: requestItems error', result.error());\n\t\t\t});\n\t}\n\n\tgetSearchRequestParams(firstPage: boolean): Object\n\t{\n\t\tconst requestParams = {\n\t\t\tSEARCH_TEXT: this.searchQuery,\n\t\t\tSEARCH_TYPE: this.searchType,\n\t\t\tLIMIT: LIMIT_PER_PAGE,\n\t\t\tCONVERT_TEXT: 'Y',\n\t\t};\n\n\t\tif (BX.parseDate(this.searchDate) instanceof Date)\n\t\t{\n\t\t\trequestParams.SEARCH_DATE = BX.parseDate(this.searchDate).toISOString();\n\t\t}\n\n\t\tif (!firstPage)\n\t\t{\n\t\t\trequestParams.LAST_ID = this.lastId;\n\t\t}\n\n\t\treturn requestParams;\n\t}\n\n\tgetLastItemId(collection: Array<Object>): number\n\t{\n\t\treturn collection[collection.length - 1].id;\n\t}\n\n\tisLastPage(notifications: Array): boolean\n\t{\n\t\treturn !Type.isArrayFilled(notifications) || notifications.length < LIMIT_PER_PAGE;\n\t}\n\n\tdestroy()\n\t{\n\t\tLogger.warn('Notification search service destroyed');\n\t}\n}\n","import { Runtime, Type } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\n\nexport class NotificationReadService\n{\n\tstore: Object;\n\trestClient: Object;\n\titemsToRead = new Set();\n\treadRequestWithDebounce: Function;\n\treadOnClientWithDebounce: Function;\n\tchangeReadStatusBlockTimeout = {};\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.readOnClientWithDebounce = Runtime.debounce(this.readOnClient, 50, this);\n\t\tthis.readRequestWithDebounce = Runtime.debounce(this.readRequest, 500, this);\n\t}\n\n\taddToReadQueue(notificationIds: number[]): void\n\t{\n\t\tif (!Type.isArrayFilled(notificationIds))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnotificationIds.forEach((id: number) => {\n\t\t\tif (!Type.isNumber(id))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst notification = this.store.getters['notifications/getById'](id);\n\t\t\tif (notification.read)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.itemsToRead.add(id);\n\t\t});\n\t}\n\n\tread(): void\n\t{\n\t\tthis.readOnClientWithDebounce();\n\t\tthis.readRequestWithDebounce();\n\t}\n\n\treadRequest(): void\n\t{\n\t\tif (this.itemsToRead.size === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst idToReadFrom = Math.min(...this.itemsToRead);\n\n\t\tthis.restClient.callMethod(RestMethod.imNotifyRead, { id: idToReadFrom })\n\t\t\t.then((response) => {\n\t\t\t\tLogger.warn(`I have read all the notifications from id ${idToReadFrom}`, response);\n\t\t\t})\n\t\t\t.catch((result: RestResult) => {\n\t\t\t\tconsole.error('NotificationReadService: readRequest error', result.error());\n\t\t\t});\n\n\t\tthis.itemsToRead.clear();\n\t}\n\n\treadOnClient()\n\t{\n\t\tthis.store.dispatch('notifications/read', { ids: [...this.itemsToRead], read: true });\n\t}\n\n\treadAll(): void\n\t{\n\t\tthis.store.dispatch('notifications/readAll');\n\n\t\tthis.restClient.callMethod(RestMethod.imNotifyRead, { id: 0 })\n\t\t\t.then((response) => {\n\t\t\t\tLogger.warn('I have read ALL the notifications', response);\n\t\t\t}).catch((result: RestResult) => {\n\t\t\t\tconsole.error('NotificationReadService: readAll error', result.error());\n\t\t\t});\n\t}\n\n\tchangeReadStatus(notificationId: number): void\n\t{\n\t\tconst notification = this.store.getters['notifications/getById'](notificationId);\n\t\tthis.store.dispatch('notifications/read', { ids: [notification.id], read: !notification.read });\n\n\t\tclearTimeout(this.changeReadStatusBlockTimeout[notification.id]);\n\t\tthis.changeReadStatusBlockTimeout[notification.id] = setTimeout(() => {\n\t\t\tthis.restClient.callMethod(RestMethod.imNotifyRead, {\n\t\t\t\tid: notification.id,\n\t\t\t\taction: notification.read ? 'N' : 'Y',\n\t\t\t\tonly_current: 'Y',\n\t\t\t}).then(() => {\n\t\t\t\tLogger.warn(`Notification ${notification.id} unread status set to ${!notification.read}`);\n\t\t\t}).catch((result: RestResult) => {\n\t\t\t\tconsole.error('NotificationReadService: changeReadStatus error', result.error());\n\t\t\t\t// revert?\n\t\t\t});\n\t\t}, 1500);\n\t}\n\n\tdestroy()\n\t{\n\t\tLogger.warn('Notification read service destroyed');\n\t}\n}\n","import 'main.polyfill.intersectionobserver';\nimport { Event, Runtime, Type } from 'main.core';\nimport { mapState } from 'ui.vue3.vuex';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { NotificationTypesCodes, Settings } from 'im.v2.const';\nimport { NotificationService } from 'im.v2.provider.service.notification';\nimport { UserListPopup } from 'im.v2.component.elements.user-list-popup';\nimport { Loader } from 'im.v2.component.elements.loader';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport { NotificationItem } from './components/notification-item';\nimport { NotificationPlaceholder } from './components/notification-placeholder';\nimport { NotificationSearchPanel } from './components/notification-search-panel';\nimport { NotificationScrollButton } from './components/notification-scroll-button';\nimport { NotificationSearchService } from './classes/notification-search-service';\nimport { NotificationReadService } from './classes/notification-read-service';\n\nimport './css/notification-content.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelNotification } from 'im.v2.model';\n\n// @vue/component\nexport const NotificationContent = {\n\tname: 'NotificationContent',\n\tcomponents:\n\t{\n\t\tNotificationItem,\n\t\tNotificationSearchPanel,\n\t\tNotificationPlaceholder,\n\t\tNotificationScrollButton,\n\t\tUserListPopup,\n\t\tLoader,\n\t},\n\tdirectives:\n\t{\n\t\t'notifications-item-observer':\n\t\t{\n\t\t\tmounted(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.observer.observe(element);\n\t\t\t},\n\t\t\tbeforeUnmount(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.observer.unobserve(element);\n\t\t\t},\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisInitialLoading: false,\n\t\t\tisNextPageLoading: false,\n\t\t\tnotificationsOnScreen: new Set(),\n\n\t\t\twindowFocused: false,\n\t\t\tshowSearchPanel: false,\n\t\t\tshowSearchResult: false,\n\n\t\t\tpopupBindElement: null,\n\t\t\tshowUserListPopup: false,\n\t\t\tuserListIds: null,\n\n\t\t\tschema: {},\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tNotificationTypesCodes: () => NotificationTypesCodes,\n\t\tnotificationCollection(): ImModelNotification[]\n\t\t{\n\t\t\treturn this.$store.getters['notifications/getSortedCollection'];\n\t\t},\n\t\tsearchResultCollection(): ImModelNotification[]\n\t\t{\n\t\t\treturn this.$store.getters['notifications/getSearchResultCollection'];\n\t\t},\n\t\tnotifications(): ImModelNotification[]\n\t\t{\n\t\t\tif (this.showSearchResult)\n\t\t\t{\n\t\t\t\treturn this.searchResultCollection;\n\t\t\t}\n\n\t\t\treturn this.notificationCollection;\n\t\t},\n\t\tisReadAllAvailable(): boolean\n\t\t{\n\t\t\tif (this.showSearchResult)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.unreadCounter > 0;\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.notifications.length === 0 && !this.isInitialLoading && !this.isNextPageLoading;\n\t\t},\n\t\temptyStateIcon(): string\n\t\t{\n\t\t\treturn this.showSearchResult\n\t\t\t\t? 'bx-im-content-notification__not-found-icon'\n\t\t\t\t: 'bx-im-content-notification__empty-state-icon'\n\t\t\t;\n\t\t},\n\t\temptyStateTitle(): string\n\t\t{\n\t\t\treturn this.showSearchResult\n\t\t\t\t? this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_RESULTS_NOT_FOUND')\n\t\t\t\t: this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_NO_ITEMS')\n\t\t\t;\n\t\t},\n\t\tenableAutoRead(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.notification.enableAutoRead);\n\t\t},\n\t\t...mapState({\n\t\t\tunreadCounter: (state) => state.notifications.unreadCounter,\n\t\t}),\n\t},\n\twatch:\n\t{\n\t\tshowSearchPanel(newValue: boolean, oldValue: boolean)\n\t\t{\n\t\t\tif (newValue === false && oldValue === true)\n\t\t\t{\n\t\t\t\tthis.showSearchResult = false;\n\t\t\t\tthis.$store.dispatch('notifications/clearSearchResult');\n\t\t\t}\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.notificationService = new NotificationService();\n\t\tthis.notificationSearchService = new NotificationSearchService();\n\t\tthis.notificationReadService = new NotificationReadService();\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 1500, this);\n\n\t\tEvent.bind(window, 'focus', this.onWindowFocus);\n\t\tEvent.bind(window, 'blur', this.onWindowBlur);\n\n\t\tthis.initObserver();\n\t},\n\tasync mounted()\n\t{\n\t\tthis.isInitialLoading = true;\n\t\tthis.windowFocused = document.hasFocus();\n\n\t\tthis.schema = await this.notificationService.loadFirstPage();\n\t\tthis.isInitialLoading = false;\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.notificationService.destroy();\n\t\tthis.notificationSearchService.destroy();\n\t\tthis.notificationReadService.destroy();\n\t\tEvent.unbind(window, 'focus', this.onWindowFocus);\n\t\tEvent.unbind(window, 'blur', this.onWindowBlur);\n\t},\n\tmethods:\n\t{\n\t\tinitObserver()\n\t\t{\n\t\t\tthis.observer = new IntersectionObserver((entries) => {\n\t\t\t\tentries.forEach((entry) => {\n\t\t\t\t\tconst notificationId = Number.parseInt(entry.target.dataset.id, 10);\n\t\t\t\t\tif (!entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notificationsOnScreen.delete(notificationId);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tentry.intersectionRatio >= 0.7\n\t\t\t\t\t\t|| (entry.intersectionRatio > 0 && entry.intersectionRect.height > entry.rootBounds.height / 2)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.read(notificationId);\n\t\t\t\t\t\tthis.notificationsOnScreen.add(notificationId);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.notificationsOnScreen.delete(notificationId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, {\n\t\t\t\troot: this.$refs.listNotifications,\n\t\t\t\tthreshold: Array.from({ length: 101 }).fill(0).map((zero, index) => index * 0.01),\n\t\t\t});\n\t\t},\n\t\tread(notificationIds: number | number[])\n\t\t{\n\t\t\tif (!this.enableAutoRead)\n\t\t\t{\n\t\t\t\tLogger.warn('Notifications: Auto read is disabled!');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (Type.isNumber(notificationIds))\n\t\t\t{\n\t\t\t\tnotificationIds = [notificationIds];\n\t\t\t}\n\n\t\t\tthis.notificationReadService.addToReadQueue(notificationIds);\n\t\t\tthis.notificationReadService.read();\n\t\t},\n\t\tasync searchOnServer(event)\n\t\t{\n\t\t\tconst result = await this.notificationSearchService.loadFirstPage(event);\n\t\t\tthis.isNextPageLoading = false;\n\t\t\tthis.setSearchResult(result);\n\t\t},\n\t\tsetSearchResult(items: Array)\n\t\t{\n\t\t\tthis.$store.dispatch('notifications/setSearchResult', {\n\t\t\t\tnotifications: items,\n\t\t\t});\n\t\t},\n\t\tonScrollButtonClick(offset)\n\t\t{\n\t\t\tthis.$refs.listNotifications.scroll({\n\t\t\t\ttop: offset,\n\t\t\t\tbehavior: 'smooth',\n\t\t\t});\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tthis.showUserListPopup = false;\n\n\t\t\tif (this.showSearchResult)\n\t\t\t{\n\t\t\t\tthis.onScrollSearchResult(event);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.onScrollNotifications(event);\n\t\t\t}\n\t\t},\n\t\tonClickReadAll()\n\t\t{\n\t\t\tconst messageBox = new MessageBox({\n\t\t\t\tmessage: this.$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP'),\n\t\t\t\tbuttons: MessageBoxButtons.YES_CANCEL,\n\t\t\t\tonYes: () => {\n\t\t\t\t\tthis.notificationReadService.readAll();\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t},\n\t\t\t});\n\t\t\tmessageBox.show();\n\t\t},\n\t\tonScrollNotifications(event)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Utils.dom.isOneScreenRemaining(event.target)\n\t\t\t\t|| !this.notificationService.hasMoreItemsToLoad\n\t\t\t\t|| this.isInitialLoading\n\t\t\t\t|| this.isNextPageLoading\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isNextPageLoading = true;\n\t\t\tthis.notificationService.loadNextPage().then(() => {\n\t\t\t\tthis.isNextPageLoading = false;\n\t\t\t});\n\t\t},\n\t\tasync onScrollSearchResult(event)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Utils.dom.isOneScreenRemaining(event.target)\n\t\t\t\t|| !this.notificationSearchService.hasMoreItemsToLoad\n\t\t\t\t|| this.isInitialLoading\n\t\t\t\t|| this.isNextPageLoading\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isNextPageLoading = true;\n\t\t\tconst result = await this.notificationSearchService.loadNextPage();\n\t\t\tthis.isNextPageLoading = false;\n\t\t\tthis.setSearchResult(result);\n\t\t},\n\t\tonDoubleClick(notificationId: number)\n\t\t{\n\t\t\tthis.notificationReadService.changeReadStatus(notificationId);\n\t\t},\n\t\tonConfirmButtonsClick(button: { id: string, value: string})\n\t\t{\n\t\t\tconst { id, value } = button;\n\t\t\tconst notificationId = Number.parseInt(id, 10);\n\n\t\t\tthis.notificationsOnScreen.delete(notificationId);\n\t\t\tthis.notificationService.sendConfirmAction(notificationId, value);\n\t\t},\n\t\tonDeleteClick(notificationId: number)\n\t\t{\n\t\t\tthis.notificationsOnScreen.delete(notificationId);\n\t\t\tthis.notificationService.delete(notificationId);\n\t\t},\n\t\tonMoreUsersClick(event)\n\t\t{\n\t\t\tLogger.warn('onMoreUsersClick', event);\n\t\t\tthis.popupBindElement = event.event.target;\n\t\t\tthis.userListIds = event.users;\n\t\t\tthis.showUserListPopup = true;\n\t\t},\n\t\tonSearch(event)\n\t\t{\n\t\t\tif (event.searchQuery.length < 3 && event.searchType === '' && event.searchDate === '')\n\t\t\t{\n\t\t\t\tthis.showSearchResult = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showSearchResult = true;\n\t\t\tconst localResult = this.notificationSearchService.searchInModel(event);\n\t\t\tthis.$store.dispatch('notifications/clearSearchResult');\n\t\t\tthis.$store.dispatch('notifications/setSearchResult', { notifications: localResult, skipValidation: true });\n\n\t\t\tthis.isNextPageLoading = true;\n\t\t\tthis.searchOnServerDelayed(event);\n\t\t},\n\t\tonSendQuickAnswer(event)\n\t\t{\n\t\t\tthis.notificationService.sendQuickAnswer(event);\n\t\t},\n\t\tonWindowFocus()\n\t\t{\n\t\t\tthis.windowFocused = true;\n\t\t\tthis.read([...this.notificationsOnScreen]);\n\t\t},\n\t\tonWindowBlur()\n\t\t{\n\t\t\tthis.windowFocused = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-notification__container\">\n\t\t\t<div class=\"bx-im-content-notification__header-container\">\n\t\t\t\t<div class=\"bx-im-content-notification__header\">\n\t\t\t\t\t<div class=\"bx-im-content-notification__header-panel-container\">\n\t\t\t\t\t\t<div class=\"bx-im-content-notification__panel-title_icon\"></div>\n\t\t\t\t\t\t<div class=\"bx-im-content-notification__panel_text\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_NOTIFICATIONS_HEADER') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"notificationCollection.length > 0\" class=\"bx-im-content-notification__header-buttons-container\">\n\t\t\t\t\t\t<transition name=\"notifications-read-all-fade\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if=\"isReadAllAvailable\"\n\t\t\t\t\t\t\t\tclass=\"bx-im-content-notification__header_button bx-im-content-notification__header_read-all-button\"\n\t\t\t\t\t\t\t\t@click=\"onClickReadAll\"\n\t\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_READ_ALL_BUTTON')\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</transition>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"bx-im-content-notification__header_button bx-im-content-notification__header_filter-button\"\n\t\t\t\t\t\t\t:class=\"[showSearchPanel ? '--active' : '']\"\n\t\t\t\t\t\t\t@click=\"showSearchPanel = !showSearchPanel\"\n\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_NOTIFICATIONS_SEARCH_FILTER_OPEN_BUTTON')\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<NotificationSearchPanel \n\t\t\t\t\tv-if=\"showSearchPanel\" \n\t\t\t\t\t:schema=\"schema\" \n\t\t\t\t\t@search=\"onSearch\" \n\t\t\t\t\t@close=\"showSearchPanel = false\" \n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-content-notification__elements-container\">\n\t\t\t\t<div class=\"bx-im-content-notification__elements\" @scroll.passive=\"onScroll\" ref=\"listNotifications\">\n\t\t\t\t\t<NotificationItem\n\t\t\t\t\t\tv-for=\"notification in notifications\"\n\t\t\t\t\t\t:key=\"notification.id\"\n\t\t\t\t\t\t:data-id=\"notification.id\"\n\t\t\t\t\t\t:notification=\"notification\"\n\t\t\t\t\t\t@dblclick=\"onDoubleClick\"\n\t\t\t\t\t\t@confirmButtonsClick=\"onConfirmButtonsClick\"\n\t\t\t\t\t\t@deleteClick=\"onDeleteClick\"\n\t\t\t\t\t\t@moreUsersClick=\"onMoreUsersClick\"\n\t\t\t\t\t\t@sendQuickAnswer=\"onSendQuickAnswer\"\n\t\t\t\t\t\tv-notifications-item-observer\n\t\t\t\t\t/>\n\t\t\t\t\t<div v-if=\"isEmptyState\" class=\"bx-im-content-notification__empty-state-container\">\n\t\t\t\t\t\t<div :class=\"emptyStateIcon\"></div>\n\t\t\t\t\t\t<span class=\"bx-im-content-notification__empty-state-title\">\n\t\t\t\t\t\t\t{{ emptyStateTitle }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<NotificationPlaceholder v-if=\"isInitialLoading\" />\n\t\t\t\t\t<div v-if=\"isNextPageLoading\" class=\"bx-im-content-notification__loader-container\">\n\t\t\t\t\t\t<Loader />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<NotificationScrollButton\n\t\t\t\t\tv-if=\"!isInitialLoading || !isNextPageLoading\"\n\t\t\t\t\t:unreadCounter=\"unreadCounter\"\n\t\t\t\t\t:notificationsOnScreen=\"notificationsOnScreen\"\n\t\t\t\t\t@scrollButtonClick=\"onScrollButtonClick\"\n\t\t\t\t/>\n\t\t\t\t<UserListPopup\n\t\t\t\t\tv-if=\"showUserListPopup\"\n\t\t\t\t\t:userIds=\"userListIds\"\n\t\t\t\t\t:bindElement=\"popupBindElement\"\n\t\t\t\t\t:showPopup=\"showUserListPopup\"\n\t\t\t\t\t@close=\"showUserListPopup = false\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["NotificationItemAvatar","name","components","ChatAvatar","props","userId","type","Number","required","computed","AvatarSize","isSystem","userDialogId","toString","user","$store","getters","template","NotificationQuickAnswer","ChatButton","notification","Object","emits","data","quickAnswerText","quickAnswerResultMessage","showQuickAnswer","isSending","successSentQuickAnswer","ButtonSize","ButtonColor","methods","toggleQuickAnswer","$nextTick","$refs","focus","sendQuickAnswer","trim","$emit","id","text","callbackSuccess","response","result_message","resultMessage","message","callbackError","NotificationItemConfirmButtons","buttons","Array","preparedButtons","map","button","value","COMMAND_PARAMS","split","Text","decode","TEXT","click","getButtonColor","Primary","LightBorder","NotificationItemContent","Attach","notificationItem","hasQuickAnswer","Boolean","params","canAnswer","content","Parser","decodeNotification","attachList","attach","onContentClick","event","executeClickEvent","onConfirmButtonsClick","onSendQuickAnswer","NotificationItemHeader","ChatTitle","date","sectionCode","authorId","hasName","length","title","$Bitrix","Loc","getMessage","titleClasses","UserType","extranet","hasMoreUsers","users","moreUsers","phrase","start","end","canDelete","NotificationTypesCodes","simple","itemDate","DateFormatter","formatByTemplate","DateTemplate","onUserTitleClick","Messenger","openChat","onMoreUsersClick","onDeleteClick","NotificationItem","searchMode","default","isUnread","read","userData","onDoubleClick","NotificationPlaceholder","itemsToShow","NotificationSearchPanel","schema","searchQuery","searchType","searchDate","filterTypes","originalSchema","modulesToRemove","forEach","moduleId","LIST","calendar","NAME","sender","blog","socialnetwork","intranet","modulesToShowInFilter","notificationFilterTypes","push","isEmptyQuery","hasFocus","document","activeElement","searchInput","watch","search","created","EventEmitter","subscribe","EventType","key","onBeforeEscape","beforeUnmount","unsubscribe","onDateFilterClick","BX","get","popup","close","node","target","field","bTime","callback_after","EscEventAction","ignored","handled","NotificationScrollButton","unreadCounter","notificationsOnScreen","notificationCollection","hasUnreadOnScreen","some","notificationMapCollection","firstUnreadId","item","find","firstUnreadBelowVisible","minIdOnScreen","Math","min","hasUnreadBelowVisible","unreadCounterBeforeVisible","i","has","showScrollButton","arrowButtonClass","arrowDown","formattedCounter","mapState","state","notifications","collection","onScrollButtonClick","idToScroll","firstUnreadNode","selector","querySelector","offsetTop","latestNotification","latestNotificationNode","LIMIT_PER_PAGE","NotificationSearchService","constructor","store","restClient","userManager","isLoading","lastId","hasMoreItemsToLoad","Core","getStore","getRestClient","UserManager","loadFirstPage","requestItems","firstPage","loadNextPage","Promise","resolve","searchInModel","filter","result","toLowerCase","includes","settingName","parseDate","Date","itemDateForCompare","getTime","setHours","dateFromInput","queryParams","getSearchRequestParams","callMethod","RestMethod","imNotifyHistorySearch","then","responseData","Logger","warn","isLastPage","getLastItemId","setUsersToModel","catch","console","error","requestParams","SEARCH_TEXT","SEARCH_TYPE","LIMIT","CONVERT_TEXT","SEARCH_DATE","toISOString","LAST_ID","Type","isArrayFilled","destroy","NotificationReadService","itemsToRead","Set","changeReadStatusBlockTimeout","readOnClientWithDebounce","Runtime","debounce","readOnClient","readRequestWithDebounce","readRequest","addToReadQueue","notificationIds","isNumber","add","size","idToReadFrom","imNotifyRead","clear","dispatch","ids","readAll","changeReadStatus","notificationId","clearTimeout","setTimeout","action","only_current","NotificationContent","UserListPopup","Loader","directives","mounted","element","binding","instance","observer","observe","unobserve","isInitialLoading","isNextPageLoading","windowFocused","showSearchPanel","showSearchResult","popupBindElement","showUserListPopup","userListIds","searchResultCollection","isReadAllAvailable","isEmptyState","emptyStateIcon","emptyStateTitle","enableAutoRead","Settings","newValue","oldValue","notificationService","NotificationService","notificationSearchService","notificationReadService","searchOnServerDelayed","searchOnServer","Event","bind","window","onWindowFocus","onWindowBlur","initObserver","unbind","IntersectionObserver","entries","entry","parseInt","dataset","isIntersecting","delete","intersectionRatio","intersectionRect","height","rootBounds","root","listNotifications","threshold","from","fill","zero","index","setSearchResult","items","offset","scroll","top","behavior","onScroll","onScrollSearchResult","onScrollNotifications","onClickReadAll","messageBox","MessageBox","MessageBoxButtons","YES_CANCEL","onYes","onCancel","show","Utils","dom","isOneScreenRemaining","sendConfirmAction","onSearch","localResult","skipValidation"],"mappings":"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"}