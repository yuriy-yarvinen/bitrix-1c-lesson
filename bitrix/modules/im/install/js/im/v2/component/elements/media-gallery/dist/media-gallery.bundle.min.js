this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,i,r,n,a,l){"use strict";const s=590;const o={name:"MediaGalleryItem",directives:{lazyload:r.lazyload},components:{ProgressBar:l.ProgressBar},props:{file:{type:Object,required:true},size:{type:Object,required:true},isGallery:{type:Boolean,default:true},handleLoading:{type:Boolean,default:false},allowRemove:{type:Boolean,default:false},allowSorting:{type:Boolean,default:false},viewerGroupBy:{type:String||null,default:null},highlightDropzonePosition:{type:String||null,default:null}},emits:["remove","cancelClick","itemDragStart","itemDragEnd","itemDragOver","itemDragLeave","itemDrop"],data(){return{isDraggable:false,dragEvents:{}}},computed:{viewerAttributes(){if(this.file.viewerAttrs){return a.Utils.file.getViewerDataAttributes({viewerAttributes:this.file.viewerAttrs,previewImageSrc:this.file.urlPreview,context:n.FileViewerContext.dialog})}return a.Utils.file.getViewerDataAttributes({viewerAttributes:{viewer:true,viewerResized:true,viewerType:this.file.type,title:this.file.name,src:this.file.urlDownload,viewerGroupBy:this.viewerGroupBy},previewImageSrc:this.file.urlPreview,context:n.FileViewerContext.dialog})},canBeOpenedWithViewer(){var t;return this.file.viewerAttrs&&((t=BX.UI)==null?void 0:t.Viewer)},imageTitle(){const t=a.Utils.file.formatFileSize(this.file.size);return this.loc("IM_ELEMENTS_MEDIA_IMAGE_TITLE",{"#NAME#":this.file.name,"#SIZE#":t})},isLoaded(){return this.file.progress===100},isVideo(){return this.file.type===n.FileType.video},showPlayIcon(){return[n.FileStatus.wait,n.FileStatus.done].includes(this.file.status)},previewSourceLink(){if(this.file.extension==="gif"){return this.file.urlShow||this.file.urlDownload}return this.file.urlPreview||this.file.urlShow||this.file.urlDownload},allowLazyLoad(){return!this.previewSourceLink.startsWith("blob:")},withoutPreview(){return!e.Type.isStringFilled(this.previewSourceLink)},containerStyle(){return{width:`${this.size.width}px`,height:`${Math.min(this.size.height,s)}px`}},hasImageGap(){const t=Math.min(this.size.width/this.file.image.width,this.size.height/this.file.image.height);const e=this.file.image.width*t;const i=this.file.image.height*t;return Math.floor(this.size.width)>Math.floor(e)||Math.floor(this.size.height)>Math.floor(i)},useBlur(){return this.hasImageGap},blurStyle(){return{backgroundImage:`url("${this.previewSourceLink}")`}},draggableClasses(){const t={};if(this.highlightDropzonePosition){t[`--dropzone-${this.highlightDropzonePosition}`]=true}t["--draggable"]=this.isDraggable;return t},progressbarSize(){if(this.size.width>100&&this.size.height>90){return l.ProgressBarSize.L}return l.ProgressBarSize.S}},methods:{download(){var t;if(this.file.progress!==100||this.canBeOpenedWithViewer){return}const e=(t=this.file.urlDownload)!=null?t:this.file.urlShow;window.open(e,"_blank")},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onRemoveClick(t){t.stopPropagation();this.$emit("remove",{file:this.file})},onCancelClick(t){this.$emit("cancelClick",t)},onDragStart(t){this.$emit("itemDragStart",{file:this.file,event:t});this.isDraggable=true},onDragEnd(t){this.$emit("itemDragEnd",{file:this.file,event:t});t.target.removeAttribute("draggable");this.isDraggable=false},onDragOver(t){this.$emit("itemDragOver",{file:this.file,event:t})},onDragLeave(t){this.$emit("itemDragLeave",{file:this.file,event:t})},onDrop(t){this.$emit("itemDrop",{file:this.file,event:t});this.isDraggable=false},onMouseDown(t){this.$refs.dragElement.setAttribute("draggable","true")},getHandleStatus(){if(this.isVideo){return[n.FileStatus.preparing,n.FileStatus.progress,n.FileStatus.upload]}return[n.FileStatus.progress,n.FileStatus.upload]},getStatusMap(){if(this.isVideo){return{[n.FileStatus.preparing]:{iconClass:i.Outline.CLOUD}}}return{}}},template:`\n\t\t<div\n\t\t\tclass="bx-im-elements-media-gallery__item"\n\t\t\t:class="{'--without-preview': withoutPreview, ...this.draggableClasses}"\n\t\t\t@click="download"\n\t\t\t:style="containerStyle"\n\t\t\t@dragstart="onDragStart"\n\t\t\t@dragend="onDragEnd"\n\t\t\t@dragover="onDragOver"\n\t\t\t@dragleave="onDragLeave"\n\t\t\t@drop="onDrop"\n\t\t\tref="dragElement"\n\t\t\tdraggable="false"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="bx-im-elements-media-gallery__item-drag"\n\t\t\t\tv-if="allowSorting"\n\t\t\t\t@mousedown="onMouseDown"\n\t\t\t>\n\t\t\t\t<div class="bx-im-elements-media-gallery__item-drag-icon"></div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="bx-im-elements-media-gallery__item-inner"\n\t\t\t>\n\t\t\t\t<img\n\t\t\t\t\tv-if="allowLazyLoad"\n\t\t\t\t\tv-lazyload\n\t\t\t\t\tdata-lazyload-dont-hide\n\t\t\t\t\t:data-lazyload-src="previewSourceLink"\n\t\t\t\t\t:title="imageTitle"\n\t\t\t\t\t:alt="file.name"\n\t\t\t\t\tclass="bx-im-elements-media-gallery__item-source"\n\t\t\t\t\tdraggable="false"\n\t\t\t\t/>\n\t\t\t\t<img\n\t\t\t\t\tv-else\n\t\t\t\t\t:src="previewSourceLink"\n\t\t\t\t\t:title="imageTitle"\n\t\t\t\t\t:alt="file.name"\n\t\t\t\t\tclass="bx-im-elements-media-gallery__item-source"\n\t\t\t\t\tdraggable="false"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="useBlur"\n\t\t\t\t\tclass="bx-im-elements-media-gallery__item-blur"\n\t\t\t\t\t:style="blurStyle"\n\t\t\t\t></div>\n\t\t\t\t<div v-if="isVideo && showPlayIcon" class="bx-im-elements-media-gallery__item-play">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="bx-im-elements-media-gallery__item-play-icon"\n\t\t\t\t\t\tv-bind="viewerAttributes"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="allowRemove" class="bx-im-elements-media-gallery__item-remove" @click.stop="onRemoveClick">\n\t\t\t\t<div class="bx-im-elements-media-gallery__item-remove-icon"></div>\n\t\t\t</div>\n\t\t\t<ProgressBar\n\t\t\t\tv-if="handleLoading && !isLoaded"\n\t\t\t\t:item="file"\n\t\t\t\t:size="progressbarSize"\n\t\t\t\t:handleStatus="getHandleStatus()"\n\t\t\t\t:statusMap="getStatusMap()"\n\t\t\t\t@cancelClick="onCancelClick"\n\t\t\t/>\n\t\t\t<div \n\t\t\t\tclass="bx-im-elements-media-gallery__item-viewer-clickable-overlay"\n\t\t\t\tv-bind="viewerAttributes"\n\t\t\t></div>\n\t\t</div>\n\n\t`};const m=4;const g=3;const h=70;const d=58;const u=1600;const v=900;const c={width:u,height:v};const p={name:"MediaGalleryRow",components:{MediaGalleryItem:o},props:{files:{type:Array,required:true},allowRemoveItem:{type:Boolean,default:false},allowSorting:{type:Boolean,default:false},handleLoading:{type:Boolean,default:false},width:{type:Number,required:true},spacingSize:{type:Number,default:1},viewerGroupBy:{type:String||null,default:null},highlightDropzone:{type:Object,default:()=>({})}},emits:["remove","cancelClick","itemDragStart","itemDragEnd","itemDragOver","itemDragLeave","itemDrop"],computed:{totalRatio(){return this.files.reduce(((t,e)=>{const i=this.getSafeSize(e);return t+this.getSafeRatio(i)}),0)},spacing(){return this.files.length-1},availableContainerWidth(){return this.width-this.spacing*this.spacingSize},sizes(){const t=this.availableContainerWidth/this.totalRatio;return this.files.map((e=>{const i=this.getSafeSize(e);const r=this.getSafeRatio(i)*t;return{width:Math.max(r,h),height:Math.max(t,d)}}))}},methods:{getSafeSize(t){var i,r;if(e.Type.isNumber((i=t.image)==null?void 0:i.width)&&e.Type.isNumber((r=t.image)==null?void 0:r.height)){var n,a;return{width:(n=t.image)==null?void 0:n.width,height:(a=t.image)==null?void 0:a.height}}return c},getSafeRatio(t){const e=Math.max(t.width/t.height,t.height/t.width);if(e>m){if(t.height>t.width){return 1/g}return g}return t.width/t.height},onRemove(t){this.$emit("remove",t)},onCancel(t){this.$emit("cancelClick",t)},onItemDragStart(t){this.$emit("itemDragStart",t)},onItemDragEnd(t){this.$emit("itemDragEnd",t)},onItemDragOver(t){this.$emit("itemDragOver",t)},onItemDragLeave(t){this.$emit("itemDragLeave",t)},onItemDrop(t){this.$emit("itemDrop",t)},getHighlightDropzonePosition(t){if(t.id===this.highlightDropzone.fileId){return this.highlightDropzone.position}return null}},template:`\n\t\t<div class="bx-im-elements-media-gallery__row">\n\t\t\t<MediaGalleryItem\n\t\t\t\tv-for="(file, index) in files"\n\t\t\t\t:key="file.id"\n\t\t\t\t:file="file"\n\t\t\t\t:size="sizes[index]"\n\t\t\t\t:allowRemove="allowRemoveItem"\n\t\t\t\t:allowSorting="allowSorting"\n\t\t\t\t:handleLoading="handleLoading"\n\t\t\t\t:highlightDropzonePosition="getHighlightDropzonePosition(file)"\n\t\t\t\tviewerGroupBy="viewerGroupBy"\n\t\t\t\t@remove="onRemove"\n\t\t\t\t@cancelClick="onCancel"\n\t\t\t\t@itemDragStart="onItemDragStart"\n\t\t\t\t@itemDragEnd="onItemDragEnd"\n\t\t\t\t@itemDragOver="onItemDragOver"\n\t\t\t\t@itemDragLeave="onItemDragLeave"\n\t\t\t\t@itemDrop="onItemDrop"\n\t\t\t/>\n\t\t</div>\n\t`};const f={1:[1],2:[2],3:[3],4:[2,2],5:[2,3],6:[2,2,2],7:[2,3,2],8:[2,3,3],9:[2,3,2,2],10:[2,3,2,3]};const w={name:"MediaGallery",components:{MediaGalleryRow:p},props:{files:{type:Array,required:true},allowRemoveItem:{type:Boolean,default:false},allowSorting:{type:Boolean,default:false},handleLoading:{type:Boolean,default:false},width:{type:Number,default:376},viewerGroupBy:{type:String||null,default:null},highlightDropzone:{type:Object,default:()=>({})}},emits:["removeItem","cancelClick","itemDragStart","itemDragEnd","itemDragOver","itemDragLeave","itemDrop"],computed:{rows(){const t=f[this.files.length];let e=0;return t.map((t=>{const i=this.files.slice(e,e+t);e+=t;return i}))}},methods:{onRemoveItem(t){this.$emit("removeItem",t)},onCancel(t){this.$emit("cancelClick",t)},onItemDragStart(t){this.$emit("itemDragStart",t)},onItemDragEnd(t){this.$emit("itemDragEnd",t)},onItemDragOver(t){this.$emit("itemDragOver",t)},onItemDragLeave(t){this.$emit("itemDragLeave",t)},onItemDrop(t){this.$emit("itemDrop",t)}},template:`\n\t\t<div class="bx-im-elements-media-gallery">\n\t\t\t<MediaGalleryRow\n\t\t\t\tv-for="(row) in rows"\n\t\t\t\t:files="row"\n\t\t\t\t:allowRemoveItem="allowRemoveItem"\n\t\t\t\t:allowSorting="allowSorting"\n\t\t\t\t:handleLoading="handleLoading"\n\t\t\t\t:width="width"\n\t\t\t\t:highlightDropzone="highlightDropzone"\n\t\t\t\t@remove="onRemoveItem"\n\t\t\t\t@cancelClick="onCancel"\n\t\t\t\t@itemDragStart="onItemDragStart"\n\t\t\t\t@itemDragEnd="onItemDragEnd"\n\t\t\t\t@itemDragOver="onItemDragOver"\n\t\t\t\t@itemDragLeave="onItemDragLeave"\n\t\t\t\t@itemDrop="onItemDrop"\n\t\t\t/>\n\t\t</div>\n\t`};t.MediaGallery=w;t.MediaGalleryItem=o;t.MediaGalleryRow=p})(this.BX.Messenger.v2.Component.Elements=this.BX.Messenger.v2.Component.Elements||{},BX,BX.UI.IconSet,BX.Vue3.Directives,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Elements);
//# sourceMappingURL=media-gallery.bundle.map.js