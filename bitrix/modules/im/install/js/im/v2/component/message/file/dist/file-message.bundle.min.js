this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,i,s,n,a,r,o,l,d,c,g,m,h,u,p,f,M,v,I,C,y,x){"use strict";const b=5e6;const S=460;const B=380;const w=200;const F=100;const _=320;const T=180;const k={name:"VideoItem",components:{VideoPlayer:a.VideoPlayer,ProgressBar:h.ProgressBar},props:{id:{type:[String,Number],required:true},message:{type:Object,required:true}},emits:["cancelClick"],computed:{messageItem(){return this.message},file(){return this.$store.getters["files/get"](this.id,true)},autoplay(){return this.file.size<b},canBeOpenedWithViewer(){var t;return this.file.viewerAttrs&&((t=BX.UI)==null?void 0:t.Viewer)},viewerAttributes(){return c.Utils.file.getViewerDataAttributes({viewerAttributes:this.file.viewerAttrs,previewImageSrc:this.file.urlPreview,context:x.FileViewerContext.dialog})},imageSize(){let t=this.file.image.width;let e=this.file.image.height;if(!e||!t){return{width:`${_}px`,height:`${T}px`}}if(this.file.image.width>S||this.file.image.height>B){const i=this.file.image.width/this.file.image.height;if(this.file.image.width>S){t=S;e=Math.round(S/i)}if(e>B){t=Math.round(B*i);e=B}}const i={width:Math.max(t,w),height:Math.max(e,F)};return{width:`${i.width}px`,height:`${i.height}px`,"object-fit":i.width<100||i.height<100?"cover":"contain"}},isLoaded(){return this.file.progress===100},isForward(){return g.Type.isStringFilled(this.messageItem.forward.id)}},methods:{download(){if(this.file.progress!==100||this.canBeOpenedWithViewer){return}window.open(this.file.urlDownload,"_blank")},onCancelClick(t){this.$emit("cancelClick",t)},getHandleStatus(){return[x.FileStatus.preparing,x.FileStatus.progress,x.FileStatus.upload]},getStatusMap(){return{[x.FileStatus.preparing]:{iconClass:p.Outline.CLOUD,labelText:this.$Bitrix.Loc.getMessage("IM_MESSAGE_FILE_PREPARING_PROGRESS_LABEL")}}}},template:`\n\t\t<div\n\t\t\tclass="bx-im-video-item__container bx-im-video-item__scope"\n\t\t\t:class="{'--with-forward': isForward}"\n\t\t\t@click="download"\n\t\t>\n\t\t\t<ProgressBar \n\t\t\t\t:item="file"\n\t\t\t\t:handleStatus="getHandleStatus()"\n\t\t\t\t:statusMap="getStatusMap()"\n\t\t\t\t@cancelClick="onCancelClick"\n\t\t\t/>\n\t\t\t<VideoPlayer\n\t\t\t\t:fileId="file.id"\n\t\t\t\t:src="file.urlDownload"\n\t\t\t\t:previewImageUrl="file.urlPreview"\n\t\t\t\t:elementStyle="imageSize"\n\t\t\t\t:withAutoplay="autoplay"\n\t\t\t\t:withPlayerControls="isLoaded"\n\t\t\t\t:viewerAttributes="viewerAttributes"\n\t\t\t/>\n\t\t</div>\n\t`};const A={maxWidth:460,maxHeight:590};const P={minWidth:120,minHeight:120};const O={maxWidth:460,maxHeight:590};const E={minWidth:460,minHeight:260};const H=460;const $={name:"MediaContent",components:{VideoItem:k,MessageStatus:C.MessageStatus,MediaGallery:n.MediaGallery,MediaGalleryItem:n.MediaGalleryItem},props:{item:{type:Object,required:true},containerHeight:{type:[Number,null],default:null}},emits:["cancelClick"],computed:{message(){return this.item},files(){return this.message.files.map((t=>this.$store.getters["files/get"](t)))},filesCount(){return this.files.length},firstFile(){return this.files[0]},firstFileId(){var t;return(t=this.firstFile)==null?void 0:t.id},hasText(){return this.message.text.length>0},hasAttach(){return this.message.attach.length>0},onlyMedia(){return!this.hasText&&!this.hasAttach},isSingleVideo(){return this.filesCount===1&&this.firstFile.type===x.FileType.video},isSingleImage(){return this.filesCount===1&&this.firstFile.type===x.FileType.image},singleImageMaxSize(){if(g.Type.isNumber(this.containerHeight)){const{maxWidth:t,maxHeight:e}=A;const i=Math.min(e,this.containerHeight*.9);return{maxWidth:t,maxHeight:i}}return A},imageWithTextMaxSize(){if(g.Type.isNumber(this.containerHeight)){const{maxWidth:t,maxHeight:e}=O;const i=Math.min(e,this.containerHeight*.9);return{maxWidth:t,maxHeight:i}}return O},singleImageSize(){if(this.onlyMedia){return this.calcPreviewSize({...this.firstFile.image,...P,...this.singleImageMaxSize})}return this.calcPreviewSize({...this.firstFile.image,...E,...this.imageWithTextMaxSize})}},methods:{onCancel(t){this.$emit("cancelClick",t)},calcPreviewSize(t){const{width:e,height:i,minWidth:s,minHeight:n,maxWidth:a,maxHeight:r}=t;const o=Math.min(Math.max(e,s),a);const l=Math.min(Math.max(i,n),r);if(o===e&&l===i){return{width:e,height:i}}const d=Math.min(a/e,r/i,o/e,l/i);return{width:Math.max(Math.min(e*d,a),s),height:Math.max(Math.min(i*d,r),n)}},getGalleryMaxWidth(){return H}},template:`\n\t\t<div class="bx-im-message-media-content__container">\n\t\t\t<div v-if="isSingleImage" class="bx-im-message-media-content__single-image">\n\t\t\t\t<MediaGalleryItem\n\t\t\t\t\t:file="firstFile"\n\t\t\t\t\t:size="singleImageSize"\n\t\t\t\t\t:handleLoading="true"\n\t\t\t\t\t@cancelClick="onCancel"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-else-if="isSingleVideo" class="bx-im-message-media-content__single-video">\n\t\t\t\t<VideoItem\n\t\t\t\t\t:id="firstFileId"\n\t\t\t\t\t:message="message"\n\t\t\t\t\t@cancelClick="onCancel"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-else class="bx-im-message-media-content__gallery">\n\t\t\t\t<MediaGallery\n\t\t\t\t\t:files="files"\n\t\t\t\t\t:width="getGalleryMaxWidth()"\n\t\t\t\t\t:handleLoading="true"\n\t\t\t\t\t@cancelClick="onCancel"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-if="onlyMedia" class="bx-im-message-media-content__status-container">\n\t\t\t\t<MessageStatus :item="message" :isOverlay="true" />\n\t\t\t</div>\n\t\t</div>\n\t`};const X=460;const D=460;const L={name:"MediaMessage",components:{ReactionList:C.ReactionList,BaseMessage:y.BaseMessage,MessageStatus:C.MessageStatus,DefaultMessageContent:C.DefaultMessageContent,MessageHeader:C.MessageHeader,MessageFooter:C.MessageFooter,MediaContent:$},props:{item:{type:Object,required:true},dialogId:{type:String,required:true},withTitle:{type:Boolean,default:true},containerHeight:{type:[Number,null],default:0}},emits:["cancelClick"],computed:{message(){return this.item},fileIds(){return this.message.files},dialog(){return this.$store.getters["chats/get"](this.dialogId)},hasText(){return this.message.text.length>0},hasAttach(){return this.message.attach.length>0},hasReply(){return this.message.replyId!==0},hasError(){return this.message.error},showContextMenu(){return this.onlyImage},showBottomContainer(){return this.hasText||this.hasAttach||this.hasReply},isForward(){return g.Type.isStringFilled(this.message.forward.id)},needBackground(){return this.showBottomContainer||this.isChannelPost||this.isForward},isChannelPost(){return[x.ChatType.channel,x.ChatType.openChannel].includes(this.dialog.type)},imageContainerStyles(){let t=D;if(this.fileIds.length>1||this.hasText){t=X}return{"max-width":`${t}px`}}},methods:{onCancel(t){this.$emit("cancelClick",t)}},template:`\n\t\t<BaseMessage \n\t\t\t:item="item" \n\t\t\t:dialogId="dialogId" \n\t\t\t:withBackground="needBackground"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass="bx-im-message-image__container"\n\t\t\t\t:class="{\n\t\t\t\t\t'--has-text': hasText,\n\t\t\t\t}"\n\t\t\t\t:style="imageContainerStyles"\n\t\t\t>\n\t\t\t\t<MessageHeader :withTitle="false" :item="item" class="bx-im-message-image__header" />\n\t\t\t\t<MediaContent \n\t\t\t\t\t:item="message"\n\t\t\t\t\t:containerHeight="containerHeight"\n\t\t\t\t\t@cancelClick="onCancel"\n\t\t\t\t/>\n\t\t\t\t<div v-if="showBottomContainer" class="bx-im-message-image__bottom-container">\n\t\t\t\t\t<DefaultMessageContent\n\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t:withText="hasText"\n\t\t\t\t\t\t:withAttach="hasAttach"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<MessageFooter :item="item" :dialogId="dialogId" />\n\t\t\t</div>\n\t\t\t<template #after-message>\n\t\t\t\t<div v-if="!showBottomContainer" class="bx-im-message-image__reaction-list-container">\n\t\t\t\t\t<ReactionList :messageId="message.id" :contextDialogId="dialogId" />\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</BaseMessage>\n\t`};var z=babelHelpers.classPrivateFieldLooseKey("getMessageFile");class N extends o.BaseMenu{constructor(){super();Object.defineProperty(this,z,{value:U});this.id=x.PopupType.messageBaseFileMenu;this.id="bx-im-message-file-context-menu";this.diskService=new r.DiskService}getMenuItems(){return[this.getDownloadFileItem(),this.getSaveToDiskItem()]}getDownloadFileItem(){const t=babelHelpers.classPrivateFieldLooseBase(this,z)[z]();if(!t){return null}return{title:g.Loc.getMessage("IM_MESSAGE_FILE_MENU_DOWNLOAD_FILE"),onClick:function(){c.Utils.file.downloadFiles([t]);this.menuInstance.close()}.bind(this)}}getSaveToDiskItem(){const t=babelHelpers.classPrivateFieldLooseBase(this,z)[z]();if(!t){return null}return{title:g.Loc.getMessage("IM_MESSAGE_FILE_MENU_SAVE_ON_DISK_MSGVER_1"),onClick:async function(){this.menuInstance.close();await this.diskService.save(this.context.files);l.Notifier.file.onDiskSaveComplete()}.bind(this)}}}function U(){if(!this.context.fileId){return null}return this.store.getters["files/get"](this.context.fileId)}const R={name:"BaseFileItem",components:{ProgressBar:h.ProgressBar},props:{id:{type:[String,Number],required:true},messageId:{type:[String,Number],required:true}},emits:["cancelClick"],computed:{ProgressBarSize:()=>h.ProgressBarSize,file(){return this.$store.getters["files/get"](this.id,true)},fileShortName(){const t=20;return c.Utils.file.getShortFileName(this.file.name,t)},fileSize(){return c.Utils.file.formatFileSize(this.file.size)},iconClass(){const t=c.Utils.file.getIconTypeByFilename(this.file.name);return`ui-icon-file-${t}`},canBeOpenedWithViewer(){var t;return this.file.viewerAttrs&&((t=BX.UI)==null?void 0:t.Viewer)},viewerAttributes(){return c.Utils.file.getViewerDataAttributes({viewerAttributes:this.file.viewerAttrs,previewImageSrc:this.file.urlPreview,context:x.FileViewerContext.dialog})},isLoaded(){return this.file.progress===100},imageStyles(){return{backgroundImage:`url(${this.file.urlPreview})`}},hasPreview(){return g.Type.isStringFilled(this.file.urlPreview)}},methods:{download(){if(this.file.progress!==100||this.canBeOpenedWithViewer){return}window.open(this.file.urlDownload,"_blank")},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},openContextMenu(t){this.$emit("openContextMenu",{event:t,fileId:this.id})},onCancelClick(t){this.$emit("cancelClick",t)}},template:`\n\t\t<div class="bx-im-base-file-item__container">\n\t\t\t<div class="bx-im-base-file-item__viewer-container" v-bind="viewerAttributes" @click="download">\n\t\t\t\t<div class="bx-im-base-file-item__icon-container" ref="loader-icon">\n\t\t\t\t\t<ProgressBar \n\t\t\t\t\t\tv-if="!isLoaded" \n\t\t\t\t\t\t:item="file"\n\t\t\t\t\t\t:size="ProgressBarSize.S"\n\t\t\t\t\t\t@cancelClick="onCancelClick"\n\t\t\t\t\t/>\n\t\t\t\t<div v-if="hasPreview" :style="imageStyles" class="bx-im-base-file-item__image"></div>\n\t\t\t\t\t<div v-else :class="iconClass" class="bx-im-base-file-item__type-icon ui-icon"><i></i></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-base-file-item__content">\n\t\t\t\t\t<span :title="file.name" class="bx-im-base-file-item__title">\n\t\t\t\t\t\t{{ fileShortName }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="bx-im-base-file-item__size">{{ fileSize }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass="bx-im-base-file-item__download-icon"\n\t\t\t\t:class="{'--not-active': !isLoaded}"\n\t\t\t\t@click="openContextMenu"\n\t\t\t></div>\n\t\t</div>\n\t`};const V={name:"BaseFileMessage",components:{BaseMessage:y.BaseMessage,DefaultMessageContent:C.DefaultMessageContent,BaseFileItem:R,MessageHeader:C.MessageHeader,MessageFooter:C.MessageFooter},props:{item:{type:Object,required:true},dialogId:{type:String,required:true},withTitle:{type:Boolean,default:true}},emits:["cancelClick"],computed:{FileType:()=>x.FileType,message(){return this.item},messageFile(){const t=this.message.files[0];return this.$store.getters["files/get"](t,true)}},created(){this.contextMenu=new N},beforeUnmount(){this.contextMenu.destroy()},methods:{onOpenContextMenu({event:t,fileId:e}){const i={dialogId:this.dialogId,fileId:e,...this.message};this.contextMenu.openMenu(i,t.target)},onCancel(t){this.$emit("cancelClick",t)}},template:`\n\t\t<BaseMessage :item="item" :dialogId="dialogId">\n\t\t\t<div class="bx-im-message-base-file__container">\n\t\t\t\t<MessageHeader :withTitle="withTitle" :item="item" class="bx-im-message-base-file__author-title" />\n\t\t\t\t<BaseFileItem\n\t\t\t\t\t:key="messageFile.id"\n\t\t\t\t\t:id="messageFile.id"\n\t\t\t\t\t:messageId="message.id"\n\t\t\t\t\t@openContextMenu="onOpenContextMenu"\n\t\t\t\t\t@cancelClick="onCancel"\n\t\t\t\t/>\n\t\t\t\t<DefaultMessageContent :item="item" :dialogId="dialogId" />\n\t\t\t</div>\n\t\t\t<MessageFooter :item="item" :dialogId="dialogId" />\n\t\t</BaseMessage>\n\t`};const q={name:"TranscriptionItem",components:{ExpandAnimation:u.ExpandAnimation},props:{file:{type:Object,required:true},messageId:{type:[String,Number],required:true},isOpened:{type:Boolean,required:true}},computed:{transcription(){return this.$store.getters["files/getTranscription"](this.file.id)},text(){return this.isError?this.loc("IM_MESSAGE_FILE_AUDIO_TRANSCRIPTION_ERROR"):this.transcription.transcriptText},isError(){return this.transcription&&this.transcription.status===x.TranscriptionStatus.ERROR},showDivider(){return this.isOpened&&Boolean(this.message.text)},message(){return this.$store.getters["messages/getById"](this.messageId)}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-audio-player__transcription-container">\n\t\t\t<ExpandAnimation>\n\t\t\t\t<div\n\t\t\t\t\tv-if="isOpened"\n\t\t\t\t\t:class="{'--error': isError}"\n\t\t\t\t>\n\t\t\t\t\t<div class="bx-im-audio-player__transcription-content">\n\t\t\t\t\t\t{{ text }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</ExpandAnimation>\n\t\t\t<div v-if="showDivider" class="bx-im-audio-player__transcription-divider"></div>\n\t\t</div>\n\t`};const G={name:"TranscriptionButtonItem",components:{Spinner:f.Spinner,BIcon:p.BIcon},props:{file:{type:Object,required:true},isOpened:{type:Boolean,required:true}},emits:["transcriptionToggle"],computed:{SpinnerSize:()=>f.SpinnerSize,OutlineIcons:()=>p.Outline,Color:()=>x.Color,fileId(){return this.file.id},chatId(){return this.file.chatId},transcription(){return this.$store.getters["files/getTranscription"](this.fileId)},status(){return this.transcription?this.transcription.status:null},isPending(){return this.status===x.TranscriptionStatus.PENDING},isSuccess(){return this.status===x.TranscriptionStatus.SUCCESS},buttonIcon(){return this.isOpened?p.Outline.CHEVRON_TOP_M:p.Outline.TRANSCRIPTION},withTranscription(){return this.file.isTranscribable&&v.FeatureManager.isFeatureAvailable(v.Feature.aiFileTranscriptionAvailable)&&v.FeatureManager.isFeatureAvailable(v.Feature.copilotAvailable)}},watch:{status(t,e){if(e===x.TranscriptionStatus.PENDING){I.Analytics.getInstance().audioMessage.onViewTranscription(this.chatId,t);this.open()}}},methods:{async onButtonClick(){if(this.isPending){return}if(this.isOpened){this.close();return}if(this.isSuccess){I.Analytics.getInstance().audioMessage.onViewTranscription(this.chatId,x.TranscriptionStatus.SUCCESS);this.open();return}const t=await this.transcribe();if(t){this.open()}},async transcribe(){const t=new M.MessageService({chatId:this.chatId});return t.transcribe(this.fileId)},open(){this.$emit("transcriptionToggle",true)},close(){this.$emit("transcriptionToggle",false)}},template:`\n\t\t<div\n\t\t\tv-if="withTranscription"\n\t\t\tclass="bx-im-audio-player__transcription-button-container"\n\t\t>\n\t\t\t<button @click="onButtonClick">\n\t\t\t\t<Spinner v-if="isPending" :size="SpinnerSize.XXS" />\n\t\t\t\t<BIcon\n\t\t\t\t\tv-else\n\t\t\t\t\t:name="buttonIcon"\n\t\t\t\t\t:color="Color.accentBlue"\n\t\t\t\t\t:size="20"\n\t\t\t\t/>\n\t\t\t</button>\n\t\t</div>\n\t`};const W={name:"AudioItem",components:{AudioPlayer:m.AudioPlayer,ProgressBar:h.ProgressBar,TranscriptionItem:q,TranscriptionButtonItem:G},props:{item:{type:Object,required:true},messageId:{type:[String,Number],required:true}},emits:["cancelClick"],data(){return{isTranscriptionOpened:false}},computed:{ProgressBarSize:()=>h.ProgressBarSize,file(){return this.item},timelineType(){return Math.floor(Math.random()*5)}},methods:{onCancelClick(t){this.$emit("cancelClick",t)},transcriptionToggle(t){this.isTranscriptionOpened=t}},template:`\n\t\t<div class="bx-im-media-audio__container">\n\t\t\t<ProgressBar \n\t\t\t\t:item="file"\n\t\t\t\t:size="ProgressBarSize.S"\n\t\t\t\t@cancelClick="onCancelClick"\n\t\t\t/>\n\t\t\t<AudioPlayer\n\t\t\t\t:id="file.id"\n\t\t\t\t:messageId="messageId"\n\t\t\t\t:src="file.urlDownload"\n\t\t\t\t:file="file"\n\t\t\t\t:timelineType="timelineType"\n\t\t\t\t:authorId="file.authorId"\n\t\t\t\t:withContextMenu="false"\n\t\t\t\t:withAvatar="false"\n\t\t\t>\n\t\t\t\t<template #transcription-control>\n\t\t\t\t\t<TranscriptionButtonItem\n\t\t\t\t\t\t:file="file"\n\t\t\t\t\t\t:isOpened="isTranscriptionOpened"\n\t\t\t\t\t\t@transcriptionToggle="transcriptionToggle"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</AudioPlayer>\n\t\t\t<TranscriptionItem\n\t\t\t\t:file="file"\n\t\t\t\t:isOpened="isTranscriptionOpened"\n\t\t\t\t:messageId="messageId"\n\t\t\t/>\n\t\t</div>\n\t`};const j={name:"AudioMessage",components:{BaseMessage:y.BaseMessage,MessageHeader:C.MessageHeader,MessageFooter:C.MessageFooter,DefaultMessageContent:C.DefaultMessageContent,AudioItem:W},props:{item:{type:Object,required:true},dialogId:{type:String,required:true},withTitle:{type:Boolean,default:false}},emits:["cancelClick"],computed:{FileType:()=>x.FileType,message(){return this.item},messageFile(){const t=this.message.files[0];return this.$store.getters["files/get"](t,true)},canSetReactions(){return g.Type.isNumber(this.message.id)}},methods:{onCancel(t){this.$emit("cancelClick",t)}},template:`\n\t\t<BaseMessage :item="item" :dialogId="dialogId">\n\t\t\t<div class="bx-im-message-audio__container">\n\t\t\t\t<MessageHeader :withTitle="withTitle" :item="item" class="bx-im-message-audio__header"/>\n\t\t\t\t<AudioItem\n\t\t\t\t\t:key="messageFile.id"\n\t\t\t\t\t:item="messageFile"\n\t\t\t\t\t:messageId="message.id"\n\t\t\t\t\t@cancelClick="onCancel"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="bx-im-message-audio__default-message-container">\n\t\t\t\t<DefaultMessageContent :item="item" :dialogId="dialogId" />\n\t\t\t</div>\n\t\t\t<MessageFooter :item="item" :dialogId="dialogId" />\n\t\t</BaseMessage>\n\t`};const K=10;const J={name:"FileCollectionMessage",components:{BaseMessage:y.BaseMessage,DefaultMessageContent:C.DefaultMessageContent,BaseFileItem:R,MessageHeader:C.MessageHeader,MessageFooter:C.MessageFooter},props:{item:{type:Object,required:true},dialogId:{type:String,required:true},withTitle:{type:Boolean,default:true}},emits:["cancelClick"],computed:{FileType:()=>x.FileType,message(){return this.item},messageId(){return this.message.id},fileIds(){return this.message.files.slice(0,K)}},created(){this.contextMenu=new N},beforeUnmount(){this.contextMenu.destroy()},methods:{onOpenContextMenu({event:t,fileId:e}){const i={dialogId:this.dialogId,fileId:e,...this.message};this.contextMenu.openMenu(i,t.target)},onCancel(t){this.$emit("cancelClick",t)}},template:`\n\t\t<BaseMessage :item="item" :dialogId="dialogId">\n\t\t\t<div class="bx-im-message-file-collection__container">\n\t\t\t\t<MessageHeader :withTitle="withTitle" :item="item" class="bx-im-message-file-collection__author-title" />\n\t\t\t\t<div class="bx-im-message-file-collection__items">\n\t\t\t\t\t<BaseFileItem\n\t\t\t\t\t\tv-for="fileId in fileIds"\n\t\t\t\t\t\t:key="fileId"\n\t\t\t\t\t\t:id="fileId"\n\t\t\t\t\t\t:messageId="messageId"\n\t\t\t\t\t\t@openContextMenu="onOpenContextMenu"\n\t\t\t\t\t\t@cancelClick="onCancel"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<DefaultMessageContent \n\t\t\t\t\t:item="item" \n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\tclass="bx-im-message-file-collection__default-content" \n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<MessageFooter :item="item" :dialogId="dialogId" />\n\t\t</BaseMessage>\n\t`};const Q=Object.freeze({media:"MediaMessage",audio:"AudioMessage",base:"BaseFileMessage",collection:"FileCollectionMessage"});const Y={name:"FileMessage",components:{BaseFileMessage:V,MediaMessage:L,AudioMessage:j,UnsupportedMessage:e.UnsupportedMessage,FileCollectionMessage:J},props:{item:{type:Object,required:true},dialogId:{type:String,required:true},withTitle:{type:Boolean,default:true},containerHeight:{type:[Number,null],default:null}},computed:{FileType:()=>x.FileType,message(){return this.$store.getters["messages/getById"](this.item.id)},messageFiles(){const t=[];if(this.message.files.length===0){return t}this.message.files.forEach((e=>{const i=this.$store.getters["files/get"](e,true);t.push(i)}));return t},isGallery(){const t=new Set([x.FileType.image,x.FileType.video]);const e=this.messageFiles.every((e=>t.has(e.type)));const i=this.messageFiles.some((t=>t.image!==false));return e&&i},componentName(){if(this.messageFiles.length>1){return this.isGallery?Q.media:Q.collection}const t=this.messageFiles[0];const e=Boolean(t.image);if(t.type===x.FileType.image&&e){return Q.media}if(t.type===x.FileType.audio){return Q.audio}if(t.type===x.FileType.video&&e){return Q.media}return Q.base},isRealMessage(){return this.$store.getters["messages/isRealMessage"](this.message.id)}},methods:{onCancel(t){const e=t.file.id;const s=i.UploadingService.getInstance();const n=s.getUploaderIdByFileId(e);s.removeFileFromUploader({uploaderId:n,filesIds:[e],restartUploading:true});const a=s.getFiles(n);if(g.Type.isArrayFilled(a)){const t=a.map((t=>t.getId()));void this.$store.dispatch("messages/update",{id:this.message.id,fields:{files:t}})}else{const t=this.message.chatId;void this.$store.dispatch("messages/delete",{id:this.message.id});const e=this.$store.getters["chats/getByChatId"](t);const i=this.$store.getters["messages/findLastChatMessageId"](t);if(g.Type.isString(i)||g.Type.isNumber(i)){void this.$store.dispatch("recent/update",{id:e.dialogId,fields:{messageId:i}})}else{void this.$store.dispatch("recent/delete",{id:e.dialogId})}}}},template:`\n\t\t<component \n\t\t\t:is="componentName" \n\t\t\t:item="message" \n\t\t\t:dialogId="dialogId"\n\t\t\t:withTitle="withTitle" \n\t\t\t:containerHeight="containerHeight"\n\t\t\t:withContextMenu="isRealMessage"\n\t\t\t@cancelClick="onCancel"\n\t\t/>\n\t`};t.FileMessage=Y;t.MediaContent=$})(this.BX.Messenger.v2.Component.Message=this.BX.Messenger.v2.Component.Message||{},BX.Messenger.v2.Component.Message,BX.Messenger.v2.Service,BX.UI.Uploader,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.Animation,BX.UI.IconSet,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Const);
//# sourceMappingURL=file-message.bundle.map.js