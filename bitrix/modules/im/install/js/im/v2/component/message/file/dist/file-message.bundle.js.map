{"version":3,"file":"file-message.bundle.js","sources":["../src/components/items/video.js","../src/components/media-content.js","../src/components/media-message.js","../src/classes/base-file-context-menu.js","../src/components/items/base-file.js","../src/components/base-file-message.js","../src/components/items/transcription.js","../src/components/items/transcription-button.js","../src/components/items/audio.js","../src/components/audio-message.js","../src/components/file-collection-message.js","../src/file-message.js"],"sourcesContent":["import { Type } from 'main.core';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { FileViewerContext, FileStatus } from 'im.v2.const';\nimport { VideoPlayer } from\t'im.v2.component.elements.videoplayer';\nimport { ProgressBar } from 'im.v2.component.elements.progressbar';\nimport { Outline } from 'ui.icon-set.api.vue';\n\nimport '../../css/items/video.css';\n\nimport type { ImModelFile, ImModelMessage } from 'im.v2.model';\n\nconst VIDEO_SIZE_TO_AUTOPLAY = 5_000_000;\nconst MAX_WIDTH = 460;\nconst MAX_HEIGHT = 380;\nconst MIN_WIDTH = 200;\nconst MIN_HEIGHT = 100;\nconst DEFAULT_WIDTH = 320;\nconst DEFAULT_HEIGHT = 180;\n\n// @vue/component\nexport const VideoItem = {\n\tname: 'VideoItem',\n\tcomponents: { VideoPlayer, ProgressBar },\n\tprops:\n\t{\n\t\tid: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['cancelClick'],\n\tcomputed:\n\t{\n\t\tmessageItem(): ImModelMessage\n\t\t{\n\t\t\treturn this.message;\n\t\t},\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.id, true);\n\t\t},\n\t\tautoplay(): boolean\n\t\t{\n\t\t\treturn this.file.size < VIDEO_SIZE_TO_AUTOPLAY;\n\t\t},\n\t\tcanBeOpenedWithViewer(): boolean\n\t\t{\n\t\t\treturn this.file.viewerAttrs && BX.UI?.Viewer;\n\t\t},\n\t\tviewerAttributes(): Object\n\t\t{\n\t\t\treturn Utils.file.getViewerDataAttributes({\n\t\t\t\tviewerAttributes: this.file.viewerAttrs,\n\t\t\t\tpreviewImageSrc: this.file.urlPreview,\n\t\t\t\tcontext: FileViewerContext.dialog,\n\t\t\t});\n\t\t},\n\t\timageSize(): {width: string, height: string, backgroundSize: string}\n\t\t{\n\t\t\tlet newWidth = this.file.image.width;\n\t\t\tlet newHeight = this.file.image.height;\n\n\t\t\tif (!newHeight || !newWidth)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\twidth: `${DEFAULT_WIDTH}px`,\n\t\t\t\t\theight: `${DEFAULT_HEIGHT}px`,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (this.file.image.width > MAX_WIDTH || this.file.image.height > MAX_HEIGHT)\n\t\t\t{\n\t\t\t\tconst aspectRatio = this.file.image.width / this.file.image.height;\n\n\t\t\t\tif (this.file.image.width > MAX_WIDTH)\n\t\t\t\t{\n\t\t\t\t\tnewWidth = MAX_WIDTH;\n\t\t\t\t\tnewHeight = Math.round(MAX_WIDTH / aspectRatio);\n\t\t\t\t}\n\n\t\t\t\tif (newHeight > MAX_HEIGHT)\n\t\t\t\t{\n\t\t\t\t\tnewWidth = Math.round(MAX_HEIGHT * aspectRatio);\n\t\t\t\t\tnewHeight = MAX_HEIGHT;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst sizes = {\n\t\t\t\twidth: Math.max(newWidth, MIN_WIDTH),\n\t\t\t\theight: Math.max(newHeight, MIN_HEIGHT),\n\t\t\t};\n\n\t\t\treturn {\n\t\t\t\twidth: `${sizes.width}px`,\n\t\t\t\theight: `${sizes.height}px`,\n\t\t\t\t'object-fit': (sizes.width < 100 || sizes.height < 100) ? 'cover' : 'contain',\n\t\t\t};\n\t\t},\n\t\tisLoaded(): boolean\n\t\t{\n\t\t\treturn this.file.progress === 100;\n\t\t},\n\t\tisForward(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.messageItem.forward.id);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tdownload()\n\t\t{\n\t\t\tif (this.file.progress !== 100 || this.canBeOpenedWithViewer)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.open(this.file.urlDownload, '_blank');\n\t\t},\n\t\tonCancelClick(event)\n\t\t{\n\t\t\tthis.$emit('cancelClick', event);\n\t\t},\n\t\tgetHandleStatus(): Array<string>\n\t\t{\n\t\t\treturn [\n\t\t\t\tFileStatus.preparing,\n\t\t\t\tFileStatus.progress,\n\t\t\t\tFileStatus.upload,\n\t\t\t];\n\t\t},\n\t\tgetStatusMap(): { [key: string]: { iconClass: string, labelText: string } }\n\t\t{\n\t\t\treturn {\n\t\t\t\t[FileStatus.preparing]: {\n\t\t\t\t\ticonClass: Outline.CLOUD,\n\t\t\t\t\tlabelText: this.$Bitrix.Loc.getMessage('IM_MESSAGE_FILE_PREPARING_PROGRESS_LABEL'),\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"bx-im-video-item__container bx-im-video-item__scope\"\n\t\t\t:class=\"{'--with-forward': isForward}\"\n\t\t\t@click=\"download\"\n\t\t>\n\t\t\t<ProgressBar \n\t\t\t\t:item=\"file\"\n\t\t\t\t:handleStatus=\"getHandleStatus()\"\n\t\t\t\t:statusMap=\"getStatusMap()\"\n\t\t\t\t@cancelClick=\"onCancelClick\"\n\t\t\t/>\n\t\t\t<VideoPlayer\n\t\t\t\t:fileId=\"file.id\"\n\t\t\t\t:src=\"file.urlDownload\"\n\t\t\t\t:previewImageUrl=\"file.urlPreview\"\n\t\t\t\t:elementStyle=\"imageSize\"\n\t\t\t\t:withAutoplay=\"autoplay\"\n\t\t\t\t:withPlayerControls=\"isLoaded\"\n\t\t\t\t:viewerAttributes=\"viewerAttributes\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { MessageStatus } from 'im.v2.component.message.elements';\nimport { MediaGallery, MediaGalleryItem } from 'im.v2.component.elements.media-gallery';\nimport { FileType } from 'im.v2.const';\n\nimport { VideoItem } from './items/video';\n\nimport '../css/items/media-content.css';\n\nimport type { ImModelMessage, ImModelFile } from 'im.v2.model';\n\ntype Size = { width: number, height: number };\ntype MaxSize = { maxWidth: number, maxHeight: number };\ntype MinSize = { minWidth: number, minHeight: number };\n\nconst SINGLE_IMAGE_CONTAINER_MAX_SIZE: MaxSize = {\n\tmaxWidth: 460,\n\tmaxHeight: 590,\n};\n\nconst SINGLE_IMAGE_CONTAINER_MIN_SIZE: MinSize = {\n\tminWidth: 120,\n\tminHeight: 120,\n};\n\nconst SINGLE_IMAGE_WITH_TEXT_CONTAINER_MAX_SIZE: MaxSize = {\n\tmaxWidth: 460,\n\tmaxHeight: 590,\n};\n\nconst SINGLE_IMAGE_WITH_TEXT_CONTAINER_MIN_SIZE: MinSize = {\n\tminWidth: 460,\n\tminHeight: 260,\n};\n\nconst GALLERY_MAX_WIDTH: number = 460;\n\n// @vue/component\nexport const MediaContent = {\n\tname: 'MediaContent',\n\tcomponents: { VideoItem, MessageStatus, MediaGallery, MediaGalleryItem },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcontainerHeight: {\n\t\t\ttype: [Number, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\temits: ['cancelClick'],\n\tcomputed: {\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tfiles(): Array<ImModelFile>\n\t\t{\n\t\t\treturn this.message.files.map((fileId) => {\n\t\t\t\treturn this.$store.getters['files/get'](fileId);\n\t\t\t});\n\t\t},\n\t\tfilesCount(): number\n\t\t{\n\t\t\treturn this.files.length;\n\t\t},\n\t\tfirstFile(): ?ImModelFile\n\t\t{\n\t\t\treturn this.files[0];\n\t\t},\n\t\tfirstFileId(): ?ImModelFile['id']\n\t\t{\n\t\t\treturn this.firstFile?.id;\n\t\t},\n\t\thasText(): boolean\n\t\t{\n\t\t\treturn this.message.text.length > 0;\n\t\t},\n\t\thasAttach(): boolean\n\t\t{\n\t\t\treturn this.message.attach.length > 0;\n\t\t},\n\t\tonlyMedia(): boolean\n\t\t{\n\t\t\treturn !this.hasText && !this.hasAttach;\n\t\t},\n\t\tisSingleVideo(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.filesCount === 1\n\t\t\t\t&& this.firstFile.type === FileType.video\n\t\t\t);\n\t\t},\n\t\tisSingleImage(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.filesCount === 1\n\t\t\t\t&& this.firstFile.type === FileType.image\n\t\t\t);\n\t\t},\n\t\tsingleImageMaxSize(): MaxSize\n\t\t{\n\t\t\tif (Type.isNumber(this.containerHeight))\n\t\t\t{\n\t\t\t\tconst { maxWidth, maxHeight } = SINGLE_IMAGE_CONTAINER_MAX_SIZE;\n\t\t\t\tconst maxAllowedPreviewHeight = Math.min(maxHeight, this.containerHeight * 0.9);\n\n\t\t\t\treturn {\n\t\t\t\t\tmaxWidth,\n\t\t\t\t\tmaxHeight: maxAllowedPreviewHeight,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn SINGLE_IMAGE_CONTAINER_MAX_SIZE;\n\t\t},\n\t\timageWithTextMaxSize(): MaxSize\n\t\t{\n\t\t\tif (Type.isNumber(this.containerHeight))\n\t\t\t{\n\t\t\t\tconst { maxWidth, maxHeight } = SINGLE_IMAGE_WITH_TEXT_CONTAINER_MAX_SIZE;\n\t\t\t\tconst maxAllowedPreviewHeight = Math.min(maxHeight, this.containerHeight * 0.9);\n\n\t\t\t\treturn {\n\t\t\t\t\tmaxWidth,\n\t\t\t\t\tmaxHeight: maxAllowedPreviewHeight,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn SINGLE_IMAGE_WITH_TEXT_CONTAINER_MAX_SIZE;\n\t\t},\n\t\tsingleImageSize(): { width: number; height: number }\n\t\t{\n\t\t\tif (this.onlyMedia)\n\t\t\t{\n\t\t\t\treturn this.calcPreviewSize({\n\t\t\t\t\t...this.firstFile.image,\n\t\t\t\t\t...SINGLE_IMAGE_CONTAINER_MIN_SIZE,\n\t\t\t\t\t...this.singleImageMaxSize,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.calcPreviewSize({\n\t\t\t\t...this.firstFile.image,\n\t\t\t\t...SINGLE_IMAGE_WITH_TEXT_CONTAINER_MIN_SIZE,\n\t\t\t\t...this.imageWithTextMaxSize,\n\t\t\t});\n\t\t},\n\t},\n\tmethods: {\n\t\tonCancel(event)\n\t\t{\n\t\t\tthis.$emit('cancelClick', event);\n\t\t},\n\t\tcalcPreviewSize(options: Size & MinSize & MaxSize): Size\n\t\t{\n\t\t\tconst { width, height, minWidth, minHeight, maxWidth, maxHeight } = options;\n\n\t\t\tconst adjustedWidth = Math.min(Math.max(width, minWidth), maxWidth);\n\t\t\tconst adjustedHeight = Math.min(Math.max(height, minHeight), maxHeight);\n\n\t\t\tif (adjustedWidth === width && adjustedHeight === height)\n\t\t\t{\n\t\t\t\treturn { width, height };\n\t\t\t}\n\n\t\t\tconst scale = Math.min(\n\t\t\t\tmaxWidth / width,\n\t\t\t\tmaxHeight / height,\n\t\t\t\tadjustedWidth / width,\n\t\t\t\tadjustedHeight / height,\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\twidth: Math.max(Math.min(width * scale, maxWidth), minWidth),\n\t\t\t\theight: Math.max(Math.min(height * scale, maxHeight), minHeight),\n\t\t\t};\n\t\t},\n\t\tgetGalleryMaxWidth(): number\n\t\t{\n\t\t\treturn GALLERY_MAX_WIDTH;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-media-content__container\">\n\t\t\t<div v-if=\"isSingleImage\" class=\"bx-im-message-media-content__single-image\">\n\t\t\t\t<MediaGalleryItem\n\t\t\t\t\t:file=\"firstFile\"\n\t\t\t\t\t:size=\"singleImageSize\"\n\t\t\t\t\t:handleLoading=\"true\"\n\t\t\t\t\t@cancelClick=\"onCancel\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-else-if=\"isSingleVideo\" class=\"bx-im-message-media-content__single-video\">\n\t\t\t\t<VideoItem\n\t\t\t\t\t:id=\"firstFileId\"\n\t\t\t\t\t:message=\"message\"\n\t\t\t\t\t@cancelClick=\"onCancel\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-im-message-media-content__gallery\">\n\t\t\t\t<MediaGallery\n\t\t\t\t\t:files=\"files\"\n\t\t\t\t\t:width=\"getGalleryMaxWidth()\"\n\t\t\t\t\t:handleLoading=\"true\"\n\t\t\t\t\t@cancelClick=\"onCancel\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-if=\"onlyMedia\" class=\"bx-im-message-media-content__status-container\">\n\t\t\t\t<MessageStatus :item=\"message\" :isOverlay=\"true\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\n\nimport {\n\tMessageStatus,\n\tReactionList,\n\tDefaultMessageContent,\n\tMessageHeader,\n\tMessageFooter,\n} from 'im.v2.component.message.elements';\nimport { BaseMessage } from 'im.v2.component.message.base';\nimport { ChatType } from 'im.v2.const';\n\nimport { MediaContent } from './media-content';\n\nimport '../css/media-message.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelMessage, ImModelChat } from 'im.v2.model';\n\nconst MAX_GALLERY_WIDTH = 460;\nconst MAX_SINGLE_MEDIA_WIDTH = 460;\n\n// @vue/component\nexport const MediaMessage = {\n\tname: 'MediaMessage',\n\tcomponents: {\n\t\tReactionList,\n\t\tBaseMessage,\n\t\tMessageStatus,\n\t\tDefaultMessageContent,\n\t\tMessageHeader,\n\t\tMessageFooter,\n\t\tMediaContent,\n\t},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tcontainerHeight: {\n\t\t\ttype: [Number, null],\n\t\t\tdefault: 0,\n\t\t},\n\t},\n\temits: ['cancelClick'],\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tfileIds(): number[]\n\t\t{\n\t\t\treturn this.message.files;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId);\n\t\t},\n\t\thasText(): boolean\n\t\t{\n\t\t\treturn this.message.text.length > 0;\n\t\t},\n\t\thasAttach(): boolean\n\t\t{\n\t\t\treturn this.message.attach.length > 0;\n\t\t},\n\t\thasReply(): boolean\n\t\t{\n\t\t\treturn this.message.replyId !== 0;\n\t\t},\n\t\thasError(): boolean\n\t\t{\n\t\t\treturn this.message.error;\n\t\t},\n\t\tshowContextMenu(): boolean\n\t\t{\n\t\t\treturn this.onlyImage;\n\t\t},\n\t\tshowBottomContainer(): boolean\n\t\t{\n\t\t\treturn this.hasText || this.hasAttach || this.hasReply;\n\t\t},\n\t\tisForward(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.message.forward.id);\n\t\t},\n\t\tneedBackground(): boolean\n\t\t{\n\t\t\treturn this.showBottomContainer || this.isChannelPost || this.isForward;\n\t\t},\n\t\tisChannelPost(): boolean\n\t\t{\n\t\t\treturn [ChatType.channel, ChatType.openChannel].includes(this.dialog.type);\n\t\t},\n\t\timageContainerStyles(): JsonObject\n\t\t{\n\t\t\tlet maxWidth = MAX_SINGLE_MEDIA_WIDTH;\n\t\t\tif (this.fileIds.length > 1 || this.hasText)\n\t\t\t{\n\t\t\t\tmaxWidth = MAX_GALLERY_WIDTH;\n\t\t\t}\n\n\t\t\treturn { 'max-width': `${maxWidth}px` };\n\t\t},\n\t},\n\tmethods: {\n\t\tonCancel(event)\n\t\t{\n\t\t\tthis.$emit('cancelClick', event);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BaseMessage \n\t\t\t:item=\"item\" \n\t\t\t:dialogId=\"dialogId\" \n\t\t\t:withBackground=\"needBackground\"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass=\"bx-im-message-image__container\"\n\t\t\t\t:class=\"{\n\t\t\t\t\t'--has-text': hasText,\n\t\t\t\t}\"\n\t\t\t\t:style=\"imageContainerStyles\"\n\t\t\t>\n\t\t\t\t<MessageHeader :withTitle=\"false\" :item=\"item\" class=\"bx-im-message-image__header\" />\n\t\t\t\t<MediaContent \n\t\t\t\t\t:item=\"message\"\n\t\t\t\t\t:containerHeight=\"containerHeight\"\n\t\t\t\t\t@cancelClick=\"onCancel\"\n\t\t\t\t/>\n\t\t\t\t<div v-if=\"showBottomContainer\" class=\"bx-im-message-image__bottom-container\">\n\t\t\t\t\t<DefaultMessageContent\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t:withText=\"hasText\"\n\t\t\t\t\t\t:withAttach=\"hasAttach\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<MessageFooter :item=\"item\" :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t\t<template #after-message>\n\t\t\t\t<div v-if=\"!showBottomContainer\" class=\"bx-im-message-image__reaction-list-container\">\n\t\t\t\t\t<ReactionList :messageId=\"message.id\" :contextDialogId=\"dialogId\" />\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</BaseMessage>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { DiskService } from 'im.v2.provider.service.disk';\nimport { BaseMenu } from 'im.v2.lib.menu';\nimport { Utils } from 'im.v2.lib.utils';\nimport { PopupType } from 'im.v2.const';\nimport { Notifier } from 'im.v2.lib.notifier';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\nimport type { ImModelFile, ImModelMessage } from 'im.v2.model';\n\nexport class BaseFileContextMenu extends BaseMenu\n{\n\tcontext: ImModelMessage & {dialogId: string, fileId: number};\n\n\tid: String = PopupType.messageBaseFileMenu;\n\tdiskService: DiskService;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'bx-im-message-file-context-menu';\n\t\tthis.diskService = new DiskService();\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\treturn [\n\t\t\tthis.getDownloadFileItem(),\n\t\t\tthis.getSaveToDiskItem(),\n\t\t];\n\t}\n\n\tgetDownloadFileItem(): ?MenuItemOptions\n\t{\n\t\tconst file = this.#getMessageFile();\n\t\tif (!file)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_MESSAGE_FILE_MENU_DOWNLOAD_FILE'),\n\t\t\tonClick: function() {\n\t\t\t\tUtils.file.downloadFiles([file]);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\tgetSaveToDiskItem(): ?MenuItemOptions\n\t{\n\t\tconst file = this.#getMessageFile();\n\t\tif (!file)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_MESSAGE_FILE_MENU_SAVE_ON_DISK_MSGVER_1'),\n\t\t\tonClick: async function() {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tawait this.diskService.save(this.context.files);\n\t\t\t\tNotifier.file.onDiskSaveComplete();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\t#getMessageFile(): ?ImModelFile\n\t{\n\t\tif (!this.context.fileId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.store.getters['files/get'](this.context.fileId);\n\t}\n}\n","import 'ui.icons.disk';\nimport { Type } from 'main.core';\n\nimport { FileViewerContext } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { ProgressBar, ProgressBarSize } from 'im.v2.component.elements.progressbar';\n\nimport '../../css/items/base-file.css';\n\nimport type { ImModelFile } from 'im.v2.model';\n\n// @vue/component\nexport const BaseFileItem = {\n\tname: 'BaseFileItem',\n\tcomponents: { ProgressBar },\n\tprops:\n\t{\n\t\tid: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['cancelClick'],\n\tcomputed:\n\t{\n\t\tProgressBarSize: () => ProgressBarSize,\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.id, true);\n\t\t},\n\t\tfileShortName(): string\n\t\t{\n\t\t\tconst NAME_MAX_LENGTH = 20;\n\n\t\t\treturn Utils.file.getShortFileName(this.file.name, NAME_MAX_LENGTH);\n\t\t},\n\t\tfileSize(): string\n\t\t{\n\t\t\treturn Utils.file.formatFileSize(this.file.size);\n\t\t},\n\t\ticonClass(): string\n\t\t{\n\t\t\tconst iconType = Utils.file.getIconTypeByFilename(this.file.name);\n\n\t\t\treturn `ui-icon-file-${iconType}`;\n\t\t},\n\t\tcanBeOpenedWithViewer(): boolean\n\t\t{\n\t\t\treturn this.file.viewerAttrs && BX.UI?.Viewer;\n\t\t},\n\t\tviewerAttributes(): Object\n\t\t{\n\t\t\treturn Utils.file.getViewerDataAttributes({\n\t\t\t\tviewerAttributes: this.file.viewerAttrs,\n\t\t\t\tpreviewImageSrc: this.file.urlPreview,\n\t\t\t\tcontext: FileViewerContext.dialog,\n\t\t\t});\n\t\t},\n\t\tisLoaded(): boolean\n\t\t{\n\t\t\treturn this.file.progress === 100;\n\t\t},\n\t\timageStyles(): {backgroundImage: string}\n\t\t{\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url(${this.file.urlPreview})`,\n\t\t\t};\n\t\t},\n\t\thasPreview(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.file.urlPreview);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tdownload()\n\t\t{\n\t\t\tif (this.file.progress !== 100 || this.canBeOpenedWithViewer)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.open(this.file.urlDownload, '_blank');\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\topenContextMenu(event: PointerEvent)\n\t\t{\n\t\t\tthis.$emit('openContextMenu', {\n\t\t\t\tevent,\n\t\t\t\tfileId: this.id,\n\t\t\t});\n\t\t},\n\t\tonCancelClick(event)\n\t\t{\n\t\t\tthis.$emit('cancelClick', event);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-base-file-item__container\">\n\t\t\t<div class=\"bx-im-base-file-item__viewer-container\" v-bind=\"viewerAttributes\" @click=\"download\">\n\t\t\t\t<div class=\"bx-im-base-file-item__icon-container\" ref=\"loader-icon\">\n\t\t\t\t\t<ProgressBar \n\t\t\t\t\t\tv-if=\"!isLoaded\" \n\t\t\t\t\t\t:item=\"file\"\n\t\t\t\t\t\t:size=\"ProgressBarSize.S\"\n\t\t\t\t\t\t@cancelClick=\"onCancelClick\"\n\t\t\t\t\t/>\n\t\t\t\t<div v-if=\"hasPreview\" :style=\"imageStyles\" class=\"bx-im-base-file-item__image\"></div>\n\t\t\t\t\t<div v-else :class=\"iconClass\" class=\"bx-im-base-file-item__type-icon ui-icon\"><i></i></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-base-file-item__content\">\n\t\t\t\t\t<span :title=\"file.name\" class=\"bx-im-base-file-item__title\">\n\t\t\t\t\t\t{{ fileShortName }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"bx-im-base-file-item__size\">{{ fileSize }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass=\"bx-im-base-file-item__download-icon\"\n\t\t\t\t:class=\"{'--not-active': !isLoaded}\"\n\t\t\t\t@click=\"openContextMenu\"\n\t\t\t></div>\n\t\t</div>\n\t`,\n};\n","import { DefaultMessageContent, MessageHeader, MessageFooter } from 'im.v2.component.message.elements';\nimport { BaseMessage } from 'im.v2.component.message.base';\nimport { FileType } from 'im.v2.const';\n\nimport { BaseFileContextMenu } from '../classes/base-file-context-menu';\nimport { BaseFileItem } from './items/base-file';\n\nimport '../css/base-file-message.css';\n\nimport type { ImModelMessage, ImModelFile } from 'im.v2.model';\n\n// @vue/component\nexport const BaseFileMessage = {\n\tname: 'BaseFileMessage',\n\tcomponents: {\n\t\tBaseMessage,\n\t\tDefaultMessageContent,\n\t\tBaseFileItem,\n\t\tMessageHeader,\n\t\tMessageFooter,\n\t},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['cancelClick'],\n\tcomputed:\n\t{\n\t\tFileType: () => FileType,\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tmessageFile(): ImModelFile\n\t\t{\n\t\t\tconst firstFileId = this.message.files[0];\n\n\t\t\treturn this.$store.getters['files/get'](firstFileId, true);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new BaseFileContextMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonOpenContextMenu({ event, fileId }: { event: PointerEvent, fileId: number })\n\t\t{\n\t\t\tconst context = { dialogId: this.dialogId, fileId, ...this.message };\n\t\t\tthis.contextMenu.openMenu(context, event.target);\n\t\t},\n\t\tonCancel(event)\n\t\t{\n\t\t\tthis.$emit('cancelClick', event);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BaseMessage :item=\"item\" :dialogId=\"dialogId\">\n\t\t\t<div class=\"bx-im-message-base-file__container\">\n\t\t\t\t<MessageHeader :withTitle=\"withTitle\" :item=\"item\" class=\"bx-im-message-base-file__author-title\" />\n\t\t\t\t<BaseFileItem\n\t\t\t\t\t:key=\"messageFile.id\"\n\t\t\t\t\t:id=\"messageFile.id\"\n\t\t\t\t\t:messageId=\"message.id\"\n\t\t\t\t\t@openContextMenu=\"onOpenContextMenu\"\n\t\t\t\t\t@cancelClick=\"onCancel\"\n\t\t\t\t/>\n\t\t\t\t<DefaultMessageContent :item=\"item\" :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t\t<MessageFooter :item=\"item\" :dialogId=\"dialogId\" />\n\t\t</BaseMessage>\n\t`,\n};\n","import { ExpandAnimation } from 'im.v2.component.animation';\nimport { TranscriptionStatus } from 'im.v2.const';\n\nimport '../../css/items/transcription.css';\n\nimport type { ImModelMessage, ImModelTranscription } from 'im.v2.model';\n\n// @vue/component\nexport const TranscriptionItem = {\n\tname: 'TranscriptionItem',\n\tcomponents: { ExpandAnimation },\n\tprops: {\n\t\tfile: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t\tisOpened: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\ttranscription(): ?ImModelTranscription\n\t\t{\n\t\t\treturn this.$store.getters['files/getTranscription'](this.file.id);\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\treturn this.isError\n\t\t\t\t? this.loc('IM_MESSAGE_FILE_AUDIO_TRANSCRIPTION_ERROR')\n\t\t\t\t: this.transcription.transcriptText;\n\t\t},\n\t\tisError(): boolean\n\t\t{\n\t\t\treturn this.transcription && this.transcription.status === TranscriptionStatus.ERROR;\n\t\t},\n\t\tshowDivider(): boolean\n\t\t{\n\t\t\treturn this.isOpened && Boolean(this.message.text);\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.messageId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(code: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(code);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-audio-player__transcription-container\">\n\t\t\t<ExpandAnimation>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isOpened\"\n\t\t\t\t\t:class=\"{'--error': isError}\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bx-im-audio-player__transcription-content\">\n\t\t\t\t\t\t{{ text }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</ExpandAnimation>\n\t\t\t<div v-if=\"showDivider\" class=\"bx-im-audio-player__transcription-divider\"></div>\n\t\t</div>\n\t`,\n};\n","import { BIcon, Outline as OutlineIcons } from 'ui.icon-set.api.vue';\n\nimport { Spinner, SpinnerSize } from 'im.v2.component.elements.loader';\nimport { Color, TranscriptionStatus } from 'im.v2.const';\nimport { MessageService } from 'im.v2.provider.service.message';\nimport { Feature, FeatureManager } from 'im.v2.lib.feature';\nimport { Analytics } from 'im.v2.lib.analytics';\n\nimport '../../css/items/transcription.css';\n\nimport type { ImModelTranscription } from 'im.v2.model';\n\n// @vue/component\nexport const TranscriptionButtonItem = {\n\tname: 'TranscriptionButtonItem',\n\tcomponents: { Spinner, BIcon },\n\tprops: {\n\t\tfile: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisOpened: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['transcriptionToggle'],\n\tcomputed:\n\t{\n\t\tSpinnerSize: () => SpinnerSize,\n\t\tOutlineIcons: () => OutlineIcons,\n\t\tColor: () => Color,\n\t\tfileId(): boolean\n\t\t{\n\t\t\treturn this.file.id;\n\t\t},\n\t\tchatId(): boolean\n\t\t{\n\t\t\treturn this.file.chatId;\n\t\t},\n\t\ttranscription(): ?ImModelTranscription\n\t\t{\n\t\t\treturn this.$store.getters['files/getTranscription'](this.fileId);\n\t\t},\n\t\tstatus(): TranscriptionStatus | null\n\t\t{\n\t\t\treturn this.transcription ? this.transcription.status : null;\n\t\t},\n\t\tisPending(): boolean\n\t\t{\n\t\t\treturn this.status === TranscriptionStatus.PENDING;\n\t\t},\n\t\tisSuccess(): boolean\n\t\t{\n\t\t\treturn this.status === TranscriptionStatus.SUCCESS;\n\t\t},\n\t\tbuttonIcon(): string\n\t\t{\n\t\t\treturn this.isOpened ? OutlineIcons.CHEVRON_TOP_M : OutlineIcons.TRANSCRIPTION;\n\t\t},\n\t\twithTranscription(): boolean\n\t\t{\n\t\t\treturn this.file.isTranscribable\n\t\t\t\t&& FeatureManager.isFeatureAvailable(Feature.aiFileTranscriptionAvailable)\n\t\t\t\t&& FeatureManager.isFeatureAvailable(Feature.copilotAvailable);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tstatus(newValue: TranscriptionStatus | null, oldValue: TranscriptionStatus | null)\n\t\t{\n\t\t\tif (oldValue === TranscriptionStatus.PENDING)\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().audioMessage.onViewTranscription(this.chatId, newValue);\n\t\t\t\tthis.open();\n\t\t\t}\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tasync onButtonClick(): Promise<void>\n\t\t{\n\t\t\tif (this.isPending)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isOpened)\n\t\t\t{\n\t\t\t\tthis.close();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isSuccess)\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().audioMessage.onViewTranscription(this.chatId, TranscriptionStatus.SUCCESS);\n\t\t\t\tthis.open();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst result = await this.transcribe();\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tthis.open();\n\t\t\t}\n\t\t},\n\t\tasync transcribe(): Promise<void>\n\t\t{\n\t\t\tconst messageService = new MessageService({ chatId: this.chatId });\n\n\t\t\treturn messageService.transcribe(this.fileId);\n\t\t},\n\t\topen(): void\n\t\t{\n\t\t\tthis.$emit('transcriptionToggle', true);\n\t\t},\n\t\tclose(): void\n\t\t{\n\t\t\tthis.$emit('transcriptionToggle', false);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"withTranscription\"\n\t\t\tclass=\"bx-im-audio-player__transcription-button-container\"\n\t\t>\n\t\t\t<button @click=\"onButtonClick\">\n\t\t\t\t<Spinner v-if=\"isPending\" :size=\"SpinnerSize.XXS\" />\n\t\t\t\t<BIcon\n\t\t\t\t\tv-else\n\t\t\t\t\t:name=\"buttonIcon\"\n\t\t\t\t\t:color=\"Color.accentBlue\"\n\t\t\t\t\t:size=\"20\"\n\t\t\t\t/>\n\t\t\t</button>\n\t\t</div>\n\t`,\n};\n","import { AudioPlayer } from 'im.v2.component.elements.audioplayer';\nimport { ProgressBar, ProgressBarSize } from 'im.v2.component.elements.progressbar';\n\nimport { TranscriptionItem } from './transcription';\nimport { TranscriptionButtonItem } from './transcription-button';\n\nimport '../../css/items/audio.css';\n\nimport type { ImModelFile } from 'im.v2.model';\n\n// @vue/component\nexport const AudioItem = {\n\tname: 'AudioItem',\n\tcomponents: { AudioPlayer, ProgressBar, TranscriptionItem, TranscriptionButtonItem },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['cancelClick'],\n\tdata(): { transcriptionStatus: boolean }\n\t{\n\t\treturn {\n\t\t\tisTranscriptionOpened: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tProgressBarSize: () => ProgressBarSize,\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\ttimelineType(): number\n\t\t{\n\t\t\treturn Math.floor(Math.random() * 5);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonCancelClick(event: PointerEvent): void\n\t\t{\n\t\t\tthis.$emit('cancelClick', event);\n\t\t},\n\t\ttranscriptionToggle(status: boolean): void\n\t\t{\n\t\t\tthis.isTranscriptionOpened = status;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-media-audio__container\">\n\t\t\t<ProgressBar \n\t\t\t\t:item=\"file\"\n\t\t\t\t:size=\"ProgressBarSize.S\"\n\t\t\t\t@cancelClick=\"onCancelClick\"\n\t\t\t/>\n\t\t\t<AudioPlayer\n\t\t\t\t:id=\"file.id\"\n\t\t\t\t:messageId=\"messageId\"\n\t\t\t\t:src=\"file.urlDownload\"\n\t\t\t\t:file=\"file\"\n\t\t\t\t:timelineType=\"timelineType\"\n\t\t\t\t:authorId=\"file.authorId\"\n\t\t\t\t:withContextMenu=\"false\"\n\t\t\t\t:withAvatar=\"false\"\n\t\t\t>\n\t\t\t\t<template #transcription-control>\n\t\t\t\t\t<TranscriptionButtonItem\n\t\t\t\t\t\t:file=\"file\"\n\t\t\t\t\t\t:isOpened=\"isTranscriptionOpened\"\n\t\t\t\t\t\t@transcriptionToggle=\"transcriptionToggle\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</AudioPlayer>\n\t\t\t<TranscriptionItem\n\t\t\t\t:file=\"file\"\n\t\t\t\t:isOpened=\"isTranscriptionOpened\"\n\t\t\t\t:messageId=\"messageId\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\n\nimport { DefaultMessageContent, MessageHeader, MessageFooter } from 'im.v2.component.message.elements';\nimport { BaseMessage } from 'im.v2.component.message.base';\nimport { FileType } from 'im.v2.const';\n\nimport { AudioItem } from './items/audio';\n\nimport '../css/audio-message.css';\n\nimport type { ImModelMessage, ImModelFile } from 'im.v2.model';\n\n// @vue/component\nexport const AudioMessage = {\n\tname: 'AudioMessage',\n\tcomponents: {\n\t\tBaseMessage,\n\t\tMessageHeader,\n\t\tMessageFooter,\n\t\tDefaultMessageContent,\n\t\tAudioItem,\n\t},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['cancelClick'],\n\tcomputed:\n\t{\n\t\tFileType: () => FileType,\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tmessageFile(): ImModelFile\n\t\t{\n\t\t\tconst firstFileId = this.message.files[0];\n\n\t\t\treturn this.$store.getters['files/get'](firstFileId, true);\n\t\t},\n\t\tcanSetReactions(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.message.id);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonCancel(event)\n\t\t{\n\t\t\tthis.$emit('cancelClick', event);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BaseMessage :item=\"item\" :dialogId=\"dialogId\">\n\t\t\t<div class=\"bx-im-message-audio__container\">\n\t\t\t\t<MessageHeader :withTitle=\"withTitle\" :item=\"item\" class=\"bx-im-message-audio__header\"/>\n\t\t\t\t<AudioItem\n\t\t\t\t\t:key=\"messageFile.id\"\n\t\t\t\t\t:item=\"messageFile\"\n\t\t\t\t\t:messageId=\"message.id\"\n\t\t\t\t\t@cancelClick=\"onCancel\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-message-audio__default-message-container\">\n\t\t\t\t<DefaultMessageContent :item=\"item\" :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t\t<MessageFooter :item=\"item\" :dialogId=\"dialogId\" />\n\t\t</BaseMessage>\n\t`,\n};\n","import { DefaultMessageContent, MessageHeader, MessageFooter } from 'im.v2.component.message.elements';\nimport { BaseMessage } from 'im.v2.component.message.base';\nimport { FileType } from 'im.v2.const';\n\nimport { BaseFileContextMenu } from '../classes/base-file-context-menu';\nimport { BaseFileItem } from './items/base-file';\n\nimport '../css/file-collection-message.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\nconst FILES_LIMIT = 10;\n\n// @vue/component\nexport const FileCollectionMessage = {\n\tname: 'FileCollectionMessage',\n\tcomponents: {\n\t\tBaseMessage,\n\t\tDefaultMessageContent,\n\t\tBaseFileItem,\n\t\tMessageHeader,\n\t\tMessageFooter,\n\t},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['cancelClick'],\n\tcomputed:\n\t{\n\t\tFileType: () => FileType,\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tmessageId(): string | number\n\t\t{\n\t\t\treturn this.message.id;\n\t\t},\n\t\tfileIds(): number[]\n\t\t{\n\t\t\treturn this.message.files.slice(0, FILES_LIMIT);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new BaseFileContextMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonOpenContextMenu({ event, fileId }: { event: PointerEvent, fileId: number })\n\t\t{\n\t\t\tconst context = { dialogId: this.dialogId, fileId, ...this.message };\n\t\t\tthis.contextMenu.openMenu(context, event.target);\n\t\t},\n\t\tonCancel(event)\n\t\t{\n\t\t\tthis.$emit('cancelClick', event);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BaseMessage :item=\"item\" :dialogId=\"dialogId\">\n\t\t\t<div class=\"bx-im-message-file-collection__container\">\n\t\t\t\t<MessageHeader :withTitle=\"withTitle\" :item=\"item\" class=\"bx-im-message-file-collection__author-title\" />\n\t\t\t\t<div class=\"bx-im-message-file-collection__items\">\n\t\t\t\t\t<BaseFileItem\n\t\t\t\t\t\tv-for=\"fileId in fileIds\"\n\t\t\t\t\t\t:key=\"fileId\"\n\t\t\t\t\t\t:id=\"fileId\"\n\t\t\t\t\t\t:messageId=\"messageId\"\n\t\t\t\t\t\t@openContextMenu=\"onOpenContextMenu\"\n\t\t\t\t\t\t@cancelClick=\"onCancel\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<DefaultMessageContent \n\t\t\t\t\t:item=\"item\" \n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\tclass=\"bx-im-message-file-collection__default-content\" \n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<MessageFooter :item=\"item\" :dialogId=\"dialogId\" />\n\t\t</BaseMessage>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { FileType } from 'im.v2.const';\nimport { UnsupportedMessage } from 'im.v2.component.message.unsupported';\nimport { UploadingService } from 'im.v2.provider.service.uploading';\nimport { UploaderFile } from 'ui.uploader.core';\n\nimport { MediaMessage } from './components/media-message';\nimport { BaseFileMessage } from './components/base-file-message';\nimport { AudioMessage } from './components/audio-message';\nimport { FileCollectionMessage } from './components/file-collection-message';\nimport { MediaContent } from './components/media-content';\n\nimport type { ImModelMessage, ImModelFile, ImModelChat } from 'im.v2.model';\n\nconst FileMessageType = Object.freeze({\n\tmedia: 'MediaMessage',\n\taudio: 'AudioMessage',\n\tbase: 'BaseFileMessage',\n\tcollection: 'FileCollectionMessage',\n});\n\n// @vue/component\nexport const FileMessage = {\n\tname: 'FileMessage',\n\tcomponents: {\n\t\tBaseFileMessage,\n\t\tMediaMessage,\n\t\tAudioMessage,\n\t\tUnsupportedMessage,\n\t\tFileCollectionMessage,\n\t},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tcontainerHeight: {\n\t\t\ttype: [Number, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tFileType: () => FileType,\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.item.id);\n\t\t},\n\t\tmessageFiles(): ImModelFile[]\n\t\t{\n\t\t\tconst files = [];\n\n\t\t\tif (this.message.files.length === 0)\n\t\t\t{\n\t\t\t\treturn files;\n\t\t\t}\n\n\t\t\tthis.message.files.forEach((fileId: number) => {\n\t\t\t\tconst file: ImModelFile = this.$store.getters['files/get'](fileId, true);\n\t\t\t\tfiles.push(file);\n\t\t\t});\n\n\t\t\treturn files;\n\t\t},\n\t\tisGallery(): boolean\n\t\t{\n\t\t\tconst allowedGalleryTypes: Set<string> = new Set([FileType.image, FileType.video]);\n\t\t\tconst isMediaOnly: boolean = this.messageFiles.every((file) => {\n\t\t\t\treturn allowedGalleryTypes.has(file.type);\n\t\t\t});\n\t\t\tconst hasImageProp: boolean = this.messageFiles.some((file) => {\n\t\t\t\treturn file.image !== false;\n\t\t\t});\n\n\t\t\treturn isMediaOnly && hasImageProp;\n\t\t},\n\t\tcomponentName(): string\n\t\t{\n\t\t\tif (this.messageFiles.length > 1)\n\t\t\t{\n\t\t\t\treturn this.isGallery ? FileMessageType.media : FileMessageType.collection;\n\t\t\t}\n\n\t\t\tconst file = this.messageFiles[0];\n\t\t\tconst hasPreview = Boolean(file.image);\n\n\t\t\tif (file.type === FileType.image && hasPreview)\n\t\t\t{\n\t\t\t\treturn FileMessageType.media;\n\t\t\t}\n\n\t\t\tif (file.type === FileType.audio)\n\t\t\t{\n\t\t\t\treturn FileMessageType.audio;\n\t\t\t}\n\n\t\t\tif (file.type === FileType.video && hasPreview)\n\t\t\t{\n\t\t\t\treturn FileMessageType.media;\n\t\t\t}\n\n\t\t\treturn FileMessageType.base;\n\t\t},\n\t\tisRealMessage(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/isRealMessage'](this.message.id);\n\t\t},\n\t},\n\tmethods: {\n\t\tonCancel(event: { file: ImModelFile })\n\t\t{\n\t\t\tconst canceledFileId: string = event.file.id;\n\t\t\tconst uploadingService: UploadingService = UploadingService.getInstance();\n\t\t\tconst uploaderId: string = uploadingService.getUploaderIdByFileId(canceledFileId);\n\n\t\t\tuploadingService.removeFileFromUploader({\n\t\t\t\tuploaderId,\n\t\t\t\tfilesIds: [canceledFileId],\n\t\t\t\trestartUploading: true,\n\t\t\t});\n\n\t\t\tconst uploaderFiles: Array<UploaderFile> = uploadingService.getFiles(uploaderId);\n\t\t\tif (Type.isArrayFilled(uploaderFiles))\n\t\t\t{\n\t\t\t\tconst actualMessageFiles: Array<string> = uploaderFiles.map((file: UploaderFile) => {\n\t\t\t\t\treturn file.getId();\n\t\t\t\t});\n\n\t\t\t\tvoid this.$store.dispatch('messages/update', {\n\t\t\t\t\tid: this.message.id,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tfiles: actualMessageFiles,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst chatId: number = this.message.chatId;\n\t\t\t\tvoid this.$store.dispatch('messages/delete', { id: this.message.id });\n\n\t\t\t\tconst chat: ImModelChat = this.$store.getters['chats/getByChatId'](chatId);\n\t\t\t\tconst lastMessageId: string | number | null = this.$store.getters['messages/findLastChatMessageId'](chatId);\n\n\t\t\t\tif (Type.isString(lastMessageId) || Type.isNumber(lastMessageId))\n\t\t\t\t{\n\t\t\t\t\tvoid this.$store.dispatch('recent/update', {\n\t\t\t\t\t\tid: chat.dialogId,\n\t\t\t\t\t\tfields: { messageId: lastMessageId },\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvoid this.$store.dispatch('recent/delete', {\n\t\t\t\t\t\tid: chat.dialogId,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<component \n\t\t\t:is=\"componentName\" \n\t\t\t:item=\"message\" \n\t\t\t:dialogId=\"dialogId\"\n\t\t\t:withTitle=\"withTitle\" \n\t\t\t:containerHeight=\"containerHeight\"\n\t\t\t:withContextMenu=\"isRealMessage\"\n\t\t\t@cancelClick=\"onCancel\"\n\t\t/>\n\t`,\n};\n\nexport { MediaContent };\n"],"names":["VIDEO_SIZE_TO_AUTOPLAY","MAX_WIDTH","MAX_HEIGHT","MIN_WIDTH","MIN_HEIGHT","DEFAULT_WIDTH","DEFAULT_HEIGHT","VideoItem","name","components","VideoPlayer","ProgressBar","props","id","type","String","Number","required","message","Object","emits","computed","messageItem","file","$store","getters","autoplay","size","canBeOpenedWithViewer","viewerAttrs","BX","UI","Viewer","viewerAttributes","Utils","getViewerDataAttributes","previewImageSrc","urlPreview","context","FileViewerContext","dialog","imageSize","newWidth","image","width","newHeight","height","aspectRatio","Math","round","sizes","max","isLoaded","progress","isForward","Type","isStringFilled","forward","methods","download","window","open","urlDownload","onCancelClick","event","$emit","getHandleStatus","FileStatus","preparing","upload","getStatusMap","iconClass","Outline","CLOUD","labelText","$Bitrix","Loc","getMessage","template","SINGLE_IMAGE_CONTAINER_MAX_SIZE","maxWidth","maxHeight","SINGLE_IMAGE_CONTAINER_MIN_SIZE","minWidth","minHeight","SINGLE_IMAGE_WITH_TEXT_CONTAINER_MAX_SIZE","SINGLE_IMAGE_WITH_TEXT_CONTAINER_MIN_SIZE","GALLERY_MAX_WIDTH","MediaContent","MessageStatus","MediaGallery","MediaGalleryItem","item","containerHeight","default","files","map","fileId","filesCount","length","firstFile","firstFileId","hasText","text","hasAttach","attach","onlyMedia","isSingleVideo","FileType","video","isSingleImage","singleImageMaxSize","isNumber","maxAllowedPreviewHeight","min","imageWithTextMaxSize","singleImageSize","calcPreviewSize","onCancel","options","adjustedWidth","adjustedHeight","scale","getGalleryMaxWidth","MAX_GALLERY_WIDTH","MAX_SINGLE_MEDIA_WIDTH","MediaMessage","ReactionList","BaseMessage","DefaultMessageContent","MessageHeader","MessageFooter","dialogId","withTitle","Boolean","fileIds","hasReply","replyId","hasError","error","showContextMenu","onlyImage","showBottomContainer","needBackground","isChannelPost","ChatType","channel","openChannel","includes","imageContainerStyles","BaseFileContextMenu","BaseMenu","constructor","PopupType","messageBaseFileMenu","diskService","DiskService","getMenuItems","getDownloadFileItem","getSaveToDiskItem","title","onClick","downloadFiles","menuInstance","close","bind","save","Notifier","onDiskSaveComplete","store","BaseFileItem","messageId","ProgressBarSize","fileShortName","NAME_MAX_LENGTH","getShortFileName","fileSize","formatFileSize","iconType","getIconTypeByFilename","imageStyles","backgroundImage","hasPreview","loc","phraseCode","replacements","openContextMenu","BaseFileMessage","messageFile","created","contextMenu","beforeUnmount","destroy","onOpenContextMenu","openMenu","target","TranscriptionItem","ExpandAnimation","isOpened","transcription","isError","transcriptText","status","TranscriptionStatus","ERROR","showDivider","code","TranscriptionButtonItem","Spinner","BIcon","SpinnerSize","OutlineIcons","Color","chatId","isPending","PENDING","isSuccess","SUCCESS","buttonIcon","CHEVRON_TOP_M","TRANSCRIPTION","withTranscription","isTranscribable","FeatureManager","isFeatureAvailable","Feature","aiFileTranscriptionAvailable","copilotAvailable","watch","newValue","oldValue","Analytics","getInstance","audioMessage","onViewTranscription","onButtonClick","result","transcribe","messageService","MessageService","AudioItem","AudioPlayer","data","isTranscriptionOpened","timelineType","floor","random","transcriptionToggle","AudioMessage","canSetReactions","FILES_LIMIT","FileCollectionMessage","slice","FileMessageType","freeze","media","audio","base","collection","FileMessage","UnsupportedMessage","messageFiles","forEach","push","isGallery","allowedGalleryTypes","Set","isMediaOnly","every","has","hasImageProp","some","componentName","isRealMessage","canceledFileId","uploadingService","UploadingService","uploaderId","getUploaderIdByFileId","removeFileFromUploader","filesIds","restartUploading","uploaderFiles","getFiles","isArrayFilled","actualMessageFiles","getId","dispatch","fields","chat","lastMessageId","isString"],"mappings":"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"}