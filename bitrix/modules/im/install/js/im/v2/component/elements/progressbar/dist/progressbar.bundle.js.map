{"version":3,"file":"progressbar.bundle.js","sources":["../src/helpers/format-progress-label.js","../src/progressbar.js"],"sourcesContent":["import { Loc } from 'main.core';\n\nconst SIZE_LOWER_THRESHOLD = 1024 * 1024 * 2;\n\nexport const formatProgressLabel = (progress: number, totalBytes: number): string => {\n\tif (totalBytes < SIZE_LOWER_THRESHOLD)\n\t{\n\t\treturn Loc.getMessage('IM_ELEMENTS_PROGRESSBAR_UPLOAD_LOADING');\n\t}\n\n\tconst bytesSent = (totalBytes / 100) * progress;\n\tconst megaBytesSent = `${convertBytesToMegaBytes(bytesSent)} ${Loc.getMessage('IM_ELEMENTS_PROGRESSBAR_SIZE_MB')}`;\n\tconst megaBytesTotal = `${convertBytesToMegaBytes(totalBytes)} ${Loc.getMessage('IM_ELEMENTS_PROGRESSBAR_SIZE_MB')}`;\n\n\treturn `${megaBytesSent} / ${megaBytesTotal}`;\n};\n\nconst convertBytesToMegaBytes = (bytes: number): number => {\n\treturn (bytes / 1024 / 1024).toFixed(2);\n};\n","import { BIcon, Outline as OutlineIcons } from 'ui.icon-set.api.vue';\n\nimport { FileStatus, Color } from 'im.v2.const';\n\nimport { formatProgressLabel } from './helpers/format-progress-label';\n\nimport './css/progressbar.css';\n\nimport type { ImModelFile } from 'im.v2.model';\n\nexport const ProgressBarSize = Object.freeze({\n\tS: 'S',\n\tL: 'L',\n});\n\nconst MIN_PROGRESS = 1; // Minimum progress to show the circle animation\n\n// @vue/component\nexport const ProgressBar = {\n\tname: 'ProgressBar',\n\tcomponents: { BIcon },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tsize: {\n\t\t\ttype: String,\n\t\t\tdefault: ProgressBarSize.L,\n\t\t},\n\t\thandleStatus: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => {\n\t\t\t\treturn [FileStatus.progress, FileStatus.upload];\n\t\t\t},\n\t\t},\n\t\t/**\n\t\t * @value {[status: string]: { iconClass: string, labelText: string }}\n\t\t */\n\t\tstatusMap: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => {\n\t\t\t\treturn {};\n\t\t\t},\n\t\t},\n\t},\n\temits: ['cancelClick'],\n\tcomputed: {\n\t\tColor: () => Color,\n\t\tOutlineIcons: () => OutlineIcons,\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tneedProgressBar(): boolean\n\t\t{\n\t\t\treturn this.handleStatus.includes(this.file.status);\n\t\t},\n\t\tprogressStyles(): { strokeDashoffset: number, strokeDasharray: number }\n\t\t{\n\t\t\tconst radius = 23;\n\t\t\tconst circumference = 2 * Math.PI * radius;\n\n\t\t\tconst adjustedProgress = Math.max(this.file.progress, MIN_PROGRESS);\n\t\t\tconst offset = circumference - (adjustedProgress / 100) * circumference;\n\n\t\t\treturn {\n\t\t\t\tstrokeDasharray: circumference,\n\t\t\t\tstrokeDashoffset: offset,\n\t\t\t};\n\t\t},\n\t\tlabelText(): string\n\t\t{\n\t\t\tif (this.statusMap?.[this.file.status]?.labelText)\n\t\t\t{\n\t\t\t\treturn this.statusMap?.[this.file.status]?.labelText;\n\t\t\t}\n\n\t\t\treturn formatProgressLabel(this.file.progress, this.file.size);\n\t\t},\n\t\ticonClass(): string\n\t\t{\n\t\t\tif (this.statusMap?.[this.file.status]?.iconClass)\n\t\t\t{\n\t\t\t\treturn this.statusMap[this.file.status].iconClass;\n\t\t\t}\n\n\t\t\treturn OutlineIcons.CROSS_L;\n\t\t},\n\t\tcontainerClass(): string\n\t\t{\n\t\t\treturn `--size-${this.size.toLowerCase()}`;\n\t\t},\n\t\tneedLabel(): boolean\n\t\t{\n\t\t\treturn this.size === ProgressBarSize.L;\n\t\t},\n\t\ticonSize(): number\n\t\t{\n\t\t\treturn this.size === ProgressBarSize.L ? 28 : 24;\n\t\t},\n\t},\n\tmethods: {\n\t\tonLoaderClick()\n\t\t{\n\t\t\tif (!this.handleStatus.includes(this.file.status))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('cancelClick', { file: this.file });\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tv-if=\"needProgressBar\"\n\t\t\t:class=\"containerClass\"\n\t\t\tclass=\"bx-im-progress-bar__container\" \n\t\t>\n\t\t\t<div class=\"bx-im-progress-bar__loader\" @click=\"onLoaderClick\">\n\t\t\t\t<svg viewBox=\"0 0 48 48\">\n\t\t\t\t\t<circle\n\t\t\t\t\t\t:style=\"progressStyles\"\n\t\t\t\t\t\tclass=\"bx-im-progress-bar__loader-progress\" \n\t\t\t\t\t\tcx=\"24\" \n\t\t\t\t\t\tcy=\"24\" \n\t\t\t\t\t\tr=\"23\"\n\t\t\t\t\t></circle>\n\t\t\t\t</svg>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"iconClass\"\n\t\t\t\t\t:color=\"Color.white\"\n\t\t\t\t\t:size=\"iconSize\"\n\t\t\t\t\tclass=\"bx-im-progress-bar__loader-icon\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-if=\"needLabel\" class=\"bx-im-progress-bar__label\">\n\t\t\t\t{{ labelText }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["SIZE_LOWER_THRESHOLD","formatProgressLabel","progress","totalBytes","Loc","getMessage","bytesSent","megaBytesSent","convertBytesToMegaBytes","megaBytesTotal","bytes","toFixed","ProgressBarSize","Object","freeze","S","L","MIN_PROGRESS","ProgressBar","name","components","BIcon","props","item","type","required","size","String","default","handleStatus","Array","FileStatus","upload","statusMap","emits","computed","Color","OutlineIcons","file","needProgressBar","includes","status","progressStyles","radius","circumference","Math","PI","adjustedProgress","max","offset","strokeDasharray","strokeDashoffset","labelText","iconClass","CROSS_L","containerClass","toLowerCase","needLabel","iconSize","methods","onLoaderClick","$emit","loc","phraseCode","$Bitrix","template"],"mappings":"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"}