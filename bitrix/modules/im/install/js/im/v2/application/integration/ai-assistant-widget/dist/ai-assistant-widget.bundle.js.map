{"version":3,"file":"ai-assistant-widget.bundle.js","sources":["../src/components/content/components/header.js","../src/components/content/chat-content.js","../src/components/ai-assistant-widget-chat-opener.js","../src/ai-assistant-widget.js"],"sourcesContent":["import { BIcon, Outline as OutlineIcons } from 'ui.icon-set.api.vue';\nimport { EventEmitter } from 'main.core.events';\n\nimport { ChatHeader } from 'im.v2.component.content.elements';\nimport { Color } from 'im.v2.const';\n\nimport '../css/header.css';\n\nconst MINIMIZE_EVENT_NAME = 'IM.AiAssistantWidget:minimize';\n\n// @vue/component\nexport const AiAssistantWidgetChatHeader = {\n\tname: 'AiAssistantWidgetChatHeader',\n\tcomponents: { ChatHeader, BIcon },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tcomputed: {\n\t\tOutlineIcons: () => OutlineIcons,\n\t\tColor: () => Color,\n\t},\n\tmethods: {\n\t\tonMinimize()\n\t\t{\n\t\t\tEventEmitter.emit(MINIMIZE_EVENT_NAME);\n\t\t},\n\t\tloc(phrase: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phrase);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ChatHeader\n\t\t\t:dialogId=\"dialogId\"\n\t\t\t:withCallButton=\"false\"\n\t\t\t:withSearchButton=\"false\"\n\t\t\t:withAddToChatButton=\"false\"\n\t\t>\n\t\t\t<template #before-actions>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"OutlineIcons.CROSS_L\"\n\t\t\t\t\t:hoverable=\"true\"\n\t\t\t\t\t:color=\"Color.base4\"\n\t\t\t\t\t:title=\"loc('IM_AI_ASSISTANT_WIDGET_MINIMIZE')\"\n\t\t\t\t\tclass=\"bx-im-ai-assistant-chat-header__icon\"\n\t\t\t\t\t@click=\"onMinimize\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</ChatHeader>\n\t`,\n};\n","import { EventEmitter, type BaseEvent } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\nimport { AiAssistantBotContent } from 'im.v2.component.content.chat';\nimport { NotifierShowMessageAction } from 'im.v2.lib.message-notifier';\n\nimport { AiAssistantWidgetChatHeader } from './components/header';\n\n// @vue/component\nexport const AiAssistantWidgetChatContent = {\n\tname: 'AiAssistantWidgetChatContent',\n\tcomponents: { AiAssistantWidgetChatHeader, AiAssistantBotContent },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\twithSidebar: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tEventEmitter.subscribe(EventType.notifier.onBeforeShowMessage, this.onBeforeNotificationShow);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.notifier.onBeforeShowMessage, this.onBeforeNotificationShow);\n\t},\n\tmethods:\n\t{\n\t\tonBeforeNotificationShow(event: BaseEvent<{ dialogId: string }>): $Values<typeof NotifierShowMessageAction>\n\t\t{\n\t\t\tconst eventData = event.getData();\n\t\t\tif (eventData.dialogId !== this.dialogId)\n\t\t\t{\n\t\t\t\treturn NotifierShowMessageAction.show;\n\t\t\t}\n\n\t\t\treturn NotifierShowMessageAction.skip;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<AiAssistantBotContent :dialogId=\"dialogId\" :withSidebar=\"withSidebar\">\n\t\t\t<template #header>\n\t\t\t\t<AiAssistantWidgetChatHeader :dialogId=\"dialogId\"/>\n\t\t\t</template>\n\t\t</AiAssistantBotContent>\n\t`,\n};\n","import 'im.v2.css.classes';\nimport { Logger } from 'im.v2.lib.logger';\nimport { ChatService } from 'im.v2.provider.service.chat';\n\nimport { AiAssistantWidgetChatContent } from './content/chat-content';\n\nimport type { ImModelChat } from 'im.v2.model';\n\nimport './css/ai-assistant-chat-opener.css';\n\n// @vue/component\nexport const AiAssistantWidgetChatOpener = {\n\tname: 'AiAssistantWidgetChatOpener',\n\tcomponents: { AiAssistantWidgetChatContent },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tcreated(): Promise\n\t{\n\t\treturn this.onChatOpen();\n\t},\n\tmethods: {\n\t\tasync onChatOpen()\n\t\t{\n\t\t\tif (this.dialog.inited)\n\t\t\t{\n\t\t\t\tLogger.warn(`AiAssistantChatOpener: chat ${this.chatId} is already loaded`);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.loadChat();\n\t\t},\n\t\tasync loadChat()\n\t\t{\n\t\t\tLogger.warn(`AiAssistantChatOpener: loading chat ${this.chatId}`);\n\t\t\tawait this.getChatService().loadChatWithMessages(this.dialogId);\n\t\t\tLogger.warn(`AiAssistantChatOpener: chat ${this.chatId} is loaded`);\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatSerivce = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatSerivce;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-messenger__scope bx-im-ai-assistant-chat-opener__container\">\n\t\t\t<AiAssistantWidgetChatContent :dialogId=\"dialogId\" :withSidebar=\"false\"/>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\n\nimport { AiAssistantWidgetChatOpener } from './components/ai-assistant-widget-chat-opener';\n\nimport type { RunActionError } from 'im.v2.lib.rest';\n\nconst APP_NAME = 'AiAssistantWidgetApplication';\n\ntype MountPayload = {\n\trootContainer: string | HTMLElement,\n\taiAssistantBotId: number,\n\tonError: (RunActionError[]) => void,\n};\n\nexport class AiAssistantWidgetApplication\n{\n\t#initPromise: Promise<AiAssistantWidgetApplication>;\n\n\tconstructor()\n\t{\n\t\tthis.#initPromise = this.#init();\n\t}\n\n\tready(): Promise\n\t{\n\t\treturn this.#initPromise;\n\t}\n\n\tasync mount(payload: MountPayload): Promise\n\t{\n\t\tawait this.ready();\n\n\t\tconst { rootContainer, aiAssistantBotId, onError } = payload;\n\t\tif (!rootContainer)\n\t\t{\n\t\t\treturn Promise.reject(new Error('Provide node or selector for root container'));\n\t\t}\n\n\t\tconst dialogId = aiAssistantBotId.toString();\n\n\t\treturn Core.createVue(this, {\n\t\t\tname: APP_NAME,\n\t\t\tel: rootContainer,\n\t\t\tonError,\n\t\t\tcomponents: { AiAssistantWidgetChatOpener },\n\t\t\ttemplate: `<AiAssistantWidgetChatOpener dialogId=\"${dialogId}\" />`,\n\t\t});\n\t}\n\n\tasync #init(): Promise<AiAssistantWidgetApplication>\n\t{\n\t\tawait Core.ready();\n\n\t\treturn this;\n\t}\n}\n"],"names":["MINIMIZE_EVENT_NAME","AiAssistantWidgetChatHeader","name","components","ChatHeader","BIcon","props","dialogId","type","String","default","computed","OutlineIcons","Color","methods","onMinimize","EventEmitter","emit","loc","phrase","$Bitrix","Loc","getMessage","template","AiAssistantWidgetChatContent","AiAssistantBotContent","withSidebar","Boolean","created","subscribe","EventType","notifier","onBeforeShowMessage","onBeforeNotificationShow","beforeUnmount","unsubscribe","event","eventData","getData","NotifierShowMessageAction","show","skip","AiAssistantWidgetChatOpener","required","dialog","$store","getters","chatId","onChatOpen","inited","Logger","warn","loadChat","getChatService","loadChatWithMessages","chatService","chatSerivce","ChatService","APP_NAME","AiAssistantWidgetApplication","constructor","ready","mount","payload","rootContainer","aiAssistantBotId","onError","Promise","reject","Error","toString","Core","createVue","el"],"mappings":"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"}