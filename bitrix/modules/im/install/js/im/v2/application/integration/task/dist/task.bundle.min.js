this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(t,e,a,n,s,i,r,o,d,h,l,c,g,C,p,u,m,v,b){"use strict";const I={name:"TaskChatHeader",components:{ChatHeader:m.ChatHeader,UserCounter:m.UserCounter,LineLoader:p.LineLoader,FadeAnimation:u.FadeAnimation},props:{dialogId:{type:String,default:""}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},isInited(){return this.dialog.inited}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<ChatHeader\n\t\t\t:dialogId="dialogId"\n\t\t\t:withAddToChatButton="false"\n\t\t>\n\t\t\t<template #left>\n\t\t\t\t<div class="bx-im-task-chat-header__left_container">\n\t\t\t\t\t<div class="bx-im-task-chat-header__avatar"></div>\n\t\t\t\t\t<div class="bx-im-task-chat-header__info">\n\t\t\t\t\t\t<div class="bx-im-task-chat-header__title">{{ loc('IM_TASK_CHAT_HEADER_TITLE') }}</div>\n\t\t\t\t\t\t<LineLoader v-if="!isInited" :width="50" :height="16" />\n\t\t\t\t\t\t<FadeAnimation :duration="100">\n\t\t\t\t\t\t\t<UserCounter v-if="isInited" :dialogId="dialogId" />\n\t\t\t\t\t\t</FadeAnimation>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ChatHeader>\n\t`};const f={name:"TaskChatContent",components:{BaseChatContent:m.BaseChatContent,TaskChatHeader:I,ChatDialog:g.ChatDialog,ChatTextarea:c.ChatTextarea},props:{dialogId:{type:String,default:""},withSidebar:{type:Boolean,default:true}},created(){l.EventEmitter.subscribe(v.EventType.notifier.onBeforeShowMessage,this.onBeforeNotificationShow)},beforeUnmount(){l.EventEmitter.unsubscribe(v.EventType.notifier.onBeforeShowMessage,this.onBeforeNotificationShow)},methods:{onBeforeNotificationShow(t){const e=t.getData();if(e.dialogId!==this.dialogId){return C.NotifierShowMessageAction.show}return C.NotifierShowMessageAction.skip}},template:`\n\t\t<BaseChatContent :dialogId="dialogId" :withSidebar="withSidebar">\n\t\t\t<template #header>\n\t\t\t\t<TaskChatHeader :dialogId="dialogId" />\n\t\t\t</template>\n\t\t\t<template #dialog>\n\t\t\t\t<ChatDialog\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t:key="dialogId"\n\t\t\t\t\t:reloadOnExit="false"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template #textarea="{ onTextareaMount }">\n\t\t\t\t<ChatTextarea\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t:key="dialogId"\n\t\t\t\t\t:withMarket="false"\n\t\t\t\t\t:withAutoFocus="false"\n\t\t\t\t\t@mounted="onTextareaMount"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</BaseChatContent>\n\t`};const k=()=>{const t=new b.DemoChatBuilder;const{dialogId:e}=t.addChat();t.addMessage({text:e,componentId:v.MessageComponent.taskChatCreationMessage});t.save();return e};const B={name:"TaskChatPlaceholder",components:{TaskChatContent:f},props:{taskId:{type:[Number,String],required:true}},data(){return{fakeDialogId:"",chatMembersCount:1}},computed:{containerClasses(){const t=this.$store.getters["application/settings/get"](v.Settings.appearance.alignment);return[`--${t}-align`]},backgroundStyle(){return h.ThemeManager.getCurrentBackgroundStyle()}},created(){this.fakeDialogId=k();this.bindEvents()},beforeUnmount(){this.unbindEvents()},methods:{bindEvents(){l.EventEmitter.subscribe(v.EventType.task.onMembersCountChange,this.onMembersCountChange)},unbindEvents(){l.EventEmitter.unsubscribe(v.EventType.task.onMembersCountChange,this.onMembersCountChange)},onMembersCountChange(t){const{taskId:e,userCounter:a}=t.getData();if(e!==this.taskId){return}this.$store.dispatch("chats/update",{dialogId:this.fakeDialogId,fields:{userCounter:a}})}},template:`\n\t\t<div class="bx-im-task-chat-placeholder__container bx-im-messenger__scope">\n\t\t\t<TaskChatContent :dialogId="fakeDialogId" :withSidebar="false" />\n\t\t\t<div class="bx-im-task-chat-placeholder__overlay"></div>\n\t\t</div>\n\t`};const M={name:"TaskChatOpener",components:{TaskChatContent:f,TaskChatPlaceholder:B},props:{chatId:{type:Number,required:true},chatType:{type:String,required:true}},computed:{dialog(){return this.$store.getters["chats/getByChatId"](this.chatId,true)},dialogId(){return this.dialog.dialogId}},created(){return this.onChatOpen()},methods:{async onChatOpen(){if(this.dialog.inited){o.Logger.warn(`TaskChatOpener: chat ${this.chatId} is already loaded`);return}await this.loadChat()},async loadChat(){o.Logger.warn(`TaskChatOpener: loading chat ${this.chatId}`);await this.getChatService().loadChatByChatId(this.chatId);o.Logger.warn(`TaskChatOpener: chat ${this.chatId} is loaded`)},getChatService(){if(!this.chatService){this.chatService=new d.ChatService}return this.chatService}},template:`\n\t\t<div class="bx-im-messenger__scope bx-im-task-chat-opener__container">\n\t\t\t<TaskChatContent :dialogId="dialogId" />\n\t\t</div>\n\t`};const y="TaskChatApplication";const T="TaskChatPlaceholderApplication";var w=babelHelpers.classPrivateFieldLooseKey("initPromise");var P=babelHelpers.classPrivateFieldLooseKey("init");var E=babelHelpers.classPrivateFieldLooseKey("initPull");class S{constructor(){Object.defineProperty(this,E,{value:_});Object.defineProperty(this,P,{value:X});Object.defineProperty(this,w,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,w)[w]=babelHelpers.classPrivateFieldLooseBase(this,P)[P]();babelHelpers.classPrivateFieldLooseBase(this,E)[E]()}ready(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w]}async mount(t){await this.ready();const{rootContainer:n,chatId:s,onError:i,type:r}=t;if(!n){return Promise.reject(new Error("Provide node or selector for root container"))}if(!r){return Promise.reject(new Error("Provide custom chat type name for task chat"))}const o=e.Text.toCamelCase(r);return a.Core.createVue(this,{name:y,el:n,onError:i,components:{TaskChatOpener:M},template:`<TaskChatOpener :chatId="${s}" chatType="${o}" />`})}async mountPlaceholder(t){await this.ready();const{rootContainer:e,taskId:n}=t;if(!e){return Promise.reject(new Error("Provide node or selector for root container"))}return a.Core.createVue(this,{name:T,el:e,components:{TaskChatPlaceholder:B},template:`<TaskChatPlaceholder :taskId="${n}" />`})}}async function X(){await a.Core.ready();return this}async function _(){await this.ready();a.Core.getPullClient().subscribe(new n.SidebarPullHandler)}t.TaskApplication=S})(this.BX.Messenger.v2.Application=this.BX.Messenger.v2.Application||{},BX,BX.Messenger.v2.Application,BX.Messenger.v2.Provider.Pull,BX.Messenger.v2.Css,BX.Messenger.v2.Css,BX.Messenger.v2.Css,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Event,BX.Messenger.v2.Component,BX.Messenger.v2.Component.Dialog,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.Animation,BX.Messenger.v2.Component.Content,BX.Messenger.v2.Const,BX.Messenger.v2.Lib);
//# sourceMappingURL=task.bundle.map.js