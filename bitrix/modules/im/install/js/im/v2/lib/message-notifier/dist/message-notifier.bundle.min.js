this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,i,a,o,r,l,n,c,d,b,p){"use strict";const v={chat:"im_chat",taskComments:"im_task_comments",lines:"im_lines",notify:"im_notify"};const f="-";const u={build(e){const{prefix:s}=e;if(s===v.notify){const{notifyId:t}=e;return`${s}${f}${t}`}const{dialogId:t,messageId:i}=e;return`${s}${f}${t}${f}${i}`},parse(e){const s=e.split(f);const[t]=s;if(t===v.notify){const[,e]=s;return{prefix:t,notifyId:e}}const[,i,a]=s;return{prefix:t,dialogId:i,messageId:a}}};var h=babelHelpers.classPrivateFieldLooseKey("message");var P=babelHelpers.classPrivateFieldLooseKey("chat");var g=babelHelpers.classPrivateFieldLooseKey("user");var y=babelHelpers.classPrivateFieldLooseKey("isLines");var L=babelHelpers.classPrivateFieldLooseKey("getId");var B=babelHelpers.classPrivateFieldLooseKey("getAvatarUrl");var F=babelHelpers.classPrivateFieldLooseKey("getText");class H{constructor(e){Object.defineProperty(this,F,{value:m});Object.defineProperty(this,B,{value:M});Object.defineProperty(this,L,{value:I});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});const{message:s,chat:t,user:i,isLines:a}=e;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=s;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=t;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=i;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=a}build(){return{id:babelHelpers.classPrivateFieldLooseBase(this,L)[L](),title:babelHelpers.classPrivateFieldLooseBase(this,P)[P].name,icon:babelHelpers.classPrivateFieldLooseBase(this,B)[B](),text:babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}}}function I(){const e=[{condition:()=>babelHelpers.classPrivateFieldLooseBase(this,y)[y],prefix:v.lines},{condition:()=>babelHelpers.classPrivateFieldLooseBase(this,P)[P].type===b.ChatType.taskComments,prefix:v.taskComments}];let s=v.chat;const t=e.find((e=>e.condition()===true));if(t){s=t.prefix}return u.build({prefix:s,dialogId:babelHelpers.classPrivateFieldLooseBase(this,P)[P].dialogId,messageId:babelHelpers.classPrivateFieldLooseBase(this,h)[h].id})}function M(){var e;return babelHelpers.classPrivateFieldLooseBase(this,P)[P].avatar||((e=babelHelpers.classPrivateFieldLooseBase(this,g)[g])==null?void 0:e.avatar)}function m(){let e="";if(babelHelpers.classPrivateFieldLooseBase(this,P)[P].type!==b.ChatType.user&&babelHelpers.classPrivateFieldLooseBase(this,g)[g]){e+=`${babelHelpers.classPrivateFieldLooseBase(this,g)[g].name}: `}e+=p.Parser.purifyMessage(babelHelpers.classPrivateFieldLooseBase(this,h)[h]);return e}const O="button_";const w={first:"1",second:"2"};const N={skip:"skip",show:"show"};var k=babelHelpers.classPrivateFieldLooseKey("instance");var T=babelHelpers.classPrivateFieldLooseKey("store");var A=babelHelpers.classPrivateFieldLooseKey("notificationService");var C=babelHelpers.classPrivateFieldLooseKey("prepareNotificationOptions");var j=babelHelpers.classPrivateFieldLooseKey("subscribeToNotifierEvents");var K=babelHelpers.classPrivateFieldLooseKey("onNotifierAction");var S=babelHelpers.classPrivateFieldLooseKey("onNotifierQuickAnswer");var X=babelHelpers.classPrivateFieldLooseKey("onNotifierButtonClick");var D=babelHelpers.classPrivateFieldLooseKey("sendButtonAction");var x=babelHelpers.classPrivateFieldLooseKey("isConfirmButtonAction");var _=babelHelpers.classPrivateFieldLooseKey("extractButtonNumber");var E=babelHelpers.classPrivateFieldLooseKey("extractButtonParams");var $=babelHelpers.classPrivateFieldLooseKey("isChatOpened");var R=babelHelpers.classPrivateFieldLooseKey("playOpenedChatMessageSound");var W=babelHelpers.classPrivateFieldLooseKey("playMessageSound");var Y=babelHelpers.classPrivateFieldLooseKey("flashDesktopIcon");var V=babelHelpers.classPrivateFieldLooseKey("shouldSkipNotification");class Q{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,k)[k]){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=new this}return babelHelpers.classPrivateFieldLooseBase(this,k)[k]}static init(){Q.getInstance()}constructor(){Object.defineProperty(this,V,{value:le});Object.defineProperty(this,Y,{value:re});Object.defineProperty(this,W,{value:oe});Object.defineProperty(this,R,{value:ae});Object.defineProperty(this,$,{value:ie});Object.defineProperty(this,E,{value:te});Object.defineProperty(this,_,{value:se});Object.defineProperty(this,x,{value:ee});Object.defineProperty(this,D,{value:Z});Object.defineProperty(this,X,{value:J});Object.defineProperty(this,S,{value:G});Object.defineProperty(this,K,{value:z});Object.defineProperty(this,j,{value:q});Object.defineProperty(this,C,{value:U});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,A,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,T)[T]=r.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,A)[A]=new d.NotificationService;babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}async handleIncomingMessage(e){const{isImportant:s,dialogId:t}=e;if(await babelHelpers.classPrivateFieldLooseBase(this,V)[V](t)){babelHelpers.classPrivateFieldLooseBase(this,R)[R](s);return}babelHelpers.classPrivateFieldLooseBase(this,W)[W](s);babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]();Q.getInstance().showMessage(e)}handleIncomingNotification(e){const{notificationId:s,userId:t,isSilent:i}=e;const a=babelHelpers.classPrivateFieldLooseBase(this,T)[T].getters["notifications/getById"](s);const r=babelHelpers.classPrivateFieldLooseBase(this,T)[T].getters["users/get"](t);if(!i){o.SoundNotificationManager.getInstance().playOnce(b.SoundType.reminder)}babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]();Q.getInstance().showNotification(a,r)}showMessage(e){const{messageId:s,dialogId:t,isLines:i}=e;const o=babelHelpers.classPrivateFieldLooseBase(this,T)[T].getters["messages/getById"](s);const r=babelHelpers.classPrivateFieldLooseBase(this,T)[T].getters["chats/get"](t,true);const n=babelHelpers.classPrivateFieldLooseBase(this,T)[T].getters["users/get"](o.authorId);const c=new H({message:o,chat:r,user:n,isLines:i});const d=c.build();const b=l.DesktopManager.isChatWindow()&&document.hasFocus();if(b){a.Notifier.notifyViaBrowserProvider(d)}else{a.Notifier.notify(d)}}showNotification(e,t){let i=s.Loc.getMessage("IM_LIB_NOTIFIER_NOTIFY_SYSTEM_TITLE");if(e.title){i=e.title}else if(t){i=t.name}const o=babelHelpers.classPrivateFieldLooseBase(this,C)[C](i,e,t);const r=l.DesktopManager.isChatWindow()&&document.hasFocus();if(r){a.Notifier.notifyViaBrowserProvider(o)}else{a.Notifier.notify(o)}}onNotifierClick(e){const{id:s}=e;const{prefix:t,dialogId:i}=u.parse(s);if(t===v.chat){void c.Messenger.openChat(i)}else if(t===v.taskComments){void c.Messenger.openTaskComments(i)}else if(t===v.lines){void c.Messenger.openLines(i)}else if(t===v.notify){void c.Messenger.openNotifications()}}}function U(e,t,i){var a;const o=u.build({prefix:v.notify,notifyId:t.id});const r={id:o,title:e,icon:i?i.avatar:"",text:p.Parser.purifyNotification(t)};if(t.sectionCode===b.NotificationTypesCodes.confirm){const[e,s]=t.notifyButtons;r.button1Text=e.TEXT;r.button2Text=s.TEXT}else if(((a=t.params)==null?void 0:a.canAnswer)==="Y"){r.inputPlaceholderText=s.Loc.getMessage("IM_LIB_NOTIFIER_NOTIFY_REPLY_PLACEHOLDER")}return r}function q(){a.Notifier.subscribe("click",(async e=>{if(!n.DesktopApi.isAirDesignEnabledInDesktop()){n.DesktopApi.activateWindow();this.onNotifierClick(e.getData());return}await n.DesktopApi.showBrowserWindow();if(n.DesktopApi.isFeatureSupported(n.DesktopFeature.portalTabActivation.id)){await n.DesktopApi.handlePortalTabActivation()}l.DesktopBroadcastManager.getInstance().sendActionMessage({action:b.DesktopBroadcastAction.notification,params:e.getData()})}));a.Notifier.subscribe("action",(e=>{babelHelpers.classPrivateFieldLooseBase(this,K)[K](e.getData())}))}function z(e){const{id:s,action:t,userInput:i}=e;const{prefix:a,notifyId:o}=u.parse(s);if(a!==v.notify){return}const r=babelHelpers.classPrivateFieldLooseBase(this,T)[T].getters["notifications/getById"](o);if(i){babelHelpers.classPrivateFieldLooseBase(this,S)[S](r,i)}else if(babelHelpers.classPrivateFieldLooseBase(this,x)[x](t,r)){babelHelpers.classPrivateFieldLooseBase(this,X)[X](t,r)}}function G(e,s){babelHelpers.classPrivateFieldLooseBase(this,A)[A].sendQuickAnswer({id:e.id,text:s})}function J(e,s){const[t,i]=s.notifyButtons;const a=babelHelpers.classPrivateFieldLooseBase(this,_)[_](e);if(a===w.first){babelHelpers.classPrivateFieldLooseBase(this,D)[D](s,t)}else if(a===w.second){babelHelpers.classPrivateFieldLooseBase(this,D)[D](s,i)}}function Z(e,s){const[t,i]=babelHelpers.classPrivateFieldLooseBase(this,E)[E](s);babelHelpers.classPrivateFieldLooseBase(this,A)[A].sendConfirmAction(t,i)}function ee(e,s){const t=s.sectionCode;return e.startsWith(O)&&t===b.NotificationTypesCodes.confirm}function se(e){return e.split("_")[1]}function te(e){return e.COMMAND_PARAMS.split("|")}function ie(e){const s=babelHelpers.classPrivateFieldLooseBase(this,T)[T].getters["application/isChatOpen"](e);return Boolean(document.hasFocus()&&s)}function ae(e){if(e){o.SoundNotificationManager.getInstance().forcePlayOnce(b.SoundType.newMessage2);return}o.SoundNotificationManager.getInstance().playOnce(b.SoundType.newMessage2)}function oe(e){if(e){o.SoundNotificationManager.getInstance().forcePlayOnce(b.SoundType.newMessage1);return}o.SoundNotificationManager.getInstance().playOnce(b.SoundType.newMessage1)}function re(){if(!l.DesktopManager.isDesktop()){return}n.DesktopApi.flashIcon()}async function le(e){if(babelHelpers.classPrivateFieldLooseBase(this,$)[$](e)){return true}const s=await t.EventEmitter.emitAsync(b.EventType.notifier.onBeforeShowMessage,{dialogId:e});return s.includes(N.skip)}Object.defineProperty(Q,k,{writable:true,value:void 0});e.NotifierShowMessageAction=N;e.MessageNotifierManager=Q})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Event,BX.Vue3.Vuex,BX.UI.NotificationManager,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Const,BX.Messenger.v2.Lib);
//# sourceMappingURL=message-notifier.bundle.map.js