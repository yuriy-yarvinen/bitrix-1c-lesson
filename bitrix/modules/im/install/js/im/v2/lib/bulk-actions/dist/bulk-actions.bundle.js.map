{"version":3,"file":"bulk-actions.bundle.js","sources":["../src/bulk-actions.js"],"sourcesContent":["import { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\nimport { Core } from 'im.v2.application.core';\nimport { EscEventAction } from 'im.v2.lib.esc-manager';\n\nexport class BulkActionsManager\n{\n\tstatic #instance: BulkActionsManager;\n\n\tstatic getInstance(): BulkActionsManager\n\t{\n\t\tif (!this.#instance)\n\t\t{\n\t\t\tthis.#instance = new this();\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n\n\tstatic init()\n\t{\n\t\tBulkActionsManager.getInstance();\n\t}\n\n\tconstructor()\n\t{\n\t\tEventEmitter.subscribe(EventType.dialog.openBulkActionsMode, this.enableBulkMode.bind(this));\n\t\tEventEmitter.subscribe(EventType.dialog.closeBulkActionsMode, this.disableBulkMode.bind(this));\n\n\t\tthis.keyPressHandler = this.#onKeyPressCloseBulkActions.bind(this);\n\t}\n\n\tenableBulkMode(event: BaseEvent<{messageId: number, dialogId: string}>)\n\t{\n\t\tconst { messageId, dialogId } = event.getData();\n\n\t\tvoid Core.getStore().dispatch('messages/select/enableBulkMode', {\n\t\t\tmessageId,\n\t\t\tdialogId,\n\t\t});\n\n\t\tthis.#bindEscHandler();\n\t}\n\n\tdisableBulkMode(event: BaseEvent<{dialogId: string}>)\n\t{\n\t\tconst { dialogId } = event.getData();\n\n\t\tvoid Core.getStore().dispatch('messages/select/disableBulkMode', {\n\t\t\tdialogId,\n\t\t});\n\n\t\tthis.#unbindEscHandler();\n\t}\n\n\tclearCollection()\n\t{\n\t\tvoid Core.getStore().dispatch('messages/select/clearCollection');\n\n\t\tthis.#unbindEscHandler();\n\t}\n\n\t#bindEscHandler()\n\t{\n\t\tEventEmitter.subscribe(EventType.key.onBeforeEscape, this.keyPressHandler);\n\t}\n\n\t#unbindEscHandler()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.key.onBeforeEscape, this.keyPressHandler);\n\t}\n\n\t#onKeyPressCloseBulkActions(): $Values<typeof EscEventAction>\n\t{\n\t\tthis.clearCollection();\n\n\t\treturn EscEventAction.handled;\n\t}\n}\n"],"names":["BulkActionsManager","getInstance","init","constructor","EventEmitter","subscribe","EventType","dialog","openBulkActionsMode","enableBulkMode","bind","closeBulkActionsMode","disableBulkMode","keyPressHandler","event","messageId","dialogId","getData","Core","getStore","dispatch","clearCollection","key","onBeforeEscape","unsubscribe","EscEventAction","handled"],"mappings":";;;;;;;CAIuD;CAAA;CAAA;CAAA;AAEvD,CAAO,MAAMA,kBAAkB,CAC/B;GAGC,OAAOC,WAAW,GAClB;KACC,IAAI,yCAAC,IAAI,uBAAU,EACnB;OACC,4CAAI,0BAAa,IAAI,IAAI,EAAE;;KAG5B,+CAAO,IAAI;;GAGZ,OAAOC,IAAI,GACX;KACCF,kBAAkB,CAACC,WAAW,EAAE;;GAGjCE,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KACCC,6BAAY,CAACC,SAAS,CAACC,qBAAS,CAACC,MAAM,CAACC,mBAAmB,EAAE,IAAI,CAACC,cAAc,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;KAC5FN,6BAAY,CAACC,SAAS,CAACC,qBAAS,CAACC,MAAM,CAACI,oBAAoB,EAAE,IAAI,CAACC,eAAe,CAACF,IAAI,CAAC,IAAI,CAAC,CAAC;KAE9F,IAAI,CAACG,eAAe,GAAG,4CAAI,4DAA6BH,IAAI,CAAC,IAAI,CAAC;;GAGnED,cAAc,CAACK,KAAuD,EACtE;KACC,MAAM;OAAEC,SAAS;OAAEC;MAAU,GAAGF,KAAK,CAACG,OAAO,EAAE;KAE/C,KAAKC,2BAAI,CAACC,QAAQ,EAAE,CAACC,QAAQ,CAAC,gCAAgC,EAAE;OAC/DL,SAAS;OACTC;MACA,CAAC;KAEF,4CAAI;;GAGLJ,eAAe,CAACE,KAAoC,EACpD;KACC,MAAM;OAAEE;MAAU,GAAGF,KAAK,CAACG,OAAO,EAAE;KAEpC,KAAKC,2BAAI,CAACC,QAAQ,EAAE,CAACC,QAAQ,CAAC,iCAAiC,EAAE;OAChEJ;MACA,CAAC;KAEF,4CAAI;;GAGLK,eAAe,GACf;KACC,KAAKH,2BAAI,CAACC,QAAQ,EAAE,CAACC,QAAQ,CAAC,iCAAiC,CAAC;KAEhE,4CAAI;;CAmBN;CAAC,4BAfA;GACChB,6BAAY,CAACC,SAAS,CAACC,qBAAS,CAACgB,GAAG,CAACC,cAAc,EAAE,IAAI,CAACV,eAAe,CAAC;CAC3E;CAAC,8BAGD;GACCT,6BAAY,CAACoB,WAAW,CAAClB,qBAAS,CAACgB,GAAG,CAACC,cAAc,EAAE,IAAI,CAACV,eAAe,CAAC;CAC7E;CAAC,wCAGD;GACC,IAAI,CAACQ,eAAe,EAAE;GAEtB,OAAOI,mCAAc,CAACC,OAAO;CAC9B;CAAC,sBAxEW1B,kBAAkB;GAAA;GAAA;CAAA;;;;;;;;"}