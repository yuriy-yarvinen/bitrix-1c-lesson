{"version":3,"file":"navigation.bundle.js","sources":["../src/navigation.js"],"sourcesContent":["import { FeaturePromoter } from 'ui.info-helper';\n\nimport { Layout, SliderCode, NavigationMenuItem } from 'im.v2.const';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { Feature, FeatureManager } from 'im.v2.lib.feature';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { PhoneManager } from 'im.v2.lib.phone';\nimport { Utils } from 'im.v2.lib.utils';\nimport { MarketManager } from 'im.v2.lib.market';\n\nconst customClickHandler = {\n\t[NavigationMenuItem.copilot]: onCopilotClick,\n\t[NavigationMenuItem.call]: onCallClick,\n\t[NavigationMenuItem.timemanager]: onTimeManagerClick,\n\t[NavigationMenuItem.homepage]: onHomepageClick,\n\t[NavigationMenuItem.market]: onMarketClick,\n};\n\nexport type NavigationMenuItemParams = {\n\tid: string,\n\tentityId?: string,\n\ttarget?: HTMLElement,\n};\n\nexport const NavigationManager = {\n\topen(menuItem: NavigationMenuItemParams): void\n\t{\n\t\tconst { id, entityId } = menuItem;\n\t\tif (!NavigationMenuItem[id])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (customClickHandler[id])\n\t\t{\n\t\t\tcustomClickHandler[id](menuItem);\n\n\t\t\treturn;\n\t\t}\n\n\t\tchangeLayout({\n\t\t\tlayoutName: id,\n\t\t\tlayoutEntityId: entityId,\n\t\t});\n\t},\n\tisLayout(id: string): boolean\n\t{\n\t\treturn Boolean(Layout[id]);\n\t},\n\tisMarketApp(payload: NavigationMenuItemParams): boolean\n\t{\n\t\tconst { id, entityId } = payload;\n\t\tconst isMarketMenuItem = id === NavigationMenuItem.market;\n\n\t\treturn isMarketMenuItem && Boolean(entityId);\n\t},\n};\n\nfunction onCopilotClick(payload: NavigationMenuItemParams)\n{\n\tif (!FeatureManager.isFeatureAvailable(Feature.copilotActive))\n\t{\n\t\tconst promoter = new FeaturePromoter({ code: SliderCode.copilotDisabled });\n\t\tpromoter.show();\n\t\tAnalytics.getInstance().copilot.onOpenTab({ isAvailable: false });\n\n\t\treturn;\n\t}\n\n\tchangeLayout({\n\t\tlayoutName: Layout.copilot,\n\t\tlayoutEntityId: payload.entityId,\n\t});\n}\n\nfunction onCallClick(payload: NavigationMenuItemParams)\n{\n\tconst KEYPAD_OFFSET_TOP = -30;\n\tconst KEYPAD_OFFSET_LEFT = 64;\n\n\tPhoneManager.getInstance().openKeyPad({\n\t\tbindElement: payload?.target,\n\t\toffsetTop: KEYPAD_OFFSET_TOP,\n\t\toffsetLeft: KEYPAD_OFFSET_LEFT,\n\t});\n}\n\nfunction onTimeManagerClick()\n{\n\tBX.Timeman?.Monitor?.openReport();\n}\n\nfunction onHomepageClick()\n{\n\tUtils.browser.openLink('/');\n}\n\nfunction onMarketClick(payload: NavigationMenuItemParams)\n{\n\tconst { entityId } = payload;\n\tif (entityId)\n\t{\n\t\tchangeLayout({\n\t\t\tlayoutName: Layout.market,\n\t\t\tlayoutEntityId: entityId,\n\t\t});\n\n\t\treturn;\n\t}\n\n\tMarketManager.openMarketplace();\n}\n\nfunction handleMenuItem(payload: NavigationMenuItemParams): void\n{\n\tconst { id: layoutName, entityId: layoutEntityId, asLink } = payload;\n\tif (asLink)\n\t{\n\t\topenLink({ layoutName, layoutEntityId });\n\n\t\treturn;\n\t}\n\n\tchangeLayout({ layoutName, layoutEntityId });\n}\n\nfunction openLink({ layoutName, layoutEntityId }: LayoutParams): void\n{\n\tconst LayoutToUrlConfigMap: Record<string, { paramName: string, useParamByDefault: boolean, canUseId: boolean }> = {\n\t\t[NavigationMenuItem.chat]: {\n\t\t\tparamName: GetParameter.openChat,\n\t\t\tuseParamByDefault: false,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.copilot]: {\n\t\t\tparamName: GetParameter.openCopilotChat,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.collab]: {\n\t\t\tparamName: GetParameter.openCollab,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.channel]: {\n\t\t\tparamName: GetParameter.openChannel,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.tasksTask]: {\n\t\t\tparamName: GetParameter.openTaskComments,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.openlines]: {\n\t\t\tparamName: GetParameter.openLines,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.notification]: {\n\t\t\tparamName: GetParameter.openNotifications,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: false,\n\t\t},\n\t\t[NavigationMenuItem.settings]: {\n\t\t\tparamName: GetParameter.openSettings,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: false,\n\t\t},\n\t};\n\n\tconst basePath = Path.online;\n\tconst urlConfig = LayoutToUrlConfigMap[layoutName];\n\tif (!urlConfig)\n\t{\n\t\treturn;\n\t}\n}\n\nfunction changeLayout({ layoutName, layoutEntityId }: { layoutName: string, layoutEntityId?: string | number })\n{\n\tconst layoutManager = LayoutManager.getInstance();\n\tif (!layoutManager.isValidLayout(layoutName))\n\t{\n\t\treturn;\n\t}\n\n\tlet entityId = layoutEntityId;\n\n\tconst lastOpenedElement = layoutManager.getLastOpenedElement(layoutName);\n\tif (!entityId && lastOpenedElement)\n\t{\n\t\tentityId = lastOpenedElement;\n\t}\n\n\tvoid layoutManager.setLayout({ name: layoutName, entityId });\n}\n"],"names":["customClickHandler","NavigationMenuItem","copilot","onCopilotClick","call","onCallClick","timemanager","onTimeManagerClick","homepage","onHomepageClick","market","onMarketClick","NavigationManager","open","menuItem","id","entityId","changeLayout","layoutName","layoutEntityId","isLayout","Boolean","Layout","isMarketApp","payload","isMarketMenuItem","FeatureManager","isFeatureAvailable","Feature","copilotActive","promoter","FeaturePromoter","code","SliderCode","copilotDisabled","show","Analytics","getInstance","onOpenTab","isAvailable","KEYPAD_OFFSET_TOP","KEYPAD_OFFSET_LEFT","PhoneManager","openKeyPad","bindElement","target","offsetTop","offsetLeft","BX","Timeman","Monitor","openReport","Utils","browser","openLink","MarketManager","openMarketplace","layoutManager","LayoutManager","isValidLayout","lastOpenedElement","getLastOpenedElement","setLayout","name"],"mappings":"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"}