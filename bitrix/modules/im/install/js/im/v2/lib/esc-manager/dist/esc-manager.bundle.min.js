this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,r,i,n,l,o,c,d,b,v){"use strict";const u=".bx-im-messenger__container";const p=Object.freeze({handled:"handled",ignored:"ignored"});var h=babelHelpers.classPrivateFieldLooseKey("messengerContainer");var y=babelHelpers.classPrivateFieldLooseKey("wasKeyDownHandled");var P=babelHelpers.classPrivateFieldLooseKey("instance");var L=babelHelpers.classPrivateFieldLooseKey("shouldIgnoreEscape");var f=babelHelpers.classPrivateFieldLooseKey("isHandledBySubscriber");var g=babelHelpers.classPrivateFieldLooseKey("handleActiveInput");var B=babelHelpers.classPrivateFieldLooseKey("handleLayoutClear");var H=babelHelpers.classPrivateFieldLooseKey("handleMessengerSliderClose");var F=babelHelpers.classPrivateFieldLooseKey("handleDesktopAction");var E=babelHelpers.classPrivateFieldLooseKey("onKeyUp");var M=babelHelpers.classPrivateFieldLooseKey("onKeyDown");var m=babelHelpers.classPrivateFieldLooseKey("getMessengerContainer");var X=babelHelpers.classPrivateFieldLooseKey("switchToChatLayout");var O=babelHelpers.classPrivateFieldLooseKey("isExternalSliderOpened");var w=babelHelpers.classPrivateFieldLooseKey("handleChannelComments");class C{constructor(){Object.defineProperty(this,w,{value:W});Object.defineProperty(this,O,{value:V});Object.defineProperty(this,X,{value:x});Object.defineProperty(this,m,{value:T});Object.defineProperty(this,M,{value:U});Object.defineProperty(this,E,{value:A});Object.defineProperty(this,F,{value:D});Object.defineProperty(this,H,{value:S});Object.defineProperty(this,B,{value:I});Object.defineProperty(this,g,{value:k});Object.defineProperty(this,f,{value:j});Object.defineProperty(this,L,{value:K});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:false});this.keyUpEventHandler=babelHelpers.classPrivateFieldLooseBase(this,E)[E].bind(this);this.keyDownEventHandler=babelHelpers.classPrivateFieldLooseBase(this,M)[M].bind(this)}static getInstance(){var e;babelHelpers.classPrivateFieldLooseBase(C,P)[P]=(e=babelHelpers.classPrivateFieldLooseBase(C,P)[P])!=null?e:new C;return babelHelpers.classPrivateFieldLooseBase(C,P)[P]}register(){babelHelpers.classPrivateFieldLooseBase(this,h)[h]=babelHelpers.classPrivateFieldLooseBase(this,m)[m]();s.Event.bind(document,"keyup",this.keyUpEventHandler);s.Event.bind(document,"keydown",this.keyDownEventHandler)}unregister(){babelHelpers.classPrivateFieldLooseBase(this,h)[h]=babelHelpers.classPrivateFieldLooseBase(this,m)[m]();s.Event.unbind(document,"keyup",this.keyUpEventHandler);s.Event.unbind(document,"keydown",this.keyDownEventHandler)}async handleEsc(){if(babelHelpers.classPrivateFieldLooseBase(this,y)[y]){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=false;return}if(babelHelpers.classPrivateFieldLooseBase(this,L)[L]()){return}if(await babelHelpers.classPrivateFieldLooseBase(this,f)[f]()){return}if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]()){return}if(babelHelpers.classPrivateFieldLooseBase(this,w)[w]()){return}if(babelHelpers.classPrivateFieldLooseBase(this,B)[B]()){return}if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]()){return}babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}}function K(){const e=n.CallManager.getInstance().hasVisibleCall();const s=a.PopupWindowManager.isAnyPopupShown();return e||s||babelHelpers.classPrivateFieldLooseBase(this,O)[O]()}async function j(){const e=await t.EventEmitter.emitAsync(o.EventType.key.onBeforeEscape);return e.includes(p.handled)}function k(){const{activeElement:e}=document;if(!e){return false}const s=babelHelpers.classPrivateFieldLooseBase(this,h)[h].contains(e);const t=e.matches("input");if(s&&t){e.blur();return true}return false}function I(){const e=c.LayoutManager.getInstance();const s=e.getLayout();const t=e.isChatLayout(s.name);const a=t&&s.entityId==="";if(a){return false}if(t){e.clearCurrentLayoutEntityId()}else{babelHelpers.classPrivateFieldLooseBase(this,X)[X]()}return true}function S(){const e=d.MessengerSlider.getInstance();if(e.getCurrent()&&e.isFocused()){e.getCurrent().close();return true}return false}function D(){if(!b.DesktopManager.isDesktop()){return false}v.DesktopApi.hideWindow();return true}function A(e){if(!i.Utils.key.isCombination(e,"Escape")){return}void this.handleEsc()}function U(){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=BX.UI.Viewer.Instance.isOpen()}function T(){return document.querySelector(u)}function x(){void c.LayoutManager.getInstance().setLayout({name:o.Layout.chat,entityId:""})}function V(){const e=c.LayoutManager.getInstance().isEmbeddedMode();if(e){return r.SidePanel.Instance.getOpenSlidersCount()>0}return!d.MessengerSlider.getInstance().isFocused()}function W(){const e=l.Core.getStore().getters["messages/comments/areOpened"];if(e){t.EventEmitter.emit(o.EventType.dialog.closeComments)}return e}Object.defineProperty(C,P,{writable:true,value:void 0});e.EscEventAction=p;e.EscManager=C})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Event,BX.Main,BX.SidePanel,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=esc-manager.bundle.map.js