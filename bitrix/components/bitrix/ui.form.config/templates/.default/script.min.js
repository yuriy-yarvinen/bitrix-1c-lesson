(function(e,a,i,s,t,l){"use strict";var r=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"popupIsOpen",value:function e(){return this.isOpen}},{key:"setPopupClose",value:function e(){this.isOpen=false}},{key:"setPopupOpen",value:function e(){this.isOpen=true}},{key:"isSubscribed",value:function a(i){return e.subscribedItems.includes(i)}},{key:"addSubscribed",value:function a(i){e.subscribedItems.push(i)}},{key:"showConfirmDialog",value:function e(a,i,s){l.MessageBox.confirm(a,s,i,undefined,undefined,true)}}]);return e}();babelHelpers.defineProperty(r,"isOpen",false);babelHelpers.defineProperty(r,"subscribedItems",[]);var n,b,d;function c(e,a){o(e,a);a.add(e)}function p(e,a,i){o(e,a);a.set(e,i)}function o(e,a){if(a.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function u(e,a,i){if(!a.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var v=3;var h=new WeakMap;var H=new WeakMap;var I=new WeakMap;var T=new WeakMap;var f=new WeakMap;var z=new WeakMap;var m=new WeakMap;var F=new WeakMap;var P=new WeakMap;var g=new WeakSet;var w=new WeakSet;var S=new WeakSet;var G=new WeakSet;var C=new WeakSet;var k=new WeakSet;var E=new WeakSet;var y=new WeakSet;var M=new WeakMap;var O=new WeakMap;var D=new WeakMap;var W=new WeakMap;var _=new WeakSet;var B=new WeakSet;var x=new WeakSet;var L=new WeakSet;var U=new WeakMap;var X=new WeakMap;var R=new WeakMap;var N=new WeakSet;var A=new WeakSet;var $=function(e){babelHelpers.inherits(a,e);function a(e){var i;babelHelpers.classCallCheck(this,a);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).call(this));c(babelHelpers.assertThisInitialized(i),A);c(babelHelpers.assertThisInitialized(i),N);c(babelHelpers.assertThisInitialized(i),L);c(babelHelpers.assertThisInitialized(i),x);c(babelHelpers.assertThisInitialized(i),B);c(babelHelpers.assertThisInitialized(i),_);c(babelHelpers.assertThisInitialized(i),y);c(babelHelpers.assertThisInitialized(i),E);c(babelHelpers.assertThisInitialized(i),k);c(babelHelpers.assertThisInitialized(i),C);c(babelHelpers.assertThisInitialized(i),G);c(babelHelpers.assertThisInitialized(i),S);c(babelHelpers.assertThisInitialized(i),w);c(babelHelpers.assertThisInitialized(i),g);p(babelHelpers.assertThisInitialized(i),h,{writable:true,value:void 0});p(babelHelpers.assertThisInitialized(i),H,{writable:true,value:void 0});p(babelHelpers.assertThisInitialized(i),I,{writable:true,value:void 0});p(babelHelpers.assertThisInitialized(i),T,{writable:true,value:[]});p(babelHelpers.assertThisInitialized(i),f,{writable:true,value:void 0});p(babelHelpers.assertThisInitialized(i),z,{writable:true,value:void 0});p(babelHelpers.assertThisInitialized(i),m,{writable:true,value:void 0});p(babelHelpers.assertThisInitialized(i),F,{writable:true,value:void 0});p(babelHelpers.assertThisInitialized(i),P,{writable:true,value:void 0});p(babelHelpers.assertThisInitialized(i),M,{writable:true,value:function e(a){var s=babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),D).call(babelHelpers.assertThisInitialized(i),a);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),T).push([s.type,s.id]);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),H)[s.accessCode]=s;u(babelHelpers.assertThisInitialized(i),G,q).call(babelHelpers.assertThisInitialized(i),true)}});p(babelHelpers.assertThisInitialized(i),O,{writable:true,value:function e(a){var s=babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),D).call(babelHelpers.assertThisInitialized(i),a);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),T,babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),F).getSelectedItems());delete babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),H)[s.accessCode];u(babelHelpers.assertThisInitialized(i),G,q).call(babelHelpers.assertThisInitialized(i),true)}});p(babelHelpers.assertThisInitialized(i),D,{writable:true,value:function e(a){var t=a.getData(),l=t.item;return{id:l.id,accessCode:u(babelHelpers.assertThisInitialized(i),x,ie).call(babelHelpers.assertThisInitialized(i),l),type:l.entityId,name:l.title.text,avatar:s.Type.isStringFilled(l.avatar)?l.avatar:null}}});p(babelHelpers.assertThisInitialized(i),W,{writable:true,value:function e(){if(BX.type.isNotEmptyObject(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),H))){babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),U).call(babelHelpers.assertThisInitialized(i));babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),z).setPopupClose()}else{u(babelHelpers.assertThisInitialized(i),_,ee).call(babelHelpers.assertThisInitialized(i))}}});p(babelHelpers.assertThisInitialized(i),U,{writable:true,value:function e(){BX.ajax.runComponentAction("bitrix:ui.form.config","updateScopeAccessCodes",{data:{moduleId:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),f),scopeId:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),h),accessCodes:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),H)}}).then((function(e){u(babelHelpers.assertThisInitialized(i),N,te).call(babelHelpers.assertThisInitialized(i))}))["catch"](u(babelHelpers.assertThisInitialized(i),L,se).bind(babelHelpers.assertThisInitialized(i)))}});p(babelHelpers.assertThisInitialized(i),X,{writable:true,value:function e(a){if(a.data.scopeId!==s.Text.toInteger(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),h))){return}babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),z).showConfirmDialog(s.Loc.getMessage("UI_SCOPE_LIST_CONFIRM_TITLE_COPY"),s.Loc.getMessage("UI_SCOPE_LIST_CONFIRM_ACCEPT_COPY"),(function(){BX.ajax.runComponentAction("bitrix:ui.form.config","copyScope",{data:{moduleId:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),f),entityTypeId:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),m),scopeId:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),h)}}).then((function(e){u(babelHelpers.assertThisInitialized(i),N,te).call(babelHelpers.assertThisInitialized(i))}))["catch"](u(babelHelpers.assertThisInitialized(i),L,se).bind(babelHelpers.assertThisInitialized(i)));return true}))}});p(babelHelpers.assertThisInitialized(i),R,{writable:true,value:function e(a){if(a.data.scopeId!==s.Text.toInteger(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),h))){return}babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),z).showConfirmDialog(s.Loc.getMessage("UI_SCOPE_LIST_CONFIRM_TITLE_DELETE"),s.Loc.getMessage("UI_SCOPE_LIST_CONFIRM_ACCEPT_DELETE"),(function(){BX.ajax.runComponentAction("bitrix:ui.form.config","removeScope",{data:{moduleId:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),f),scopeId:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),h)}}).then((function(e){u(babelHelpers.assertThisInitialized(i),N,te).call(babelHelpers.assertThisInitialized(i))}))["catch"](u(babelHelpers.assertThisInitialized(i),L,se).bind(babelHelpers.assertThisInitialized(i)));return true}))}});i.setEventNamespace("BX.Ui.Form");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),h,e.scopeId||null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),H,e.members||null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),I,BX("ui-editor-config-".concat(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(i),h))));babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),f,e.moduleId||null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),z,r);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),m,e.entityTypeId||null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),P,BX.prop.getBoolean(e,"useHumanResourcesModule",false));u(babelHelpers.assertThisInitialized(i),G,q).call(babelHelpers.assertThisInitialized(i));babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),F,u(babelHelpers.assertThisInitialized(i),w,Y).call(babelHelpers.assertThisInitialized(i)));u(babelHelpers.assertThisInitialized(i),g,j).call(babelHelpers.assertThisInitialized(i));return i}return a}(a.EventEmitter);function j(){if(!babelHelpers.classPrivateFieldGet(this,z).isSubscribed(babelHelpers.classPrivateFieldGet(this,h))){a.EventEmitter.subscribe("BX.Ui.Form.ConfigItem:copyContextAction",babelHelpers.classPrivateFieldGet(this,X));a.EventEmitter.subscribe("BX.Ui.Form.ConfigItem:deleteContextAction",babelHelpers.classPrivateFieldGet(this,R));babelHelpers.classPrivateFieldGet(this,z).addSubscribed(babelHelpers.classPrivateFieldGet(this,h))}}function Y(){return new i.Dialog({targetNode:babelHelpers.classPrivateFieldGet(this,I),enableSearch:true,context:"EDITOR_CONFIG_USER_CONTEXT",preselectedItems:u(this,S,K).call(this),items:[],entities:[{id:"user"},{id:"project"},{id:babelHelpers.classPrivateFieldGet(this,P)?"structure-node":"department",options:{selectMode:"usersAndDepartments"}}],events:{"Item:onSelect":babelHelpers.classPrivateFieldGet(this,M),"Item:onDeselect":babelHelpers.classPrivateFieldGet(this,O),onHide:babelHelpers.classPrivateFieldGet(this,W)}})}function K(){var e=this;if(babelHelpers.classPrivateFieldGet(this,H)&&!s.Type.isArrayFilled(Object.keys(babelHelpers.classPrivateFieldGet(this,T)))){var a=[];var i=babelHelpers.classPrivateFieldGet(this,H);Object.entries(i).forEach((function(i){var s=babelHelpers.slicedToArray(i,2),t=s[0],l=s[1];a.push(u(e,B,ae).call(e,t))}));babelHelpers.classPrivateFieldSet(this,T,a)}return babelHelpers.classPrivateFieldGet(this,T)||[]}function q(e){var a=this;if(!babelHelpers.classPrivateFieldGet(this,H)){return}if(e){s.Dom.clean(babelHelpers.classPrivateFieldGet(this,I))}var i=babelHelpers.classPrivateFieldGet(this,H);var t=0;if(Object.values(babelHelpers.classPrivateFieldGet(this,H)).length>v){i=Object.values(babelHelpers.classPrivateFieldGet(this,H)).slice(0,v);t=Object.values(babelHelpers.classPrivateFieldGet(this,H)).length-v}Object.values(i).forEach((function(e){s.Dom.append(u(a,C,J).call(a,e),babelHelpers.classPrivateFieldGet(a,I))}));if(t>0){s.Dom.append(u(this,E,V).call(this,t),babelHelpers.classPrivateFieldGet(this,I))}s.Dom.append(u(this,k,Q).call(this),babelHelpers.classPrivateFieldGet(this,I))}function J(e){var a=e.avatar?s.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['<a href="','" class="ui-editor-config-item-avatar"  title="','" style="background-image: url(\'',"')\"></a>"])),e.url,s.Text.encode(e.name),encodeURI(s.Text.encode(e.avatar))):s.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['<a href="','" class="ui-icon ui-icon-xs ui-icon-common-user" title="','"><i></i></a>'])),e.url,s.Text.encode(e.name));return s.Dom.create("div",{attrs:{class:"ui-editor-config-item"},children:[a]})}function Q(){var e=this;return s.Dom.create("div",{events:{click:function a(i){if(!babelHelpers.classPrivateFieldGet(e,z).popupIsOpen()){u(e,y,Z).call(e)}}},attrs:{class:"ui-editor-config-item ui-editor-config-item--add"}})}function V(e){return s.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['<div class="ui-editor-config-item"><span href="#" class="ui-editor-config-item--number">+',"</span></div>"])),e)}function Z(){babelHelpers.classPrivateFieldGet(this,z).setPopupOpen();babelHelpers.classPrivateFieldGet(this,F).show()}function ee(){var e=this;var a=l.MessageBox.create({message:s.Loc.getMessage("UI_SCOPE_LIST_ALERT_EMPTY_CODES"),useAirDesign:true,buttons:l.MessageBoxButtons.OK,onOk:function a(i){i.close();babelHelpers.classPrivateFieldGet(e,F).show()}});a.show()}function ae(e){if(/^I?U(\d+)$/.test(e)){var a=e.match(/^I?U(\d+)$/)||null;var i=a?a[1]:null;return["user",i]}if(/^DR(\d+)$/.test(e)){var s=e.match(/^DR(\d+)$/)||null;var t=s?s[1]:null;return["department",t]}if(/^D(\d+)$/.test(e)){var l=e.match(/^D(\d+)$/)||null;var r=l?l[1]:null;return["department","".concat(r,":F")]}if(/^G(\d+)$/.test(e)){var n=e.match(/^G(\d+)$/)||null;var b=n?n[1]:null;return["site-groups",b]}if(e.at(0)==="A"){return["user-groups",e]}if(/^SG(\d+)_([AEK])$/.test(e)){return["project-access-codes",e]}if(/^SND(\d+)$/.test(e)){var d=e.match(/^SND(\d+)$/)||null;var c=d?d[1]:null;return["structure-node","".concat(c,":F")]}if(/^SNDR(\d+)$/.test(e)){var p=e.match(/^SNDR(\d+)$/)||null;var o=p?p[1]:null;return["structure-node",o]}return["unknown",e]}function ie(e){var a=e.entityId;if(a==="user"){return"U".concat(e.id)}if(a==="department"){if(s.Type.isString(e.id)&&e.id.endsWith(":F")){var i=e.id.match(/^(\d+):F$/);var t=i?i[1]:null;return"D".concat(t)}return"DR".concat(e.id)}if(a==="structure-node"){if(s.Type.isString(e.id)&&e.id.endsWith(":F")){var l=e.id.match(/^(\d+):F$/);var r=l?l[1]:null;return"SND".concat(r)}return"SNDR".concat(e.id)}if(a==="site-groups"){return"G".concat(e.id)}if(a==="user-groups"){return e.id}if(a==="project-access-codes"){return e.id}return""}function se(e){if(e.status==="error"){u(this,A,le).call(this,e.data[0])}}function te(e){BX.Main.gridManager.getInstanceById("editor_scopes").reload()}function le(e){BX.UI.Notification.Center.notify({content:e===null||e===void 0?void 0:e.message,autoHideDelay:5e3})}var re=s.Reflection.namespace("BX.Ui.Form");re.Config=r;re.ConfigItem=$})(this.window=this.window||{},BX.Event,BX.UI.EntitySelector,BX,BX.UI,BX.UI.Dialogs);
//# sourceMappingURL=script.map.js