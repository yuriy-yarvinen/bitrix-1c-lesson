this.BX=this.BX||{};(function(e,t,a,r,s,i){"use strict";let n=e=>e,l,o,c,d,h,v,b,p;class u{constructor(e){this.parentNode=e.parentNode;this.init()}init(){this.bar=s.Tag.render(l||(l=n`
			<div class="calendar-relation-bar">
			</div>
		`));s.Event.bind(this.bar,"mouseenter",(()=>{t.EventEmitter.emit("BX.Calendar.EntityRelation.onMouseEnter")}))}renderLoader(){s.Dom.clean(this.bar);if(!this.loaderWrap){this.loaderWrap=s.Tag.render(o||(o=n`<div class="calendar-relation-bar-loader"></div>`))}s.Dom.append(this.loaderWrap,this.bar);this.showLoader();return this.bar}showLoader(){if(this.loader){this.loader.destroy()}this.loader=new a.Loader({target:this.loaderWrap,size:22,color:"#2066B0",offset:{left:"0px",top:"0px"},mode:"inline"});this.loader.show()}render(e,t){s.Dom.clean(this.bar);s.Dom.append(t,this.bar);s.Dom.append(this.getOwnerData(e),this.bar);return this.bar}getEntityLink({link:e="#",text:t,title:a}){const r=new i.Icon({icon:i.Outline.CHEVRON_RIGHT_M,size:20,color:"rgb(130, 139, 149)"});return s.Tag.render(c||(c=n`
			<a
				class="calendar-relation-entity-link"
				href="${0}"
				title="${0}"
			>
				<div class="calendar-relation-entity-link-text">
					${0}
				</div>
				<div class="calendar-relation-entity-link-arrow">
					${0}
				</div>
			</a>
		`),e,a,t,r.render())}getOwnerData(e){const t=new i.Icon({icon:i.Outline.MESSAGES,size:22,color:"rgb(0, 117, 255)"});const{root:a,chatButton:r}=s.Tag.render(d||(d=n`
			<div class="calendar-relation-owner">
				<div class="calendar-relation-owner-role">${0}</div>
				<div class="calendar-relation-owner-info">
					${0}
					${0}
					<div
						ref="chatButton"
						class="calendar-relation-owner-chat"
						title="${0}"
					>
						${0}
					</div>
				</div>
			</div>
		`),s.Loc.getMessage("CALENDAR_RELATION_OWNER_ROLE_DEAL"),this.getOwnerAvatarNode(e),this.getOwnerNameNode(e),s.Loc.getMessage("CALENDAR_RELATION_CHAT_BUTTON_HINT"),t.render());s.Event.bind(r,"click",(()=>this.openChat(e.owner.id)));return a}getOwnerAvatarNode(e){const t=s.Tag.render(h||(h=n`
			<a
				href="${0}"
				class="calendar-relation-owner-avatar ui-icon ui-icon-common-user"
				title="${0}"
			>
			</a>
		`),e.owner.link,s.Loc.getMessage("CALENDAR_RELATION_OWNER_PROFILE_HINT"));let a=null;if(e.owner.avatar){a=s.Tag.render(v||(v=n`
				<img
					src="${0}"
					alt=""
				/>
			`),encodeURI(e.owner.avatar))}else{a=s.Tag.render(b||(b=n`
				<i></i>
			`))}s.Dom.append(a,t);return t}getOwnerNameNode(e){return s.Tag.render(p||(p=n`
			<a
				class="calendar-relation-owner-name"
				href="${0}"
				title="${0}"
			>
				${0}
			</a>
		`),e.owner.link,s.Loc.getMessage("CALENDAR_RELATION_OWNER_PROFILE_HINT"),e.owner.name)}openChat(e){r.Messenger.openChat(e)}}var L=babelHelpers.classPrivateFieldLooseKey("bar");var g=babelHelpers.classPrivateFieldLooseKey("BookingEventPopup");var y=babelHelpers.classPrivateFieldLooseKey("getEntityLink");var E=babelHelpers.classPrivateFieldLooseKey("openBooking");class N{constructor(e){Object.defineProperty(this,E,{value:f});Object.defineProperty(this,y,{value:w});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e}render(e){s.Runtime.loadExtension("booking.application.booking-event-popup").then((e=>{babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e.BookingEventPopup})).catch((e=>{console.error("Calendar. EntityRelation. Load BookingEventPopup extension error",e)}));return babelHelpers.classPrivateFieldLooseBase(this,L)[L].render(e,babelHelpers.classPrivateFieldLooseBase(this,y)[y](e))}}function w(e){const t=babelHelpers.classPrivateFieldLooseBase(this,L)[L].getEntityLink({link:e.entity.link,text:s.Loc.getMessage("CALENDAR_RELATION_ENTITY_LINK_BOOKING"),title:s.Loc.getMessage("CALENDAR_RELATION_ENTITY_LINK_BOOKING")});s.Event.bind(t,"click",(async t=>{t.preventDefault();await babelHelpers.classPrivateFieldLooseBase(this,E)[E](e.entity.id)}));return t}async function f(e){if(!babelHelpers.classPrivateFieldLooseBase(this,g)[g]){return}await new(babelHelpers.classPrivateFieldLooseBase(this,g)[g])({bookingId:e}).show()}var O=babelHelpers.classPrivateFieldLooseKey("bar");var P=babelHelpers.classPrivateFieldLooseKey("getEntityLink");class I{constructor(e){Object.defineProperty(this,P,{value:B});Object.defineProperty(this,O,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,O)[O]=e}render(e){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].render(e,babelHelpers.classPrivateFieldLooseBase(this,P)[P](e))}}function B(e){return babelHelpers.classPrivateFieldLooseBase(this,O)[O].getEntityLink({link:e.entity.link,text:s.Loc.getMessage("CALENDAR_RELATION_ENTITY_LINK_DEAL"),title:s.Loc.getMessage("CALENDAR_RELATION_OPEN_ENTITY_HINT_DEAL")})}class T{static async getRelationData(e){if(s.Type.isNil(e)){return false}const t="calendar.api.calendarentryajax.getEventEntityRelation";const a={eventId:e};const r=await s.ajax.runAction(t,{data:a}).then((e=>e),(()=>null));return(r==null?void 0:r.data)||false}}class H{static getRelation(e){var t;return(t=H.map.get(e))!=null?t:false}static setRelation(e){H.map.set(e.eventId,e)}}H.map=new Map;let R=e=>e,_;const A=26423530;var D=babelHelpers.classPrivateFieldLooseKey("getHelpDeskIcon");var k=babelHelpers.classPrivateFieldLooseKey("showHelpDesk");class F{constructor(){Object.defineProperty(this,k,{value:$});Object.defineProperty(this,D,{value:m})}render(){return s.Tag.render(_||(_=R`
			<div class="calendar--relation-entities-header">
				<h6 class="calendar--relation-entities-title">
					${0}
				</h6>
				<span class="calendar--relation-entities-help-desk-icon">
					${0}
				</span>
			</div>
		`),s.Loc.getMessage("CALENDAR_RELATIONS_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,D)[D]())}}function m(){const e=new i.Icon({icon:i.Outline.QUESTION,size:16,color:"rgba(167, 167, 167, 1)"}).render();s.Event.bind(e,"click",(()=>babelHelpers.classPrivateFieldLooseBase(this,k)[k]()));return e}function $(){if(!top.BX.Helper){return}const e={redirect:"detail",code:A};const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");top.BX.Helper.show(t)}let C=e=>e,K;var M=babelHelpers.classPrivateFieldLooseKey("renderBar");var j=babelHelpers.classPrivateFieldLooseKey("wrapLayout");class X{constructor(e){var t;Object.defineProperty(this,j,{value:W});Object.defineProperty(this,M,{value:x});this.bar=new u({parentNode:e.parentNode});this.eventId=(t=e.eventId)!=null?t:null;this.relationData=H.getRelation(this.eventId)||null;this.layout=null}render(){if(s.Type.isNil(this.relationData)){this.layout=this.bar.renderLoader();void this.showLazy()}else if(this.relationData){this.layout=babelHelpers.classPrivateFieldLooseBase(this,M)[M](this.relationData)}return babelHelpers.classPrivateFieldLooseBase(this,j)[j](this.layout)}async showLazy(){this.relationData=await T.getRelationData(this.eventId);if(this.relationData){H.setRelation(this.relationData);const e=babelHelpers.classPrivateFieldLooseBase(this,M)[M](this.relationData);s.Dom.replace(this.layout,e);this.layout=e}else{this.destroy()}}destroy(){s.Dom.remove(this.layout);this.layout=null}}function x(e){if(e.entity.type==="deal"){return new I(this.bar).render(e)}if(e.entity.type==="booking"){return new N(this.bar).render(e)}return null}function W(e){if(e===null){return e}return s.Tag.render(K||(K=C`
			<div class="calendar--relation-entities-wrapper">
				${0}
				${0}
			</div>
		`),(new F).render(),this.layout)}e.RelationInterface=X})(this.BX.Calendar=this.BX.Calendar||{},BX.Event,BX,BX.Messenger.v2.Lib,BX,BX.UI.IconSet);
//# sourceMappingURL=entityrelation.bundle.map.js