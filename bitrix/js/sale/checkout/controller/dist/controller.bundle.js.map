{"version":3,"file":"controller.bundle.js","sources":["../src/basket.js","../src/application.js"],"sourcesContent":["import { ajax } from 'main.core';\nimport {\n\tPool,\n\tTimer,\n\tBasket as Lib,\n\tProduct as ProductLib,\n} from 'sale.checkout.lib'\n\nimport {\n    Application as ApplicationConst,\n    RestMethod as RestMethodConst,\n    Component as ComponentConst,\n    Loader as LoaderConst,\n    Pool as PoolConst,\n} from 'sale.checkout.const';\n\nexport class Basket\n{\n    constructor()\n    {\n        this.pool = this.getPool();\n        this.timer = this.getTimer();\n\n        this.running = 'N';\n    }\n\n    /**\n     * @private\n     */\n    getPool()\n    {\n        return new Pool();\n    }\n\n    /**\n     * @private\n     */\n    getTimer()\n    {\n        return new Timer();\n    }\n\n    /**\n     * @private\n     */\n    isRunning()\n    {\n        return this.running === 'Y';\n    }\n\n    /**\n     * @private\n     */\n    setRunningY()\n    {\n        this.running = 'Y'\n    }\n\n    /**\n     * @private\n     */\n    setRunningN()\n    {\n        this.running = 'N'\n    }\n\n    /**\n     * @private\n     */\n    setStore(store)\n    {\n        this.store = store;\n        return this;\n    }\n\n    /**\n     * @private\n     */\n    setProvider(provider)\n    {\n        this.provider = provider;\n        return this;\n    }\n\n    /**\n     * @private\n     */\n    executeRestAnswer(command, result, extra)\n    {\n        return this.provider.execute(command, result, extra);\n    }\n\n    /**\n     * @private\n     */\n    getItem(index)\n    {\n        return this.store.getters['basket/get'](index);\n    }\n\n    /**\n     * @private\n     */\n    getBasket()\n    {\n        return this.store.getters['basket/getBasket'];\n    }\n\n\t/**\n\t * @private\n\t */\n\tgetBasketCollection()\n\t{\n\t\treturn this.getBasket().filter(item => item.deleted === 'N');\n\t}\n\n    /**\n     * @private\n     */\n    changeItem(product)\n    {\n        this.store.dispatch('basket/changeItem', {\n            index: product.index,\n            fields: product.fields\n        });\n    }\n\n    /**\n     * @private\n     */\n    setQuantity(index, quantity)\n    {\n        let fields = this.getItem(index);\n\n        fields.quantity = quantity;\n        fields.baseSum = this.round(fields.basePrice * fields.quantity);\n        fields.sum = this.round(fields.price * fields.quantity);\n        fields.discount.sum = this.round(fields.discount.price * fields.quantity);\n\n        this.refreshDiscount();\n        this.refreshTotal();\n\n        this.pool.add(PoolConst.action.quantity, index, {id: fields.id, value: fields.quantity});\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n\n    refreshDiscount()\n    {\n        let basket = this.getBasket();\n        if(basket.length > 0)\n        {\n            this.store.dispatch('basket/setDiscount', {\n                sum: basket.reduce((result, value) => result + value.discount.sum, 0),\n            });\n        }\n    }\n\n    refreshTotal()\n    {\n        let basket = this.getBasketCollection();\n        if(basket.length > 0)\n        {\n            this.store.dispatch('basket/setTotal', {\n                price: basket.reduce((result, value) => result + value.sum, 0),\n                basePrice: basket.reduce((result, value) => result + value.baseSum, 0)\n            });\n        }\n    }\n\n    /**\n     * @private\n     */\n    removeItem(product)\n    {\n        return this.store.dispatch('basket/removeItem', {\n            index: product.index\n        });\n    }\n\n    /**\n     * @private\n     */\n    round(value, precision = 10)\n    {\n        const factor = Math.pow(10, precision);\n\n        return Math.round(value * factor) / factor;\n    }\n\n    emitOnBasketChange()\n    {\n        BX.onCustomEvent('OnBasketChange');\n    }\n\n    /**\n     * @private\n     */\n    handlerOrderSuccess()\n    {\n        this.emitOnBasketChange()\n    }\n\n    /**\n     * @private\n     */\n    handlerRemoveProductSuccess()\n    {\n        this.emitOnBasketChange()\n    }\n\n    /**\n     * @private\n     */\n    handlerRestoreProductSuccess()\n    {\n        this.emitOnBasketChange()\n    }\n\n    /**\n     * @private\n     */\n    handlerRemove(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n\n        fields.deleted = 'Y';\n        fields.status = LoaderConst.status.wait;\n\n        this.pool.add(PoolConst.action.delete, index, {id: fields.id, fields: {value: 'Y'}});\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n\n    /**\n     * @private\n     */\n    handlerSuccessRemove(event)\n    {\n        let index = event.getData().index;\n\n        this.timer.create(5000, index + '_DELETE', () =>\n            this.removeItem({index})\n                .then(() =>\n                {\n                    if(this.getBasket().length === 0)\n                    {\n                        this.store.dispatch('application/setStage', {stage: ApplicationConst.stage.empty})\n                    }\n                })\n        )\n    }\n\n    /**\n     * @private\n     */\n    handlerRestore(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n\n        this.timer.clean({\n            index: index + '_DELETE'\n        });\n\n        fields.deleted = 'N';\n        fields.status = LoaderConst.status.wait;\n\n        //todo: send all fields ?\n        this.pool.add(PoolConst.action.restore, index, {\n            basePrice:fields.basePrice,\n            baseSum:fields.baseSum,\n            currency:fields.currency,\n            discount:fields.discount,\n            id:fields.id,\n            measureText:fields.measureText,\n            module:fields.module,\n            name:fields.name,\n            price:fields.price,\n            product:fields.product,\n            productProviderClass:fields.productProviderClass,\n            props:fields.props,\n            quantity:fields.quantity,\n            sum:fields.sum,\n        });\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n\n    /**\n     * @private\n     */\n    handlerChangeQuantity(event)\n    {\n        // let data = event.getData().data;\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n\n        let quantity = fields.quantity;\n        let ratio = fields.product.ratio;\n        let available = fields.product.availableQuantity;\n\n        quantity = Lib.roundValue(quantity)\n        ratio = Lib.roundValue(ratio)\n\n        quantity = isNaN(quantity) ? 0:quantity\n\n        if (ratio > 0 && quantity < ratio)\n        {\n            quantity = ratio;\n        }\n\n\t\tif (ProductLib.isService(fields))\n\t\t{\n\t\t\t// for services\n\t\t\t// do nothing\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// for products\n\t\t\tif (ProductLib.isLimitedQuantity(fields))\n\t\t\t{\n\t\t\t\tif (available > 0 && quantity > available)\n\t\t\t\t{\n\t\t\t\t\tquantity = available;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n        quantity = Lib.toFixed(quantity, ratio, available)\n\n        if(fields.quantity !== quantity)\n        {\n            this.setQuantity(index, quantity)\n        }\n    }\n\n    /**\n     * @private\n     */\n    handlerQuantityPlus(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n        let quantity = fields.quantity;\n        let ratio = fields.product.ratio;\n        let available = fields.product.availableQuantity;\n\n        quantity = Lib.roundValue(quantity)\n        ratio = Lib.roundValue(ratio)\n\n        quantity = quantity + ratio;\n\n        if (Lib.isValueFloat(quantity))\n        {\n            quantity = Lib.roundFloatValue(quantity)\n        }\n\n        if (ProductLib.isService(fields))\n\t\t{\n\t\t\t// for services\n\t\t\t// do nothing\n\t\t}\n        else\n\t\t{\n\t\t\t// for products\n\t\t\tif (ProductLib.isLimitedQuantity(fields))\n\t\t\t{\n\t\t\t\tif (available > 0 && quantity > available)\n\t\t\t\t{\n\t\t\t\t\tquantity = available;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n        quantity = Lib.toFixed(quantity, ratio, available)\n\n        if(fields.quantity < quantity)\n        {\n            this.setQuantity(index, quantity)\n        }\n    }\n\n    /**\n     * @private\n     */\n    handlerQuantityMinus(event)\n    {\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n        let quantity = fields.quantity;\n        let ratio = fields.product.ratio;\n        let available = fields.product.availableQuantity;\n\n        quantity = Lib.roundValue(quantity)\n        ratio = Lib.roundValue(ratio)\n\n        let delta = quantity = quantity - ratio;\n\n        if(Lib.isValueFloat(quantity))\n        {\n            quantity = Lib.roundFloatValue(quantity)\n\t\t\tdelta = Lib.roundFloatValue(delta)\n        }\n\n        if (ratio > 0 && quantity < ratio)\n        {\n            quantity = ratio;\n        }\n\n\t\tif (ProductLib.isService(fields))\n\t\t{\n\t\t\t// for services\n\t\t\t// do nothing\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// for products\n\t\t\tif (ProductLib.isLimitedQuantity(fields))\n\t\t\t{\n\t\t\t\tif (available > 0 && quantity > available)\n\t\t\t\t{\n\t\t\t\t\tquantity = available;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n        quantity = Lib.toFixed(quantity, ratio, available)\n\n        if(delta >= ratio)\n        {\n            this.setQuantity(index, quantity)\n        }\n    }\n\n    /**\n     * @private\n     */\n    commit()\n    {\n        return new Promise((resolve, reject) =>\n        {\n            let fields = {};\n\n            if(this.pool.isEmpty() === false)\n            {\n                fields = this.pool.get();\n                this.pool.clean();\n\n                const component = ComponentConst.bitrixSaleOrderCheckout;\n                const cmd = RestMethodConst.saleEntityRecalculateBasket;\n\n                ajax.runComponentAction(\n                    component,\n                    cmd,\n                    {\n                        data: {\n                            actions: fields\n                        },\n                        signedParameters: this.store.getters['application/getSignedParameters']\n                    }\n                )\n                .then((result) => this.executeRestAnswer(cmd, result, this.pool)\n                    .then(() => this.commit()\n                        .then(() => resolve())))\n                .catch()\n            }\n            else\n            {\n                resolve();\n            }\n        });\n    }\n\n    /**\n     * @private\n     */\n    shelveCommit(index = 'BASKET')\n    {\n        if(this.isRunning() === false)\n        {\n            this.timer.create(300, index,\n                () => {\n                    this.setRunningY();\n                    this.commit()\n                        .then(()=>this.setRunningN())\n                }\n            );\n        }\n    }\n\n    /**\n     * @private\n     */\n    getStatus()\n    {\n        return this.store.getters['basket/getStatus'];\n    }\n\n    /**\n     * @private\n     */\n    setStatusWait()\n    {\n        let app = {status: LoaderConst.status.wait};\n        return this.store.dispatch('basket/setStatus', app);\n    }\n\n    /**\n     * @private\n     */\n    setStatusNone()\n    {\n        let app = {status: LoaderConst.status.none};\n        return this.store.dispatch('basket/setStatus', app);\n    }\n\n    /**\n     * @private\n     */\n    handlerNeedRefreshY()\n    {\n        this.setNeedRefreshY();\n        this.setStatusWait();\n    }\n\n    /**\n     * @private\n     */\n    handlerNeedRefreshN()\n    {\n        this.setNeedRefreshN();\n        this.setStatusNone();\n    }\n\n    /**\n     * @private\n     */\n    setNeedRefreshY()\n    {\n        let app = {needRefresh: 'Y'};\n        return this.store.dispatch('basket/setNeedRefresh', app);\n    }\n\n    /**\n     * @private\n     */\n    setNeedRefreshN()\n    {\n        let app = {needRefresh: 'N'};\n        return this.store.dispatch('basket/setNeedRefresh', app);\n    }\n\n    /**\n     * @private\n     */\n    handlerChangeSku(event)\n    {\n        let offerId = event.getData().data[0].ID;\n\n        let index = event.getData().index;\n        let fields = this.getItem(index);\n\n        fields.status = LoaderConst.status.wait;\n\n        this.pool.add(PoolConst.action.offer, index, {id: fields.id, fields: {offerId: offerId}});\n        this.changeItem({index, fields});\n        this.shelveCommit();\n    }\n}\n","import { Runtime, ajax } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { BasketRestHandler } from 'sale.checkout.provider.rest';\nimport {\n\tApplication as ApplicationConst,\n\tRestMethod as RestMethodConst,\n\tComponent as ComponentConst,\n\tConsent as ConsentConst,\n\tLoader as LoaderConst,\n\tEventType,\n} from 'sale.checkout.const';\n\nimport { History } from 'sale.checkout.lib';\n\nimport { Basket } from './basket';\n\nexport class Application\n{\n\tconstructor(option)\n\t{\n\t\tthis.init(option)\n\t\t\t.then(() => this.initProvider())\n\t\t\t.then(() => this.iniController())\n\t\t\t.then(() => this.subscribeToEvents())\n\t\t\t.then(() => this.subscribeToStoreChanges())\n\t\t;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tinit(option)\n\t{\n\t\tthis.store = option.store;\n\t\tthis.orderSaveAllowed = false;\n\t\tthis.preselectedConsentsIsSubmitted = false;\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\t/**\n\t * @private\n\t */\n\tisAllowOrderSave(): boolean\n\t{\n\t\treturn this.orderSaveAllowed;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tallowOrderSave(): void\n\t{\n\t\tthis.orderSaveAllowed = true;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tdisallowOrderSave(): void\n\t{\n\t\tthis.orderSaveAllowed = false;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tinitProvider()\n\t{\n\t\tthis.provider = BasketRestHandler.create({ store: this.store });\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\t/**\n\t * @private\n\t */\n\tiniController()\n\t{\n\t\tthis.basket = new Basket().setStore(this.store).setProvider(this.provider);\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\t/**\n\t * @private\n\t */\n\texecuteRestAnswer(command, result, extra)\n\t{\n\t\treturn this.provider.execute(command, result, extra);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tsubscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe(EventType.order.success, (e) => this.basket.handlerOrderSuccess(e));\n\n\t\tEventEmitter.subscribe(EventType.basket.removeProduct, (e) => this.basket.handlerRemoveProductSuccess(e));\n\t\tEventEmitter.subscribe(EventType.basket.restoreProduct, (e) => this.basket.handlerRestoreProductSuccess(e));\n\n\t\tEventEmitter.subscribe(EventType.basket.buttonRemoveProduct, Runtime.debounce((e) => this.basket.handlerRemove(e), 500, this));\n\t\tEventEmitter.subscribe(EventType.basket.buttonPlusProduct, (e) => this.basket.handlerQuantityPlus(e));\n\t\tEventEmitter.subscribe(EventType.basket.buttonMinusProduct, (e) => this.basket.handlerQuantityMinus(e));\n\t\tEventEmitter.subscribe(EventType.basket.inputChangeQuantityProduct, (e) => this.basket.handlerChangeQuantity(e));\n\t\tEventEmitter.subscribe(EventType.basket.buttonRestoreProduct, Runtime.debounce((e) => this.basket.handlerRestore(e), 500, this));\n\t\tEventEmitter.subscribe(EventType.basket.needRefresh, (e) => this.basket.handlerNeedRefreshY(e));\n\t\tEventEmitter.subscribe(EventType.basket.refreshAfter, (e) => this.basket.handlerNeedRefreshN(e));\n\n\t\tEventEmitter.subscribe(EventType.basket.changeSku, (e) => this.basket.handlerChangeSku(e));\n\n\t\tEventEmitter.subscribe(EventType.consent.refused, (e) => this.handlerConsentRefused(e));\n\t\tEventEmitter.subscribe(EventType.consent.accepted, (e) => this.handlerConsentAccepted(e));\n\n\t\tEventEmitter.subscribe(EventType.property.validate, (e) => this.handlerValidateProperty(e));\n\n\t\tEventEmitter.subscribe(EventType.element.buttonCheckout, Runtime.debounce(() => this.handlerCheckout(), 1000, this));\n\t\tEventEmitter.subscribe(EventType.element.buttonShipping, Runtime.debounce(() => this.handlerShipping(), 1000, this));\n\n\t\tEventEmitter.subscribe(EventType.paysystem.beforeInitList, () => this.paySystemSetStatusWait());\n\t\tEventEmitter.subscribe(EventType.paysystem.afterInitList, () => this.paySystemSetStatusNone());\n\t}\n\n\t/**\n\t * @private\n\t */\n\tsubscribeToStoreChanges()\n\t{\n\t\t// this.store.subscribe((mutation, state) => {\n\t\t//\t const { payload, type } = mutation;\n\t\t//\t if (type === 'basket/setNeedRefresh')\n\t\t//\t {\n\t\t//\t \talert('@@');\n\t\t//\t \tthis.getData();\n\t\t//\t }\n\t\t// });\n\n\t\treturn new Promise((resolve, reject) => resolve());\n\t}\n\n\t/**\n\t * @private\n\t */\n\tpaySystemSetStatusWait()\n\t{\n\t\tconst paySystem = { status: LoaderConst.status.wait };\n\n\t\treturn this.store.dispatch('pay-system/setStatus', paySystem);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tpaySystemSetStatusNone()\n\t{\n\t\tconst paySystem = { status: LoaderConst.status.none };\n\n\t\treturn this.store.dispatch('pay-system/setStatus', paySystem);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tappSetStatusWait()\n\t{\n\t\tconst app = { status: LoaderConst.status.wait };\n\n\t\treturn this.store.dispatch('application/setStatus', app);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tappSetStatusNone()\n\t{\n\t\tconst app = { status: LoaderConst.status.none };\n\n\t\treturn this.store.dispatch('application/setStatus', app);\n\t}\n\n\t/**\n\t * @private\n\t */\n\thandlerConsentAccepted(event)\n\t{\n\t\tconst item = event.getData()[0];\n\t\tthis.store.dispatch('consent/setChecked', { id: item.config.id, checked: 'Y' });\n\t\tif (this.isAllowOrderSave())\n\t\t{\n\t\t\tthis.handlerCheckout();\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\thandlerConsentRefused(event)\n\t{\n\t\tconst item = event.getData()[0];\n\t\tthis.store.dispatch('consent/setChecked', { id: item.config.id, checked: 'N' });\n\t\tthis.disallowOrderSave();\n\t}\n\n\tsendEventsForCheckedConsents(): void\n\t{\n\t\tconst consent = this.store.getters['consent/get'];\n\t\tconsent.items.forEach((item) => {\n\t\t\tif (item.checked === 'Y')\n\t\t\t{\n\t\t\t\tEventEmitter.emit(`${ConsentConst.validate.submit}-${item.id}`, []);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetFirstRequiredUncheckedConsentItem()\n\t{\n\t\tconst consent = this.store.getters['consent/get'];\n\n\t\treturn consent.items.find((item) => item.required === 'Y' && item.checked === 'N');\n\t}\n\n\t/**\n\t * @private\n\t */\n\thandlerCheckout()\n\t{\n\t\tthis.allowOrderSave();\n\t\tif (!this.preselectedConsentsIsSubmitted)\n\t\t{\n\t\t\tthis.sendEventsForCheckedConsents();\n\t\t\tthis.preselectedConsentsIsSubmitted = true;\n\t\t}\n\n\t\tconst firstRequiredUncheckedConsentItem = this.getFirstRequiredUncheckedConsentItem();\n\t\tif (firstRequiredUncheckedConsentItem)\n\t\t{\n\t\t\tEventEmitter.emit(`${ConsentConst.validate.submit}-${firstRequiredUncheckedConsentItem.id}`, []);\n\n\t\t\treturn;\n\t\t}\n\n\t\t// this.propertiesValidate();\n\t\t// this.propertiesIsValid() ? alert('propsSuccess'):alert('propsError')\n\n\t\tthis.appSetStatusWait();\n\n\t\tthis.saveOrder()\n\t\t\t.then(() => {\n\t\t\t\tthis.appSetStatusNone()\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tconst order = this.store.getters['order/getOrder'];\n\n\t\t\t\t\t\tif (order.id > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst url = History.pushState(\n\t\t\t\t\t\t\t\tthis.store.getters['application/getPathLocation'],\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\taccountNumber: order.accountNumber,\n\t\t\t\t\t\t\t\t\taccess: order.hash,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tthis.store.dispatch('application/setPathLocation', url);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.catch(() => this.appSetStatusNone());\n\t}\n\n\t/**\n\t * @private\n\t */\n\thandlerShipping()\n\t{\n\t\tthis.store.dispatch('application/setStage', { stage: ApplicationConst.stage.view });\n\t\t// todo\n\t\tdelete BX.UserConsent;\n\n\t\tconst order = this.store.getters['order/getOrder'];\n\t\tif (order.id > 0)\n\t\t{\n\t\t\tconst component = ComponentConst.bitrixSaleOrderCheckout;\n\t\t\tconst cmd = RestMethodConst.saleEntityPaymentPay;\n\n\t\t\treturn ajax.runComponentAction(\n\t\t\t\tcomponent,\n\t\t\t\tcmd,\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\torderId: order.id,\n\t\t\t\t\t\t\taccessCode: order.hash,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tsignedParameters: this.store.getters['application/getSignedParameters'],\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\tsaveOrder()\n\t{\n\t\tconst component = ComponentConst.bitrixSaleOrderCheckout;\n\t\tconst cmd = RestMethodConst.saleEntitySaveOrder;\n\n\t\treturn ajax.runComponentAction(\n\t\t\tcomponent,\n\t\t\tcmd,\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tsiteId: this.store.getters['application/getSiteId'],\n\t\t\t\t\t\tpersonTypeId: this.store.getters['application/getPersonTypeId'],\n\t\t\t\t\t\ttradingPlatformId: this.store.getters['application/getTradingPlatformId'],\n\t\t\t\t\t\tproperties: this.preparePropertyFields(\n\t\t\t\t\t\t\tthis.getPropertyList(),\n\t\t\t\t\t\t),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tsignedParameters: this.store.getters['application/getSignedParameters'],\n\t\t\t},\n\t\t)\n\t\t\t.then((result) => this.executeRestAnswer(cmd, result))\n\t\t\t.catch((result) => this.executeRestAnswer(cmd, { error: result.errors }));\n\t}\n\n\t/**\n\t * @private\n\t */\n\thandlerValidateProperty(event)\n\t{\n\t\tconst property = {};\n\t\tproperty.index = event.getData().index;\n\t\tproperty.fields = this.getPropertyItem(property.index);\n\t\tthis.changeValidatedProperty(property);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tgetPropertyItem(index)\n\t{\n\t\treturn this.store.getters['property/get'](index);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tchangeValidatedProperty(property)\n\t{\n\t\tconst fields = property.fields;\n\t\tlet errors = this.store.getters['property/getErrors'];\n\t\tif (this.propertyDataValidate(fields))\n\t\t{\n\t\t\terrors = this.deletePropertyError(fields, errors);\n\t\t}\n\t\telse\n\t\t{\n\t\t\terrors = this.addPropertyError(fields, errors);\n\t\t}\n\t\tthis.provider.setModelPropertyError(errors);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tpropertyDataValidate(fields)\n\t{\n\t\treturn !(fields.required === 'Y' && fields.value === '');\n\t}\n\n\t/**\n\t * @private\n\t */\n\tdeletePropertyError(fields, errors)\n\t{\n\t\tfor (const errorIndex in errors)\n\t\t{\n\t\t\tif (errors[errorIndex].propertyId === fields.id)\n\t\t\t{\n\t\t\t\terrors.splice(errorIndex, 1);\n\t\t\t}\n\t\t}\n\n\t\treturn errors;\n\t}\n\n\t/**\n\t * @private\n\t */\n\taddPropertyError(fields, errors)\n\t{\n\t\tconst errorIds = errors.map((item) => item.propertyId);\n\t\tif (!errorIds.includes(fields.id))\n\t\t{\n\t\t\terrors.push({ propertyId: fields.id });\n\t\t}\n\n\t\treturn errors;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tgetPropertyList()\n\t{\n\t\tconst result = [];\n\t\tconst list = this.store.getters['property/getProperty'];\n\t\ttry\n\t\t{\n\t\t\tfor (const key in list)\n\t\t\t{\n\t\t\t\tif (!list.hasOwnProperty(key))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tresult[list[key].id] = list[key];\n\t\t\t}\n\t\t}\n\t\tcatch\n\t\t{}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tpreparePropertyFields(list)\n\t{\n\t\tconst fields = {};\n\t\tlist.forEach((property, inx) => {\n\t\t\tfields[inx] = property.value;\n\t\t});\n\n\t\treturn fields;\n\t}\n}\n"],"names":["Basket","pool","getPool","timer","getTimer","running","Pool","Timer","store","provider","command","result","extra","execute","index","getters","getBasket","filter","item","deleted","product","dispatch","fields","quantity","getItem","baseSum","round","basePrice","sum","price","discount","refreshDiscount","refreshTotal","add","PoolConst","action","id","value","changeItem","shelveCommit","basket","length","reduce","getBasketCollection","precision","factor","Math","pow","BX","onCustomEvent","emitOnBasketChange","event","getData","status","LoaderConst","wait","create","removeItem","then","stage","ApplicationConst","empty","clean","restore","currency","measureText","module","name","productProviderClass","props","ratio","available","availableQuantity","Lib","roundValue","isNaN","ProductLib","isService","isLimitedQuantity","toFixed","setQuantity","isValueFloat","roundFloatValue","delta","Promise","resolve","reject","isEmpty","get","component","ComponentConst","bitrixSaleOrderCheckout","cmd","RestMethodConst","saleEntityRecalculateBasket","ajax","runComponentAction","data","actions","signedParameters","executeRestAnswer","commit","isRunning","setRunningY","setRunningN","app","none","setNeedRefreshY","setStatusWait","setNeedRefreshN","setStatusNone","needRefresh","offerId","ID","offer","Application","option","init","initProvider","iniController","subscribeToEvents","subscribeToStoreChanges","orderSaveAllowed","preselectedConsentsIsSubmitted","BasketRestHandler","setStore","setProvider","EventEmitter","subscribe","EventType","order","success","e","handlerOrderSuccess","removeProduct","handlerRemoveProductSuccess","restoreProduct","handlerRestoreProductSuccess","buttonRemoveProduct","Runtime","debounce","handlerRemove","buttonPlusProduct","handlerQuantityPlus","buttonMinusProduct","handlerQuantityMinus","inputChangeQuantityProduct","handlerChangeQuantity","buttonRestoreProduct","handlerRestore","handlerNeedRefreshY","refreshAfter","handlerNeedRefreshN","changeSku","handlerChangeSku","consent","refused","handlerConsentRefused","accepted","handlerConsentAccepted","property","validate","handlerValidateProperty","element","buttonCheckout","handlerCheckout","buttonShipping","handlerShipping","paysystem","beforeInitList","paySystemSetStatusWait","afterInitList","paySystemSetStatusNone","paySystem","config","checked","isAllowOrderSave","disallowOrderSave","items","forEach","emit","ConsentConst","submit","find","required","allowOrderSave","sendEventsForCheckedConsents","firstRequiredUncheckedConsentItem","getFirstRequiredUncheckedConsentItem","appSetStatusWait","saveOrder","appSetStatusNone","url","History","pushState","accountNumber","access","hash","view","UserConsent","saleEntityPaymentPay","orderId","accessCode","saleEntitySaveOrder","siteId","personTypeId","tradingPlatformId","properties","preparePropertyFields","getPropertyList","error","errors","getPropertyItem","changeValidatedProperty","propertyDataValidate","deletePropertyError","addPropertyError","setModelPropertyError","errorIndex","propertyId","splice","errorIds","map","includes","push","list","key","hasOwnProperty","inx"],"mappings":"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"}