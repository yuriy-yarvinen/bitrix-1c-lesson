this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};this.BX.UI.AccessRights=this.BX.UI.AccessRights||{};(function(e,t,s,i,l,r,a,o,n,c,d,u){"use strict";const h={name:"Checkbox",components:{BIcon:o.BIcon},props:{status:{type:String,required:true,validator:e=>["checked","indeterminate","unchecked"].includes(e)}},computed:{set(){return o.Outline},iconName(){return this.status==="checked"?this.set.CHECK_S:this.set.MINUS_S},iconColor(){return this.status==="checked"?"var(--ui-color-bg-content-light)":"var(--ui-color-accent-main-primary)"}},methods:{handleClick(){this.$emit("change")}},template:`\n\t\t<label\n\t\t  class="ui-item-selector__checkbox"\n\t\t  :class="{ \n\t\t    'ui-item-selector__checkbox--active': status === 'checked',\n\t\t    'ui-item-selector__checkbox--indeterminate': status === 'indeterminate'\n\t\t  }"\n\t\t  @click="handleClick"\n\t\t>\n\t\t  <BIcon\n\t\t    v-if="status !== 'unchecked'"\n\t\t    class="ui-item-selector-item__checked-icon"\n\t\t    :name="iconName"\n\t\t    :color="iconColor"\n\t\t    :size="22"\n\t\t  ></BIcon>\n\t\t</label>\n\t`};const b={name:"Item",components:{BIcon:o.BIcon,Checkbox:h},props:{id:{type:String,required:true},title:{type:String,required:true},isSelected:{type:Boolean},isDraggable:{type:Boolean},hint:{type:String,default:null}},directives:{hint:l.hint},methods:{handleClick(e){if(!e.target.closest(".ui-item-selector-item__drag-icon")){this.$emit("update:selected",!this.isSelected)}}},computed:{Outline(){return o.Outline},checkboxStatus(){return this.isSelected?"checked":"unchecked"},itemClasses(){return{"ui-item-selector-item--active":this.isSelected}}},template:`\n\t\t<div\n\t\t\tclass="ui-item-selector-item"\n\t\t\t:class="itemClasses"\n\t\t\t@click="handleClick"\n\t\t\t:data-id="id"\n\t\t\t:data-selected="isSelected"\n\t\t\tv-hint="hint"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tclass="ui-item-selector-item__drag-icon"\n\t\t\t\t:class="isDraggable ? 'ui-item-selector-item__drag_element' : ''"\n\t\t\t\t:name="Outline.DRAG_M"\n\t\t\t\t:color="isSelected ? 'var(--ui-color-accent-main-primary-alt)' : 'var(--ui-color-g-content-grey-2)'"\n\t\t\t\t:style="{ opacity: isDraggable ? '1' : '0' }"\n\t\t\t></BIcon>\n\n\t\t\t<span class="ui-item-selector-item__title" :title="title">\n\t\t\t\t{{ title }}\n\t\t\t</span>\n\n\t\t\t<Checkbox\n\t\t\t\t:status="checkboxStatus"\n\t\t\t/>\n\t\t</div>\n\t`};const m={name:"Selector",components:{Item:b,BIcon:o.BIcon,Checkbox:h,Chip:u.Chip},props:{items:{type:Array,required:true},maxSelected:{type:Number,default:null}},data(){return{localItems:this.items.map((e=>({...e}))),searchQuery:"",sortDirection:null}},computed:{selectedCount(){return this.localItems.filter((e=>e.selected)).length},filteredItems(){let e=[...this.itemsBySearchQuery];if(this.sortDirection){e.sort(((e,t)=>{if(e.selected!==t.selected){return e.selected?-1:1}const s=e.title.localeCompare(t.title);return this.sortDirection==="asc"?s:-s}))}else{e.sort(((e,t)=>{if(e.selected!==t.selected){return e.selected?-1:1}if(!d.Type.isUndefined(e.sort)&&!d.Type.isUndefined(t.sort)){const s=d.Text.toInteger(e.sort)-d.Text.toInteger(t.sort);if(s!==0){return s}}if(this.sortDirection){const s=e.title.localeCompare(t.title);return this.sortDirection==="asc"?s:-s}return 0}))}return e},itemsBySearchQuery(){let e=[...this.localItems];if(this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter((e=>e.title.toLowerCase().includes(t)))}return e},hasActiveItems(){return this.itemsBySearchQuery.some((e=>e.selected))},allItemsActive(){const e=this.itemsBySearchQuery;return e.length>0&&e.every((e=>e.selected))},toggleAllStatus(){return this.allItemsActive?"checked":this.hasActiveItems?"indeterminate":"unchecked"},selectionLimitReached(){return this.selectedCount>=this.maxSelected},Outline(){return o.Outline},ChipDesign(){return u.ChipDesign}},mounted(){this.initDragAndDrop()},methods:{handleItemSelect(e){const t=this.localItems.find((t=>t.id===e));if(t.selected){t.selected=false;return}if(!t.selected&&this.maxSelected!==null&&this.selectionLimitReached){return}t.selected=true},initDragAndDrop(){new r.Draggable({container:this.$refs["items-container"].$el,draggable:".ui-item-selector-item",dragElement:".ui-item-selector-item__drag_element"}).subscribe("end",this.onDragEnd.bind(this))},onDragEnd(){const e=this.getCurrentOrder();this.localItems=this.localItems.map((t=>{const s=e.get(t.id);return s?{...t,sort:s.sort}:t}))},toggleAllItems(){const e=!this.hasActiveItems;this.itemsBySearchQuery.forEach((t=>{t.selected=e}))},toggleSort(){if(this.sortDirection==="asc"){this.sortDirection="desc"}else{this.sortDirection="asc"}},getCurrentOrder(){return new Map([...this.$el.querySelectorAll(".ui-item-selector-item")].map(((e,t)=>[e.dataset.id,{id:e.dataset.id,sort:t+1,selected:e.dataset.selected==="true"}])))},getOrder(){this.searchQuery="";this.filteredItems.forEach(((e,t)=>{e.sort=t}));return this.filteredItems}},template:`\n\t\t<div class="ui-item-selector">\n\t\t\t<div class="ui-item-selector-controls">\n\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-w100">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tclass="ui-ctl-element ui-ctl-textbox ui-item-selector-search__input"\n\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('JS_UI_ITEM_SELECTOR_SEARCH_PLACEHOLDER')"\n\t\t\t\t\t\tv-model="searchQuery"\n\t\t\t\t\t>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tclass="ui-item-selector-search-icon"\n\t\t\t\t\t\t:name="Outline.SEARCH"\n\t\t\t\t\t\t:size="20"\n\t\t\t\t\t\tcolor="var(--ui-color-base-4)"\n\t\t\t\t\t></BIcon>\n\t\t\t\t</div>\n\n\t\t\t\t<Chip\n\t\t\t\t\t:icon="sortDirection === 'asc' ? Outline.LETTER_SORT_DOWN : Outline.LETTER_SORT_UP"\n\t\t\t\t\t:design="sortDirection ? ChipDesign.OutlineAccent : ChipDesign.Outline"\n\t\t\t\t\t@click="toggleSort"\n\t\t\t\t/>\n\n\t\t\t\t<Checkbox\n\t\t\t\t\t:status="toggleAllStatus"\n\t\t\t\t\t@change="toggleAllItems"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<TransitionGroup tag="div" name="ui-item-selector-items" class="ui-item-selector-items" ref="items-container">\n\t\t\t\t<Item\n\t\t\t\t\tv-for="(item) in filteredItems"\n\t\t\t\t\t:key="item.id"\n\t\t\t\t\t:id="item.id"\n\t\t\t\t\t:title="item.title"\n\t\t\t\t\t:isSelected="item.selected"\n\t\t\t\t\t:isDraggable="!this.searchQuery"\n\t\t\t\t\t@update:selected="handleItemSelect(item.id)"\n\t\t\t\t/>\n\t\t\t</TransitionGroup>\n\t\t</div>\n\t`};let p=e=>e,v,B;var g=babelHelpers.classPrivateFieldLooseKey("targetNode");var y=babelHelpers.classPrivateFieldLooseKey("content");var P=babelHelpers.classPrivateFieldLooseKey("items");var L=babelHelpers.classPrivateFieldLooseKey("app");var f=babelHelpers.classPrivateFieldLooseKey("title");var H=babelHelpers.classPrivateFieldLooseKey("subtitle");var I=babelHelpers.classPrivateFieldLooseKey("events");var S=babelHelpers.classPrivateFieldLooseKey("maxSelected");var F=babelHelpers.classPrivateFieldLooseKey("popup");var C=babelHelpers.classPrivateFieldLooseKey("rootComponent");var O=babelHelpers.classPrivateFieldLooseKey("getPopup");var D=babelHelpers.classPrivateFieldLooseKey("createSelector");var _=babelHelpers.classPrivateFieldLooseKey("getContent");var k=babelHelpers.classPrivateFieldLooseKey("save");var A=babelHelpers.classPrivateFieldLooseKey("getHeader");class x{constructor(e){Object.defineProperty(this,A,{value:R});Object.defineProperty(this,k,{value:X});Object.defineProperty(this,_,{value:T});Object.defineProperty(this,D,{value:w});Object.defineProperty(this,O,{value:E});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,S,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:void 0});if(!d.Type.isDomNode(e.targetNode)){throw new Error("Target DOM node not found")}babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e.targetNode;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e.items;babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e.title;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=e.subtitle;babelHelpers.classPrivateFieldLooseBase(this,I)[I]=e.events;babelHelpers.classPrivateFieldLooseBase(this,S)[S]=d.Type.isInteger(e.maxSelected)?e.maxSelected:null}show(){babelHelpers.classPrivateFieldLooseBase(this,O)[O]().show();babelHelpers.classPrivateFieldLooseBase(this,D)[D]()}hide(){if(babelHelpers.classPrivateFieldLooseBase(this,L)[L]){babelHelpers.classPrivateFieldLooseBase(this,L)[L].unmount();babelHelpers.classPrivateFieldLooseBase(this,L)[L]=null}if(babelHelpers.classPrivateFieldLooseBase(this,I)[I].onHide){babelHelpers.classPrivateFieldLooseBase(this,I)[I].onHide()}babelHelpers.classPrivateFieldLooseBase(this,F)[F].destroy()}getSelectedItems(){var e;return(e=this.getCurrentOrder().filter((e=>e.selected)))!=null?e:[]}getCurrentOrder(){if(!babelHelpers.classPrivateFieldLooseBase(this,C)[C]){return[]}const e=[...babelHelpers.classPrivateFieldLooseBase(this,C)[C].getOrder().values()];e.sort(((e,t)=>{var s,i;const l=(s=e.sort)!=null?s:Infinity;const r=(i=t.sort)!=null?i:Infinity;return l-r}));return e}}function E(){if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]){return babelHelpers.classPrivateFieldLooseBase(this,F)[F]}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=new t.Popup({width:409,fixed:true,autoHide:true,closeByEsc:true,contentPadding:0,padding:24,className:"ui-item-selector-popup",bindElement:babelHelpers.classPrivateFieldLooseBase(this,g)[g],titleBar:{content:babelHelpers.classPrivateFieldLooseBase(this,A)[A]()},content:babelHelpers.classPrivateFieldLooseBase(this,_)[_](),buttons:[new s.SaveButton({onclick:babelHelpers.classPrivateFieldLooseBase(this,k)[k].bind(this),size:s.ButtonSize.LARGE,style:s.AirButtonStyle.FILLED,useAirDesign:true}),new s.CancelButton({onclick:this.hide.bind(this),size:s.ButtonSize.LARGE,style:s.AirButtonStyle.OUTLINE,useAirDesign:true})],events:{onClose:this.hide.bind(this)}});return babelHelpers.classPrivateFieldLooseBase(this,F)[F]}function w(){const e={items:babelHelpers.classPrivateFieldLooseBase(this,P)[P],maxSelected:babelHelpers.classPrivateFieldLooseBase(this,S)[S]};babelHelpers.classPrivateFieldLooseBase(this,L)[L]=i.BitrixVue.createApp(m,e);babelHelpers.classPrivateFieldLooseBase(this,C)[C]=babelHelpers.classPrivateFieldLooseBase(this,L)[L].mount(babelHelpers.classPrivateFieldLooseBase(this,_)[_]())}function T(){if(!babelHelpers.classPrivateFieldLooseBase(this,y)[y]){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=d.Tag.render(v||(v=p`
				<div class="ui-item-selector-content"></div>
			`))}return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}function X(){if(babelHelpers.classPrivateFieldLooseBase(this,I)[I].onSave){babelHelpers.classPrivateFieldLooseBase(this,I)[I].onSave()}this.hide()}function R(){return d.Tag.render(B||(B=p`
			<div class="ui-item-selector-header">
				<div class="ui-item-selector-header-title">${0}</div>
				<div class="ui-item-selector-header-subtitle">${0}</div>
			</div>
		`),d.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,f)[f]),d.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,H)[H]))}e.ItemListSelector=x})(this.BX.UI.AccessRights.V2=this.BX.UI.AccessRights.V2||{},BX.Main,BX.UI,BX.Vue3,BX.Vue3.Directives,BX.UI.DragAndDrop,BX,BX.UI.IconSet,BX,BX,BX,BX.UI.System.Chip.Vue);
//# sourceMappingURL=item-list-selector.bundle.map.js