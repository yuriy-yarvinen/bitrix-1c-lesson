this.BX=this.BX||{};this.BX.Landing=this.BX.Landing||{};this.BX.Landing.Ui=this.BX.Landing.Ui||{};this.BX.Landing.Ui.Panel=this.BX.Landing.Ui.Panel||{};this.BX.Landing.Ui.Panel.Formsettingspanel=this.BX.Landing.Ui.Panel.Formsettingspanel||{};(function(e,t,a,n,i,s,r,o,c,h){"use strict";var g="yandex";var u="google";var l=new Set(["ru","by","kz","uz"]);function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){babelHelpers.defineProperty(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var _=function(e){babelHelpers.inherits(t,e);function t(e){var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));a.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.Content.SpamProtection.KeysForm");r.Dom.addClass(a.layout,"landing-ui-form-form-keys-settings");a.getButton().renderTo(a.layout);a.value={};return a}babelHelpers.createClass(t,[{key:"getButton",value:function e(){var t=this;return this.cache.remember("button",(function(){return new o.Button({text:t.options.buttonLabel,color:o.ButtonColor.LIGHT_BORDER,onclick:function e(){t.getButton().setWaiting(true);r.Runtime.loadExtension("crm.form.captcha").then((function(e){var a=e.Captcha;t.getButton().setWaiting(false);return a.open(t.options.type)})).then((function(e){t.value=d({},e);var a=c.FormSettingsPanel.getInstance();if(t.options.type===g){a.getFormDictionary().captcha.yandexCaptcha.hasKeys=r.Type.isStringFilled(e.key)&&r.Type.isStringFilled(e.secret)}else{a.getFormDictionary().captcha.recaptcha.hasKeys=r.Type.isStringFilled(e.key)&&r.Type.isStringFilled(e.secret)}var n=a.getSidebarButtons().find((function(e){return e.isActive()}));if(n){n.getLayout().click()}t.emit("onChange")}))}})}))}},{key:"serialize",value:function e(){return this.value}}]);return t}(s.FormSettingsForm);function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){babelHelpers.defineProperty(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var O=function(e){babelHelpers.inherits(i,e);function i(e){var n;babelHelpers.classCallCheck(this,i);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.SpamProtection");var s=new t.HeaderCard({title:a.Loc.getMessage("LANDING_SPAM_PROTECTION_TITLE")});var r=new h.MessageCard({header:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_MESSAGE_TITLE"),description:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_MESSAGE_TEXT"),angle:false});if(l.has(e.dictionary.region)){var o=u;if(n.options.formOptions.captcha.service===u||n.options.formOptions.captcha.service===""&&n.options.formOptions.captcha.recaptcha.use===true){o=u}else if(e.dictionary.region==="ru"||n.options.formOptions.captcha.service===g){o=g}var c=n.getServiceForm(false,o);n.addItem(s);n.addItem(r);n.addItem(c);c.subscribe("onChange",n.onCaptchaServiceChange.bind(babelHelpers.assertThisInitialized(n)));n.onCaptchaServiceChange();return babelHelpers.possibleConstructorReturn(n)}var p=n.getServiceForm(true,u);var d=n.getRecaptchaForm();n.addItem(p);n.addItem(d);d.subscribe("onChange",n.onRecaptchaTypeChange.bind(babelHelpers.assertThisInitialized(n)));n.onRecaptchaTypeChange();return n}babelHelpers.createClass(i,[{key:"getServiceForm",value:function e(t,n){return new s.FormSettingsForm({id:"service",description:null,hidden:t,fields:[new BX.Landing.UI.Field.Dropdown({selector:"service",title:a.Loc.getMessage("LANDING_SPAM_PROTECTION_SERVICE_TITLE"),items:[{name:a.Loc.getMessage("LANDING_SPAM_PROTECTION_SERVICE_OPTION_YANDEX"),value:g},{name:a.Loc.getMessage("LANDING_SPAM_PROTECTION_SERVICE_OPTION_GOOGLE"),value:u}],content:n})]})}},{key:"onCaptchaServiceChange",value:function e(){var t=this.getRecaptchaForm();var a=this.getYandexCaptchaForm();var n=this.getForeignServiceWarningForm();r.Dom.remove(t.getLayout());r.Dom.remove(a.getLayout());r.Dom.remove(n.getLayout());if(this.getValue().captcha.service===u){a.unsubscribe("onChange",this.onYandexTypeChange.bind(this));this.onYandexTypeChange();this.addForeignServiceWarningForm(n,u);this.addItem(t);t.subscribe("onChange",this.onRecaptchaTypeChange.bind(this));this.onRecaptchaTypeChange()}else{t.unsubscribe("onChange",this.onRecaptchaTypeChange.bind(this));this.onRecaptchaTypeChange();this.addForeignServiceWarningForm(n,g);this.addItem(a);a.subscribe("onChange",this.onYandexTypeChange.bind(this));this.onYandexTypeChange()}}},{key:"addForeignServiceWarningForm",value:function e(t,a){if(this.options.dictionary.region==="by"||this.options.dictionary.region==="ru"&&a===u){this.addItem(t)}}},{key:"getForeignServiceWarningForm",value:function e(){return this.cache.remember("foreignServiceWarning",(function(){return new s.FormSettingsForm({id:"foreignServiceWarning",description:null,fields:[new h.MessageCard({selector:"warningForeign",context:"warning",description:a.Loc.getMessage("LANDING_SPAM_PROTECTION_MESSAGE_WARNING_FOREIGN"),angle:false,closeable:false})]})}))}},{key:"getRecaptchaForm",value:function e(){var t=this;return this.cache.remember("recaptchaForm",(function(){return new s.FormSettingsForm({id:"type",description:null,fields:[new h.MessageCard({selector:"warningCaptcha",context:"warning",description:a.Loc.getMessage("LANDING_SPAM_PROTECTION_MESSAGE_WARNING_RECAPTCHA").replace("#URL_POLICIES_PRIVACY#","https://policies.google.com/privacy").replace("#URL_POLICIES_TERMS#","https://policies.google.com/terms"),angle:false,closeable:false}),new n.RadioButtonField({selector:"recaptchaUse",title:a.Loc.getMessage("LANDING_SPAM_PROTECTION_TABS_TITLE"),value:r.Text.toBoolean(t.options.formOptions.captcha.recaptcha.use)?"hidden":"disabled",items:[{id:"disabled",title:a.Loc.getMessage("LANDING_SPAM_PROTECTION_TAB_DISABLED"),icon:"landing-ui-spam-protection-icon-disabled"},{id:"hidden",title:a.Loc.getMessage("LANDING_SPAM_PROTECTION_TAB_HIDDEN"),icon:"landing-ui-spam-protection-icon-hidden"}]})]})}))}},{key:"getYandexCaptchaForm",value:function e(){var t=this;return this.cache.remember("yandexCaptchaForm",(function(){return new s.FormSettingsForm({id:"yandexType",description:null,fields:[new n.RadioButtonField({selector:"yandexUse",title:a.Loc.getMessage("LANDING_SPAM_PROTECTION_TABS_TITLE_YANDEX"),value:r.Text.toBoolean(t.options.formOptions.captcha.yandexCaptcha.use)?"hidden":"disabled",items:[{id:"disabled",title:a.Loc.getMessage("LANDING_SPAM_PROTECTION_TAB_DISABLED"),icon:"landing-ui-spam-protection-icon-disabled"},{id:"hidden",title:a.Loc.getMessage("LANDING_SPAM_PROTECTION_TAB_HIDDEN"),icon:"landing-ui-spam-protection-icon-hidden"}]})]})}))}},{key:"hasDefaultYandexKeys",value:function e(){return r.Text.toBoolean(this.options.formOptions.captcha.yandexCaptcha.hasDefaults)}},{key:"hasCustomYandexKeys",value:function e(){return r.Text.toBoolean(this.options.dictionary.captcha.yandexCaptcha.hasKeys)}},{key:"onYandexTypeChange",value:function e(){r.Dom.remove(this.getYandexKeysSettingsForm().getLayout());r.Dom.remove(this.getYandexRequiredKeysForm().getLayout());if(this.getValue().captcha.service===g&&this.getValue().captcha.yandexCaptcha.use){if(!this.hasDefaultYandexKeys()&&!this.hasCustomYandexKeys()){this.addItem(this.getYandexRequiredKeysForm())}else if(this.hasCustomYandexKeys()){this.addItem(this.getYandexKeysSettingsForm())}else if(this.hasDefaultYandexKeys()&&!this.hasCustomYandexKeys()){this.addItem(this.getYandexCustomKeysForm())}}}},{key:"getYandexCustomKeysForm",value:function e(){return this.cache.remember("yandexCustomKeysForm",(function(){return new _({title:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_YANDEX_KEYS_FORM_TITLE"),buttonLabel:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_CUSTOM_BUTTON_LABEL"),type:g})}))}},{key:"getYandexRequiredKeysForm",value:function e(){return this.cache.remember("yandexRequiredKeysForm",(function(){return new _({title:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_YANDEX_KEYS_FORM_TITLE"),buttonLabel:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_BUTTON_LABEL"),description:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_YANDEX_KEYS_FORM_REQUIRED_DESCRIPTION"),type:g})}))}},{key:"getYandexKeysSettingsForm",value:function e(){return this.cache.remember("yandexCustomKeysForm",(function(){return new _({title:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_YANDEX_KEYS_FORM_TITLE"),buttonLabel:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_CHANGE_BUTTON_LABEL"),type:g})}))}},{key:"hasDefaultRecaptchaKeys",value:function e(){return r.Text.toBoolean(this.options.formOptions.captcha.recaptcha.hasDefaults)}},{key:"hasRecaptchaCustomKeys",value:function e(){return r.Text.toBoolean(this.options.dictionary.captcha.recaptcha.hasKeys)}},{key:"onRecaptchaTypeChange",value:function e(){r.Dom.remove(this.getRecaptchaCustomKeysForm().getLayout());r.Dom.remove(this.getRecaptchaRequiredKeysForm().getLayout());r.Dom.remove(this.getRecaptchaKeysSettingsForm().getLayout());if((this.getValue().captcha.service===u||!this.getValue().captcha.service)&&this.getValue().captcha.recaptcha.use){if(!this.hasDefaultRecaptchaKeys()&&!this.hasRecaptchaCustomKeys()){this.addItem(this.getRecaptchaRequiredKeysForm())}else if(this.hasRecaptchaCustomKeys()){this.addItem(this.getRecaptchaKeysSettingsForm())}else if(this.hasDefaultRecaptchaKeys()&&!this.hasRecaptchaCustomKeys()){this.addItem(this.getRecaptchaCustomKeysForm())}}}},{key:"getRecaptchaCustomKeysForm",value:function e(){return this.cache.remember("customKeysForm",(function(){return new _({title:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_TITLE"),buttonLabel:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_CUSTOM_BUTTON_LABEL"),type:u})}))}},{key:"getRecaptchaRequiredKeysForm",value:function e(){return this.cache.remember("requiredKeysForm",(function(){return new _({title:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_TITLE"),buttonLabel:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_BUTTON_LABEL"),description:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_REQUIRED_DESCRIPTION"),type:u})}))}},{key:"getRecaptchaKeysSettingsForm",value:function e(){return this.cache.remember("keysSettingsForm",(function(){return new _({title:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_TITLE"),buttonLabel:a.Loc.getMessage("LANDING_FORM_EDITOR_FORM_CAPTCHA_KEYS_FORM_CHANGE_BUTTON_LABEL"),type:u})}))}},{key:"valueReducer",value:function e(t){return{captcha:{service:t.service,recaptcha:y(y(y({use:t.recaptchaUse?t.recaptchaUse==="hidden":this.options.formOptions.captcha.recaptcha.use},this.getRecaptchaKeysSettingsForm().serialize()),this.getRecaptchaCustomKeysForm().serialize()),this.getRecaptchaRequiredKeysForm().serialize()),yandexCaptcha:y(y({use:t.yandexUse?t.yandexUse==="hidden":this.options.formOptions.captcha.yandexCaptcha.use},this.getYandexRequiredKeysForm().serialize()),this.getYandexKeysSettingsForm().serialize())}}}},{key:"onChange",value:function e(t){this.emit("onChange",y(y({},t.getData()),{},{skipPrepare:true}))}}]);return i}(i.ContentWrapper);e.default=O})(this.BX.Landing.Ui.Panel.Formsettingspanel.Content=this.BX.Landing.Ui.Panel.Formsettingspanel.Content||{},BX.Landing.UI.Card,BX.Landing,BX.Landing.UI.Field,BX.Landing.UI.Panel,BX.Landing.UI.Form,BX,BX.UI,BX.Landing.UI.Panel,BX.Landing.UI.Card);
//# sourceMappingURL=spam-protection.bundle.map.js